

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="robots" content="noodp" />
    <title>Mars Stealer: Oski refactoring - 3xp0rt</title><meta name="Description" content="Analysing of Mars Stealer"><meta property="og:title" content="Mars Stealer: Oski refactoring" />
<meta property="og:description" content="Analysing of Mars Stealer" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://3xp0rt.com/posts/mars-stealer/" /><meta property="og:image" content="https://3xp0rt.com"/><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2022-02-01T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-03-19T00:00:00+00:00" /><meta property="og:site_name" content="3xp0rt" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://3xp0rt.com"/>

<meta name="twitter:title" content="Mars Stealer: Oski refactoring"/>
<meta name="twitter:description" content="Analysing of Mars Stealer"/>
<meta name="application-name" content="3xp0rt">
<meta name="apple-mobile-web-app-title" content="3xp0rt">

<meta name="theme-color" content="#f8f8f8"><meta name="msapplication-TileColor" content="#da532c"><link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" />
        <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png"><link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png"><link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5"><link rel="canonical" href="https://3xp0rt.com/posts/mars-stealer/" />
<link rel="stylesheet" href="/css/main.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/normalize.css@8.0.1/normalize.min.css"><link rel="stylesheet" href="/css/color.css"><link rel="stylesheet" href="/css/style.min.css"><script src="/cdn-cgi/scripts/7d0fa10a/cloudflare-static/rocket-loader.min.js" data-cf-settings="155e0f9bcee2c407ab269f22-|49"></script><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css"></noscript><script src="/cdn-cgi/scripts/7d0fa10a/cloudflare-static/rocket-loader.min.js" data-cf-settings="155e0f9bcee2c407ab269f22-|49"></script><link rel="preload" as="style" onload="this.onload=null;this.rel='stylesheet'" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css">
        <noscript><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@4.1.1/animate.min.css"></noscript><script type="application/ld+json">
    {
        "@context": "http://schema.org",
        "@type": "BlogPosting",
        "headline": "Mars Stealer: Oski refactoring",
        "inLanguage": "en",
        "mainEntityOfPage": {
            "@type": "WebPage",
            "@id": "https:\/\/3xp0rt.com\/posts\/mars-stealer\/"
        },"image": ["https:\/\/3xp0rt.com\/images\/Apple-Devices-Preview.png"],"genre": "posts","keywords": "stealer, malware analysis, reverse engineering","wordcount":  1529 ,
        "url": "https:\/\/3xp0rt.com\/posts\/mars-stealer\/","datePublished": "2022-02-01T00:00:00+00:00","dateModified": "2023-03-19T00:00:00+00:00","publisher": {
            "@type": "Organization",
            "name": "xxxx","logo": "https:\/\/3xp0rt.com\/images\/avatar.png"},"author": {
                "@type": "Person",
                "name": "3xp0rt"
            },"description": "Analysing of Mars Stealer"
    }
    </script><script src="//instant.page/5.2.0" defer type="155e0f9bcee2c407ab269f22-module" integrity="sha384-jnZyxPjiipYXnSU0ygqeac2q7CVYMbh84q0uHVRRxEtvFPiQYbXWUorga2aqZJ0z"></script>
</head>

<body header-desktop="" header-mobile=""><script type="155e0f9bcee2c407ab269f22-text/javascript">
        function setTheme(theme) {document.body.setAttribute('theme', theme); document.documentElement.style.setProperty('color-scheme', theme === 'light' ? 'light' : 'dark'); window.theme = theme;   window.isDark = window.theme !== 'light' }
        function saveTheme(theme) {window.localStorage && localStorage.setItem('theme', theme);}
        function getMeta(metaName) {const metas = document.getElementsByTagName('meta'); for (let i = 0; i < metas.length; i++) if (metas[i].getAttribute('name') === metaName) return metas[i]; return '';}
        if (window.localStorage && localStorage.getItem('theme')) {let theme = localStorage.getItem('theme');theme === 'light' || theme === 'dark' || theme === 'black' ? setTheme(theme) : (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light')); } else { if ('auto' === 'light' || 'auto' === 'dark' || 'auto' === 'black') setTheme('auto'), saveTheme('auto'); else saveTheme('auto'), window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches ? setTheme('dark') : setTheme('light');}
        let metaColors = {'light': '#f8f8f8','dark': '#252627','black': '#000000'}
        getMeta('theme-color').content = metaColors[document.body.getAttribute('theme')];
        window.switchThemeEventSet = new Set()
    </script>
    <div id="back-to-top"></div>
    <div id="mask"></div><div class="wrapper"><header class="desktop" id="header-desktop">
    <div class="header-wrapper">
        <div class="header-title">
            <a href="/" title="3xp0rt">3xp0rt</a>
        </div>
        <div class="menu">
            <div class="menu-inner"><a class="menu-item" href="/posts/"> Posts </a><a class="menu-item" href="/tags/"> Tags </a><a class="menu-item" href="/categories/"> Categories </a><span class="menu-item delimiter"></span><span class="menu-item search" id="search-desktop">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-desktop">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-desktop" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-desktop" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-desktop">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </span><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                    <i class="fas fa-adjust fa-fw"></i>
                </a></div>
        </div>
    </div>
</header><header class="mobile" id="header-mobile">
    <div class="header-container">
        <div class="header-wrapper">
            <div class="header-title">
                <a href="/" title="3xp0rt">3xp0rt</a>
            </div>
            <div class="menu-toggle" id="menu-toggle-mobile">
                <span></span><span></span><span></span>
            </div>
        </div>
        <div class="menu" id="menu-mobile"><div class="search-wrapper">
                    <div class="search mobile" id="search-mobile">
                        <input type="text" placeholder="Search titles or contents..." id="search-input-mobile">
                        <a href="javascript:void(0);" class="search-button search-toggle" id="search-toggle-mobile" title="Search">
                            <i class="fas fa-search fa-fw"></i>
                        </a>
                        <a href="javascript:void(0);" class="search-button search-clear" id="search-clear-mobile" title="Clear">
                            <i class="fas fa-times-circle fa-fw"></i>
                        </a>
                        <span class="search-button search-loading" id="search-loading-mobile">
                            <i class="fas fa-spinner fa-fw fa-spin"></i>
                        </span>
                    </div>
                    <a href="javascript:void(0);" class="search-cancel" id="search-cancel-mobile">
                        Cancel
                    </a>
                </div><a class="menu-item" href="/posts/" title="">Posts</a><a class="menu-item" href="/tags/" title="">Tags</a><a class="menu-item" href="/categories/" title="">Categories</a><a href="javascript:void(0);" class="menu-item theme-switch" title="Switch Theme">
                <i class="fas fa-adjust fa-fw"></i>
            </a></div>
    </div>
</header>
<div class="search-dropdown desktop">
    <div id="search-dropdown-desktop"></div>
</div>
<div class="search-dropdown mobile">
    <div id="search-dropdown-mobile"></div>
</div>
<main class="main">
            <div class="container"><div class="toc" id="toc-auto">
        <h2 class="toc-title">Contents</h2>
        <div class="toc-content" id="toc-content-auto"><nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#technical-overview">Technical overview</a></li>
    <li><a href="#obfuscation--techniques">Obfuscation  techniques</a>
      <ul>
        <li><a href="#strings-encryption">Strings encryption</a></li>
      </ul>
    </li>
    <li><a href="#anti-analysis-techniques">Anti-analysis techniques</a>
      <ul>
        <li><a href="#run-time-dynamic-linking">Run-Time Dynamic Linking</a></li>
        <li><a href="#timing-based-anti-debug">Timing-based anti-debug</a></li>
        <li><a href="#anti-emulation">Anti-emulation</a></li>
      </ul>
    </li>
    <li><a href="#security-checks">Security checks</a>
      <ul>
        <li><a href="#anti-cis">Anti-CIS</a></li>
        <li><a href="#mutex">Mutex</a></li>
        <li><a href="#expiration-check">Expiration check</a></li>
      </ul>
    </li>
    <li><a href="#external-dlls">External DLLs</a></li>
    <li><a href="#stealing-functional">Stealing functional</a>
      <ul>
        <li><a href="#browsers">Browsers</a></li>
        <li><a href="#2facrypto-extensions">2FA/crypto extensions</a></li>
        <li><a href="#wallets">Wallets</a></li>
      </ul>
    </li>
    <li><a href="#grabber">Grabber</a></li>
    <li><a href="#loader">Loader</a></li>
    <li><a href="#self-removal">Self-removal</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
    <li><a href="#iocs">IOCs</a></li>
  </ul>
</nav></div>
    </div><script type="155e0f9bcee2c407ab269f22-text/javascript">document.getElementsByTagName("main")[0].setAttribute("autoTOC", "true")</script><article class="page single"><h1 class="single-title animate__animated animate__flipInX">Mars Stealer: Oski refactoring</h1><div class="post-meta">
            <div class="post-meta-line">
                <span class="post-author"><span class="author fas fa-user-circle fa-fw"></span><a href="https://3xp0rt.com" title="Author" target="_blank" rel="noopener noreferrer author" class="author">3xp0rt</a>
                </span>&nbsp;<span class="post-category">included in </span>&nbsp;<span class="post-category">category <a href="/categories/malware-analysis/"><i class="far fa-folder fa-fw"></i>Malware analysis</a></span></div>
            <div class="post-meta-line"><i class="far fa-calendar-alt fa-fw"></i>&nbsp;<time datetime="2022-02-01">2022-02-01</time>&nbsp;<i class="far fa-edit fa-fw"></i>&nbsp;<time datetime="2023-03-19">2023-03-19</time>&nbsp;<i class="fas fa-pencil-alt fa-fw"></i>&nbsp;1529 words&nbsp;<i class="far fa-clock fa-fw"></i>&nbsp;8 minutes&nbsp;</div>
        </div><div class="details toc" id="toc-static"  kept="">
                <div class="details-summary toc-title">
                    <span>Contents</span>
                    <span><i class="details-icon fas fa-angle-right"></i></span>
                </div>
                <div class="details-content toc-content" id="toc-content-static"><nav id="TableOfContents">
  <ul>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#technical-overview">Technical overview</a></li>
    <li><a href="#obfuscation--techniques">Obfuscation  techniques</a>
      <ul>
        <li><a href="#strings-encryption">Strings encryption</a></li>
      </ul>
    </li>
    <li><a href="#anti-analysis-techniques">Anti-analysis techniques</a>
      <ul>
        <li><a href="#run-time-dynamic-linking">Run-Time Dynamic Linking</a></li>
        <li><a href="#timing-based-anti-debug">Timing-based anti-debug</a></li>
        <li><a href="#anti-emulation">Anti-emulation</a></li>
      </ul>
    </li>
    <li><a href="#security-checks">Security checks</a>
      <ul>
        <li><a href="#anti-cis">Anti-CIS</a></li>
        <li><a href="#mutex">Mutex</a></li>
        <li><a href="#expiration-check">Expiration check</a></li>
      </ul>
    </li>
    <li><a href="#external-dlls">External DLLs</a></li>
    <li><a href="#stealing-functional">Stealing functional</a>
      <ul>
        <li><a href="#browsers">Browsers</a></li>
        <li><a href="#2facrypto-extensions">2FA/crypto extensions</a></li>
        <li><a href="#wallets">Wallets</a></li>
      </ul>
    </li>
    <li><a href="#grabber">Grabber</a></li>
    <li><a href="#loader">Loader</a></li>
    <li><a href="#self-removal">Self-removal</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
    <li><a href="#iocs">IOCs</a></li>
  </ul>
</nav></div>
            </div><div class="content" id="content"><p>Analysis of a new malware called Mars Stealer, which is a further development of Oski Stealer.</p>
<h2 id="introduction" class="headerLink">
    <a href="#introduction" class="header-mark"></a>Introduction</h2><p>It has been noticed that Oski support stopped answering its customers and deleted its telegram account and bot around July 2, 2020. This disappearance has raised eyebrows, as major projects like KPOT Stealer and Predator The Thief don&rsquo;t usually just go away.</p>
<p>Recently, I came across a sample of Mars Stealer, which appears to be an upgraded version of Oski Stealer. Since Mars Stealer is gaining popularity, I have decided to write a technical analysis about this stealer. Enjoy reading!</p>
<h2 id="technical-overview" class="headerLink">
    <a href="#technical-overview" class="header-mark"></a>Technical overview</h2><p>Mars Stealer written in ASM/C with using WinApi, weight is 95 kb. Uses special techniques to hide WinApi calls, encrypts strings, collects information in the memory, supports secured SSL-connection with C&amp;C, doesn&rsquo;t use CRT, STD.</p>
<p>Browsers (supports Chrome V80):</p>
<ul>
<li>Internet Explorer, Microsoft Edge (Chromium Version), Kometa, Amigo, Torch, Orbitium, Comodo Dragon, Nichrome, Maxxthon5, Maxxthon6, Sputnik Browser, Epic Privacy Browser, Vivaldi, CocCoc, Uran Browser, QIP Surf, Cent Browser, Elements Browser, TorBro Browser, CryptoTab Browser, Brave, Opera Stable, Opera GX, Opera Neon, Firefox, SlimBrowser, PaleMoon, Waterfox, CyberFox, BlackHawk, IceCat, K-Meleon, Thunderbird.</li>
</ul>
<p>Crypto extensions:</p>
<ul>
<li>TronLink, MetaMask, Binance Chain Wallet, Yoroi, Nifty Wallet, Math Wallet, Coinbase Wallet, Guarda, EQUAL Wallet, Jaox Liberty, BitAppWllet, iWallet, Wombat, MEW CX, Guild Wallet, Saturn Wallet, Ronin Wallet, Neoline, Clover Wallet, Liquality Wallet, Terra Station, Keplr, Sollet, Auro Wallet, Polymesh Wallet, ICONex, Nabox Wallet, KHC, Temple, TezBox Cyano Wallet, Byone, OneKey, Leaf Wallet, DAppPlay, BitClip, Steem Keychain, Nash Extension, Hycon Lite Client, ZilPay, Coin98 Wallet.</li>
</ul>
<p>2FA plugins:</p>
<ul>
<li>Authenticator, Authy, EOS Authenticator, GAuth Authenticator, Trezor Password Manager.</li>
</ul>
<p>Crypto wallets:</p>
<ul>
<li>Bitcoin Core and all derivatives (Dogecoin, Zcash, DashCore, LiteCoin, etc), Ethereum, Electrum, Electrum LTC, Exodus, Electron Cash, MultiDoge, JAXX, Atomic, Binance, Coinomi.</li>
</ul>
<p>Computer information:</p>
<ul>
<li>IP and country</li>
<li>Working path to EXE file</li>
<li>Local time and time zone</li>
<li>Language system</li>
<li>Language keyboard layout</li>
<li>Notebook or desktop</li>
<li>Processor model</li>
<li>Computer name</li>
<li>User name</li>
<li>Domain computer name</li>
<li>Machine ID</li>
<li>GUID</li>
<li>Installed software and their versions</li>
</ul>
<p>Additional functional:</p>
<ul>
<li>Files grabber</li>
<li>Loader</li>
</ul>
<p><figure><a class="lightgallery" href="/posts/mars-stealer/forum.png" title="/posts/mars-stealer/forum.png" data-thumbnail="/posts/mars-stealer/forum.png">
        <img
            
            loading="lazy"
            src="/posts/mars-stealer/forum.png"
            srcset="/posts/mars-stealer/forum.png, /posts/mars-stealer/forum.png 1.5x, /posts/mars-stealer/forum.png 2x"
            sizes="auto"
            alt="/posts/mars-stealer/forum.png" height="903"  width="960" >
    </a></figure></p>
<h2 id="obfuscation--techniques" class="headerLink">
    <a href="#obfuscation--techniques" class="header-mark"></a>Obfuscation  techniques</h2><h3 id="strings-encryption" class="headerLink">
    <a href="#strings-encryption" class="header-mark"></a>Strings encryption</h3><p>Most strings are encrypted using combinations of RC4 and Base64. The decryption key of RC4 is stored in the <code>decrypt_key</code> variable that was declared in the Run-Time Dynamic Linking function. In this case, the decryption key is <code>86223203794583053453</code>.</p>
<p><figure><a class="lightgallery" href="/posts/mars-stealer/decrypt_string.png" title="/posts/mars-stealer/decrypt_string.png" data-thumbnail="/posts/mars-stealer/decrypt_string.png">
        <img
            
            loading="lazy"
            src="/posts/mars-stealer/decrypt_string.png"
            srcset="/posts/mars-stealer/decrypt_string.png, /posts/mars-stealer/decrypt_string.png 1.5x, /posts/mars-stealer/decrypt_string.png 2x"
            sizes="auto"
            alt="/posts/mars-stealer/decrypt_string.png" height="293"  width="440" >
    </a></figure></p>
<h2 id="anti-analysis-techniques" class="headerLink">
    <a href="#anti-analysis-techniques" class="header-mark"></a>Anti-analysis techniques</h2><h3 id="run-time-dynamic-linking" class="headerLink">
    <a href="#run-time-dynamic-linking" class="header-mark"></a>Run-Time Dynamic Linking</h3><p>The first called function from <code>WinMain</code> declares decryption key for encrypted strings and unencrypted strings, which contain names of WinApi functions for Run-Time Dynamic Linking.</p>
<p><figure><a class="lightgallery" href="/posts/mars-stealer/strings_start.png" title="/posts/mars-stealer/strings_start.png" data-thumbnail="/posts/mars-stealer/strings_start.png">
        <img
            
            loading="lazy"
            src="/posts/mars-stealer/strings_start.png"
            srcset="/posts/mars-stealer/strings_start.png, /posts/mars-stealer/strings_start.png 1.5x, /posts/mars-stealer/strings_start.png 2x"
            sizes="auto"
            alt="/posts/mars-stealer/strings_start.png" height="309"  width="411" >
    </a></figure></p>
<p>Mars gets a module handle of kernel32.dll by parsing <code>InLoadOrderModuleList</code> which usually contains kernel32 library as its 3rd element (0x18 address). After obtaining the base address of kernel32.dll, it parses the PE file and loops over the exported functions of the DLL to get the address of the <code>LoadLibaryA()</code> and <code>GetProcAddress()</code> functions.</p>
<p>After procedures with kernel32 functions, <code>LoadLibraryA()</code> loads <code>advapi32.dll</code> library and gets the address of the <code>GetUserNameA()</code> for anti-emulation check. The same thing program does with <code>crypt32.dll</code> and gets the address of <code>CryptStringToBinaryA()</code> for strings decryption.</p>
<p><figure><a class="lightgallery" href="/posts/mars-stealer/linking_start.png" title="/posts/mars-stealer/linking_start.png" data-thumbnail="/posts/mars-stealer/linking_start.png">
        <img
            
            loading="lazy"
            src="/posts/mars-stealer/linking_start.png"
            srcset="/posts/mars-stealer/linking_start.png, /posts/mars-stealer/linking_start.png 1.5x, /posts/mars-stealer/linking_start.png 2x"
            sizes="auto"
            alt="/posts/mars-stealer/linking_start.png" height="532"  width="650" >
    </a></figure></p>
<h3 id="timing-based-anti-debug" class="headerLink">
    <a href="#timing-based-anti-debug" class="header-mark"></a>Timing-based anti-debug</h3><p>Malware initializes a double word (4 bytes) and calls the <code>GetTickCount()</code> function that returns the number of milliseconds that have elapsed since the system has started. Then calls the <code>Sleep()</code> to suspend the execution of the current thread until 15000 milliseconds (15 seconds). <code>GetTickCount()</code> again gets the time and malware uses the first result to subtract then checks if a gotten number is greater than 10000 milliseconds (10 seconds). If the function returns true, it means that the <code>Sleep()</code> hasn&rsquo;t been skipped by the debugger and malware continues execution flow.</p>
<p><figure><a class="lightgallery" href="/posts/mars-stealer/anti_debug.png" title="/posts/mars-stealer/anti_debug.png" data-thumbnail="/posts/mars-stealer/anti_debug.png">
        <img
            
            loading="lazy"
            src="/posts/mars-stealer/anti_debug.png"
            srcset="/posts/mars-stealer/anti_debug.png, /posts/mars-stealer/anti_debug.png 1.5x, /posts/mars-stealer/anti_debug.png 2x"
            sizes="auto"
            alt="/posts/mars-stealer/anti_debug.png" height="130"  width="350" >
    </a></figure></p>
<h3 id="anti-emulation" class="headerLink">
    <a href="#anti-emulation" class="header-mark"></a>Anti-emulation</h3><p>Anti-emulation is used to avoid running in the Windows Defender emulator. Malware compares the current computer name with <code>HAL9TH</code> and the username with <code>JohnDoe</code>. If the computer name and username have coincided, the malware finishes execution.</p>
<p><figure><a class="lightgallery" href="/posts/mars-stealer/anti_emulation.png" title="/posts/mars-stealer/anti_emulation.png" data-thumbnail="/posts/mars-stealer/anti_emulation.png">
        <img
            
            loading="lazy"
            src="/posts/mars-stealer/anti_emulation.png"
            srcset="/posts/mars-stealer/anti_emulation.png, /posts/mars-stealer/anti_emulation.png 1.5x, /posts/mars-stealer/anti_emulation.png 2x"
            sizes="auto"
            alt="/posts/mars-stealer/anti_emulation.png" height="247"  width="391" >
    </a></figure></p>
<h2 id="security-checks" class="headerLink">
    <a href="#security-checks" class="header-mark"></a>Security checks</h2><h3 id="anti-cis" class="headerLink">
    <a href="#anti-cis" class="header-mark"></a>Anti-CIS</h3><p>This feature is used to avoid infection of machines from the Commonwealth of Independent States (CIS) by using <code>GetUserDefaultLangID()</code> that returns the language identifier of the region format setting for the current user. If the user language ID matches one from the list, the stealer finishes execution.</p>
<p><figure><a class="lightgallery" href="/posts/mars-stealer/cis_check.png" title="/posts/mars-stealer/cis_check.png" data-thumbnail="/posts/mars-stealer/cis_check.png">
        <img
            
            loading="lazy"
            src="/posts/mars-stealer/cis_check.png"
            srcset="/posts/mars-stealer/cis_check.png, /posts/mars-stealer/cis_check.png 1.5x, /posts/mars-stealer/cis_check.png 2x"
            sizes="auto"
            alt="/posts/mars-stealer/cis_check.png" height="489"  width="556" >
    </a></figure></p>
<table>
<thead>
<tr>
<th>Language ID</th>
<th>Language-tag</th>
<th>Country</th>
</tr>
</thead>
<tbody>
<tr>
<td>0x43F</td>
<td>kk-KZ</td>
<td>Kazakhstan</td>
</tr>
<tr>
<td>0x443</td>
<td>us-Latb-US</td>
<td>Uzbekistan</td>
</tr>
<tr>
<td>0x82C</td>
<td>az-Cyrl-AZ</td>
<td>Azerbaijan</td>
</tr>
<tr>
<td>0x43Fu</td>
<td>kk-KZ</td>
<td>Kazakhstan</td>
</tr>
<tr>
<td>0x419u</td>
<td>ru-RU</td>
<td>Russia</td>
</tr>
<tr>
<td>0x423u</td>
<td>ru-BY</td>
<td>Belarus</td>
</tr>
</tbody>
</table>
<h3 id="mutex" class="headerLink">
    <a href="#mutex" class="header-mark"></a>Mutex</h3><p>If all checks have passed, the malware creates a mutex object using <code>CreateMutexA()</code> to avoid repeat launch. Mutex name is the same as a strings decryption key, but they are stored in different variables. Then calls <code>GetLastError()</code> which gets the last error, and if the error code is equal to 183 (ERROR_ALREADY_EXIST) it means that mutex already exists therefore malware finishes execution.</p>
<p><figure><a class="lightgallery" href="/posts/mars-stealer/create_mutex.png" title="/posts/mars-stealer/create_mutex.png" data-thumbnail="/posts/mars-stealer/create_mutex.png">
        <img
            
            loading="lazy"
            src="/posts/mars-stealer/create_mutex.png"
            srcset="/posts/mars-stealer/create_mutex.png, /posts/mars-stealer/create_mutex.png 1.5x, /posts/mars-stealer/create_mutex.png 2x"
            sizes="auto"
            alt="/posts/mars-stealer/create_mutex.png" height="83"  width="537" >
    </a></figure></p>
<h3 id="expiration-check" class="headerLink">
    <a href="#expiration-check" class="header-mark"></a>Expiration check</h3><p>The <code>compilation_date</code> variable contains <code>28/08/2021 00:00:00</code>. The month on this date has increased by 1 unit, so malware can’t run after a month of compilation. Accordingly, this sample was compiled not on <code>28/08/2021</code>, but on <code>28/07/2021</code>.</p>
<p>Mars uses <code>GetSystemTime()</code> to put current system time to a struct, then calls <code>sscanf()</code> to parse the compilation date. <code>SystemTimeToFileTime()</code> is used to convert the current date and compilation date from system time to file time format.</p>
<p>If the current file time is bigger than the compile time, the malware calls <code>`ExitProcess()`</code> to finish the process.</p>
<p><figure><a class="lightgallery" href="/posts/mars-stealer/expiration_check.png" title="/posts/mars-stealer/expiration_check.png" data-thumbnail="/posts/mars-stealer/expiration_check.png">
        <img
            
            loading="lazy"
            src="/posts/mars-stealer/expiration_check.png"
            srcset="/posts/mars-stealer/expiration_check.png, /posts/mars-stealer/expiration_check.png 1.5x, /posts/mars-stealer/expiration_check.png 2x"
            sizes="auto"
            alt="/posts/mars-stealer/expiration_check.png" height="471"  width="619" >
    </a></figure></p>
<h2 id="external-dlls" class="headerLink">
    <a href="#external-dlls" class="header-mark"></a>External DLLs</h2><p>When stealing Gecko browsers credentials, the malware makes 6 requests using WinINet libary to download dependencies from the public folder and saves them in the ProgramData folder, but <code>sqlite3.dll</code> is downloading before chrome stealing starts. At the end of execution, malware deletes mentioned DLLs and finishes execution.</p>
<p><figure><a class="lightgallery" href="/posts/mars-stealer/external_dlls.png" title="/posts/mars-stealer/external_dlls.png" data-thumbnail="/posts/mars-stealer/external_dlls.png">
        <img
            
            loading="lazy"
            src="/posts/mars-stealer/external_dlls.png"
            srcset="/posts/mars-stealer/external_dlls.png, /posts/mars-stealer/external_dlls.png 1.5x, /posts/mars-stealer/external_dlls.png 2x"
            sizes="auto"
            alt="/posts/mars-stealer/external_dlls.png" height="546"  width="461" >
    </a></figure></p>
<table>
<thead>
<tr>
<th>DLL name</th>
<th>Download url</th>
<th>Save path</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>sqlite3.dll</td>
<td><a href="http://cookreceipts.fun/public/sqlite3.dll" target="_blank" rel="noopener noreferrer">http://cookreceipts.fun/public/sqlite3.dll</a></td>
<td>C:\ProgramData\sqlite3.dll</td>
<td>Libary for chromium data</td>
</tr>
<tr>
<td>freebl3.dll</td>
<td><a href="http://cookreceipts.fun/public/freebl3.dll" target="_blank" rel="noopener noreferrer">http://cookreceipts.fun/public/freebl3.dll</a></td>
<td>C:\ProgramData\freebl3.dll</td>
<td>Library for the NSS (Gecko-based)</td>
</tr>
<tr>
<td>mozglue.dll</td>
<td><a href="http://cookreceipts.fun/public/mozglue.dll" target="_blank" rel="noopener noreferrer">http://cookreceipts.fun/public/mozglue.dll</a></td>
<td>C:\ProgramData\mozglue.dll</td>
<td>Mozilla Browser Library</td>
</tr>
<tr>
<td>msvcp140.dll</td>
<td><a href="http://cookreceipts.fun/public/msvcp140.dll" target="_blank" rel="noopener noreferrer">http://cookreceipts.fun/public/msvcp140.dll</a></td>
<td>C:\ProgramData\msvcp140.dll</td>
<td>Visual C++ Runtime 2015</td>
</tr>
<tr>
<td>nss3.dll</td>
<td><a href="http://cookreceipts.fun/public/nss3.dll" target="_blank" rel="noopener noreferrer">http://cookreceipts.fun/public/nss3.dll</a></td>
<td>C:\ProgramData\nss3.dll</td>
<td>Network System Services Library (Gecko-based)</td>
</tr>
<tr>
<td>softokn3.dll</td>
<td><a href="http://cookreceipts.fun/public/softokn3.dll" target="_blank" rel="noopener noreferrer">http://cookreceipts.fun/public/softokn3.dll</a></td>
<td>C:\ProgramData\softokn3.dll</td>
<td>Mozilla Browser Library</td>
</tr>
<tr>
<td>vcruntime140.dll</td>
<td><a href="http://cookreceipts.fun/public/vcruntime140.dll" target="_blank" rel="noopener noreferrer">http://cookreceipts.fun/public/vcruntime140.dll</a></td>
<td>C:\ProgramData\vcruntime140.dll</td>
<td>Visual C++ Runtime 2015</td>
</tr>
</tbody>
</table>
<h2 id="stealing-functional" class="headerLink">
    <a href="#stealing-functional" class="header-mark"></a>Stealing functional</h2><h3 id="browsers" class="headerLink">
    <a href="#browsers" class="header-mark"></a>Browsers</h3><p>Mars steals credentials from Chromium and Gecko browsers by static paths, therefore it supports only the most popular.</p>
<p><figure><a class="lightgallery" href="/posts/mars-stealer/browsers.png" title="/posts/mars-stealer/browsers.png" data-thumbnail="/posts/mars-stealer/browsers.png">
        <img
            
            loading="lazy"
            src="/posts/mars-stealer/browsers.png"
            srcset="/posts/mars-stealer/browsers.png, /posts/mars-stealer/browsers.png 1.5x, /posts/mars-stealer/browsers.png 2x"
            sizes="auto"
            alt="/posts/mars-stealer/browsers.png" height="745"  width="575" >
    </a></figure></p>
<table>
<thead>
<tr>
<th>Browser name</th>
<th>Browser folder</th>
</tr>
</thead>
<tbody>
<tr>
<td>Chrome</td>
<td>%localappdata%\Google\Chrome\User Data</td>
</tr>
<tr>
<td>Chromium</td>
<td>%localappdata%\Chromium\User Data</td>
</tr>
<tr>
<td>Microsoft Edge</td>
<td>%localappdata%\Microsoft\Edge\User Data</td>
</tr>
<tr>
<td>Kometa</td>
<td>%localappdata%\Kometa\User Data</td>
</tr>
<tr>
<td>Amigo</td>
<td>%localappdata%\Amigo\User Data</td>
</tr>
<tr>
<td>Torch</td>
<td>%localappdata%\Torch\User Data</td>
</tr>
<tr>
<td>Orbitum</td>
<td>%localappdata%\Orbitum\User Data</td>
</tr>
<tr>
<td>Comodo</td>
<td>%localappdata%\Comodo\Dragon\User Data</td>
</tr>
<tr>
<td>Nichrome</td>
<td>%localappdata%\Nichrome\User Data</td>
</tr>
<tr>
<td>Maxthon5</td>
<td>%localappdata%\Maxthon5\Users</td>
</tr>
<tr>
<td>Sputnik</td>
<td>%localappdata%\Sputnik\User Data</td>
</tr>
<tr>
<td>Epic Privacy Browser</td>
<td>%localappdata%\Epic Privacy Browser\User Data</td>
</tr>
<tr>
<td>Vivaldi</td>
<td>%localappdata%\Vivaldi\User Data</td>
</tr>
<tr>
<td>CocCoc</td>
<td>%localappdata%\CocCoc\Browser\User Data</td>
</tr>
<tr>
<td>Uran</td>
<td>%localappdata%\uCozMedia\Uran\User Data</td>
</tr>
<tr>
<td>QIP Surf</td>
<td>%localappdata%\QIP Surf\User Data</td>
</tr>
<tr>
<td>Cent Browser</td>
<td>%localappdata%\CentBrowser\User Data</td>
</tr>
<tr>
<td>Elements Browser</td>
<td>%localappdata%\Elements Browser\User Data</td>
</tr>
<tr>
<td>TorBro</td>
<td>%localappdata%\TorBro\Profile</td>
</tr>
<tr>
<td>CryptoTab Browser</td>
<td>%localappdata%\CryptoTab Browser\User Data</td>
</tr>
<tr>
<td>Brave</td>
<td>%localappdata%\BraveSoftware\Brave-Browser\User Data</td>
</tr>
<tr>
<td>Opera</td>
<td>%appdata%\Opera Software\Opera Stable\</td>
</tr>
<tr>
<td>Opera GX</td>
<td>%appdata%\Opera Software\Opera GX Stable\</td>
</tr>
<tr>
<td>Opera Neon</td>
<td>%appdata%\Opera Software\Opera Neon\User Data</td>
</tr>
<tr>
<td>Firefox</td>
<td>%appdata%\Mozilla\Firefox\Profiles\</td>
</tr>
<tr>
<td>SlimBrowser</td>
<td>%appdata%\FlashPeak\SlimBrowser\Profiles</td>
</tr>
<tr>
<td>Pale Moon</td>
<td>%appdata%\Moonchild Productions\Pale Moon\Profiles\</td>
</tr>
<tr>
<td>Waterfox</td>
<td>%appdata%\Waterfox\Profiles\</td>
</tr>
<tr>
<td>Cyberfox</td>
<td>%appdata%\8pecxstudios\Cyberfox\Profiles\</td>
</tr>
<tr>
<td>BlackHawk</td>
<td>%appdata%\NETGATE Technologies\BlackHawk\Profiles\</td>
</tr>
<tr>
<td>IceCat</td>
<td>%appdata%\Mozilla\icecat\Profiles\</td>
</tr>
<tr>
<td>K-Meleon</td>
<td>%appdata%\K-Meleon\</td>
</tr>
<tr>
<td>Thunderbird</td>
<td>%appdata%\Thunderbird\Profiles\</td>
</tr>
</tbody>
</table>
<h3 id="2facrypto-extensions" class="headerLink">
    <a href="#2facrypto-extensions" class="header-mark"></a>2FA/crypto extensions</h3><p>This malware also targets 2FA and crypto extensions, but only in Chromium-based browsers (opera is an exception).</p>
<p><figure><a class="lightgallery" href="/posts/mars-stealer/extensions.png" title="/posts/mars-stealer/extensions.png" data-thumbnail="/posts/mars-stealer/extensions.png">
        <img
            
            loading="lazy"
            src="/posts/mars-stealer/extensions.png"
            srcset="/posts/mars-stealer/extensions.png, /posts/mars-stealer/extensions.png 1.5x, /posts/mars-stealer/extensions.png 2x"
            sizes="auto"
            alt="/posts/mars-stealer/extensions.png" height="741"  width="773" >
    </a></figure></p>
<table>
<thead>
<tr>
<th>Type</th>
<th>Extension name</th>
<th>Extension id</th>
</tr>
</thead>
<tbody>
<tr>
<td>Crypto</td>
<td>TronLink</td>
<td>ibnejdfjmmkpcnlpebklmnkoeoihofec</td>
</tr>
<tr>
<td>Crypto</td>
<td>MetaMask</td>
<td>nkbihfbeogaeaoehlefnkodbefgpgknn</td>
</tr>
<tr>
<td>Crypto</td>
<td>Binance Chain Wallet</td>
<td>fhbohimaelbohpjbbldcngcnapndodjp</td>
</tr>
<tr>
<td>Crypto</td>
<td>Yoroi</td>
<td>ffnbelfdoeiohenkjibnmadjiehjhajb</td>
</tr>
<tr>
<td>Crypto</td>
<td>Nifty Wallet</td>
<td>jbdaocneiiinmjbjlgalhcelgbejmnid</td>
</tr>
<tr>
<td>Crypto</td>
<td>Math Wallet</td>
<td>afbcbjpbpfadlkmhmclhkeeodmamcflc</td>
</tr>
<tr>
<td>Crypto</td>
<td>Coinbase Wallet</td>
<td>hnfanknocfeofbddgcijnmhnfnkdnaad</td>
</tr>
<tr>
<td>Crypto</td>
<td>Guarda</td>
<td>hpglfhgfnhbgpjdenjgmdgoeiappafln</td>
</tr>
<tr>
<td>Crypto</td>
<td>EQUAL Wallet</td>
<td>blnieiiffboillknjnepogjhkgnoapac</td>
</tr>
<tr>
<td>Crypto</td>
<td>Jaxx Liberty</td>
<td>cjelfplplebdjjenllpjcblmjkfcffne</td>
</tr>
<tr>
<td>Crypto</td>
<td>BitApp Wallet</td>
<td>fihkakfobkmkjojpchpfgcmhfjnmnfpi</td>
</tr>
<tr>
<td>Crypto</td>
<td>iWallet</td>
<td>kncchdigobghenbbaddojjnnaogfppfj</td>
</tr>
<tr>
<td>Crypto</td>
<td>Wombat</td>
<td>amkmjjmmflddogmhpjloimipbofnfjih</td>
</tr>
<tr>
<td>Crypto</td>
<td>MEW CX</td>
<td>nlbmnnijcnlegkjjpcfjclmcfggfefdm</td>
</tr>
<tr>
<td>Crypto</td>
<td>GuildWallet</td>
<td>nanjmdknhkinifnkgdcggcfnhdaammmj</td>
</tr>
<tr>
<td>Crypto</td>
<td>Saturn Wallet</td>
<td>nkddgncdjgjfcddamfgcmfnlhccnimig</td>
</tr>
<tr>
<td>Crypto</td>
<td>Ronin Wallet</td>
<td>fnjhmkhhmkbjkkabndcnnogagogbneec</td>
</tr>
<tr>
<td>Crypto</td>
<td>NeoLine</td>
<td>cphhlgmgameodnhkjdmkpanlelnlohao</td>
</tr>
<tr>
<td>Crypto</td>
<td>Clover Wallet</td>
<td>nhnkbkgjikgcigadomkphalanndcapjk</td>
</tr>
<tr>
<td>Crypto</td>
<td>Liquality Wallet</td>
<td>kpfopkelmapcoipemfendmdcghnegimn</td>
</tr>
<tr>
<td>Crypto</td>
<td>Terra Station</td>
<td>aiifbnbfobpmeekipheeijimdpnlpgpp</td>
</tr>
<tr>
<td>Crypto</td>
<td>Keplr</td>
<td>dmkamcknogkgcdfhhbddcghachkejeap</td>
</tr>
<tr>
<td>Crypto</td>
<td>Sollet</td>
<td>fhmfendgdocmcbmfikdcogofphimnkno</td>
</tr>
<tr>
<td>Crypto</td>
<td>Auro Wallet</td>
<td>cnmamaachppnkjgnildpdmkaakejnhae</td>
</tr>
<tr>
<td>Crypto</td>
<td>Polymesh Wallet</td>
<td>jojhfeoedkpkglbfimdfabpdfjaoolaf</td>
</tr>
<tr>
<td>Crypto</td>
<td>ICONex</td>
<td>flpiciilemghbmfalicajoolhkkenfel</td>
</tr>
<tr>
<td>Crypto</td>
<td>Nabox Wallet</td>
<td>nknhiehlklippafakaeklbeglecifhad</td>
</tr>
<tr>
<td>Crypto</td>
<td>KHC</td>
<td>hcflpincpppdclinealmandijcmnkbgn</td>
</tr>
<tr>
<td>Crypto</td>
<td>Temple</td>
<td>ookjlbkiijinhpmnjffcofjonbfbgaoc</td>
</tr>
<tr>
<td>Crypto</td>
<td>TezBox</td>
<td>mnfifefkajgofkcjkemidiaecocnkjeh</td>
</tr>
<tr>
<td>Crypto</td>
<td>Cyano Wallet</td>
<td>dkdedlpgdmmkkfjabffeganieamfklkm</td>
</tr>
<tr>
<td>Crypto</td>
<td>Byone</td>
<td>nlgbhdfgdhgbiamfdfmbikcdghidoadd</td>
</tr>
<tr>
<td>Crypto</td>
<td>OneKey</td>
<td>infeboajgfhgbjpjbeppbkgnabfdkdaf</td>
</tr>
<tr>
<td>Crypto</td>
<td>LeafWallet</td>
<td>cihmoadaighcejopammfbmddcmdekcje</td>
</tr>
<tr>
<td>Crypto</td>
<td>DAppPlay</td>
<td>lodccjjbdhfakaekdiahmedfbieldgik</td>
</tr>
<tr>
<td>Crypto</td>
<td>BitClip</td>
<td>ijmpgkjfkbfhoebgogflfebnmejmfbml</td>
</tr>
<tr>
<td>Crypto</td>
<td>Steem Keychain</td>
<td>lkcjlnjfpbikmcmbachjpdbijejflpcm</td>
</tr>
<tr>
<td>Crypto</td>
<td>Nash Extension</td>
<td>onofpnbbkehpmmoabgpcpmigafmmnjhl</td>
</tr>
<tr>
<td>Crypto</td>
<td>Hycon Lite Client</td>
<td>bcopgchhojmggmffilplmbdicgaihlkp</td>
</tr>
<tr>
<td>Crypto</td>
<td>ZilPay</td>
<td>klnaejjgbibmhlephnhpmaofohgkpgkd</td>
</tr>
<tr>
<td>Crypto</td>
<td>Coin98 Wallet</td>
<td>aeachknmefphepccionboohckonoeemg</td>
</tr>
<tr>
<td>2FA</td>
<td>Authenticator</td>
<td>bhghoamapcdpbohphigoooaddinpkbai</td>
</tr>
<tr>
<td>2FA</td>
<td>Authy</td>
<td>gaedmjdfmmahhbjefcbgaolhhanlaolb</td>
</tr>
<tr>
<td>2FA</td>
<td>EOS Authenticator</td>
<td>oeljdldpnmdbchonielidgobddffflal</td>
</tr>
<tr>
<td>2FA</td>
<td>GAuth Authenticator</td>
<td>ilgcnhelpchnceeipipijaljkblbcobl</td>
</tr>
<tr>
<td>2FA</td>
<td>Trezor Password Manager</td>
<td>imloifkgjagghnncjkhggdhalmcnfklk</td>
</tr>
</tbody>
</table>
<h3 id="wallets" class="headerLink">
    <a href="#wallets" class="header-mark"></a>Wallets</h3><p>The malware targets multiple wallets, which stores sensitive data in files as <code>wallet.dat</code> that contains the address, the private key to access this address, and other data.</p>
<p><figure><a class="lightgallery" href="/posts/mars-stealer/wallets.png" title="/posts/mars-stealer/wallets.png" data-thumbnail="/posts/mars-stealer/wallets.png">
        <img
            
            loading="lazy"
            src="/posts/mars-stealer/wallets.png"
            srcset="/posts/mars-stealer/wallets.png, /posts/mars-stealer/wallets.png 1.5x, /posts/mars-stealer/wallets.png 2x"
            sizes="auto"
            alt="/posts/mars-stealer/wallets.png" height="428"  width="1056" >
    </a></figure></p>
<table>
<thead>
<tr>
<th>Wallet name</th>
<th>Wallet folder</th>
<th>Regex</th>
</tr>
</thead>
<tbody>
<tr>
<td>Ethereum</td>
<td>%appdata%\Ethereum\</td>
<td>keystore</td>
</tr>
<tr>
<td>Electrum</td>
<td>%appdata%\Electrum\wallets\</td>
<td><em>.</em></td>
</tr>
<tr>
<td>Electrum LTC</td>
<td>%appdata%\Electrum-LTC\wallets\</td>
<td><em>.</em></td>
</tr>
<tr>
<td>Exodus</td>
<td>%appdata%\Exodus\</td>
<td>exodus.conf.json, window-state.json, \Exodus\exodus.wallet\, passphrase.json, seed.seco, info.seco</td>
</tr>
<tr>
<td>Electron Cash</td>
<td>%appdata%\ElectronCash\wallets\</td>
<td>default_wallet</td>
</tr>
<tr>
<td>MultiDoge</td>
<td>%appdata%\MultiDoge\</td>
<td>multidoge.wallet</td>
</tr>
<tr>
<td>Jaxx</td>
<td>%appdata%\jaxx\Local Storage\</td>
<td>file__0.localstorage</td>
</tr>
<tr>
<td>Atomic</td>
<td>%appdata%\atomic\Local Storage\leveldb\</td>
<td>000003.log, CURRENT, LOCK, LOG, MANIFEST.000001, 0000*</td>
</tr>
<tr>
<td>Binance</td>
<td>%appdata%\Binance\</td>
<td>app-store.json</td>
</tr>
<tr>
<td>Coinomi</td>
<td>%localappdata%\Coinomi\Coinomi\wallets\</td>
<td>*.wallet, *.config</td>
</tr>
</tbody>
</table>
<h2 id="grabber" class="headerLink">
    <a href="#grabber" class="header-mark"></a>Grabber</h2><p>Mars has a custom grabber with multiple functions. First, the malware makes a request to C&amp;C and gets config as a response. Grabber config looks like this <code>name|max_size|path|formats|recursively|</code>. Then uses  <code>setup_grabber()</code> which use <code>strtok()</code> with <code>lstrcatA()</code> to parse grabber config and calls <code>grabber()</code> which performs grabbing.</p>
<p><figure><a class="lightgallery" href="/posts/mars-stealer/grabber.png" title="/posts/mars-stealer/grabber.png" data-thumbnail="/posts/mars-stealer/grabber.png">
        <img
            
            loading="lazy"
            src="/posts/mars-stealer/grabber.png"
            srcset="/posts/mars-stealer/grabber.png, /posts/mars-stealer/grabber.png 1.5x, /posts/mars-stealer/grabber.png 2x"
            sizes="auto"
            alt="/posts/mars-stealer/grabber.png" height="772"  width="672" >
    </a></figure></p>
<h2 id="loader" class="headerLink">
    <a href="#loader" class="header-mark"></a>Loader</h2><p>Malware gets loader config as the response while uploading log. This config looks like this <code>link|load_to|startup_param|</code> (download link, path to a loaded file, start-up parameters).</p>
<p>To download file stealer calls <code>download_file()</code> function. Then uses <code>strtok()</code> with <code>lstrcatA()</code> to parse config parameters and calls <code>ShellExecuteExA()</code> to execute executable.</p>
<p><figure><a class="lightgallery" href="/posts/mars-stealer/loader.png" title="/posts/mars-stealer/loader.png" data-thumbnail="/posts/mars-stealer/loader.png">
        <img
            
            loading="lazy"
            src="/posts/mars-stealer/loader.png"
            srcset="/posts/mars-stealer/loader.png, /posts/mars-stealer/loader.png 1.5x, /posts/mars-stealer/loader.png 2x"
            sizes="auto"
            alt="/posts/mars-stealer/loader.png" height="758"  width="592" >
    </a></figure></p>
<h2 id="self-removal" class="headerLink">
    <a href="#self-removal" class="header-mark"></a>Self-removal</h2><p>Malware gets the way to itself  by using <code>GetModuleFileName()</code> and calls <code>ShellExecuteExA()</code> which executes <code>cmd.exe</code> with <code>/c timeout /t 5 &amp; del /f /q \&quot;%s\&quot; &amp; exit</code> parameters. After 5 seconds <code>cmd.exe</code> deletes current executable.</p>
<p><figure><a class="lightgallery" href="/posts/mars-stealer/self_removal.png" title="/posts/mars-stealer/self_removal.png" data-thumbnail="/posts/mars-stealer/self_removal.png">
        <img
            
            loading="lazy"
            src="/posts/mars-stealer/self_removal.png"
            srcset="/posts/mars-stealer/self_removal.png, /posts/mars-stealer/self_removal.png 1.5x, /posts/mars-stealer/self_removal.png 2x"
            sizes="auto"
            alt="/posts/mars-stealer/self_removal.png" height="353"  width="546" >
    </a></figure></p>
<h2 id="conclusion" class="headerLink">
    <a href="#conclusion" class="header-mark"></a>Conclusion</h2><p>Mars Stealer it&rsquo;s an improved version of Oski Stealer. Have been added anti-debug check, crypto extensions stealing, but outlook stealing is missing. The code has been refactoring, but some algorithms remained stupid as in Oski Stealer. <a href="https://www.cyberark.com/resources/threat-research-blog/meet-oski-stealer-an-in-depth-analysis-of-the-popular-credential-stealer" target="_blank" rel="noopener noreferrer">Here</a> you can read detailed Oski Stealer analysis from CyberArk.</p>
<h2 id="iocs" class="headerLink">
    <a href="#iocs" class="header-mark"></a>IOCs</h2><p>Tweet: <a href="https://twitter.com/3xp0rtblog/status/1424638227160473602" target="_blank" rel="noopener noreferrer">Aug 9, 2021</a></p>
<p>File:
6143734a8c9cae36bfde4f4b67f3c604</p>
<p>C&amp;C:
cookreceipts.fun</p></div>

        <div class="post-footer" id="post-footer">
    <div class="post-info">
        <div class="post-info-line">
            <div class="post-info-mod">
                <span>Updated on 2023-03-19</span>
            </div>
            <div class="post-info-license"></div>
        </div>
        <div class="post-info-line">
            <div class="post-info-md"></div>
            <div class="post-info-share"><button title="Share on Twitter" data-sharer="twitter" data-url="https://3xp0rt.com/posts/mars-stealer/" data-title="Mars Stealer: Oski refactoring" data-via="3xp0rtblog" data-hashtags="stealer,malware analysis,reverse engineering"><span class="fab fa-twitter fa-fw"></span></button><button title="Share on Facebook" data-sharer="facebook" data-url="https://3xp0rt.com/posts/mars-stealer/" data-hashtag="stealer"><span class="fab fa-facebook-square fa-fw"></span></button><button title="Share on Linkedin" data-sharer="linkedin" data-url="https://3xp0rt.com/posts/mars-stealer/"><span class="fab fa-linkedin fa-fw"></span></button><button title="Share on Hacker News" data-sharer="hackernews" data-url="https://3xp0rt.com/posts/mars-stealer/" data-title="Mars Stealer: Oski refactoring"><span class="fab fa-hacker-news fa-fw"></span></button><button title="Share on Reddit" data-sharer="reddit" data-url="https://3xp0rt.com/posts/mars-stealer/"><span class="fab fa-reddit fa-fw"></span></button><button title="Share on Blogger" data-sharer="blogger" data-url="https://3xp0rt.com/posts/mars-stealer/" data-title="Mars Stealer: Oski refactoring" data-description="Analysing of Mars Stealer"><span class="fab fa-blogger fa-fw"></span></button></div>
        </div>
    </div>

    <div class="post-info-more">
        <section class="post-tags"><i class="fas fa-tags fa-fw"></i>&nbsp;<a href="/tags/stealer/">stealer</a>,&nbsp;<a href="/tags/malware-analysis/">malware analysis</a>,&nbsp;<a href="/tags/reverse-engineering/">reverse engineering</a></section>
        <section>
            <span><a href="javascript:void(0);" onclick="if (!window.__cfRLUnblockHandlers) return false; window.history.back();" data-cf-modified-155e0f9bcee2c407ab269f22-="">Back</a></span>&nbsp;|&nbsp;<span><a href="/">Home</a></span>
        </section>
    </div>

    <div class="post-nav"></div>
</div>
</article></div>
        </main><footer class="footer">
        <div class="footer-container"><div class="footer-line"><i class="far fa-copyright fa-fw"></i><span itemprop="copyrightYear">2022 - 2024</span><span class="author" itemprop="copyrightHolder">&nbsp;<a href="https://3xp0rt.com" target="_blank" rel="noopener noreferrer">3xp0rt</a></span>&nbsp;|&nbsp;<span class="license"><a rel="license external nofollow noopener noreffer" href="https://creativecommons.org/licenses/by-nd/4.0/" target="_blank">CC BY-ND 4.0</a></span></div>
            <div class="footer-line"></div>
            <div class="footer-line">
            </div>
        </div></footer></div>

    <div id="fixed-buttons"><a href="#back-to-top" id="back-to-top-button" class="fixed-button" title="Back to Top">
            <i class="fas fa-arrow-up fa-fw"></i>
        </a><a href="#" id="view-comments" class="fixed-button" title="View Comments">
            <i class="fas fa-comment fa-fw"></i>
        </a>
    </div><div class="assets"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery.js@1.4.0/dist/css/lightgallery.min.css"><script type="155e0f9bcee2c407ab269f22-text/javascript">window.config={"code":{"copyTitle":"Copy to clipboard","maxShownLines":50},"comment":{},"lightGallery":{"actualSize":false,"exThumbImage":"data-thumbnail","hideBarsDelay":2000,"selector":".lightgallery","speed":400,"thumbContHeight":80,"thumbWidth":80,"thumbnail":true},"search":{"distance":null,"findAllMatches":null,"fuseIndexURL":"/index.json","highlightTag":"em","ignoreFieldNorm":null,"ignoreLocation":null,"isCaseSensitive":null,"location":null,"maxResultLength":10,"minMatchCharLength":null,"noResultsFound":"No results found","snippetLength":30,"threshold":null,"type":"fuse","useExtendedSearch":null},"sharerjs":true};</script><script type="155e0f9bcee2c407ab269f22-text/javascript" src="https://cdn.jsdelivr.net/npm/lightgallery.js@1.4.0/dist/js/lightgallery.min.js"></script><script type="155e0f9bcee2c407ab269f22-text/javascript" src="https://cdn.jsdelivr.net/npm/lg-thumbnail.js@1.2.0/dist/lg-thumbnail.min.js"></script><script type="155e0f9bcee2c407ab269f22-text/javascript" src="https://cdn.jsdelivr.net/npm/lg-zoom.js@1.3.0/dist/lg-zoom.min.js"></script><script type="155e0f9bcee2c407ab269f22-text/javascript" src="https://cdn.jsdelivr.net/npm/clipboard@2.0.8/dist/clipboard.min.js"></script><script type="155e0f9bcee2c407ab269f22-text/javascript" src="https://cdn.jsdelivr.net/npm/sharer.js@0.4.2/sharer.min.js"></script><script type="155e0f9bcee2c407ab269f22-text/javascript" src="/js/theme.min.js" defer></script></div>
<!-- Cloudflare Pages Analytics --><script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "cea6e4eda9f645b397aa4c45ce6746a2"}' type="155e0f9bcee2c407ab269f22-text/javascript"></script><!-- Cloudflare Pages Analytics --><script src="/cdn-cgi/scripts/7d0fa10a/cloudflare-static/rocket-loader.min.js" data-cf-settings="155e0f9bcee2c407ab269f22-|49" defer></script></body>

</html>