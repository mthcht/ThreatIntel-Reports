<!DOCTYPE html><!-- Last Published: Thu Aug 21 2025 22:34:47 GMT+0000 (Coordinated Universal Time) --><html data-wf-domain="www.binarly.io" data-wf-page="65dca03a35626ac9030cba85" data-wf-site="65d392ca924b59f0fcd873eb" lang="en" data-wf-collection="65dca03a35626ac9030cba69" data-wf-item-slug="the-untold-story-of-the-blacklotus-uefi-bootkit"><head><meta charset="utf-8"/><title>The Untold Story of the BlackLotus UEFI Bootkit</title><meta content="Uncover the secrets of the Black Lotus UEFI Bootkit. Explore the history and challenges of detecting and analyzing rootkits and bootkits through analysis." name="description"/><meta content="The Untold Story of the BlackLotus UEFI Bootkit" property="og:title"/><meta content="Uncover the secrets of the Black Lotus UEFI Bootkit. Explore the history and challenges of detecting and analyzing rootkits and bootkits through analysis." property="og:description"/><meta content="" property="og:image"/><meta content="The Untold Story of the BlackLotus UEFI Bootkit" property="twitter:title"/><meta content="Uncover the secrets of the Black Lotus UEFI Bootkit. Explore the history and challenges of detecting and analyzing rootkits and bootkits through analysis." property="twitter:description"/><meta content="" property="twitter:image"/><meta property="og:type" content="website"/><meta content="summary_large_image" name="twitter:card"/><meta content="width=device-width, initial-scale=1" name="viewport"/><link href="https://cdn.prod.website-files.com/65d392ca924b59f0fcd873eb/css/binarly-io.shared.0bd001593.min.css" rel="stylesheet" type="text/css"/><link href="https://fonts.googleapis.com" rel="preconnect"/><link href="https://fonts.gstatic.com" rel="preconnect" crossorigin="anonymous"/><script src="https://ajax.googleapis.com/ajax/libs/webfont/1.6.26/webfont.js" type="text/javascript"></script><script type="text/javascript">WebFont.load({  google: {    families: ["Exo:100,100italic,200,200italic,300,300italic,400,400italic,500,500italic,600,600italic,700,700italic,800,800italic,900,900italic","Montserrat:100,100italic,200,200italic,300,300italic,400,400italic,500,500italic,600,600italic,700,700italic,800,800italic,900,900italic","Lato:100,100italic,300,300italic,400,400italic,700,700italic,900,900italic","Exo 2:100,200,300,regular,500,600,700,800,900,100italic,200italic,300italic,italic,500italic,600italic,700italic,800italic,900italic"]  }});</script><script type="text/javascript">!function(o,c){var n=c.documentElement,t=" w-mod-";n.className+=t+"js",("ontouchstart"in o||o.DocumentTouch&&c instanceof DocumentTouch)&&(n.className+=t+"touch")}(window,document);</script><link href="https://cdn.prod.website-files.com/65d392ca924b59f0fcd873eb/660196452b0cde006a5aae30_favicon-binarly-2.png" rel="shortcut icon" type="image/x-icon"/><link href="https://cdn.prod.website-files.com/65d392ca924b59f0fcd873eb/66019f4939195a56b4e416c4_webclip.png" rel="apple-touch-icon"/><link href="https://www.binarly.io/blog/the-untold-story-of-the-blacklotus-uefi-bootkit" rel="canonical"/><link href="rss.xml" rel="alternate" title="RSS Feed" type="application/rss+xml"/><script async="" src="https://www.googletagmanager.com/gtag/js?id=G-L9WKTYN7HE"></script><script type="text/javascript">window.dataLayer = window.dataLayer || [];function gtag(){dataLayer.push(arguments);}gtag('js', new Date());gtag('set', 'developer_id.dZGVlNj', true);gtag('config', 'G-L9WKTYN7HE');</script><link rel="preconnect" href="https://assets-global.website-files.com" crossorigin>
<style>nav a:hover{border-bottom:solid #00f1ba 2px;}</style>

<!-- Apollo -->
<script>function initApollo(){var
n=Math.random().toString(36).substring(7),o=document.createElement("script");
o.src="https://assets.apollo.io/micro/website-tracker/tracker.iife.js?nocache="+n,o.as
ync=!0,o.defer=!0,
o.onload=function(){window.trackingFunctions.onLoad({appId:"65e24af123290e0439f9fe11"}
)},
document.head.appendChild(o)}initApollo();</script>

<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-L9WKTYN7HE"></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-L9WKTYN7HE');
</script>

<script type="text/javascript">
_linkedin_partner_id = "7267164";
window._linkedin_data_partner_ids = window._linkedin_data_partner_ids || [];
window._linkedin_data_partner_ids.push(_linkedin_partner_id);
</script><script type="text/javascript">
(function(l) {
if (!l){window.lintrk = function(a,b){window.lintrk.q.push([a,b])};
window.lintrk.q=[]}
var s = document.getElementsByTagName("script")[0];
var b = document.createElement("script");
b.type = "text/javascript";b.async = true;
b.src = "https://snap.licdn.com/li.lms-analytics/insight.min.js";
s.parentNode.insertBefore(b, s);})(window.lintrk);
</script>
<noscript>
<img height="1" width="1" style="display:none;" alt=""
src="https://px.ads.linkedin.com/collect/?pid=7267164&fmt=gif" />
</noscript><style>
 p{
    margin-top: 0;
    margin-bottom: 20px;
}
.w-richtext figure {
    max-width: 100%; 
    position: relative;
    margin-bottom:40px;
}
/**code{background: black;
    padding: 1px;
    color: white;}*/
    
    .w-embed{overflow:auto;}
    caption {
    caption-side: bottom;
    font-size:16px;
}
/*tbody{font-size:15px;}*/
   /* table caption{text-align:left;}*/
</style>
<style>
  /* Style for the modal */
  #modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0, 0, 0, 0.8);
    z-index: 9999;
    justify-content: center;
    align-items: center;
  }
/*
  #modal img {
    max-width: 90%;
    max-height: 90%;
    display: block;
    margin: 0 auto; 
  }*/
  #modal img {
   /* width: 80%!important;
    height: auto!important;*/
    max-height:100vh;
    display: block; /* Ensure the image is displayed as a block element */
    margin: 0 auto; /* Center the image horizontally */
    background-color:white;
  }

  #modal-caption {
    color: #fff; /* Set caption text color */
    margin-top: 10px; /* Add space between image and caption */
    text-align: center; /* Center the caption text */
  }

  /* Style for the close button */
  #close {
    position: absolute;
    top: 20px;
    right: 20px;
    color: #fff;
    cursor: pointer;
  }

  /* Change cursor to pointer when hovering over initial figure image */
  .w-richtext-align-fullwidth.w-richtext-figure-type-image img {
    cursor: pointer;
  }

  /* Change cursor to pointer for entire body when modal is open */
  body.modal-open {
    cursor: pointer;
  }
  .img-border{
    border: solid black 2px;
    border-radius: 5px;
}
figcaption{font-size:16px;}
</style>

<style>.video {
  aspect-ratio: 16 / 9;
  width: 100%;
  position:relative;
}
#video{width:100%;height:100%}
.playBtn {
    position: absolute;
    width: 96px;
    height: 96px;
    left: 50%;
    top: 50%;
    margin-left: -48px; /*half of the width */
    margin-top: -48px; /*half of the height */
}
</style></head><body class="body-12"><div data-w-id="05b1bf7a-1ee7-c70b-a37a-fbdd3bd07ec3" data-animation="default" data-collapse="medium" data-duration="400" data-easing="ease" data-easing2="ease" role="banner" class="brix---header-wrapper menu-test w-nav"><div class="blur-me"></div><div class="brix---container-default-4 w-container"><div class="brix---header-content-wrapper"><a href="/" class="brix---header-logo-link w-nav-brand"><img alt="Binarly logo with text &#x27;Binarly&#x27;
" src="https://cdn.prod.website-files.com/65d392ca924b59f0fcd873eb/660d4f979dbb18c2088ddda1_Group354.svg" class="brix---header-logo"/></a><div class="brix---header-middle-col"><nav role="navigation" class="brix---header-menu-wrapper w-nav-menu"><ul role="list" class="brix---header-nav-menu-list"><li class="brix---header-nav-list-item-middle home"><a href="/" class="link-block-20 home w-inline-block"><div class="text-block-70 home">Home<br/></div></a></li><li class="brix---header-nav-list-item-middle"><div data-delay="0" data-hover="true" class="brix---dropdown-wrapper w-dropdown"><div class="brix---dropdown-toggle w-dropdown-toggle"><div class="text-block-70 mobile-show">Platform</div><a href="#" class="link-block-57 platform w-inline-block"><div class="text-block-70">Platform</div></a></div><nav class="brix---dropdown-column-wrapper w-dropdown-list"><div class="brix---dropdown-card"><div class="brix---dropdown-pd"><div class="w-layout-grid brix---dropdown-links-grid"><a href="/features" class="brix---dropdown-link w-dropdown-link">Features</a><a href="/packages" class="brix---dropdown-link w-dropdown-link">Packages</a><a href="https://cd.binarly.io/case-studies" class="brix---dropdown-link w-dropdown-link">Case Studies</a></div></div></div></nav></div></li><li class="brix---header-nav-list-item-middle"><div data-delay="0" data-hover="true" data-w-id="05b1bf7a-1ee7-c70b-a37a-fbdd3bd07ee3" class="brix---dropdown-wrapper w-dropdown"><div class="brix---dropdown-toggle w-dropdown-toggle"><div class="text-block-71 research mobile-show">REsearch</div><a href="#" class="link-block-58 w-inline-block"><div class="text-block-71 research">REsearch</div></a></div><nav class="brix---dropdown-column-wrapper w-dropdown-list"><div class="brix---dropdown-card"><div class="brix---dropdown-pd"><div class="w-layout-grid brix---dropdown-links-grid"><a href="/advisories" class="brix---dropdown-link w-dropdown-link">Advisories</a><a href="/articles" class="brix---dropdown-link w-dropdown-link">All REsearch</a><a href="/pkfail" class="brix---dropdown-link menu-indent w-dropdown-link">PKfail</a><a href="/lighttpd" class="brix---dropdown-link menu-indent w-dropdown-link">Lighttpd</a><a href="/blog/xz-utils-supply-chain-puzzle-binarly-ships-free-scanner-for-cve-2024-3094-backdoor" class="brix---dropdown-link menu-indent w-dropdown-link">XZ Backdoor</a><a href="/logofail" class="brix---dropdown-link menu-indent w-dropdown-link">LogoFAIL</a></div></div></div></nav></div></li><li class="brix---header-nav-list-item-middle"><div data-delay="0" data-hover="true" data-w-id="05b1bf7a-1ee7-c70b-a37a-fbdd3bd07efd" class="brix---dropdown-wrapper w-dropdown"><div class="brix---dropdown-toggle w-dropdown-toggle"><div class="text-block-72 learn mobile-show">Learn</div><a href="#" class="link-block-59 w-inline-block"><div class="text-block-72 learn">Learn</div></a></div><nav class="brix---dropdown-column-wrapper w-dropdown-list"><div class="brix---dropdown-card"><div class="brix---dropdown-pd"><div class="w-layout-grid brix---dropdown-links-grid"><a href="/learn" class="brix---dropdown-link w-dropdown-link">All Resources</a><a href="/blog" class="brix---dropdown-link w-dropdown-link">Product Blog</a><a href="/video" class="brix---dropdown-link w-dropdown-link">Videos</a><a href="/free-tools" class="brix---dropdown-link w-dropdown-link">Free Detection Tools</a><a href="/reports" class="brix---dropdown-link w-dropdown-link">Reports</a></div></div></div></nav></div></li><li class="brix---header-nav-list-item-middle"><div data-delay="0" data-hover="true" data-w-id="05b1bf7a-1ee7-c70b-a37a-fbdd3bd07f17" class="brix---dropdown-wrapper w-dropdown"><div class="brix---dropdown-toggle w-dropdown-toggle"><div class="text-block-72 company mobile-show">Company</div><a href="#" class="link-block-60 w-inline-block"><div class="text-block-72 company">Company</div></a></div><nav class="brix---dropdown-column-wrapper w-dropdown-list"><div class="brix---dropdown-card"><div class="brix---dropdown-pd"><div class="w-layout-grid brix---dropdown-links-grid"><a href="/about" class="brix---dropdown-link w-dropdown-link">About Binarly</a><a href="/news" class="brix---dropdown-link w-dropdown-link">News</a><a href="/press" class="brix---dropdown-link w-dropdown-link">Press</a></div></div></div></nav></div></li><li class="brix---header-nav-list-item-middle"></li><li class="brix---header-nav-list-item-show-in-mbl"><a href="https://risk.binarly.io/" target="_blank" class="button-11 scan-button w-button">Free scan</a></li><li class="brix---header-nav-list-item-show-in-mbl"><a href="/book-a-demo-old" class="button-11 book-demo w-button">Book a demo</a></li></ul></nav></div><div class="brix---header-right-col"><div class="brix---hamburger-menu-wrapper w-nav-button"><div class="brix---hamburger-menu-bar-top"></div><div class="brix---hamburger-menu-bar-bottom"></div></div><div class="div-block-97"><a href="https://risk.binarly.io/" target="_blank" class="button-11 scan-button w-button">Free scan</a><a href="/book-a-demo" class="button-11 book-demo w-button">Book a demo</a></div></div></div></div></div><section class="blog"><div class="w-layout-blockcontainer w-container"><div class="blog-title-inner"><div class="w-embed"><!-- Modal HTML markup -->
<div id="modal">
  <span id="close">&times;</span>
  <div id="modal-content">
    <img id="modal-img" src="" alt="Modal Image">
    <div id="modal-caption"></div> <!-- Use a separate container for the caption -->
  </div>
</div></div><div class="text-block-32">March 3, 2023</div><h1 class="blog-header">The Untold Story of the BlackLotus UEFI Bootkit</h1><h2 class="heading-21 w-dyn-bind-empty"></h2></div></div></section><div class="w-layout-blockcontainer bin-blog-body w-container"><div class="bin-blog-inner"><div><div class="rich-text-block-3 w-richtext"><h6><em>by Alex Matrosov</em></h6><p>My experience with the analysis and detection of rootkits and bootkits goes back more than 20 years. In the early 2000s, the main challenge was dealing with infected machines when rootkits and bootkits modified the operating system kernel to conceal malicious components. It was such a fun time reverse engineering advanced threats in the good old days that I co-wrote &quot;<a href="https://binarly.io/posts/The_list_of_highest-rated_books_for_Malware_Analysts_features_Rootkits_and_Bootkits">Rootkits and Bootkits: Reversing Modern Malware and Next Generation Threats</a>,&quot; a book full of the most interesting stories of our time going down the rabbit hole of advanced malware.</p><p>When the major operating systems moved to UEFI support and Secure Boot was widely implemented, I really believed the golden age of bootkits had ended and the natural evolution would lead in the direction of firmware implants. I was wrong. Last week, researchers at ESET published &quot;<a href="https://www.welivesecurity.com/2023/03/01/blacklotus-uefi-bootkit-myth-confirmed/">BlackLotus UEFI Bootkit: Myth Confirmed</a>,&quot; confirming the existence of UEFI bootkits all over again. UEFI bootkits like BlackLotus are not new and have been publicly seen since 2013 or even earlier. Modified or replaced bootloaders create very visible and noisy Indicators of Compromise (IOCs) that attackers who are focused on persistence want to avoid. </p><p>Nevertheless, BlackLotus has been detected in-the-wild by the end of 2022, which is surprising for a malware class that has been around for 10+ years.</p><h2>Dive into (in)secure boot and the CVSS scoring problem</h2><p>This story also has a supply chain twist. Â A critical aspect of the BlackLotus story lies in supply chain problems relating to modern operating systems, their bootloaders, and UEFI firmware. In order to bypass Secure Boot at scale, BlackLotus exploits <a href="https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2022-21894">CVE-2022-21894</a>, a vulnerability patched by Microsoft in January 2022. A proof-of-concept exploit was released in August 2022, seven months after Microsoftâs public disclosure. </p><p>The CVE-2022-21894 vulnerabilityâs <a href="https://nvd.nist.gov/vuln/detail/CVE-2022-21894">CVSS score</a> (4.4 medium) doesn&#x27;t seem to indicate a serious vulnerability, does it? </p><p>The problem with most of the Secure Boot bypass vulnerabilities is that they require local or physical access to the target. This significantly affects CVSS scoring in terms of the impact. Since Secure Boot bypass attacks cross security boundaries or allow the disabling of security features, we need to treat them as privilege escalation vulnerabilities to more accurately reflect the CVSS impact score. </p><p>As the operating system bootloader becomes the middle layer between the firmware and operating system during the boot process, the bootloader provides a significant attack surface that can impact a lot of security features like disk encryption and secure boot. Currently, there is little documentation on attacks against bootloaders and a lot of inconsistency in the published existing knowledge. Here are some Microsoft advisories related to Secure Boot bypasses and other bootloader vulnerabilities.</p><div class="w-embed"><table>
<thead>
<tr>
<th>Vulnerability</th>
<th>CVSS Score</th>
<th>Impact</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2023-21560">CVE-2023-21560</a></td>
<td>6.6 Medium</td>
<td>BitLocker Encryption Bypass</td>
</tr>
<tr>
<td><a href="https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2022-21894">CVE-2022-21894</a></td>
<td>4.4. Medium</td>
<td>Secure Boot Security Bypass</td>
</tr>
<tr>
<td><a href="https://msrc.microsoft.com/update-guide/vulnerability/ADV200011">BootHole (ADV200011)</a></td>
<td>5.7 Medium</td>
<td>Secure Boot Security Bypass</td>
</tr>
<tr>
<td><a href="https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2020-0689">CVE-2020-0689</a></td>
<td>6.7 Medium</td>
<td>Secure Boot Security Bypass</td>
</tr>
<tr>
<td><a href="https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2019-1368">CVE-2019-1368</a></td>
<td>4.6 Medium</td>
<td>Secure Boot Security Bypass</td>
</tr>
<tr>
<td><a href="https://msrc.microsoft.com/update-guide/en-US/vulnerability/CVE-2019-1294">CVE-2019-1294</a></td>
<td>4.6 Medium</td>
<td>Secure Boot Security Bypass</td>
</tr>
<tr>
<td><a href="https://learn.microsoft.com/en-us/security-updates/SecurityBulletins/2016/ms16-140?redirectedfrom=MSDN">CVE-2016-7247</a></td>
<td>5.0 Medium</td>
<td>Secure Boot Security Bypass</td>
</tr>
<tr>
<td><a href="https://learn.microsoft.com/en-us/security-updates/securitybulletins/2016/ms16-094">CVE-2016-3287</a></td>
<td>4.4 Medium</td>
<td>Secure Boot Security Bypass</td>
</tr>
<tr>
<td><a href="https://learn.microsoft.com/en-us/security-updates/SecurityBulletins/2016/ms16-100?redirectedfrom=MSDN">CVE-2016-3320</a></td>
<td>4.9 Medium</td>
<td>Secure Boot Security Bypass</td>
</tr>
<tr>
<td><a href="https://learn.microsoft.com/en-us/security-updates/securitybulletins/2015/ms15-122">CVE-2015-6095</a></td>
<td>4.9 Medium</td>
<td>BitLocker Encryption Bypass</td>
</tr>
</tbody>
</table></div><p>As an aside, the navigation on the Microsoft Security Response Center (MSRC) website is a complete disaster from the perspective of tracking retrospective vulnerabilities and attacks. According to CVSS scores, all of these issues fall under âmedium-severityâ impact. Despite this, many of them allow bypassing Secure Boot and attacking the bootloader with serious consequences.</p><p><strong>Even after the vendor fixes the secure boot bypass vulnerabilities shown in the figure above, the vulnerabilities can present long-term, industry-wide supply chain impact. Using CVE-2022-21894 as an example shows how such vulnerabilities can be exploited in the wild after one year, even with a vendor fix available.</strong></p><p>Interestingly, CVE-2022-21894 reminds me of previous findings MS16-094/CVE-2016-3287 and MS16-100/CVE-2016-3320 (also known as <a href="https://www.theregister.com/2016/08/10/microsoft_secure_boot_ms16_100/">Golden Key vulnerabilities</a>) discovered by the same researcher <a href="https://github.com/Wack0">Clark Zammis</a>. The complexity of the modern Microsoft Windows Boot Manager (bootmgfw) grows with every new release of Windows, simultaneously expanding the attack surface. Modern UEFI-based Secure Boot schemes are extremely complicated to configure correctly and/or to reduce their attack surfaces meaningfully. That being said, bootloader attacks are not likely to disappear anytime soon.</p><p><strong>A record number of </strong><a href="https://binarly.io/advisories"><strong>high-impact vulnerabilities</strong></a><strong> (228) were disclosed by the Binarly REsearch team in UEFI system firmware within one year. By design, most of these vulnerabilities bypass Secure Boot and allow attackers to persist at the firmware level.</strong></p><p>The example of BlackLotus shows how old tricks with less complicated malware can be used to gain persistence below the operating system via exploitation of a known secure boot bypass vulnerability. Still, it is quite difficult to mitigate the BlackLotus/CVE-2022-21894 secure boot bypass across the industry. The UEFI Forum is usually responsible for coordinating and supporting the major vendor-independent mitigation of <a href="https://uefi.org/revocationlistfile">UEFI Revocation List Files</a> (DBX). This list contains the hashes of signed bootloaders or firmware components that were blacklisted.</p><p>The problem with every blacklist technology is that it will always miss known problems if it is not updated or well maintained. In the history of UEFI Revocation List Files (DBX), Microsoft pushed mandatory updates only a handful of times. Other than OS vendors, who else should be responsible for these updates? Device vendors with firmware updates? As we all know, firmware updates typically occur only a few times a year, so any blacklist will be near useless with such minimal update frequency, but it is better than nothing. </p><figure class="w-richtext-align-center w-richtext-figure-type-image"><div><img alt="Figure 1" src="https://cdn.prod.website-files.com/65dc9e6c7079139a2996b5d7/65e5b5653d4b6557c882d70d_65dde4e9b37028b11a5394c2_f7ceef6e-4a5a-4676-b130-405db02321aa.png" loading="lazy"/></div></figure><p>We can see from the figure above that any compromised signed UEFI component can break secure boot integrity and bypass it. My mind immediately goes to the Binarly REsearch team&#x27;s discovery of <a href="https://github.com/binarly-io/Vulnerability-REsearch/blob/main/HP/BRLY-2021-003.md">BRLY-2021-003/CVE-2021-39297</a> (stack buffer overflow) vulnerability on HP devices last year (almost 8 months under disclosure process). Based on the demo below, an attacker can execute arbitrary code over HP Hardware Diagnostics UEFI application.</p><figure class="w-richtext-align-center w-richtext-figure-type-image"><div><img alt="Figure 2" src="https://cdn.prod.website-files.com/65dc9e6c7079139a2996b5d7/65e5b566c0b3caadebe30062_65dde4f0af0d456657657bb7_b8b2264c-8ac3-4742-af63-ef3744cf8836.gif" loading="lazy"/></div></figure><p>During its analysis of BlackLotus, the ESET research team discovered that the MokList NVRAM variable was modified. The MokList variable contains a list of authorized Machine Owner Keys (MOKs) and hashes (EFI_SIGNATURE_LIST according to the UEFI specification). But it&#x27;s another example of a supply chain issue with broad secure boot implications in the field as the MokList variable can be modified in runtime. With the modified MokList variable, an attacker can easily load any self-signed shim bootloader, which is actually another vulnerability in the chain used to keep secure boot active.</p><p>In the modern secure boot, there are many inconsistencies due to many factors, including legacy compatibility issues. The Binarly REsearch Team has discussed these weaknesses for years at multiple public conferences, but the complexity of modern secure boot continues to increase.</p><p><strong>Enterprise defenders and CISOs need to understand that threats below the operating system are clear and present dangers to their environments. Since this attack vector has significant benefits for the attacker, it is only going to get more sophisticated and complex. Vendor claims about security features can be completely opposite to the reality.</strong> Binarly&#x27;s small research team was able to discover and disclose 228 high-impact vulnerabilities across all major enterprise vendors in a year, which we believe only scratches the surface. This research continues, on both sides of the fence (defense and offense). Â </p><h2>A new name for old tricks</h2><p>Are there any new techniques in the BlackLotus bootkit? My opinion is that BlackLotus is a good combination of well-known techniques. <a href="https://github.com/Wack0/CVE-2022-21894">Proof of concept code</a> for CVE-2022-21894 (public since August 2022) was taken from the GitHub repository of the researcher who found the vulnerability.</p><p>Binarly REsearch discovered new interesting data points about the nature of the bootkit code. It appears the author of the BlackLotus bootkit based their development on code from the <a href="https://github.com/btbd/umap">Umap GitHub project</a> (Windows UEFI bootkit that loads a generic driver manual mapper without using a UEFI runtime driver) or coincidently arrived at the same ideas. According to the first commit, Umap was released in April 2020.</p><p>This picture shows a comparison of the logic of the <a href="https://github.com/btbd/umap/blob/32c0b4062123a3f9f51fee571a2db9b9e17827ec/boot/main.c#L36">main function</a> from BlackLotus and Umap. Both look very similar and contain exactly the same steps with a few minor changes.</p><figure class="w-richtext-align-center w-richtext-figure-type-image"><div><img alt="Figure 3" src="https://cdn.prod.website-files.com/65dc9e6c7079139a2996b5d7/65e5b5653d4b6557c882d733_65dde4f922089f170b8bf044_6e2c952c-2270-4a37-8fc1-6037e58109ff.png" loading="lazy"/></div></figure><p>The <a href="https://github.com/btbd/umap/blob/32c0b4062123a3f9f51fee571a2db9b9e17827ec/boot/main.c#L110">routines responsible</a> for installing the hook chain (start with <em>ImgArchStartBootApplication</em>) are very similar as shown in the figure.</p><figure class="w-richtext-align-center w-richtext-figure-type-image"><div><img alt="Figure 4" src="https://cdn.prod.website-files.com/65dc9e6c7079139a2996b5d7/65e5b5653d4b6557c882d710_65dde4efff9a06e170b355a9_bf4e019c-7b4e-4a65-b3e7-ea9bf8acc3a3.png" loading="lazy"/></div></figure><p>BlackLotus trampoline code modification logic to setup hooks is identical to Umap code on GitHub.</p><figure class="w-richtext-align-center w-richtext-figure-type-image"><div><img alt="Figure 5" src="https://cdn.prod.website-files.com/65dc9e6c7079139a2996b5d7/65e5b5653d4b6557c882d71e_65dde502e1acfc638df8c74d_1d6938ce-df2f-4f9b-881e-02f1488c8363.png" loading="lazy"/></div></figure><p>With these new data points, we can see how UEFI bootkit code reused from 2020 can be combined with publicly available proofs of concept for CVE-2022-1894 to lead to the creation of the BlackLotus bootkit. This relatively new secure boot bypass vulnerability (which the vendor claims is low-impact) has led to widespread distribution of old malicious UEFI bootkit code.</p><h2>Zero-knowledge detection of new threats</h2><p>Binarly has been focused from the beginning on developing proactive technology based on deep code inspection to detect unknown threats and vulnerabilities to help the industry recover from repeatable failures. The Binarly Platform dashboard below shows code similarity proactive detection based on machine learning models guided by code-based embeddings. </p><p>Using the BlackLotus components, we simulated infection on one of the machines available in our lab. Binarly Platform was used to compare collected snapshots of the infected and clean EFI System Partitions (ESP). Based on function similarity, we detect the replacement of bootmgfw.efi with the shim.</p><figure class="w-richtext-align-center w-richtext-figure-type-image"><div><img alt="Figure 6" src="https://cdn.prod.website-files.com/65dc9e6c7079139a2996b5d7/65e5b5653d4b6557c882d73c_65dde505437b171365f1fde1_0cec69b1-fe19-4f7d-9583-5180fe461ef2.png" loading="lazy"/></div></figure><p>The BlackLotus anomaly was proactively detected with zero knowledge about this threat, and the explained code similarity failures make it actionable for the security and incident response teams to conduct further investigation. </p><p>Let&#x27;s explore the code similarity detection in more detail. The figure below shows the detailed output for the detected anomalies from the BlackLotus malicious components added to ESP partition. </p><figure class="w-richtext-align-center w-richtext-figure-type-image"><div><img alt="Figure 7" src="https://cdn.prod.website-files.com/65dc9e6c7079139a2996b5d7/65e5b5653d4b6557c882d73f_65dde506b0f4c836f183168c_02a25cd4-592d-4955-ba4e-492f4d9029f9.png" loading="lazy"/></div></figure><p>Code similarity detects anomalies based on code changes and integrity checking heuristics as shown in the figure below.</p><figure class="w-richtext-align-center w-richtext-figure-type-image"><div><img alt="Figure 8" src="https://cdn.prod.website-files.com/65dc9e6c7079139a2996b5d7/65e5b5653d4b6557c882d736_65dde4f9f1e08c8073f860e3_6eb6c971-9138-43e5-bbb0-ab74a354c0be.png" loading="lazy"/></div></figure><p>Here is a visual explanation of the outlier (compromised ESP partition) and details of the algorithm to detect anomaly: </p><figure class="w-richtext-align-center w-richtext-figure-type-image"><div><img alt="Figure 9" src="https://cdn.prod.website-files.com/65dc9e6c7079139a2996b5d7/65e5b5653d4b6557c882d739_65dde4eff1fa6b8787a4254a_c24c4b00-8017-4252-84d1-3c4f9a8460eb.png" loading="lazy"/></div></figure><p>Binarly&#x27;s Platform is able to analyze modules and executables based on semantic similarity. The figure above shows a visualization of the program embeddings for bootmgfw and the shim. For code function signatures, we used data clustering algorithm <a href="https://en.wikipedia.org/wiki/DBSCAN">DBSCAN</a> with a precomputed Gower distance to detect anomalies. This is where we detect that additional suspicious modules were added. Afterwards, we visualized the results using the T-SNE algorithm. </p><h2>What about detection based on FwHunt?</h2><p>We continue to maintain the public FwHunt rules database and today we released a new semantic-based rule to cover malicious bootloader components from the BlackLotus bootkit.</p><p>BlackLotus rule is included in <a href="https://github.com/binarly-io/FwHunt/tree/main/rules/Threats">FwHunt&#x27;s GitHub repository</a>. To use these rules you will need FwHunt Community Scanner (<a href="https://github.com/binarly-io/fwhunt-scan">fwhunt-scan</a>).</p><figure class="w-richtext-align-center w-richtext-figure-type-image"><div><img alt="Figure 10" src="https://cdn.prod.website-files.com/65dc9e6c7079139a2996b5d7/65e5b5653d4b6557c882d74d_65dde4f4e1acfc638df8bd57_91524d9a-66c1-4b35-ae54-6c932b2426ce.gif" loading="lazy"/></div></figure><p><strong>We need to increase the industry awareness to firmware related threats and build more effective threat hunting programs with cross-industry collaboration between the vendors to mutually benefit customers and provide better detection rates.</strong></p></div></div></div></div><div id="xz-backdoor"><section class="section-6"><div class="div-block-55"><div class="w-layout-blockcontainer container-21 w-container"><div class="cta-white-inner"><div id="w-node-_7f976207-540f-1ab4-953f-9ef9fe3e40d9-fe3e40d7" class="w-layout-layout quick-stack-15 wf-layout-layout"><div class="w-layout-cell"><div class="cta-header-text-limit"><h3 class="cta-header-3">What&#x27;s lurking in your firmware?</h3><div class="text-block-83"></div></div></div><div class="w-layout-cell cell-95"><a href="https://fwhunt.run/" class="link-block-4 w-inline-block"><div class="green-v3-button"><div id="w-node-_5f0bea21-4baf-6529-1a66-c89c1dd7cf24-1dd7cf23" class="w-layout-layout green-button-v3 wf-layout-layout"><div class="w-layout-cell"><div class="text-block-55">Free Binary Scan </div></div><div class="w-layout-cell cell-89"><img src="https://cdn.prod.website-files.com/65d392ca924b59f0fcd873eb/65f86908fed31c26610fe934_Group%20381.svg" loading="lazy" alt="Arrow indicating link" class="image-56"/></div></div></div></a></div></div></div></div></div></section></div><footer class="brix---footer-wrapper-2"><div class="div-block-56"><div class="footer-container"><div class="brix---footer-top"><div class="footer-inner"><div id="w-node-dd034383-dad6-753f-36b9-6dbc49763a70-64e2890e" class="w-clearfix"><div class="brix---mg-bottom-24px-3"><a href="/" class="brix---footer-logo-wrapper-3 w-inline-block"><img src="https://cdn.prod.website-files.com/65d392ca924b59f0fcd873eb/660d4f979dbb18c2088ddda1_Group354.svg" alt="Binarly logo with text &#x27;Binarly&#x27;
" class="brix---footer-logo-3"/></a></div><div id="w-node-dd034383-dad6-753f-36b9-6dbc49763a74-64e2890e" class="w-layout-layout quick-stack-14 wf-layout-layout"><div class="w-layout-cell"><a href="https://twitter.com/binarly_io?lang=en" target="_blank" class="w-inline-block"><img src="https://cdn.prod.website-files.com/65d392ca924b59f0fcd873eb/6601b9591b951116fb5f47de_Subtraction%205.svg" loading="lazy" alt="X logo"/></a></div><div class="w-layout-cell"><a href="https://www.linkedin.com/company/binarlyinc/" target="_blank" class="w-inline-block"><img src="https://cdn.prod.website-files.com/65d392ca924b59f0fcd873eb/6601b958f35f981e228095d6_Subtraction%204.svg" loading="lazy" alt="linkedin logo"/></a></div><div class="w-layout-cell"><a href="https://github.com/binarly-io" target="_blank" class="w-inline-block"><img src="https://cdn.prod.website-files.com/65d392ca924b59f0fcd873eb/6601b959b5a62bb6adb058a5_github-mark-white.svg" loading="lazy" alt="github logo"/></a></div><div class="w-layout-cell"><a href="https://www.youtube.com/channel/UCpJ_uhTb4_NNoq3-02QfOsA" target="_blank" class="w-inline-block"><img src="https://cdn.prod.website-files.com/65d392ca924b59f0fcd873eb/6601b95946e1fd610eef4f94_Subtraction%203.svg" loading="lazy" alt="youtube logo"/></a></div></div></div><div id="w-node-dd034383-dad6-753f-36b9-6dbc49763a81-64e2890e" class="footer-menu-expanded"><ul role="list" class="list-11 w-list-unstyled"><li><div><h6 class="footer-menu-title">Platform</h6><ul role="list" class="footer-menu-v2 w-list-unstyled"><li><a href="/features" class="link-24">Features</a></li><li><a href="/packages" class="link-24">Packages</a></li><li><a href="https://cd.binarly.io/case-studies" class="link-24">Case Studies</a></li></ul></div></li><li><div><h6 class="footer-menu-title">REsearch</h6><ul role="list" class="footer-menu-v2 w-list-unstyled"><li><a href="/advisories" class="link-24">Advisories</a></li><li class="list-item-14"><a href="/articles" class="link-24">All REsearch</a></li><li class="r-menu"><a href="/pkfail" class="link-24">PKfail</a></li><li class="r-menu"><a href="/lighttpd" class="link-24">Lighttpd</a></li><li class="r-menu"><a href="/blog/xz-utils-supply-chain-puzzle-binarly-ships-free-scanner-for-cve-2024-3094-backdoor" class="link-24">XZ Backdoor</a></li><li class="r-menu"><a href="/logofail" class="link-24">LogoFAIL</a></li></ul></div></li><li><div><h6 class="footer-menu-title">Learn</h6><ul role="list" class="footer-menu-v2 w-list-unstyled"><li><a href="/learn" class="link-24">All Resources</a></li><li><a href="/blog" class="link-24">Product Blog</a></li><li><a href="/video" class="link-24">Videos</a></li><li><a href="/free-tools" class="link-24">Free Detection Tools</a></li><li><a href="/reports" class="link-24">Reports</a></li></ul></div></li><li><div><h6 class="footer-menu-title">Company</h6><ul role="list" class="footer-menu-v2 w-list-unstyled"><li><a href="/about" class="link-24">About Binarly</a></li><li><a href="/news" class="link-24">News</a></li><li><a href="/press" class="link-24">Press</a></li></ul></div></li></ul></div></div></div><div class="brix---footer-bottom"><div class="div-block-109"><ul role="list" class="footer-bottom-links w-clearfix w-list-unstyled"><li class="list-item-15"><div class="link-25">Copyright Â© 2025</div></li><li class="list-item-16"><a href="/terms-of-use" class="link-25 left-line">Terms of use</a></li><li class="list-item-17"><a href="/cookie-policy" class="link-25 left-line">Cookie Policy</a></li><li class="list-item-18"><a href="/privacy-policy" class="link-25 left-line">Privacy Policy</a></li><li class="list-item-19"><a href="/ccpa-privacy-notice" class="link-25 left-line">CCPA Privacy Notice</a></li><li class="list-item-20"><a href="/organizational-security" class="link-25 left-line">Security Commitments</a></li></ul></div></div></div><div class="brix---container-default-5 w-container"><div class="brix---footer-top"><div class="w-layout-grid brix---grid-footer-v1"><div id="w-node-_168db288-d954-3178-7318-a3ee64e28912-64e2890e" class="w-clearfix"><div class="brix---mg-bottom-24px-3"><a href="/" class="brix---footer-logo-wrapper-3 w-inline-block"><img src="https://cdn.prod.website-files.com/65d392ca924b59f0fcd873eb/660d4f979dbb18c2088ddda1_Group354.svg" alt="Binarly logo with text &#x27;Binarly&#x27;
" class="brix---footer-logo-3"/></a></div><div id="w-node-_168db288-d954-3178-7318-a3ee64e28916-64e2890e" class="w-layout-layout quick-stack-14 wf-layout-layout"><div class="w-layout-cell"><a href="https://twitter.com/binarly_io?lang=en" target="_blank" class="w-inline-block"><img src="https://cdn.prod.website-files.com/65d392ca924b59f0fcd873eb/6601b9591b951116fb5f47de_Subtraction%205.svg" loading="lazy" alt="X logo"/></a></div><div class="w-layout-cell"><a href="https://www.linkedin.com/company/binarlyinc/" target="_blank" class="w-inline-block"><img src="https://cdn.prod.website-files.com/65d392ca924b59f0fcd873eb/6601b958f35f981e228095d6_Subtraction%204.svg" loading="lazy" alt="linkedin logo"/></a></div><div class="w-layout-cell"><a href="https://github.com/binarly-io" target="_blank" class="w-inline-block"><img src="https://cdn.prod.website-files.com/65d392ca924b59f0fcd873eb/6601b959b5a62bb6adb058a5_github-mark-white.svg" loading="lazy" alt="github logo"/></a></div><div class="w-layout-cell"><a href="https://www.youtube.com/channel/UCpJ_uhTb4_NNoq3-02QfOsA" target="_blank" class="w-inline-block"><img src="https://cdn.prod.website-files.com/65d392ca924b59f0fcd873eb/6601b95946e1fd610eef4f94_Subtraction%203.svg" loading="lazy" alt="youtube logo"/></a></div></div></div><div class="footer-menu-expanded"><ul role="list" class="list-11 w-list-unstyled"><li><div><h6 class="footer-menu-title">Platform</h6><ul role="list" class="footer-menu-v2 w-list-unstyled"><li><a href="#" class="link-24">Features</a></li><li><a href="#" class="link-24">Packages</a></li><li><a href="#" class="link-24">Customers</a></li></ul></div></li><li><div><h6 class="footer-menu-title">REsearch</h6><ul role="list" class="footer-menu-v2 w-list-unstyled"><li><a href="#" class="link-24">Advisories</a></li><li class="list-item-14"><a href="#" class="link-24">All REsearch</a></li><li class="r-menu"><a href="#" class="link-24">PKfail</a></li><li class="r-menu"><a href="#" class="link-24">Lighttpd</a></li><li class="r-menu"><a href="#" class="link-24">XZ Backdoor</a></li><li class="r-menu"><a href="#" class="link-24">LogoFAIL</a></li></ul></div></li><li><div><h6 class="footer-menu-title">Learn</h6><ul role="list" class="footer-menu-v2 w-list-unstyled"><li><a href="#" class="link-24">All Resources</a></li><li><a href="#" class="link-24">Product Blog</a></li><li><a href="#" class="link-24">Videos</a></li><li><a href="#" class="link-24">Free Detection Tools</a></li><li><a href="#" class="link-24">Reports</a></li></ul></div></li><li><div><h6 class="footer-menu-title">Company</h6><ul role="list" class="footer-menu-v2 w-list-unstyled"><li><a href="#" class="link-24">About Binarly</a></li><li><a href="#" class="link-24">News</a></li><li><a href="#" class="link-24">Press</a></li></ul></div></li></ul></div><div class="div-block-104"><ul role="list" class="brix---footer-list-wrapper-3"><li class="brix---footer-list-item-3"><a href="/features" class="brix---footer-link-3">Capabilities</a></li><li class="brix---footer-list-item-3"><a href="/packages" class="brix---footer-link-3">Packages</a></li><li class="brix---footer-list-item-3"><a href="/customers" class="brix---footer-link-3">Customers</a></li><li class="brix---footer-list-item-3"></li><li class="brix---footer-list-item-3"></li></ul></div><div id="w-node-_168db288-d954-3178-7318-a3ee64e2892e-64e2890e" class="div-block-63"><ul role="list" class="brix---footer-list-wrapper-3"><li class="brix---footer-list-item-3"><a href="/articles-old" class="brix---footer-link-3">REsearch</a></li><li class="brix---footer-list-item-3"><a href="/advisories" class="brix---footer-link-3">Advisories</a></li><li class="brix---footer-list-item-3"><a href="/free-tools" class="brix---footer-link-3">Free Tools</a></li><li class="brix---footer-list-item-3"></li></ul></div><div class="div-block-105"><ul role="list" class="brix---footer-list-wrapper-3"><li class="brix---footer-list-item-3"><a href="/about" class="brix---footer-link-3">About</a></li><li class="brix---footer-list-item-3"><a href="/news" class="brix---footer-link-3">News</a></li><li class="brix---footer-list-item-3"><a href="/press" class="brix---footer-link-3">Press</a></li><li class="brix---footer-list-item-3"></li></ul></div></div></div><div class="brix---footer-bottom"><p class="brix---paragraph-default-3">Copyright Â© 2024Â Â |Â Â <a href="/terms-of-use" class="link-11">Terms of use</a>Â Â |Â Â <a href="/cookie-policy" class="link-10">Cookie Policy</a>Â Â | <a href="/privacy-policy" class="link-9">Privacy Policy</a>Â Â |Â Â <a href="/ccpa-privacy-notice" class="link-8">CCPA Privacy Notice</a></p></div></div></div></footer><script src="https://d3e54v103j8qbb.cloudfront.net/js/jquery-3.5.1.min.dc5e7f18c8.js?site=65d392ca924b59f0fcd873eb" type="text/javascript" integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script><script src="https://cdn.prod.website-files.com/65d392ca924b59f0fcd873eb/js/binarly-io.schunk.57d5559d2f0cd9f8.js" type="text/javascript"></script><script src="https://cdn.prod.website-files.com/65d392ca924b59f0fcd873eb/js/binarly-io.schunk.db742a28e6218e89.js" type="text/javascript"></script><script src="https://cdn.prod.website-files.com/65d392ca924b59f0fcd873eb/js/binarly-io.374c1b2d.393f4a0cb03ae382.js" type="text/javascript"></script><!-- Google tag (gtag.js) -->
<!--<script async src="https://www.googletagmanager.com/gtag/js?id=G-L9WKTYN7HE"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-L9WKTYN7HE',{ 'referrer' : document.referrer.split('?')[0], } );
</script>-->


<script>function initApollo(){var n=Math.random().toString(36).substring(7),o=document.createElement("script");
o.src="https://assets.apollo.io/micro/website-tracker/tracker.iife.js?nocache="+n,o.async=!0,o.defer=!0,
o.onload=function(){window.trackingFunctions.onLoad({appId:"65e24af123290e0439f9fe11"})},
document.head.appendChild(o)}initApollo();</script>

<!-- Start of HubSpot Embed Code -->
<script type="text/javascript" id="hs-script-loader" async defer src="//js.hs-scripts.com/22222483.js"></script>
<!-- End of HubSpot Embed Code -->

<!--<script charset="utf-8" type="text/javascript" src="//js.hsforms.net/forms/embed/v2.js"></script>-->
<!--<script>
  hbspt.forms.create({
    region: "na1",
    portalId: "22222483",
    formId: "3f4016d5-88b0-444b-95ec-700da3409d3d"
  });
</script>-->

<!--<script>					
window.hsFormsOnReady = window.hsFormsOnReady || [];
window.hsFormsOnReady.push(()=>{
	hbspt.forms.create({
                region: "na1",
		portalId: "22222483",
                formId: "3f4016d5-88b0-444b-95ec-700da3409d3d",
                target: "#hub-form",
		})
});
</script>-->
<!-- Hotjar Tracking Code for https://www.binarly.io -->
<script>
    (function(h,o,t,j,a,r){
        h.hj=h.hj||function(){(h.hj.q=h.hj.q||[]).push(arguments)};
        h._hjSettings={hjid:3919527,hjsv:6};
        a=o.getElementsByTagName('head')[0];
        r=o.createElement('script');r.async=1;
        r.src=t+h._hjSettings.hjid+j+h._hjSettings.hjsv;
        a.appendChild(r);
    })(window,document,'https://static.hotjar.com/c/hotjar-','.js?sv=');
</script>
<script id="jetboost-script" type="text/javascript"> window.JETBOOST_SITE_ID = "clt4beygy01030r2h88wk8kwe"; (function(d) { var s = d.createElement("script"); s.src = "https://cdn.jetboost.io/jetboost.js"; s.async = 1; d.getElementsByTagName("head")[0].appendChild(s); })(document); </script>
<style>
  table{width:100%;
  border-collapse: collapse;
        
  } 
  .bin-blog-body  .w-embed{
   margin-top: 40px;
    margin-bottom: 40px;
  }
  /*table{
   margin-top: 40px;
    margin-bottom: 40px;
  }*/
  table, th, td {
  border: 1px solid;
}
  th, td {
  padding: 15px;
  text-align: left;
}
  tr:nth-child(even) {background-color: #f2f2f2;}
table{
    word-break: break-word;
}
  
figure.w-richtext-figure-type-image.w-richtext-align-center{
    margin-top: 40px!important;
    margin-bottom: 40px!important;           
}
.w-richtext h2{margin-bottom: 30px!important;} 
  .w-richtext h1 {color:black!important; margin-bottom:40px}
  .w-code-block{margin-top:40px; margin-bottom:40px;}
  
.brix---header-wrapper.w-nav{
	 -webkit-backdrop-filter: blur(8px);
  backdrop-filter: blur(8px);
} 
  .brix---header-wrapper.menu-test.w-nav {
    -webkit-backdrop-filter: unset!important;
  backdrop-filter:unset!important;
  }
  
  th {
   
    background-color:#3F3B6C!important;
    color:white;
    
}
td{background-color:#F0F2FC;!important}
  
  table, th, td {
    border: 2px solid white;
}
  table th {
  clip-path: xywh(0 0 100% 100% round 0.5em);
}
  able tr {
  clip-path: xywh(0 0 100% 100% round 0.5em)!important;
}
.brix---header-nav-link:hover {
    border-bottom: 2px solid var(--bin-green);
    color: var(--white);
    border-radius: 0;
    padding-bottom: 3px
}  
  
  .blur-me{
   background: hsla(0, 0%, 85%, 0);
                    position: absolute;
                    top: 0;
                    left: 0;
                    right: 0;
                    height: 8rem;
                    z-index: -1;
                    inset: 0;
                    backdrop-filter: blur(10px);
                    -webkit-backdrop-filter: blur(10px);
                    /* Safari specific */
                    /* Masking effect */
                    mask-image: linear-gradient(#000 50%, rgba(0, 0, 0, 0.8) 70%, transparent);
                    -webkit-mask-image: linear-gradient(#000 50%, rgba(0, 0, 0, 0.8) 70%, transparent);

  }  

</style><script type="text/javascript">

myElement = $('#xz-backdoor');

const url = window.location.href;
const find = 'z-utils-supply-chain-puzzle-binarly-ships-free-scanner-for-cve-2024-3094-backdoor';
const found = url.match(find);


if(found !== null && found[0] === find){
  myElement.show();
} else {
  myElement.hide();
}
</script>
<script>
document.addEventListener("DOMContentLoaded", function() {
  var modal = document.getElementById("modal");
  var modalImg = document.getElementById("modal-img");
  var modalCaption = document.getElementById("modal-caption"); // Reference to the caption container
  var closeBtn = document.getElementById("close");

  // Function to open modal with clicked image and caption
  function openModal(imgSrc, captionText) {
    modalImg.src = imgSrc;
    modalCaption.textContent = captionText; // Set the caption text
    modal.style.display = "flex";
    document.body.classList.add('modal-open');
  }

  // Function to close modal
  function closeModal() {
    modal.style.display = "none";
    document.body.classList.remove('modal-open');
  }

  // Event listener to open modal when image is clicked
  document.querySelectorAll('.w-richtext-figure-type-image').forEach(function(figure) {
    var img = figure.querySelector('img');
    var caption = figure.querySelector('figcaption');
    img.addEventListener('click', function() {
      var imgSrc = img.getAttribute('src'); // Get the image source URL
      var captionText = caption ? caption.innerText : ''; // Get the caption text
      openModal(imgSrc, captionText);
    });
  });

  // Event listener to close modal when clicked outside of image or on the modal image
  modal.addEventListener('click', function(event) {
    if (event.target === modal || event.target === closeBtn || event.target === modalImg) {
      closeModal();
    }
  });

  // Optional: Close modal when pressing Esc key
  document.addEventListener('keydown', function(event) {
    if (event.key === 'Escape') {
      closeModal();
    }
  });
});
</script>

<script>
document.addEventListener('DOMContentLoaded', function() {
  // Add a click listener to the document to catch all clicks
  document.addEventListener('click', function(event) {
    // Check if the clicked element is the close button
    if (event.target.closest('.fs_modal-1_close')) {
      //console.log('Close button clicked');

      // Find the closest modal wrapper that contains the video iframe
      var modalWrapper = event.target.closest('.fs_modal-1_wrapper');

      // Find the iframe inside the modal wrapper
      var iframe = modalWrapper.querySelector('.video-frame iframe');

      // If the iframe exists, reset its src to stop the video
      if (iframe) {
       // console.log('Iframe found, resetting src');
        iframe.src = iframe.src;  // Resetting src stops the video
      } else {
       // console.log('No iframe found in the modal');
      }
    }
  });
});

</script>

<script>
$(document).ready(function(){
 	$(function() { 
    var videos  = $(".video");

        videos.on("click", function(){
            var elm = $(this),
                conts   = elm.contents(),
                le      = conts.length,
                ifr     = null;

            for(var i = 0; i<le; i++){
              if(conts[i].nodeType == 8) ifr = conts[i].textContent;
            }

            elm.addClass("player").html(ifr);
            elm.off("click");
             $("#video")[0].src += "&autoplay=1";
        ev.preventDefault();
        });
});
});
</script></body></html>