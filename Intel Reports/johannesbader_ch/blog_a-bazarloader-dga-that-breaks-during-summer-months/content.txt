<!doctype html><html lang="en-US"><head><link href="/assets/fonts/Montserrat-VariableFont_wght.woff2" rel="preload" type="font/woff2" as="font" crossorigin=""><meta charset="utf-8"><meta content="IE=edge" http-equiv="X-UA-Compatible"><title>A BazarLoader DGA that Breaks Down in the Summer</title><meta content="Domain generation algorithms are relatively straightforward to program and usually bug free. Not so the new DGA of BazarLoader, which goes haywire during the summer months." name="description" property="og:description"><meta content="width=device-width,initial-scale=1" name="viewport"><meta content="en_US" property="og:locale"><meta content="./assets/img/front/summer_bug-800.jpeg" property="og:image"><meta content="website" property="og:type"><meta content="Binary Reverse Engineering Blog" property="og:site_name"><meta content="A BazarLoader DGA that Breaks Down in the Summer" property="og:title"><meta content="summary" name="twitter:card"><meta content="@viql" name="twitter:site"><meta content="@viql" name="twitter:creator"><meta content="A BazarLoader DGA that Breaks Down in the Summer" name="twitter:title"><meta content="Domain generation algorithms are relatively straightforward to program and usually bug free. Not so the new DGA of BazarLoader, which goes haywire during the summer months." name="twitter:description"><meta content="https://bin.re/assets/img/front/summer_bug-800.jpeg" name="twitter:image"><link href="/assets/css/common-bb493b.css" rel="stylesheet"><link href="feed.xml" rel="alternate" type="application/atom+xml" title="Atom feed for the Blog"><link href="/assets/css/blog-a83391.css" rel="stylesheet"><link href="/apple-touch-icon-60x60.png" rel="apple-touch-icon" sizes="60x60"><link href="/apple-touch-icon-76x76.png" rel="apple-touch-icon" sizes="76x76"><link href="/apple-touch-icon-120x120.png" rel="apple-touch-icon" sizes="120x120"><link href="/apple-touch-icon-152x152.png" rel="apple-touch-icon" sizes="152x152"><link href="/apple-touch-icon-180x180.png" rel="apple-touch-icon" sizes="180x180"><link href="/apple-touch-icon-192x192.png" rel="apple-touch-icon" sizes="192x192"><link href="/apple-touch-icon-512x512.png" rel="apple-touch-icon" sizes="512x512"><link href="/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png"><link href="/favicon-192x192.png" rel="icon" sizes="192x192" type="image/png"><link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png"><link href="/favicon.ico" rel="shortcut icon"><noscript><style>img.lazyload {
          display: none;
        }</style></noscript><script defer src="/assets/js/all.min-a1c570.js"></script></head><body class="a b7"><div class="b"><div class="d"><div class="f e"><svg viewBox="0 0 35 32" class="g"><use href="/assets/svg/icons.svg#icon-close" xlink:href="/assets/svg/icons.svg#icon-close"></use></svg></div><div class="h"><ul class="i j sidebar"><li class="q r"><a href="/">Home</a></li><li class="q"><a href="/publications/">Publications</a></li><li class="q t"><span class="u">Varia<svg viewBox="0 0 35 32" class="g"><use href="/assets/svg/icons.svg#icon-angle-down" xlink:href="/assets/svg/icons.svg#icon-angle-down"></use></svg></span><ul class="v"><li><a href="/projects/risk-battle-outcomes/">Probability of Winning Battles in Risk</a></li><li><a href="/tag/project-euler/">Project Euler</a></li><li><a href="/projects/bazarbackdoor/">BazarBackdoor Tools</a></li></ul></li><li class="q t"><span class="u">Reverse Engineering<svg viewBox="0 0 35 32" class="g"><use href="/assets/svg/icons.svg#icon-angle-down" xlink:href="/assets/svg/icons.svg#icon-angle-down"></use></svg></span><ul class="v"><li><a href="/tag/malware-analysis/">Malware Analysis</a></li><li><a href="/projects/solutions-to-crackmes/">Solutions to Crackmes</a></li><li><a href="/projects/solutions-to-practical-reverse-engineering/">Solutions to "Practical Reverse Engineering"</a></li></ul></li></ul></div></div></div><div id="aw"><div class="w"><header class="y x"><nav class="z a0"><a href="/"><span class="a1"><!-- Generator: Adobe Illustrator 25.0.0, SVG Export Plug-In  --> <svg viewBox="0 0 86.4 20.21" height="20.21px" style="overflow:visible;enable-background:new 0 0 86.4 20.21;" version="1.1" width="86.4px" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px"><g><path class="a2" d="M28.56,5.13c-1.99,0-2.87-1.12-2.87-2.57c0-1.5,0.9-2.57,2.87-2.57c2.02,0,2.95,1.07,2.95,2.57
    C31.51,4.01,30.58,5.13,28.56,5.13z M25.96,19.94V6.47h5.22v13.46H25.96z"></path><path class="a2" d="M43.69,19.94v-7.92c0-1.23-0.27-1.91-1.59-1.91c-0.6,0-1.53,0.3-2.24,0.76v9.07H34.6V6.45h4.89l0.08,1.31
    l0.16,0.05c1.58-1.12,3.5-1.69,4.78-1.69c3.47,0,4.42,1.91,4.42,4.86v8.96H43.69z"></path><path class="a2" d="M54.33,20.15c-1.83,0-2.62-1.01-2.62-2.37c0-1.37,0.82-2.35,2.62-2.35c1.86,0,2.68,0.98,2.68,2.35
    C57,19.14,56.16,20.15,54.33,20.15z"></path><path class="a2" d="M65.14,9.23c1.58-1.69,3.85-3.17,5.49-3.17c0.63,0,0.79,0.49,0.79,1.09c0,1.45-0.87,4.29-1.58,5.3l-4.51-0.57
    v8.06h-5.21V6.45h5.16c0,0.66-0.14,2.08-0.25,2.7L65.14,9.23z"></path><path class="a2" d="M86.4,12.78v1.2h-8.63c0.03,1.72,1.07,2.4,3.03,2.4c1.34,0,3-0.35,4.34-0.76l0.98,3.2
    c-1.94,1.04-4.34,1.39-6.25,1.39c-5.9,0-7.32-3.33-7.32-6.99c0-3.41,1.58-7.13,7.07-7.13C85.74,6.09,86.4,9.78,86.4,12.78z
     M77.82,11.52h3.9c-0.03-1.31-0.41-2.29-1.83-2.29C78.4,9.23,77.93,10.32,77.82,11.52z"></path><path class="a2" d="M6.92,12.81"></path><path class="a2" d="M17.24,6.06c-0.79,0-2.43,0.29-3.87,1.3c0-0.14-0.06-2.69-0.06-3.07V0.27H8.12v9.28
    c2.71-0.69,4.54-1.87,5.24-2.18v3.06c-0.85,0.55-4.15,2.11-5.24,2.44v5.86c2.62,1.28,6.12,1.48,7.54,1.48
    c5.79,0,7.16-3.33,7.16-7.02C22.82,9.07,21.45,6.06,17.24,6.06z M15.41,16.6c-0.54,0-1.31-0.08-2.05-0.38v-5.79
    c0.66-0.33,1.45-0.65,2.16-0.65c1.01,0,2.1,0.35,2.1,3.47C17.63,16.14,16.59,16.6,15.41,16.6z"></path><path class="a2" d="M8.12,9.55c-1.03,0.23-2.56,0.51-3.66,0.23l0-3.09L0,11.57l4.51,4.88l0-3.13c1.38,0.17,2.69-0.23,3.61-0.45
    V9.55z"></path></g></svg></span></a><div class="a3"><button class="a2 a4" id="ax"><svg height="20px" version="1.1" width="20px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewport="0 0 20 20"><path class="a5" d="M2.28,15.89l1.57-1.61l1.24,1.24l-1.57,1.61L2.28,15.89z M8.86,19.33v-2.61h1.74v2.61H8.86z M9.73,4.35
	c1.46,0,2.71,0.52,3.75,1.55s1.55,2.28,1.55,3.75s-0.52,2.71-1.55,3.75c-1.03,1.03-2.28,1.55-3.75,1.55s-2.71-0.52-3.75-1.55
	s-1.55-2.28-1.55-3.75S4.95,6.93,5.98,5.9S8.26,4.35,9.73,4.35z M16.81,8.77h2.65v1.78h-2.65V8.77z M14.36,15.52l1.24-1.2l1.57,1.57
	l-1.24,1.24L14.36,15.52z M17.18,3.43l-1.57,1.57l-1.24-1.24l1.57-1.57L17.18,3.43z M10.6,0v2.61H8.86V0C8.86,0,10.6,0,10.6,0z
	 M2.65,8.77v1.78H0V8.77H2.65z M5.09,3.77L3.85,5.01L2.28,3.43l1.24-1.24L5.09,3.77z"></path><path class="a6" d="M14.18,14.19c3.31-3.31,3.31-8.67,0-11.97C13.06,1.1,11.7,0.36,10.26,0c2.2,2.88,1.98,7.01-0.65,9.65
	C6.99,12.26,2.88,12.49,0,10.33c0.37,1.41,1.1,2.76,2.21,3.87C5.52,17.5,10.88,17.5,14.18,14.19z M7.1,2.48H6.36l0.52,0.52
	L6.55,3.34L6.03,2.81v0.74H5.56V2.81L5.04,3.34L4.71,3.01l0.52-0.52H4.49V2.02h0.74L4.71,1.49l0.33-0.33l0.52,0.52V0.95h0.47v0.74
	l0.52-0.52l0.33,0.33L6.36,2.02H7.1V2.48z M0.94,3.94c0,0.26-0.21,0.47-0.47,0.47S0,4.2,0,3.94s0.21-0.47,0.47-0.47
	S0.94,3.68,0.94,3.94z M3.88,5.66c0,0.29-0.24,0.53-0.53,0.53S2.83,5.95,2.83,5.66c0-0.29,0.24-0.53,0.53-0.53S3.88,5.36,3.88,5.66z
	"></path></svg></button><ul class="i j a7"><li class="q"><a href="/">Home</a></li><li class="q"><a href="/publications/">Publications</a></li><li class="q t"><span class="u">Varia<svg viewBox="0 0 35 32" class="g"><use href="/assets/svg/icons.svg#icon-angle-down" xlink:href="/assets/svg/icons.svg#icon-angle-down"></use></svg></span><ul class="v"><li><a href="/projects/risk-battle-outcomes/">Probability of Winning Battles in Risk</a></li><li><a href="/tag/project-euler/">Project Euler</a></li><li><a href="/projects/bazarbackdoor/">BazarBackdoor Tools</a></li></ul></li><li class="q t r"><span class="u">Reverse Engineering<svg viewBox="0 0 35 32" class="g"><use href="/assets/svg/icons.svg#icon-angle-down" xlink:href="/assets/svg/icons.svg#icon-angle-down"></use></svg></span><ul class="v"><li><a href="/tag/malware-analysis/">Malware Analysis</a></li><li><a href="/projects/solutions-to-crackmes/">Solutions to Crackmes</a></li><li><a href="/projects/solutions-to-practical-reverse-engineering/">Solutions to "Practical Reverse Engineering"</a></li></ul></li></ul><div class="f a8 a9"><svg viewBox="0 0 35 32" class="g"><use href="/assets/svg/icons.svg#icon-bars" xlink:href="/assets/svg/icons.svg#icon-bars"></use></svg></div></div></nav></header><div class="b8"><noscript>&lt;img src="/assets/img/header/summer_bug-640.jpeg" class="-minfy-post__title-image"/&gt;</noscript><img alt="cover image for post 'A BazarLoader DGA that Breaks Down in the Summer'" class="lazyload b9" data-src="/assets/img/header/summer_bug-640.jpeg" data-srcset="/assets/img/header/summer_bug-1830.webp 1830w,
/assets/img/header/summer_bug-1400.webp 1400w,
/assets/img/header/summer_bug-1080.webp 1080w,
/assets/img/header/summer_bug-830.webp 830w,
/assets/img/header/summer_bug-640.webp 640w" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMDAiIGhlaWdodD0iMjMzIj48cGF0aCBmaWxsPSIjNTk1YzMzIiBkPSJNMCAwaDMwMHYyMzNIMHoiLz48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiB4PSItLjUiIHk9Ii0uNSIgZmlsbD0iI2MzOGVjMyIgZmlsbC1vcGFjaXR5PSIuNSIgdHJhbnNmb3JtPSJtYXRyaXgoMjcwLjcwMzEzIDAgMCAxNDguODI4MTMgMTQ3IDYzLjkpIi8+PGNpcmNsZSByPSIxIiBmaWxsPSIjZmZmMmVhIiBmaWxsLW9wYWNpdHk9Ii41IiB0cmFuc2Zvcm09Im1hdHJpeCgtMTQ0LjMxMDQ0IC05LjA3OTI0IDEuMDYzMTIgLTE2Ljg5Nzg3IDE2OSAxMTguNykiLz48Y2lyY2xlIHI9IjEiIGZpbGw9IiM0YzM1MzEiIGZpbGwtb3BhY2l0eT0iLjUiIHRyYW5zZm9ybT0ibWF0cml4KC03OC4xNzAwOSAxNy4wMjE3NiAtNi44OTE5MyAtMzEuNjUwMjMgMjI5LjggNzUuMikiLz48cGF0aCBmaWxsPSIjMmYyMDRmIiBmaWxsLW9wYWNpdHk9Ii41IiBkPSJNLjYgMTM3LjdoMzAwdjk2SC42eiIvPjxjaXJjbGUgcj0iMSIgZmlsbD0iIzRjM2Y1NSIgZmlsbC1vcGFjaXR5PSIuNSIgdHJhbnNmb3JtPSJtYXRyaXgoLTE0LjQzNDYyIC0zNS44NzU4NyA4OC4wODg2MyAtMzUuNDQyMzggMzMuNCA2NS41KSIvPjxjaXJjbGUgcj0iMSIgZmlsbD0iI2ZmZDlmYSIgZmlsbC1vcGFjaXR5PSIuNSIgdHJhbnNmb3JtPSJyb3RhdGUoNjUuOSAtNTMuNyAxMTEuNilzY2FsZSg4LjMyOTQ5IDgzLjQwMTQ1KSIvPjxwYXRoIGZpbGw9IiNiYzBlNDEiIGZpbGwtb3BhY2l0eT0iLjUiIGQ9Im02Mi42IDEzOS0yLTIyLjEgNzIuNS02LjQgMiAyMi4yeiIvPjxjaXJjbGUgcj0iMSIgZmlsbD0iIzUxNDY1OCIgZmlsbC1vcGFjaXR5PSIuNSIgdHJhbnNmb3JtPSJtYXRyaXgoLTcwLjAzMjIgLTUwLjEzODEzIDM3LjczNTM4IC01Mi43MDgyMiAyOTkuMyA1My45KSIvPjxwYXRoIGZpbGw9IiNmZmZmZTgiIGZpbGwtb3BhY2l0eT0iLjUiIGQ9Ik0xMzAuNyAxMTNoMTQ4Ljh2MTguOEgxMzAuN3oiLz48cGF0aCBmaWxsPSIjZjNkMWQ1IiBmaWxsLW9wYWNpdHk9Ii41IiBkPSJtMTYxLjEgMTEzLTM2LjMtNDItMTEyLjUgNDYuOHoiLz48cGF0aCBmaWxsPSIjNTk0YzUxIiBmaWxsLW9wYWNpdHk9Ii41IiBkPSJNODYuMSAxMzQuMmgxNzQuNlYxNzRIODYuMXoiLz48cGF0aCBmaWxsPSIjNGQyYzEwIiBmaWxsLW9wYWNpdHk9Ii41IiBkPSJtMjQ5LjUgMTAxLjctODgtMzcuMSAyLjggMzMuMSAyNS41IDEwLjF6Ii8+PHBhdGggZmlsbD0iI2JkOTY4MyIgZmlsbC1vcGFjaXR5PSIuNSIgZD0ibTE5Ny41IDg1LTI1LjgtMzEuNyA4OSAzMi44eiIvPjxjaXJjbGUgcj0iMSIgZmlsbD0iIzZkNTg2OSIgZmlsbC1vcGFjaXR5PSIuNSIgdHJhbnNmb3JtPSJtYXRyaXgoMTEwLjAwNzMgMzcuMDA1NTMgLTE3LjY5OTMzIDUyLjYxNTI1IDIyLjYgMjIuNykiLz48cGF0aCBmaWxsPSIjZmZhZmNlIiBmaWxsLW9wYWNpdHk9Ii41IiBkPSJtLTE4LjIgMTQ4LjIgNzAuMy0xMS43IDI4LjItMzUuMXoiLz48cGF0aCBmaWxsPSIjZjJkZmM5IiBmaWxsLW9wYWNpdHk9Ii41IiBkPSJtMjQ3IDEzMC0xMTkgNCA0Ni04LjdMMjM2LjEgOTh6Ii8+PGNpcmNsZSByPSIxIiBmaWxsPSIjNTk0ZDUyIiBmaWxsLW9wYWNpdHk9Ii41IiB0cmFuc2Zvcm09Im1hdHJpeCg2LjU4Njk5IC03Ljk2MjMgMTguNTQ5NCAxNS4zNDU0IDIxMy4xIDE0NS43KSIvPjxwYXRoIGZpbGw9IiNmZmZmZjgiIGZpbGwtb3BhY2l0eT0iLjUiIGQ9Im00Mi44IDEyMy42LTI4LjItMTQgNjggMS4xeiIvPjxwYXRoIGZpbGw9IiNmY2VkZGQiIGZpbGwtb3BhY2l0eT0iLjUiIGQ9Ik0yMjAuOSAxMjIuNWg3OS43djEyLjloLTc5Ljd6Ii8+PGNpcmNsZSByPSIxIiBmaWxsPSIjNGQ0NTRkIiBmaWxsLW9wYWNpdHk9Ii41IiB0cmFuc2Zvcm09Im1hdHJpeCg0OC4xMDYzOCAtMzIuNTE3OTEgMTYuODk5MzkgMjUuMDAwNjQgLjYgODguNikiLz48Y2lyY2xlIHI9IjEiIGZpbGw9IiM3ZjY4NzkiIGZpbGwtb3BhY2l0eT0iLjUiIHRyYW5zZm9ybT0ibWF0cml4KDQuMjEwODggLTIwLjkyNTggMTQ0Ljk1NjQ3IDI5LjE2OTQ4IDExOS44IDMzLjMpIi8+PHBhdGggZmlsbD0iI2EwOTk5ZCIgZmlsbC1vcGFjaXR5PSIuNSIgZD0iTTEwOS42IDY3LjQgMTI3IDk2LjdsMjEuMS00OS4yeiIvPjxwYXRoIGZpbGw9IiNlMDU5OGQiIGZpbGwtb3BhY2l0eT0iLjUiIGQ9Im0xMzAuMyAxMTUuOCAzLTE2TDk4IDEwNmwtNzQuNCAzNC42eiIvPjxjaXJjbGUgcj0iMSIgZmlsbD0iIzM4M2IxYiIgZmlsbC1vcGFjaXR5PSIuNSIgdHJhbnNmb3JtPSJtYXRyaXgoOC4xNDkwNyAtMTUuNzA2MSAzMi42OTg5OSAxNi45NjU3NyAyNzkuMSAuNikiLz48cGF0aCBmaWxsPSIjNjI1NzU4IiBmaWxsLW9wYWNpdHk9Ii41IiBkPSJtODEuMyA5NC41IDEuNy4yLjMgNi41TDU5IDExMS43eiIvPjxwYXRoIGZpbGw9IiNiOWE0YjMiIGZpbGwtb3BhY2l0eT0iLjUiIGQ9Im0xNDMuNi0xMCA1NSA0NS43LTMxLjYtMi4zeiIvPjxwYXRoIGZpbGw9IiNmOGYwZjQiIGZpbGwtb3BhY2l0eT0iLjUiIGQ9Im00MS42IDc0LjQgMTQtOS40IDkuNCAzLjZ6Ii8+PGNpcmNsZSByPSIxIiBmaWxsPSIjNGM0MjQ1IiBmaWxsLW9wYWNpdHk9Ii41IiB0cmFuc2Zvcm09Im1hdHJpeCgxNC4zOTgxNiAxMS41MTUwMiAtMTYuMzMwMyAyMC40MTkwOSAyODQuNyAxNTQuOCkiLz48cGF0aCBmaWxsPSIjNDQyZTQ5IiBmaWxsLW9wYWNpdHk9Ii41IiBkPSJNLTE4LjIgOTMuNSAyOC42IDEyNGwuNSAxLjgtNDcuMyAyMy40eiIvPjxwYXRoIGZpbGw9IiNmYmVjZWIiIGZpbGwtb3BhY2l0eT0iLjUiIGQ9Im0xMDggOTUtNDMuNyAyMi40IDUyLjMtNDIuMyAxMS40IDU2eiIvPjwvc3ZnPg=="></div><main class="y aa"><article class="z ae ac ba"><div class="bb"><h1 class="bc">A BazarLoader DGA that Breaks Down in the Summer</h1></div><div class="bd"><ul class="i be"><li><svg viewBox="0 0 35 32" class="g"><use href="/assets/svg/icons.svg#icon-calendar-o" xlink:href="/assets/svg/icons.svg#icon-calendar-o"></use></svg> <a href="https://bin.re/2021/08">August 9, 2021</a></li><li><svg viewBox="0 0 35 32" class="g"><use href="/assets/svg/icons.svg#icon-book" xlink:href="/assets/svg/icons.svg#icon-book"></use></svg> <a href="/category/reverse-engineering">reverse engineering</a></li><li><svg viewBox="0 0 35 32" class="g"><use href="/assets/svg/icons.svg#icon-tags" xlink:href="/assets/svg/icons.svg#icon-tags"></use></svg> <span class="bf"><a href="/tag/dga" class="bg">dga</a> <a href="/tag/malware-analysis" class="bg">malware analysis</a></span></li><li><svg viewBox="0 0 35 32" class="g"><use href="/assets/svg/icons.svg#icon-comments-o" xlink:href="/assets/svg/icons.svg#icon-comments-o"></use></svg> no comments</li></ul><div class="bh"><span class="bj">Table of Contents</span><ul class="i bk"><li><a href="#the-sample-examined">The Sample Examined</a></li><li><a href="#the-domain-generation-algorithm">The Domain Generation Algorithm</a></li><li><a href="#the-bug-a-faulty-permutation">The Bug - A Faulty Permutation</a></li><li><a href="#reimplementation-in-python">Reimplementation in Python</a></li><li><a href="#characteristics-of-the-dga">Characteristics of the DGA</a></li></ul><div><span class="bj">Disclaimer<svg viewBox="0 0 35 32" class="g"><use href="/assets/svg/icons.svg#icon-exclamation-triangle" xlink:href="/assets/svg/icons.svg#icon-exclamation-triangle"></use></svg></span><p>These are just unpolished notes. The content likely lacks clarity and structure; and the results might not be adequately verified and/or incomplete.</p></div><span class="bj">Aliases</span><p>The malware in this blog post is also known as <span class="bl">BazarBackdoor</span>, <span class="bl">Team9Backdoor</span>, <span class="bl">BazDor</span>, <span class="bl">BazarLoader</span> and <span class="bl">BazaLoader</span></p><div><span class="bj">Malpedia</span><p>For more information about the malware in this blog post see the <a href="https://malpedia.caad.fkie.fraunhofer.de/details/win.bazarbackdoor" class="bm">Malpedia entry on BazarBackdoor</a>.</p></div><div><span class="bj">URLhaus</span><p><a href="https://urlhaus.abuse.ch/browse/tag/BazarLoader/" class="bm">This page</a> lists malware URLs that are tagged with BazarLoader.</p></div><div><span class="bj">MalwareBazaar</span><p>You can download bazaloader samples from <a href="https://bazaar.abuse.ch/browse/tag/bazaloader/" class="bm">this page</a>.</p></div><div><span class="bj">Cover Image</span> Photo by <a href="https://unsplash.com/@pawelj?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Pawel Janiak</a> on <a href="https://unsplash.com/s/photos/heat?utm_source=unsplash&amp;utm_medium=referral&amp;utm_content=creditCopyText">Unsplash</a></div><div><span class="bj">Related Posts</span> This is one of five blog posts on "Bazar Loader". Check out the other parts here:<ul class="i bn"><li><a href="/blog/the-dga-of-bazarbackdoor/">The Domain Generation Algorithm of BazarLoader (July 11, 2020)</a></li><li><a href="/blog/the-buggy-dga-of-bazarbackdoor/">The Defective Domain Generation Algorithm of BazarLoader (July 15, 2020)</a></li><li><a href="/blog/next-version-of-the-bazarloader-dga/">Next Version of the Bazar Loader DGA (December 16, 2020)</a></li><li><a href="/blog/yet-another-bazarloader-dga/">Yet Another Bazar Loader DGA (January 23, 2021)</a></li></ul></div></div></div><div class="b6 bi"><p><a href="https://twitter.com/andretavare5">André Tavares</a> sent me a Bazar Loader sample whose Domain Generation Algorithm (DGA) shows some interesting behavior. In May, it generates valid domain names with the eponymous top level domain <em>.bazar</em>:</p><p><noscript>&lt;img src="assets/cap_may_2021.png" class=""/&gt;</noscript><img alt="DGA domains in May" class="lazyload" data-src="assets/cap_may_2021.png" data-srcset="assets/cap_may_2021-1x.webp 520w" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MjAiIGhlaWdodD0iNTIwIiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjojTmFOTmFOTmFOIj48L3N2Zz4=" sizes="(max-width: 520px) 100vw, 520px"></p><p>But as soon as June comes around, some generated domains contain invalid characters:</p><p><noscript>&lt;img src="assets/cap_june_2021.png" class=""/&gt;</noscript><img alt="DGA domains in June" class="lazyload" data-src="assets/cap_june_2021.png" data-srcset="assets/cap_june_2021-1x.webp 520w" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MjAiIGhlaWdodD0iNTIwIiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjojTmFOTmFOTmFOIj48L3N2Zz4=" sizes="(max-width: 520px) 100vw, 520px"></p><p>And as it gets to July, all domain names are invalid (with very few exceptions):</p><p><noscript>&lt;img src="assets/cap_july_2021.png" class=""/&gt;</noscript><img alt="DGA domains in July" class="lazyload" data-src="assets/cap_july_2021.png" data-srcset="assets/cap_july_2021-1x.webp 520w" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1MjAiIGhlaWdodD0iNTIwIiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjojTmFOTmFOTmFOIj48L3N2Zz4=" sizes="(max-width: 520px) 100vw, 520px"></p><p>The DGA also fails during August and September. But when October rolls around, all domains are valid again. This continues until next June, when the DGA has problems all over again.</p><p>This short blog post explores what causes the DGA to stop working properly in the summer, of all times.</p><h2 id="the-sample-examined">The Sample Examined</h2><p>I reverse engineered the DGA of the following sample:</p><dl><dt>MD5</dt><dd>5f11f2db1295fa419b190bd7478d9b23</dd><dt>SHA1</dt><dd>96d6c37fa0046a8dc1c520249dc94122e0fb3f52</dd><dt>SHA256</dt><dd>86d2aa04988befc74eccca5d99550f67093969b31aafa11cdce3476a4c59ba74</dd><dt>Size</dt><dd>248 KB (254474 Bytes)</dd><dt>Compile Timestamp</dt><dd>2021-07-13 08:22:30 UTC</dd><dt>Links</dt><dd><a href="https://bazaar.abuse.ch/sample/86d2aa04988befc74eccca5d99550f67093969b31aafa11cdce3476a4c59ba74/">MalwareBazaar</a>, <a href="https://www.capesandbox.com/analysis/172120/">Cape</a>, <a href="https://www.virustotal.com/gui/file/86d2aa04988befc74eccca5d99550f67093969b31aafa11cdce3476a4c59ba74">VirusTotal</a></dd><dt>Filename</dt><dd>5f11f2db1295fa419b190bd7478d9b23.dll (MalwareBazaar), (VirusTotal)</dd><dt>Detections</dt><dd><strong>MalwareBazaar</strong>: BazaLoader, <strong>Virustotal</strong>: 47/75 as of 2021-08-05 11:35:35 - Gen:Variant.Razy.892983 (MicroWorld-eScan), Trojan.Agent (CAT-QuickHeal), Backdoor.Win64.Bazdor.ah (Sangfor), Backdoor:Win64/Bazdor.ae3c68af (Alibaba), Trojan ( 0057f6941 ) (K7GW), Trojan ( 0057f6941 ) (K7AntiVirus), W64/Trojan.FRTN-3244 (Cyren), Win64/BazarLoader.AP (ESET-NOD32), generic.ml (Paloalto), Backdoor.Win64.Bazdor.ah (Kaspersky), Gen:Variant.Razy.892983 (BitDefender), Win64:DropperX-gen [Drp] (Avast), Gen:Variant.Razy.892983 (Ad-Aware), Gen:Variant.Razy.892983 (B) (Emsisoft), Trojan.Agent.Win64.8672 (Zillya), Artemis!Trojan (McAfee-GW-Edition), Trojan.Agent.dkxh (Jiangmin), TR/Redcap.ntozn (Avira), malware (ai score=88) (MAX), Win32.Troj.Undef.(kcloud) (Kingsoft), Trojan.Win64.Agent.oa (Gridinsoft), Trojan:Win64/Cobaltstrike.A!MSR (Microsoft), Backdoor.Win64.Bazdor.ah (ZoneAlarm), Gen:Variant.Razy.892983 (GData), Trojan.Win64.Convagent (VBA32), Gen:Variant.Razy.892983 (ALYac), Trojan.Bazar (Malwarebytes), Trojan.Agent!v7VRXZm6ckQ (Yandex), Trojan.Win64.Bazarloader (Ikarus), Win64:DropperX-gen [Drp] (AVG), Trj/CI.A (Panda)</dd></dl><p>I have unpacked it to the following state:</p><dl><dt>MD5</dt><dd>7c64ea7c4a229414b6048d18ab0836fd</dd><dt>SHA1</dt><dd>f10621be9bfee0152931f7790c2cbff022611f62</dd><dt>SHA256</dt><dd>d15dbfb7ef0511556a3527cc98d09145a56302bdd19a6083ee6d007af3352434</dd><dt>Size</dt><dd>113 KB (116224 Bytes)</dd><dt>Compile Timestamp</dt><dd>2021-07-12 13:27:57 UTC</dd><dt>Links</dt><dd><a href="https://bazaar.abuse.ch/sample/d15dbfb7ef0511556a3527cc98d09145a56302bdd19a6083ee6d007af3352434/">MalwareBazaar</a>, <a href="https://www.capesandbox.com/analysis/175373/">Cape</a>, <a href="https://www.virustotal.com/gui/file/d15dbfb7ef0511556a3527cc98d09145a56302bdd19a6083ee6d007af3352434">VirusTotal</a></dd><dt>Detections</dt><dd><strong>MalwareBazaar</strong>: BazaLoader, <strong>Virustotal</strong>: 40/75 as of 2021-08-05 19:07:37 - Trojan.Win32.Razy.4!c (Lionic), Gen:Variant.Razy.891147 (MicroWorld-eScan), Gen:Variant.Razy.891147 (FireEye), Backdoor.Bazdor.Win64.3 (Zillya), Backdoor:Win64/Bazdor.9312a6ac (Alibaba), Trojan ( 0057f6941 ) (K7GW), Trojan ( 0057f6941 ) (K7AntiVirus), W64/Trojan.QFLC-7900 (Cyren), Win64/BazarLoader.AP (ESET-NOD32), Backdoor.Win64.Bazdor.ax (Kaspersky), Gen:Variant.Razy.891147 (BitDefender), Gen:Variant.Razy.891147 (Ad-Aware), BehavesLike.Win64.Trojan.ch (McAfee-GW-Edition), Gen:Variant.Razy.891147 (B) (Emsisoft), Trojan.Win64.Bazarloader (Ikarus), TR/Redcap.rlvgc (Avira), malware (ai score=81) (MAX), Win32.Hack.Undef.(kcloud) (Kingsoft), Trojan.Win64.Agent.oa (Gridinsoft), Trojan:Win32/Tiggre!rfn (Microsoft), Gen:Variant.Razy.891147 (GData), Backdoor.Win64.Bazdor (VBA32), Gen:Variant.Razy.891147 (ALYac), Trojan.Bazar (Malwarebytes), Win64.Backdoor.Bazdor.Ajls (Tencent), W64/BazarLoader.AP!tr (Fortinet), Trj/CI.A (Panda)</dd></dl><h2 id="the-domain-generation-algorithm">The Domain Generation Algorithm</h2><p>The DGA can be easily be located in the unpacked sample based on the <em>.bazar</em> TLD, for example with this Yara rule:</p><pre tabindex="0"><code class="language-yara" data-lang="yara">rule BazarDGA
{
    strings:
        $bazar_tld= { 2E [4-12] 62 [4-12] 61 [4-12] 7A [4-12] 61 [4-12] 72 }

    condition:
        $bazar_tld
}
</code></pre><p>The rule triggers at the following location, which adds the top level domain to the generated domain (pointed to by <code>rax</code>) at the end of the DGA function:</p><p><noscript>&lt;img src="assets/bazar_tld.png" class=""/&gt;</noscript><img alt="Bazar TLD" class="lazyload" data-src="assets/bazar_tld.png" data-srcset="assets/bazar_tld-1x.webp 559w" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI1NTkiIGhlaWdodD0iMjA0IiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjojTmFOTmFOTmFOIj48L3N2Zz4=" sizes="(max-width: 559px) 100vw, 559px"></p><p>Here is how the DGA works:</p><ol><li><p>BazarLoader divides the letters – except J, which was omitted for unknown reasons – into two character classes:</p><ul><li>the 6 vowels <em>aeiouy</em></li><li>the 19 consonants <em>bcdfghklmnpqrstvwxz</em></li></ul></li><li><p>The two sets are then combined into all 2⋅6⋅19 ordered pairs that contain one vowel and one consonant: <code>ab</code>, <code>ba</code>, <code>eb</code>, <code>be</code>, <code>ib</code>, <code>bi</code>, <code>ob</code>, <code>bo</code>, …, <code>oz</code>, <code>zo</code>, <code>uz</code>, <code>zu</code>, <code>yz</code>, <code>zy</code>.</p></li><li><p>These 228 pairs are then rearranged with a permutation that is hard-coded into the malware. The permutation is the seed of the BazarLoader DGA and offers the possibility to generate a different set of domains with the same algorithm. The permutation is stored as an array of 228 bytes that represent the one-line notation of the permutation. So for example, a permutation of 27, 119, 38, … would place the first pair <code>ab</code> at position 27, the second pair <code>ba</code> at 119, and so on (0 being the first position).</p></li><li><p>Four pairs are then picked from the 228 permutated pairs, and strung together to form the 8 letter long second level domain. Which pairs are selected depends on the current date. The date is formatted as <code>%m%y</code>, where <code>%m</code> is the zero-padded month and <code>%y</code> is the two digit year. For example, December 5, 2035 would be <code>1235</code>. The four digits, e.g., 1, 2, 3 and 5, then define which pairs will be selected for the first, second, third and fourth pair respectively.</p></li><li><p>The <strong>first pair</strong> is selected by first splitting the pairs into groups of 19 pairs. The first digit derived from the current date then serves as the index of the groups to select. Since the first digit can only be 0 or 1, only two groups are possible <sup id="fnref:1"><a href="#fn:1" class="footnote-ref" role="doc-noteref">1</a></sup></p><p><noscript>&lt;img src="assets/pair_1.png" class=""/&gt;</noscript><img alt="First Pair" class="lazyload" data-src="assets/pair_1.png" data-srcset="assets/pair_1-1x.webp 600w" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MDAiIGhlaWdodD0iMTUxIiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjojTmFOTmFOTmFOIj48L3N2Zz4=" sizes="(max-width: 600px) 100vw, 600px"></p><p>BazarLoader then picks a pair at random from the 19 pairs of the given group.</p></li><li><p>The <strong>second pair</strong> is selected like the first pair, except the groups are picked based on the second date digit. This digit can be any value from 0 to 9, so ten different groups are possible:</p><p><noscript>&lt;img src="assets/pair_2.png" class=""/&gt;</noscript><img alt="Second Pair" class="lazyload" data-src="assets/pair_2.png" data-srcset="assets/pair_2-1x.webp 600w" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MDAiIGhlaWdodD0iNTgxIiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjojTmFOTmFOTmFOIj48L3N2Zz4=" sizes="(max-width: 600px) 100vw, 600px"></p></li><li><p>For the <strong>third pair</strong>, the groups only have a size of 4 pairs. Since the third date digit represents the decade, the same group will be selected for years to come.</p><p><noscript>&lt;img src="assets/pair_3.png" class=""/&gt;</noscript><img alt="Third Pair" class="lazyload" data-src="assets/pair_3.png" data-srcset="assets/pair_3-1x.webp 600w" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MDAiIGhlaWdodD0iMTU5IiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjojTmFOTmFOTmFOIj48L3N2Zz4=" sizes="(max-width: 600px) 100vw, 600px"></p></li><li><p>The <strong>fourth pair</strong> is also picked from groups of 4 pairs, based on the least significant digit of the year.</p><p><noscript>&lt;img src="assets/pair_4.png" class=""/&gt;</noscript><img alt="Fourth Pair" class="lazyload" data-src="assets/pair_4.png" data-srcset="assets/pair_4-1x.webp 600w" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI2MDAiIGhlaWdodD0iMTU5IiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjojTmFOTmFOTmFOIj48L3N2Zz4=" sizes="(max-width: 600px) 100vw, 600px"></p></li><li><p>The four picked pairs are concatenated into an 8-letter second level domain, and the top level domain <code>.bazar</code> is appended.</p></li></ol><p>As can be seen from the illustrations above, pairs at higher positions are selected only as a second pair and only during the summer months. And that is exactly what causes the bug.</p><h2 id="the-bug---a-faulty-permutation">The Bug - A Faulty Permutation</h2><p>The DGA is implemented exactly as described above. The hard-coded permutation, however, is incorrect:</p><pre tabindex="0"><code> 57 63 3A 29 25 0E 1E 5C  04 77 5F 37 02 03 28 51 
 61 28 39 64 12 1C 49 30  3D 74 06 07 49 0B 10 33 
 56 10 57 19 4A 3B 2C 2E  36 71 1B 68 24 15 67 5A 
 50 20 45 6E 4C 54 2F 2B  54 62 4A 0B 59 35 51 23 
 4D 08 01 45 1A 0A 7B 27  72 55 0C 08 5B 1F 60 32 
 3C 29 3B 2E 2A 70 3A 0F  17 48 14 2C 4B 25 4E 42 
 44 15 03 05 7C 26 16 06  24 5A 0D 32 46 39 35 5F 
 4F 6F 11 0C 34 5B 47 59  4E 42 5D 5E 1C 66 52 53 
 3F 30 38 21 44 18 00 58  56 1E 40 2A 4B 3E 55 13 
 3E 65 05 0F 1D 09 36 21  22 6D 2D 12 6A 40 17 19 
 3F 34 11 2F 5D 63 5E 6B  31 61 69 22 26 33 0D 7A 
 1D 4D 16 75 7D 0A 4F 02  07 64 79 58 14 1A 53 62 
 0E 41 18 01 31 2B 47 1F  76 5C 09 04 60 43 37 13 
 3D 3C 41 48 2D 43 52 38  73 27 23 46 4C 1B 50 6C 
 78 20 7E 00
</code></pre><p>For the permutation to be valid, i.e., bijective, it would need to contain all numbers from <code>0x00</code> to <code>0xe3</code> (227). But the largest number in the above list of numbers is only <code>0x7E</code> (126). Possibly the wrong data type was chosen when generating the permutation. For example, a signed char to store the numbers 1-228.</p><p>Instead of permuting the pairs, the DGA places them all in the first 127 places. Some pairs will therefore be overwritten by another pair placed in the same spot. For instance the first pair <code>ab</code> is placed at position <code>0x57</code> (first number of the “permutation”) . But since <code>0x57</code> appears a second time (35th number of the “permutation”), the pair <code>ab</code> will be overwritten.</p><p>Similarly, all spots above 127 are never filled. So with the actual “permutation” applied, the illustration for picking the second pair looks as follows, where <code>?</code> denotes undefined memory:</p><p><noscript>&lt;img src="assets/pair_2_bug.png" class=""/&gt;</noscript><img alt="Second Pair - Bug" class="lazyload" data-src="assets/pair_2_bug.png" data-srcset="assets/pair_2_bug-1x.webp 798w,
assets/pair_2_bug-640.webp 640w" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3OTgiIGhlaWdodD0iODAwIiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjojTmFOTmFOTmFOIj48L3N2Zz4=" sizes="(max-width: 798px) 100vw, 798px"></p><p>All pairs in July, August and September are undefined and will likely result in invalid domains. In June, only 13 out of 19 pairs are undefined, hence some domains come out correct. All other months are not affected by the bug.</p><h2 id="reimplementation-in-python">Reimplementation in Python</h2><p>The following Python script will generate all possible domains for a given date. When it is run for months affected by the bug, the resulting domains will contain two <code>??</code> that represent characters from undefined memory.</p><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-Python" data-lang="Python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">argparse</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Param</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">'Param'</span><span class="p">,</span> <span class="s1">'block idx'</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">pool</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s2">"yzewevmeywreomvi"</span>
</span></span><span class="line"><span class="cl">    <span class="s2">"ekwyavygontowaer"</span>
</span></span><span class="line"><span class="cl">    <span class="s2">"udsoyrexvuamtyse"</span>
</span></span><span class="line"><span class="cl">    <span class="s2">"weesuvizpituiqow"</span>
</span></span><span class="line"><span class="cl">    <span class="s2">"uzoretzemuultiaz"</span>
</span></span><span class="line"><span class="cl">    <span class="s2">"icukoqiwolxuykos"</span>
</span></span><span class="line"><span class="cl">    <span class="s2">"upwiymitisneroxe"</span>
</span></span><span class="line"><span class="cl">    <span class="s2">"yxanlekyixxirasi"</span>
</span></span><span class="line"><span class="cl">    <span class="s2">"asxoapuxqaohezwo"</span>
</span></span><span class="line"><span class="cl">    <span class="s2">"oxdigyquziutpave"</span>
</span></span><span class="line"><span class="cl">    <span class="s2">"zohexyvyguqyqidy"</span>
</span></span><span class="line"><span class="cl">    <span class="s2">"ovynumunuwsusyen"</span>
</span></span><span class="line"><span class="cl">    <span class="s2">"xaatyvusivaripfy"</span>
</span></span><span class="line"><span class="cl">    <span class="s2">"oftesaysozuregin"</span>
</span></span><span class="line"><span class="cl">    <span class="s2">"alifkazaadytwuub"</span>
</span></span><span class="line"><span class="cl">    <span class="s2">"zuvoothymivazy"</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">pool</span> <span class="o">+=</span><span class="p">(</span><span class="mi">10</span><span class="o">*</span><span class="mi">19</span><span class="o">*</span><span class="mi">2</span> <span class="o">-</span> <span class="nb">len</span><span class="p">(</span><span class="n">pool</span><span class="p">))</span><span class="o">*</span><span class="s2">"?"</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">dga</span><span class="p">(</span><span class="n">date</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">seed</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">"%m%Y"</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">params</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="n">Param</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">Param</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">Param</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">Param</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">ranges</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">s</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">seed</span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">idx</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="n">lower</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">block</span><span class="o">*</span><span class="n">s</span>
</span></span><span class="line"><span class="cl">        <span class="n">upper</span> <span class="o">=</span> <span class="n">lower</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">block</span>
</span></span><span class="line"><span class="cl">        <span class="n">ranges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="n">domains</span> <span class="o">=</span> <span class="nb">set</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">indices</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">ranges</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">domain</span> <span class="o">=</span> <span class="s2">""</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">domain</span> <span class="o">+=</span> <span class="n">pool</span><span class="p">[</span><span class="n">index</span><span class="o">*</span><span class="mi">2</span><span class="p">:</span><span class="n">index</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">domain</span> <span class="o">+=</span> <span class="s2">".bazar"</span>
</span></span><span class="line"><span class="cl">        <span class="n">domains</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">domains</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="s2">"-d"</span><span class="p">,</span> <span class="s2">"--date"</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">"date used for seeding, e.g., 2020-06-28"</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">default</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">'%Y-%m-</span><span class="si">%d</span><span class="s1">'</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">d</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="s2">"%Y-%m-</span><span class="si">%d</span><span class="s2">"</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">domain</span> <span class="ow">in</span> <span class="n">dga</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
</span></span></code></pre></div><h2 id="characteristics-of-the-dga">Characteristics of the DGA</h2><p>The following table summarizes the properties of the BazarLoader DGA when it is working as intended, i.e., October through May.</p><table><thead><tr><th>property</th><th>value</th></tr></thead><tbody><tr><td>type</td><td>TDD (time-dependent-deterministic)</td></tr><tr><td>generation scheme</td><td>arithmetic</td></tr><tr><td>seed</td><td>current date</td></tr><tr><td>domain change frequency</td><td>every month</td></tr><tr><td>unique domains per month</td><td>5776</td></tr><tr><td>sequence</td><td>random selection, might pick domains multiple times</td></tr><tr><td>wait time between domains</td><td>none</td></tr><tr><td>top level domain</td><td>.bazar</td></tr><tr><td>second level characters</td><td>a-z, without j</td></tr><tr><td>regex</td><td>[a-ik-z]{8}.bazar</td></tr><tr><td>second level domain length</td><td>8</td></tr></tbody></table><div class="footnotes" role="doc-endnotes"><hr><ol><li id="fn:1"><p>note that the letters used in the illustrations are randomly placed and not the actual letter pairs that BazarLoader uses.&nbsp;<a href="#fnref:1" class="footnote-backref" role="doc-backlink">↩︎</a></p></li></ol></div></div></article></main><footer><div><div class="y"><div class="z ae aj"><div class="ag ak al am"><h3>Links</h3><ul class="i an"><li><a href="http://www.twitter.com/viql" rel="me"><svg viewBox="0 0 35 32" class="g"><use href="/assets/svg/icons.svg#icon-twitter" xlink:href="/assets/svg/icons.svg#icon-twitter"></use></svg> Twitter</a></li><li><a href="http://www.github.com/baderj" rel="me"><svg viewBox="0 0 35 32" class="g"><use href="/assets/svg/icons.svg#icon-github" xlink:href="/assets/svg/icons.svg#icon-github"></use></svg> GitHub</a></li><li><a href="mailto:hello@bin.re" rel="me"><svg viewBox="0 0 35 32" class="g"><use href="/assets/svg/icons.svg#icon-envelope-o" xlink:href="/assets/svg/icons.svg#icon-envelope-o"></use></svg> Mail</a></li><li><a href="https://keybase.io/baderj" rel="me"><svg viewBox="0 0 35 32" class="g"><use href="/assets/svg/icons.svg#icon-keybase" xlink:href="/assets/svg/icons.svg#icon-keybase"></use></svg> Keybase</a></li><li><a href="/feed.xml" rel="me"><svg viewBox="0 0 35 32" class="g"><use href="/assets/svg/icons.svg#icon-feed" xlink:href="/assets/svg/icons.svg#icon-feed"></use></svg> RSS</a></li><li><a href="https://threatcat.ch" rel="me"><svg viewBox="0 0 35 32" class="g"><use href="/assets/svg/icons.svg#icon-threatcat" xlink:href="/assets/svg/icons.svg#icon-threatcat"></use></svg> Threatcat.ch</a></li><li><a href="https://infosec.exchange/@viql" rel="me"><svg viewBox="0 0 35 32" class="g"><use href="/assets/svg/icons.svg#icon-mastodon" xlink:href="/assets/svg/icons.svg#icon-mastodon"></use></svg> Mastodon</a></li><li><a href="https://bsky.app/profile/viql.bsky.social" rel="me"><svg viewBox="0 0 35 32" class="g"><use href="/assets/svg/icons.svg#icon-bluesky" xlink:href="/assets/svg/icons.svg#icon-bluesky"></use></svg> Bluesky</a></li></ul></div><div class="ag ak al am"><div><h3>Categories</h3><ul class="i"><li><a href="/category/reverse-engineering">reverse-engineering</a> <span class="ao">(81)</span></li><li><a href="/category/tutorial">tutorial</a> <span class="ao">(14)</span></li><li><a href="/category/project-euler">project-euler</a> <span class="ao">(13)</span></li><li><a href="/category/misc">misc</a> <span class="ao">(2)</span></li><li><a href="/category/visualization">visualization</a> <span class="ao">(2)</span></li></ul></div></div><div class="ag ak al am a7"><div><h3>Tags</h3><span class="ap"><a href="/tag/malware-analysis" class="aq">malware-analysis <span class="ao">(42)</span></a><a href="/tag/dga" class="aq">dga <span class="ao">(36)</span></a><a href="/tag/crackmes" class="aq">crackmes <span class="ao">(23)</span></a><a href="/tag/practical-reverse-engineering" class="aq">practical-reverse-engineering <span class="ao">(16)</span></a><a href="/tag/math" class="aq">math <span class="ao">(15)</span></a><a href="/tag/project-euler" class="aq">project-euler <span class="ao">(13)</span></a><a href="/tag/python" class="aq">python <span class="ao">(12)</span></a><a href="/tag/upatre" class="aq">upatre <span class="ao">(4)</span></a><a href="/tag/visualization" class="aq">visualization <span class="ao">(4)</span></a><a href="/tag/d3js" class="aq">d3js <span class="ao">(3)</span></a></span> <a href="/tag/" class="ar">show all</a></div></div><div class="ag ak al am as"><div class="at"><div><h3>Blog Archive</h3><span class="au"><a href="/2013">2013</a><span class="ao">(20)</span></span> <span class="au"><a href="/2014">2014</a><span class="ao">(46)</span></span> <span class="au"><a href="/2015">2015</a><span class="ao">(24)</span></span> <span class="au"><a href="/2016">2016</a><span class="ao">(6)</span></span> <span class="au"><a href="/2018">2018</a><span class="ao">(1)</span></span> <span class="au"><a href="/2019">2019</a><span class="ao">(2)</span></span> <span class="au"><a href="/2020">2020</a><span class="ao">(5)</span></span> <span class="au"><a href="/2021">2021</a><span class="ao">(3)</span></span> <span class="au"><a href="/2022">2022</a><span class="ao">(3)</span></span> <span class="au"><a href="/2023">2023</a><span class="ao">(2)</span></span></div></div></div></div></div><div class="y av"><div class="z"><div class="ag"><p>© 2012 - 2025 Johannes Bader, last updated July 31, 2025</p></div></div></div></div></footer></div></div></body></html>