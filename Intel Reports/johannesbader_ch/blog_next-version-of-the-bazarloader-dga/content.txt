<!doctype html><html lang="en-US"><head><link href="/assets/fonts/Montserrat-VariableFont_wght.woff2" rel="preload" type="font/woff2" as="font" crossorigin=""><meta charset="utf-8"><meta content="IE=edge" http-equiv="X-UA-Compatible"><title>Next Version of the Bazar Loader DGA</title><meta content="This blog post shows yet another domain generation algorithm of Bazar Loader. Although it still uses exclusively the .bazar top level domain and similar seeding, the algorithm  itself is completely new." name="description" property="og:description"><meta content="width=device-width,initial-scale=1" name="viewport"><meta content="en_US" property="og:locale"><meta content="./assets/img/front/bazar2-800.jpeg" property="og:image"><meta content="website" property="og:type"><meta content="Binary Reverse Engineering Blog" property="og:site_name"><meta content="Next Version of the Bazar Loader DGA" property="og:title"><meta content="summary" name="twitter:card"><meta content="@viql" name="twitter:site"><meta content="@viql" name="twitter:creator"><meta content="Next Version of the Bazar Loader DGA" name="twitter:title"><meta content="This blog post shows yet another domain generation algorithm of Bazar Loader. Although it still uses exclusively the .bazar top level domain and similar seeding, the algorithm  itself is completely new." name="twitter:description"><meta content="https://bin.re/assets/img/front/bazar2-800.jpeg" name="twitter:image"><link href="/assets/css/common-bb493b.css" rel="stylesheet"><link href="feed.xml" rel="alternate" type="application/atom+xml" title="Atom feed for the Blog"><link href="/assets/css/blog-a83391.css" rel="stylesheet"><link href="/apple-touch-icon-60x60.png" rel="apple-touch-icon" sizes="60x60"><link href="/apple-touch-icon-76x76.png" rel="apple-touch-icon" sizes="76x76"><link href="/apple-touch-icon-120x120.png" rel="apple-touch-icon" sizes="120x120"><link href="/apple-touch-icon-152x152.png" rel="apple-touch-icon" sizes="152x152"><link href="/apple-touch-icon-180x180.png" rel="apple-touch-icon" sizes="180x180"><link href="/apple-touch-icon-192x192.png" rel="apple-touch-icon" sizes="192x192"><link href="/apple-touch-icon-512x512.png" rel="apple-touch-icon" sizes="512x512"><link href="/favicon-32x32.png" rel="icon" sizes="32x32" type="image/png"><link href="/favicon-192x192.png" rel="icon" sizes="192x192" type="image/png"><link href="/favicon-16x16.png" rel="icon" sizes="16x16" type="image/png"><link href="/favicon.ico" rel="shortcut icon"><noscript><style>img.lazyload {
          display: none;
        }</style></noscript><script src="/assets/js/all.min-a1c570.js" defer></script><script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script><script src="/assets/js/mathjax-local-ec3392.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.6/MathJax.js?config=TeX-AMS-MML_HTMLorMML" crossorigin="anonymous" integrity="sha256-nlrDrBTHxJJlDDX22AS33xYI1OJHnGMDhiYMSe2U0e0="></script></head><body class="a b7"><div class="b"><div class="d"><div class="f e"><svg viewBox="0 0 35 32" class="g"><use href="/assets/svg/icons.svg#icon-close" xlink:href="/assets/svg/icons.svg#icon-close"></use></svg></div><div class="h"><ul class="i j sidebar"><li class="q r"><a href="/">Home</a></li><li class="q"><a href="/publications/">Publications</a></li><li class="q t"><span class="u">Varia<svg viewBox="0 0 35 32" class="g"><use href="/assets/svg/icons.svg#icon-angle-down" xlink:href="/assets/svg/icons.svg#icon-angle-down"></use></svg></span><ul class="v"><li><a href="/projects/risk-battle-outcomes/">Probability of Winning Battles in Risk</a></li><li><a href="/tag/project-euler/">Project Euler</a></li><li><a href="/projects/bazarbackdoor/">BazarBackdoor Tools</a></li></ul></li><li class="q t"><span class="u">Reverse Engineering<svg viewBox="0 0 35 32" class="g"><use href="/assets/svg/icons.svg#icon-angle-down" xlink:href="/assets/svg/icons.svg#icon-angle-down"></use></svg></span><ul class="v"><li><a href="/tag/malware-analysis/">Malware Analysis</a></li><li><a href="/projects/solutions-to-crackmes/">Solutions to Crackmes</a></li><li><a href="/projects/solutions-to-practical-reverse-engineering/">Solutions to "Practical Reverse Engineering"</a></li></ul></li></ul></div></div></div><div id="aw"><div class="w"><header class="y x"><nav class="z a0"><a href="/"><span class="a1"><!-- Generator: Adobe Illustrator 25.0.0, SVG Export Plug-In  --> <svg viewBox="0 0 86.4 20.21" height="20.21px" style="overflow:visible;enable-background:new 0 0 86.4 20.21;" version="1.1" width="86.4px" x="0px" xml:space="preserve" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" y="0px"><g><path class="a2" d="M28.56,5.13c-1.99,0-2.87-1.12-2.87-2.57c0-1.5,0.9-2.57,2.87-2.57c2.02,0,2.95,1.07,2.95,2.57
    C31.51,4.01,30.58,5.13,28.56,5.13z M25.96,19.94V6.47h5.22v13.46H25.96z"></path><path class="a2" d="M43.69,19.94v-7.92c0-1.23-0.27-1.91-1.59-1.91c-0.6,0-1.53,0.3-2.24,0.76v9.07H34.6V6.45h4.89l0.08,1.31
    l0.16,0.05c1.58-1.12,3.5-1.69,4.78-1.69c3.47,0,4.42,1.91,4.42,4.86v8.96H43.69z"></path><path class="a2" d="M54.33,20.15c-1.83,0-2.62-1.01-2.62-2.37c0-1.37,0.82-2.35,2.62-2.35c1.86,0,2.68,0.98,2.68,2.35
    C57,19.14,56.16,20.15,54.33,20.15z"></path><path class="a2" d="M65.14,9.23c1.58-1.69,3.85-3.17,5.49-3.17c0.63,0,0.79,0.49,0.79,1.09c0,1.45-0.87,4.29-1.58,5.3l-4.51-0.57
    v8.06h-5.21V6.45h5.16c0,0.66-0.14,2.08-0.25,2.7L65.14,9.23z"></path><path class="a2" d="M86.4,12.78v1.2h-8.63c0.03,1.72,1.07,2.4,3.03,2.4c1.34,0,3-0.35,4.34-0.76l0.98,3.2
    c-1.94,1.04-4.34,1.39-6.25,1.39c-5.9,0-7.32-3.33-7.32-6.99c0-3.41,1.58-7.13,7.07-7.13C85.74,6.09,86.4,9.78,86.4,12.78z
     M77.82,11.52h3.9c-0.03-1.31-0.41-2.29-1.83-2.29C78.4,9.23,77.93,10.32,77.82,11.52z"></path><path class="a2" d="M6.92,12.81"></path><path class="a2" d="M17.24,6.06c-0.79,0-2.43,0.29-3.87,1.3c0-0.14-0.06-2.69-0.06-3.07V0.27H8.12v9.28
    c2.71-0.69,4.54-1.87,5.24-2.18v3.06c-0.85,0.55-4.15,2.11-5.24,2.44v5.86c2.62,1.28,6.12,1.48,7.54,1.48
    c5.79,0,7.16-3.33,7.16-7.02C22.82,9.07,21.45,6.06,17.24,6.06z M15.41,16.6c-0.54,0-1.31-0.08-2.05-0.38v-5.79
    c0.66-0.33,1.45-0.65,2.16-0.65c1.01,0,2.1,0.35,2.1,3.47C17.63,16.14,16.59,16.6,15.41,16.6z"></path><path class="a2" d="M8.12,9.55c-1.03,0.23-2.56,0.51-3.66,0.23l0-3.09L0,11.57l4.51,4.88l0-3.13c1.38,0.17,2.69-0.23,3.61-0.45
    V9.55z"></path></g></svg></span></a><div class="a3"><button class="a2 a4" id="ax"><svg height="20px" version="1.1" width="20px" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewport="0 0 20 20"><path class="a5" d="M2.28,15.89l1.57-1.61l1.24,1.24l-1.57,1.61L2.28,15.89z M8.86,19.33v-2.61h1.74v2.61H8.86z M9.73,4.35
	c1.46,0,2.71,0.52,3.75,1.55s1.55,2.28,1.55,3.75s-0.52,2.71-1.55,3.75c-1.03,1.03-2.28,1.55-3.75,1.55s-2.71-0.52-3.75-1.55
	s-1.55-2.28-1.55-3.75S4.95,6.93,5.98,5.9S8.26,4.35,9.73,4.35z M16.81,8.77h2.65v1.78h-2.65V8.77z M14.36,15.52l1.24-1.2l1.57,1.57
	l-1.24,1.24L14.36,15.52z M17.18,3.43l-1.57,1.57l-1.24-1.24l1.57-1.57L17.18,3.43z M10.6,0v2.61H8.86V0C8.86,0,10.6,0,10.6,0z
	 M2.65,8.77v1.78H0V8.77H2.65z M5.09,3.77L3.85,5.01L2.28,3.43l1.24-1.24L5.09,3.77z"></path><path class="a6" d="M14.18,14.19c3.31-3.31,3.31-8.67,0-11.97C13.06,1.1,11.7,0.36,10.26,0c2.2,2.88,1.98,7.01-0.65,9.65
	C6.99,12.26,2.88,12.49,0,10.33c0.37,1.41,1.1,2.76,2.21,3.87C5.52,17.5,10.88,17.5,14.18,14.19z M7.1,2.48H6.36l0.52,0.52
	L6.55,3.34L6.03,2.81v0.74H5.56V2.81L5.04,3.34L4.71,3.01l0.52-0.52H4.49V2.02h0.74L4.71,1.49l0.33-0.33l0.52,0.52V0.95h0.47v0.74
	l0.52-0.52l0.33,0.33L6.36,2.02H7.1V2.48z M0.94,3.94c0,0.26-0.21,0.47-0.47,0.47S0,4.2,0,3.94s0.21-0.47,0.47-0.47
	S0.94,3.68,0.94,3.94z M3.88,5.66c0,0.29-0.24,0.53-0.53,0.53S2.83,5.95,2.83,5.66c0-0.29,0.24-0.53,0.53-0.53S3.88,5.36,3.88,5.66z
	"></path></svg></button><ul class="i j a7"><li class="q"><a href="/">Home</a></li><li class="q"><a href="/publications/">Publications</a></li><li class="q t"><span class="u">Varia<svg viewBox="0 0 35 32" class="g"><use href="/assets/svg/icons.svg#icon-angle-down" xlink:href="/assets/svg/icons.svg#icon-angle-down"></use></svg></span><ul class="v"><li><a href="/projects/risk-battle-outcomes/">Probability of Winning Battles in Risk</a></li><li><a href="/tag/project-euler/">Project Euler</a></li><li><a href="/projects/bazarbackdoor/">BazarBackdoor Tools</a></li></ul></li><li class="q t r"><span class="u">Reverse Engineering<svg viewBox="0 0 35 32" class="g"><use href="/assets/svg/icons.svg#icon-angle-down" xlink:href="/assets/svg/icons.svg#icon-angle-down"></use></svg></span><ul class="v"><li><a href="/tag/malware-analysis/">Malware Analysis</a></li><li><a href="/projects/solutions-to-crackmes/">Solutions to Crackmes</a></li><li><a href="/projects/solutions-to-practical-reverse-engineering/">Solutions to "Practical Reverse Engineering"</a></li></ul></li></ul><div class="f a8 a9"><svg viewBox="0 0 35 32" class="g"><use href="/assets/svg/icons.svg#icon-bars" xlink:href="/assets/svg/icons.svg#icon-bars"></use></svg></div></div></nav></header><div class="b8"><noscript>&lt;img src="/assets/img/header/bazar2-640.jpeg" class="-minfy-post__title-image"/&gt;</noscript><img alt="cover image for post 'Next Version of the Bazar Loader DGA'" class="lazyload b9" data-src="/assets/img/header/bazar2-640.jpeg" data-srcset="/assets/img/header/bazar2-1830.webp 1830w,
/assets/img/header/bazar2-1400.webp 1400w,
/assets/img/header/bazar2-1080.webp 1080w,
/assets/img/header/bazar2-830.webp 830w,
/assets/img/header/bazar2-640.webp 640w" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIzMDAiIGhlaWdodD0iMjMzIj48cGF0aCBmaWxsPSIjNTMzNzJkIiBkPSJNMCAwaDMwMHYyMzNIMHoiLz48ZyBmaWxsLW9wYWNpdHk9Ii41IiB0cmFuc2Zvcm09InRyYW5zbGF0ZSguNiAuNilzY2FsZSgxLjE3MTg4KSI+PGNpcmNsZSByPSIxIiBmaWxsPSIjZTI4YTFmIiB0cmFuc2Zvcm09InJvdGF0ZSg1OS41IC03MyAxODkuNylzY2FsZSgxMjUuODk5MjggMjM3LjUwMikiLz48Y2lyY2xlIHI9IjEiIGZpbGw9IiNmZmQ2ODYiIHRyYW5zZm9ybT0ibWF0cml4KDYxLjMzNzcxIC00NC43MjgyMyA4Ljc1MDc2IDEyLjAwMDI5IDQ0LjcgMTQ5LjcpIi8+PGNpcmNsZSByPSIxIiBmaWxsPSIjNmYzMDAyIiB0cmFuc2Zvcm09InJvdGF0ZSgtMTY2LjYgNzMuNiAxNClzY2FsZSgyNDQuMTg5MDIgNDUuMjAzMjMpIi8+PGNpcmNsZSByPSIxIiBmaWxsPSIjZjdjMDQ0IiB0cmFuc2Zvcm09InJvdGF0ZSgxMTMuOCA2MS41IDE0Ni43KXNjYWxlKDQwLjUyNTkyIDIyLjAyNTMpIi8+PHBhdGggZmlsbD0iI2ZmZmZiMiIgZD0ibTc1LjggOTMuMSAxNC4xIDMuN0wxMDcuMyA3MmwtMzcuMiA1LjF6Ii8+PHBhdGggZmlsbD0iI2Q0OTY0MCIgZD0ibTMxIDEwLTQ3IDE3MiA2NC00MXoiLz48ZWxsaXBzZSBjeD0iMTQ4IiBjeT0iODAiIGZpbGw9IiNmZmY3YjMiIHJ4PSIzMCIgcnk9IjUiLz48Y2lyY2xlIHI9IjEiIGZpbGw9IiM0YzA3MDUiIHRyYW5zZm9ybT0icm90YXRlKC0xNDAuMyA4Ny4xIDYxLjgpc2NhbGUoMTEuMDUyNjUgNjAuOTUxNTIpIi8+PGVsbGlwc2UgY3g9IjEzMCIgY3k9IjE5MiIgZmlsbD0iI2ZmZWQ3MyIgcng9IjI0IiByeT0iMTAiLz48cGF0aCBmaWxsPSIjMjcwODAwIiBkPSJtNzYgMTUgMjggMTctODEgNzN6Ii8+PHBhdGggZmlsbD0iIzFjMGMwYyIgZD0ibTE4NSA3MS0xMyAzMCA5OS05eiIvPjxwYXRoIGZpbGw9IiNmNGI5NzYiIGQ9Im0yMTIgMTYwLTYxLTI3IDEzLTIyeiIvPjxjaXJjbGUgcj0iMSIgZmlsbD0iIzJmMDMwMiIgdHJhbnNmb3JtPSJtYXRyaXgoMTguMTA4MTQgLTEwLjIwMzQxIDUuMzI5NzMgOS40NTg3NSA2MS4zIDEwNi42KSIvPjxjaXJjbGUgY3g9IjQyIiBjeT0iMTc0IiByPSIzNiIgZmlsbD0iI2UyOWQ0YyIvPjxwYXRoIGZpbGw9IiNmZmUxN2QiIGQ9Im0tMTYgMTEzIDQwLTI0LTIxIDYzeiIvPjxwYXRoIGZpbGw9IiNmZmUwODUiIGQ9Im0yMCAzMy0zNS0xIDYtMzB6Ii8+PHBhdGggZmlsbD0iI2IxNTgxMCIgZD0ibS0xNiA4OS41IDU1LjctMjEuOSAyNy0yMC4yLTIxLjktMzEuOXoiLz48cGF0aCBmaWxsPSIjM2QwMDAwIiBkPSJtMTg1IDE2NS0yMC0zMi0yNiAyM3oiLz48Y2lyY2xlIHI9IjEiIGZpbGw9IiNmZmEyMjgiIHRyYW5zZm9ybT0icm90YXRlKDU4LjEgLTEwLjYgMTA5LjYpc2NhbGUoNy42MDg5MyAyMC41NTcxNSkiLz48cGF0aCBmaWxsPSIjMzYwMDA5IiBkPSJNMTI3IDUwaDQ1djIxaC00NXoiLz48cmVjdCB3aWR0aD0iMTAwJSIgaGVpZ2h0PSIxMDAlIiB4PSItLjUiIHk9Ii0uNSIgZmlsbD0iIzFhMDAwMCIgdHJhbnNmb3JtPSJyb3RhdGUoLTY1IDY5LjEgMzUuMilzY2FsZSgzMCAxNSkiLz48cGF0aCBmaWxsPSIjZmZlZmQ4IiBkPSJtMTA4IDE0MC41IDI1LjktMjIuMS0yOC42IDM4LjMgMTEuMi0yMC42eiIvPjxwYXRoIGZpbGw9IiM1MzIyMDIiIGQ9Im0yMDUuNiA2MCA0LjQtMzUuOCA4MC40IDkuOS00LjQgMzUuN3oiLz48Y2lyY2xlIHI9IjEiIGZpbGw9IiMzZTBhMDAiIHRyYW5zZm9ybT0ibWF0cml4KC03Ljc1NDMzIC05LjcxMzY4IDcuNTE3MjIgLTYuMDAwOTIgODUgMTU1LjMpIi8+PHBhdGggZmlsbD0iI2ZmZmZiZiIgZD0iTTEwNSAxNWg4djdoLTh6Ii8+PHBhdGggZmlsbD0iIzc3MjkwZiIgZD0ibTk3IDEwMyAyNS05NCAyNSA5OXoiLz48cGF0aCBmaWxsPSIjZmZlODU4IiBkPSJtMTk3LjQgMTMzLjggNS40LTYuMyA2LjQtMTAuNy0xNi45LTcuN3oiLz48cGF0aCBmaWxsPSIjZmVlMjhkIiBkPSJNNjcuNSAxNDguNSA4Ni40IDEzMGwtMjMtNC4yLTMxIDIyLjZ6Ii8+PHBhdGggZmlsbD0iIzU0MTcwMCIgZD0ibTE2My40IDIwNC40IDExLjQtMjcuMi04MC05LjIgNjEuMiAxOHoiLz48cGF0aCBmaWxsPSIjOTM1YTFjIiBkPSJNMjEgOTFoMTh2NjNIMjF6Ii8+PC9nPjwvc3ZnPg=="></div><main class="y aa"><article class="z ae ac ba"><div class="bb"><h1 class="bc">Next Version of the Bazar Loader DGA</h1></div><div class="bd"><ul class="i be"><li><svg viewBox="0 0 35 32" class="g"><use href="/assets/svg/icons.svg#icon-calendar-o" xlink:href="/assets/svg/icons.svg#icon-calendar-o"></use></svg> <a href="https://bin.re/2020/12">December 16, 2020</a></li><li><svg viewBox="0 0 35 32" class="g"><use href="/assets/svg/icons.svg#icon-book" xlink:href="/assets/svg/icons.svg#icon-book"></use></svg> <a href="/category/reverse-engineering">reverse engineering</a></li><li><svg viewBox="0 0 35 32" class="g"><use href="/assets/svg/icons.svg#icon-tags" xlink:href="/assets/svg/icons.svg#icon-tags"></use></svg> <span class="bf"><a href="/tag/dga" class="bg">dga</a> <a href="/tag/malware-analysis" class="bg">malware analysis</a></span></li><li><svg viewBox="0 0 35 32" class="g"><use href="/assets/svg/icons.svg#icon-comments-o" xlink:href="/assets/svg/icons.svg#icon-comments-o"></use></svg> no comments</li></ul><div class="bh"><span class="bj">Table of Contents</span><ul class="i bk"><li><a href="#reverse-engineering">Reverse Engineering</a></li><li><a href="#reimplementation-in-python">Reimplementation in Python</a></li><li><a href="#characteristics">Characteristics</a></li></ul><div><span class="bj">Disclaimer<svg viewBox="0 0 35 32" class="g"><use href="/assets/svg/icons.svg#icon-exclamation-triangle" xlink:href="/assets/svg/icons.svg#icon-exclamation-triangle"></use></svg></span><p>These are just unpolished notes. The content likely lacks clarity and structure; and the results might not be adequately verified and/or incomplete.</p></div><span class="bj">Aliases</span><p>The malware in this blog post is also known as <span class="bl">BazarBackdoor</span>, <span class="bl">Team9Backdoor</span>, <span class="bl">BazDor</span>, <span class="bl">BazarLoader</span> and <span class="bl">BazaLoader</span></p><div><span class="bj">DGArchive</span><p>The DGA in this blog post has been implemented by the <a href="https://dgarchive.caad.fkie.fraunhofer.de/" class="bm">DGArchive</a> project.</p></div><div><span class="bj">Malpedia</span><p>For more information about the malware in this blog post see the <a href="https://malpedia.caad.fkie.fraunhofer.de/details/win.bazarbackdoor" class="bm">Malpedia entry on BazarBackdoor</a>.</p></div><div><span class="bj">URLhaus</span><p><a href="https://urlhaus.abuse.ch/browse/tag/BazarLoader/" class="bm">This page</a> lists malware URLs that are tagged with BazarLoader.</p></div><div><span class="bj">MalwareBazaar</span><p>You can download bazaloader samples from <a href="https://bazaar.abuse.ch/browse/tag/bazaloader/" class="bm">this page</a>.</p></div><div><span class="bj">Cover Image</span> Image by <a href="https://pixabay.com/users/falco_81448">falco</a> from <a href="https://pixabay.com/">Pixabay</a></div><div><span class="bj">Related Posts</span> This is one of five blog posts on "Bazar Loader". Check out the other parts here:<ul class="i bn"><li><a href="/blog/the-dga-of-bazarbackdoor/">The Domain Generation Algorithm of BazarLoader (July 11, 2020)</a></li><li><a href="/blog/the-buggy-dga-of-bazarbackdoor/">The Defective Domain Generation Algorithm of BazarLoader (July 15, 2020)</a></li><li><a href="/blog/yet-another-bazarloader-dga/">Yet Another Bazar Loader DGA (January 23, 2021)</a></li><li><a href="/blog/a-bazarloader-dga-that-breaks-during-summer-months/">A BazarLoader DGA that Breaks Down in the Summer (August 9, 2021)</a></li></ul></div></div></div><div class="b6 bi"><p>Last week, a new version of the Bazar Loader Domain Generation Algorithm (DGA) appeared. I already analyzed two <a href="/blog/the-dga-of-bazarbackdoor/">previous</a> <a href="/blog/the-buggy-dga-of-bazarbackdoor/">versions</a>, so I’m keeping this post short.</p><p>The DGA still uses the eponymous <em>.bazar</em> top level domain, but the second level domains are shorter with 8 characters instead of 12 for the previous versions:</p><pre tabindex="0"><code>liybelac.bazar
izryudew.bazar
biymudqe.bazar
fuicibem.bazar
biykonem.bazar
aqtielew.bazar
yptaonem.bazar
exyxtoca.bazar
iqfisoew.bazar
aguponew.bazar
exogelqe.bazar
exybonyw.bazar
etymonac.bazar
</code></pre><p>I analysed the following sample without much obfuscation. There are many other samples that have additional reverse engineering counter measures such as junk code, but a quick comparison revealed no functional differences.</p><dl><dt>MD5</dt><dd>c6502d4dd27a434167686bfa4d183e89</dd><dt>SHA1</dt><dd>bddbceefe4185693ef9015d0a535eb7e034b9ec3</dd><dt>SHA256</dt><dd>35683ac5bbcc63eb33d552878d02ff44582161d1ea1ff969b14ea326083ea780</dd><dt>Size</dt><dd>336 KB (344576 Bytes)</dd><dt>Compile Timestamp</dt><dd>2020-12-10 13:05:18 UTC</dd><dt>Links</dt><dd><a href="https://bazaar.abuse.ch/sample/35683ac5bbcc63eb33d552878d02ff44582161d1ea1ff969b14ea326083ea780/">MalwareBazaar</a>, <a href="https://malpedia.caad.fkie.fraunhofer.de/details/win.bazarbackdoor">Malpedia</a>, <a href="https://www.capesandbox.com/analysis/108231/">Cape</a>, <a href="https://www.virustotal.com/gui/file/35683ac5bbcc63eb33d552878d02ff44582161d1ea1ff969b14ea326083ea780">VirusTotal</a></dd><dt>Filenames</dt><dd>1ld.3.v1.exe, 35683ac5bbcc63eb33d552878d02ff44582161d1ea1ff969b14ea326083ea780 (VirusTotal)</dd><dt>Detections</dt><dd><strong>Virustotal</strong>: 8/72 as of 2020-12-11 02:58:32 - Win64/Bazar.Y (ESET-NOD32), Backdoor.Win32.Bazdor.co (Kaspersky), Trojan.Win64.BAZALOADER.SMYAAJ-A (TrendMicro), Trojan.Win64.BAZALOADER.SMYAAJ-A (TrendMicro-HouseCall)</dd></dl><p>Unpacking the sample leads to this:</p><dl><dt>MD5</dt><dd>e44cfd6ecc1ea0015c28a75964d19799</dd><dt>SHA1</dt><dd>cb294c79b5d48840382a06c4021bc2772fdbcf63</dd><dt>SHA256</dt><dd>52e72513fe2a38707aa63fbc52dabd7c7d2c5809ed7e27f384315375426f57bf</dd><dt>Size</dt><dd>96 KB (98816 Bytes)</dd><dt>Compile Timestamp</dt><dd>2020-12-09 10:16:56 UTC</dd><dt>Links</dt><dd><a href="https://bazaar.abuse.ch/sample/52e72513fe2a38707aa63fbc52dabd7c7d2c5809ed7e27f384315375426f57bf/">MalwareBazaar</a>, <a href="https://malpedia.caad.fkie.fraunhofer.de/details/win.bazarbackdoor">Malpedia</a>, <a href="https://www.capesandbox.com/analysis/108232/">Cape</a>, <a href="https://www.virustotal.com/gui/file/52e72513fe2a38707aa63fbc52dabd7c7d2c5809ed7e27f384315375426f57bf">VirusTotal</a></dd><dt>Filenames</dt><dd>content.28641.20903.13470.9122.7127 (VirusTotal)</dd><dt>Detections</dt><dd><strong>Virustotal</strong>: 4/75 as of 2020-12-15 21:30:37</dd></dl><h2 id="reverse-engineering">Reverse Engineering</h2><p>Apart from the common dynamic loading of Windows API functions and encrypted strings, Bazar Loader relies on <em>arithmetic substitution via identities</em> to obfuscate the code. The following relationship is particularly often used:</p><p>$$ a \oplus b = (\sim a \cdot b) + (a \cdot \sim b) $$</p><p>The same obfuscation is also used by <a href="/blog/the-dga-of-zloader/">Zloader</a>. It makes the code very hard to read. Here is a small snippet from the DGA:</p><p><noscript>&lt;img src="assets/dga_snippet.png" class=""/&gt;</noscript><img alt="DGA Snippet Disassembly" class="lazyload" data-src="assets/dga_snippet.png" data-srcset="assets/dga_snippet-1x.webp 760w" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSI3NjAiIGhlaWdodD0iNTYzIiBzdHlsZT0iYmFja2dyb3VuZC1jb2xvcjojTmFOTmFOTmFOIj48L3N2Zz4=" sizes="(max-width: 760px) 100vw, 760px"></p><p>Hex Ray’s decompiler also produces really messy code because the arithmetic identities are not simplified:</p><p><noscript>&lt;img src="assets/dga_decompiled.png" class=""/&gt;</noscript><img alt="DGA Decompiled" class="lazyload" data-src="assets/dga_decompiled.png" data-srcset="assets/dga_decompiled-1x.webp 1050w,
assets/dga_decompiled-768.webp 768w,
assets/dga_decompiled-640.webp 640w" src="data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHdpZHRoPSIxMDUwIiBoZWlnaHQ9IjI3NyIgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6I05hTk5hTk5hTiI+PC9zdmc+" sizes="(max-width: 1050px) 100vw, 1050px"></p><p>The DGA uses the current month and year as the seed. The seed is stored as a string, and its four ASCII characters are the basis for picking four character pairs. These four pairs are joined to form the 8 second level characters.</p><p>The list of character pairs is generated by calculating the cartesian product of the consonants “bcdfghklmnpqrstvwxz” and vowels (with y) “aeiouy”. The product is calculated both ways, leading to 19·6·2 character pairs. These pairs are then concatenated into a large string of 456 characters by using a hardcoded sequence of random numbers:</p><pre tabindex="0"><code>qeewcaacywemomedekwyuhidontoibeludsocuexvuuftyliaqydhuizuctuiqow
agypetehfubitiaziceblaogolryykosuptaymodisahfiybyxcoleafkudarapu
qoawyluxqagenanyoxcygyqugiutlyvegahepovyigqyqibaeqynyfkiobpeepby
xaciyvusocaripfyoftesaysozureginalifkazaadytwuubzuvoothymivazyyz
hoevmeburedeviihiravygkemywaerdonoyryqloammoseweesuvfopiriboikuz
orruzemuulimyhceukoqiwfexuefgoycwiokitnuneroxepyanbekyixxiuqsias 
</code></pre><p>The string is then encrypted using a random xor key of the same length.</p><p>Apart from the date-based seed, the DGA also uses a standard linear congruential generator (LCG) to pick the four character pairs. The LCG is seeded with the current processor tick count and thus unpredictable. For the first two character pairs, the random number is taken mod 19, and for the remaining two pairs mod 6. These numbers correspond to the length of the consonants and vowels array, but make no sense in this context. Because the random numbers are unpredictable, any combination of the 19·19·6·6 = 12996 character pairs could be picked. Bazar Loader generates 10'000 domains per run, but does not guarantee they are unique. On average, 6975 unique domains are expected:</p><p>$$ \mathbb{E} = 12996\left( 1 - \left(\frac{12996-1}{12966}\right)^{10000} \right) = 6975 $$</p><p>Even with the short waiting time between resolving domains, the malware will need to run a long time to get through the list of domains.</p><h2 id="reimplementation-in-python">Reimplementation in Python</h2><p>The following Python code shows how the domains are generated:</p><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">itertools</span> <span class="kn">import</span> <span class="n">product</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">datetime</span> <span class="kn">import</span> <span class="n">datetime</span>
</span></span><span class="line"><span class="cl"><span class="kn">import</span> <span class="nn">argparse</span>
</span></span><span class="line"><span class="cl"><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">namedtuple</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="n">Param</span> <span class="o">=</span> <span class="n">namedtuple</span><span class="p">(</span><span class="s1">'Param'</span><span class="p">,</span> <span class="s1">'mul mod idx'</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="n">pool</span> <span class="o">=</span> <span class="p">(</span>
</span></span><span class="line"><span class="cl">    <span class="s2">"qeewcaacywemomedekwyuhidontoibeludsocuexvuuftyliaqydhuizuctuiqow"</span>
</span></span><span class="line"><span class="cl">    <span class="s2">"agypetehfubitiaziceblaogolryykosuptaymodisahfiybyxcoleafkudarapu"</span>
</span></span><span class="line"><span class="cl">    <span class="s2">"qoawyluxqagenanyoxcygyqugiutlyvegahepovyigqyqibaeqynyfkiobpeepby"</span>
</span></span><span class="line"><span class="cl">    <span class="s2">"xaciyvusocaripfyoftesaysozureginalifkazaadytwuubzuvoothymivazyyz"</span>
</span></span><span class="line"><span class="cl">    <span class="s2">"hoevmeburedeviihiravygkemywaerdonoyryqloammoseweesuvfopiriboikuz"</span>
</span></span><span class="line"><span class="cl">    <span class="s2">"orruzemuulimyhceukoqiwfexuefgoycwiokitnuneroxepyanbekyixxiuqsias"</span>
</span></span><span class="line"><span class="cl">    <span class="s2">"xoapaxmaohezwoildifaluzihipanizoecxyopguakdudyovhaumunuwsusyenko"</span>
</span></span><span class="line"><span class="cl">    <span class="s2">"atugabiv"</span>
</span></span><span class="line"><span class="cl"><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">dga</span><span class="p">(</span><span class="n">date</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">seed</span> <span class="o">=</span> <span class="n">date</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">"%m%Y"</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">params</span> <span class="o">=</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">        <span class="n">Param</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">0</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">Param</span><span class="p">(</span><span class="mi">19</span><span class="p">,</span> <span class="mi">19</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">Param</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">),</span>
</span></span><span class="line"><span class="cl">        <span class="n">Param</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">ranges</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">params</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">s</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">seed</span><span class="p">[</span><span class="n">p</span><span class="o">.</span><span class="n">idx</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">        <span class="n">lower</span> <span class="o">=</span> <span class="n">p</span><span class="o">.</span><span class="n">mul</span><span class="o">*</span><span class="n">s</span>
</span></span><span class="line"><span class="cl">        <span class="n">upper</span> <span class="o">=</span> <span class="n">lower</span> <span class="o">+</span> <span class="n">p</span><span class="o">.</span><span class="n">mod</span>
</span></span><span class="line"><span class="cl">        <span class="n">ranges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">lower</span><span class="p">,</span> <span class="n">upper</span><span class="p">)))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">indices</span> <span class="ow">in</span> <span class="n">product</span><span class="p">(</span><span class="o">*</span><span class="n">ranges</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">domain</span> <span class="o">=</span> <span class="s2">""</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">index</span> <span class="ow">in</span> <span class="n">indices</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">domain</span> <span class="o">+=</span> <span class="n">pool</span><span class="p">[</span><span class="n">index</span><span class="o">*</span><span class="mi">2</span><span class="p">:</span><span class="n">index</span><span class="o">*</span><span class="mi">2</span> <span class="o">+</span> <span class="mi">2</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">domain</span> <span class="o">+=</span> <span class="s2">".bazar"</span>
</span></span><span class="line"><span class="cl">        <span class="k">yield</span> <span class="n">domain</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">"__main__"</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">        <span class="s2">"-d"</span><span class="p">,</span> <span class="s2">"--date"</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">"date used for seeding, e.g., 2020-06-28"</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">        <span class="n">default</span><span class="o">=</span><span class="n">datetime</span><span class="o">.</span><span class="n">now</span><span class="p">()</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">'%Y-%m-</span><span class="si">%d</span><span class="s1">'</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="n">d</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">strptime</span><span class="p">(</span><span class="n">args</span><span class="o">.</span><span class="n">date</span><span class="p">,</span> <span class="s2">"%Y-%m-</span><span class="si">%d</span><span class="s2">"</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">domain</span> <span class="ow">in</span> <span class="n">dga</span><span class="p">(</span><span class="n">d</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">domain</span><span class="p">)</span>
</span></span></code></pre></div><p>Here are all the domains for <a href="assets/december_2020.txt">December 2020</a>, <a href="assets/january_2021.txt">January 2021</a>, <a href="assets/february_2021.txt">February 2021</a>, and <a href="assets/march_2021.txt">March 2021</a>.</p><h2 id="characteristics">Characteristics</h2><p>The following table summarizes the properties of the new Bazar Loader DGA.</p><table><thead><tr><th>property</th><th>value</th></tr></thead><tbody><tr><td>type</td><td>TDD (time-dependent-deterministic)</td></tr><tr><td>generation scheme</td><td>arithmetic</td></tr><tr><td>seed</td><td>current date</td></tr><tr><td>domain change frequency</td><td>every month</td></tr><tr><td>unique domains per month</td><td>12996</td></tr><tr><td>sequence</td><td>random selection, might pick domains multiple times</td></tr><tr><td>wait time between domains</td><td>10 seconds</td></tr><tr><td>top level domain</td><td><code>.bazar</code></td></tr><tr><td>second level characters</td><td>a-z, without j</td></tr><tr><td>regex</td><td><code>[a-ik-z]{8}\.bazar</code></td></tr><tr><td>second level domain length</td><td>8</td></tr></tbody></table></div></article></main><footer><div><div class="y"><div class="z ae aj"><div class="ag ak al am"><h3>Links</h3><ul class="i an"><li><a href="http://www.twitter.com/viql" rel="me"><svg viewBox="0 0 35 32" class="g"><use href="/assets/svg/icons.svg#icon-twitter" xlink:href="/assets/svg/icons.svg#icon-twitter"></use></svg> Twitter</a></li><li><a href="http://www.github.com/baderj" rel="me"><svg viewBox="0 0 35 32" class="g"><use href="/assets/svg/icons.svg#icon-github" xlink:href="/assets/svg/icons.svg#icon-github"></use></svg> GitHub</a></li><li><a href="mailto:hello@bin.re" rel="me"><svg viewBox="0 0 35 32" class="g"><use href="/assets/svg/icons.svg#icon-envelope-o" xlink:href="/assets/svg/icons.svg#icon-envelope-o"></use></svg> Mail</a></li><li><a href="https://keybase.io/baderj" rel="me"><svg viewBox="0 0 35 32" class="g"><use href="/assets/svg/icons.svg#icon-keybase" xlink:href="/assets/svg/icons.svg#icon-keybase"></use></svg> Keybase</a></li><li><a href="/feed.xml" rel="me"><svg viewBox="0 0 35 32" class="g"><use href="/assets/svg/icons.svg#icon-feed" xlink:href="/assets/svg/icons.svg#icon-feed"></use></svg> RSS</a></li><li><a href="https://threatcat.ch" rel="me"><svg viewBox="0 0 35 32" class="g"><use href="/assets/svg/icons.svg#icon-threatcat" xlink:href="/assets/svg/icons.svg#icon-threatcat"></use></svg> Threatcat.ch</a></li><li><a href="https://infosec.exchange/@viql" rel="me"><svg viewBox="0 0 35 32" class="g"><use href="/assets/svg/icons.svg#icon-mastodon" xlink:href="/assets/svg/icons.svg#icon-mastodon"></use></svg> Mastodon</a></li><li><a href="https://bsky.app/profile/viql.bsky.social" rel="me"><svg viewBox="0 0 35 32" class="g"><use href="/assets/svg/icons.svg#icon-bluesky" xlink:href="/assets/svg/icons.svg#icon-bluesky"></use></svg> Bluesky</a></li></ul></div><div class="ag ak al am"><div><h3>Categories</h3><ul class="i"><li><a href="/category/reverse-engineering">reverse-engineering</a> <span class="ao">(81)</span></li><li><a href="/category/tutorial">tutorial</a> <span class="ao">(14)</span></li><li><a href="/category/project-euler">project-euler</a> <span class="ao">(13)</span></li><li><a href="/category/misc">misc</a> <span class="ao">(2)</span></li><li><a href="/category/visualization">visualization</a> <span class="ao">(2)</span></li></ul></div></div><div class="ag ak al am a7"><div><h3>Tags</h3><span class="ap"><a href="/tag/malware-analysis" class="aq">malware-analysis <span class="ao">(42)</span></a><a href="/tag/dga" class="aq">dga <span class="ao">(36)</span></a><a href="/tag/crackmes" class="aq">crackmes <span class="ao">(23)</span></a><a href="/tag/practical-reverse-engineering" class="aq">practical-reverse-engineering <span class="ao">(16)</span></a><a href="/tag/math" class="aq">math <span class="ao">(15)</span></a><a href="/tag/project-euler" class="aq">project-euler <span class="ao">(13)</span></a><a href="/tag/python" class="aq">python <span class="ao">(12)</span></a><a href="/tag/upatre" class="aq">upatre <span class="ao">(4)</span></a><a href="/tag/visualization" class="aq">visualization <span class="ao">(4)</span></a><a href="/tag/d3js" class="aq">d3js <span class="ao">(3)</span></a></span> <a href="/tag/" class="ar">show all</a></div></div><div class="ag ak al am as"><div class="at"><div><h3>Blog Archive</h3><span class="au"><a href="/2013">2013</a><span class="ao">(20)</span></span> <span class="au"><a href="/2014">2014</a><span class="ao">(46)</span></span> <span class="au"><a href="/2015">2015</a><span class="ao">(24)</span></span> <span class="au"><a href="/2016">2016</a><span class="ao">(6)</span></span> <span class="au"><a href="/2018">2018</a><span class="ao">(1)</span></span> <span class="au"><a href="/2019">2019</a><span class="ao">(2)</span></span> <span class="au"><a href="/2020">2020</a><span class="ao">(5)</span></span> <span class="au"><a href="/2021">2021</a><span class="ao">(3)</span></span> <span class="au"><a href="/2022">2022</a><span class="ao">(3)</span></span> <span class="au"><a href="/2023">2023</a><span class="ao">(2)</span></span></div></div></div></div></div><div class="y av"><div class="z"><div class="ag"><p>© 2012 - 2025 Johannes Bader, last updated July 31, 2025</p></div></div></div></div></footer></div></div></body></html>