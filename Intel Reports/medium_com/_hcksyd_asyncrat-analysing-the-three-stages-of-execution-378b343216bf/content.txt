<!doctype html><html lang="en"><head><title data-rh="true">AsyncRAT: Analysing the Three Stages of Execution | by Hack Sydney | Medium</title><meta data-rh="true" charset="utf-8"/><meta data-rh="true" name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1,maximum-scale=1"/><meta data-rh="true" name="theme-color" content="#000000"/><meta data-rh="true" name="twitter:app:name:iphone" content="Medium"/><meta data-rh="true" name="twitter:app:id:iphone" content="828256236"/><meta data-rh="true" property="al:ios:app_name" content="Medium"/><meta data-rh="true" property="al:ios:app_store_id" content="828256236"/><meta data-rh="true" property="al:android:package" content="com.medium.reader"/><meta data-rh="true" property="fb:app_id" content="542599432471018"/><meta data-rh="true" property="og:site_name" content="Medium"/><meta data-rh="true" property="og:type" content="article"/><meta data-rh="true" property="article:published_time" content="2023-02-08T00:47:45.674Z"/><meta data-rh="true" name="title" content="AsyncRAT: Analysing the Three Stages of Execution | by Hack Sydney | Medium"/><meta data-rh="true" property="og:title" content="AsyncRAT: Analysing the Three Stages of Execution"/><meta data-rh="true" property="al:android:url" content="medium://p/378b343216bf"/><meta data-rh="true" property="al:ios:url" content="medium://p/378b343216bf"/><meta data-rh="true" property="al:android:app_name" content="Medium"/><meta data-rh="true" name="description" content="In the second half of 2022, I led an investigation that involved a suspicious registry key, comprising a value that would run a potentially malicious executable file. In this blog post, I aim to…"/><meta data-rh="true" property="og:description" content="Michael Elford"/><meta data-rh="true" property="og:url" content="https://hcksyd.medium.com/asyncrat-analysing-the-three-stages-of-execution-378b343216bf"/><meta data-rh="true" property="al:web:url" content="https://hcksyd.medium.com/asyncrat-analysing-the-three-stages-of-execution-378b343216bf"/><meta data-rh="true" property="og:image" content="https://miro.medium.com/v2/da:true/resize:fit:1010/0*aPbEP5FNvUx41G8M"/><meta data-rh="true" property="article:author" content="https://hcksyd.medium.com"/><meta data-rh="true" name="author" content="Hack Sydney"/><meta data-rh="true" name="robots" content="noindex,noarchive,follow,max-image-preview:large"/><meta data-rh="true" name="referrer" content="unsafe-url"/><meta data-rh="true" property="twitter:title" content="AsyncRAT: Analysing the Three Stages of Execution"/><meta data-rh="true" name="twitter:site" content="@Medium"/><meta data-rh="true" name="twitter:app:url:iphone" content="medium://p/378b343216bf"/><meta data-rh="true" property="twitter:description" content="Michael Elford"/><meta data-rh="true" name="twitter:image:src" content="https://miro.medium.com/v2/da:true/resize:fit:1010/0*aPbEP5FNvUx41G8M"/><meta data-rh="true" name="twitter:card" content="summary_large_image"/><meta data-rh="true" name="twitter:label1" content="Reading time"/><meta data-rh="true" name="twitter:data1" content="8 min read"/><link data-rh="true" rel="icon" href="https://miro.medium.com/v2/5d8de952517e8160e40ef9841c781cdc14a5db313057fa3c3de41c6f5b494b19"/><link data-rh="true" rel="search" type="application/opensearchdescription+xml" title="Medium" href="/osd.xml"/><link data-rh="true" rel="apple-touch-icon" sizes="152x152" href="https://miro.medium.com/v2/resize:fill:304:304/10fd5c419ac61637245384e7099e131627900034828f4f386bdaa47a74eae156"/><link data-rh="true" rel="apple-touch-icon" sizes="120x120" href="https://miro.medium.com/v2/resize:fill:240:240/10fd5c419ac61637245384e7099e131627900034828f4f386bdaa47a74eae156"/><link data-rh="true" rel="apple-touch-icon" sizes="76x76" href="https://miro.medium.com/v2/resize:fill:152:152/10fd5c419ac61637245384e7099e131627900034828f4f386bdaa47a74eae156"/><link data-rh="true" rel="apple-touch-icon" sizes="60x60" href="https://miro.medium.com/v2/resize:fill:120:120/10fd5c419ac61637245384e7099e131627900034828f4f386bdaa47a74eae156"/><link data-rh="true" rel="mask-icon" href="https://miro.medium.com/v2/resize:fill:1000:1000/7*GAOKVe--MXbEJmV9230oOQ.png" color="#171717"/><link data-rh="true" rel="preconnect" href="https://glyph.medium.com" crossOrigin=""/><link data-rh="true" id="glyph_preload_link" rel="preload" as="style" type="text/css" href="https://glyph.medium.com/css/unbound.css"/><link data-rh="true" id="glyph_link" rel="stylesheet" type="text/css" href="https://glyph.medium.com/css/unbound.css"/><link data-rh="true" rel="author" href="https://hcksyd.medium.com"/><link data-rh="true" rel="canonical" href="https://hcksyd.medium.com/asyncrat-analysing-the-three-stages-of-execution-378b343216bf"/><link data-rh="true" rel="alternate" href="android-app://com.medium.reader/https/medium.com/p/378b343216bf"/><script data-rh="true" type="application/ld+json">{"@context":"http:\u002F\u002Fschema.org","@type":"NewsArticle","image":["https:\u002F\u002Fmiro.medium.com\u002Fv2\u002Fda:true\u002Fresize:fit:1200\u002F0*aPbEP5FNvUx41G8M"],"url":"https:\u002F\u002Fhcksyd.medium.com\u002Fasyncrat-analysing-the-three-stages-of-execution-378b343216bf","dateCreated":"2023-02-08T00:47:45.674Z","datePublished":"2023-02-08T00:47:45.674Z","dateModified":"2023-02-08T00:47:47.393Z","headline":"AsyncRAT: Analysing the Three Stages of Execution - Hack Sydney - Medium","name":"AsyncRAT: Analysing the Three Stages of Execution - Hack Sydney - Medium","description":"In the second half of 2022, I led an investigation that involved a suspicious registry key, comprising a value that would run a potentially malicious executable file. In this blog post, I aim to…","identifier":"378b343216bf","author":{"@type":"Person","name":"Hack Sydney","url":"https:\u002F\u002Fhcksyd.medium.com"},"creator":["Hack Sydney"],"publisher":{"@type":"Organization","name":"Medium","url":"https:\u002F\u002Fhcksyd.medium.com\u002F","logo":{"@type":"ImageObject","width":272,"height":60,"url":"https:\u002F\u002Fmiro.medium.com\u002Fv2\u002Fresize:fit:544\u002F7*V1_7XP4snlmqrc_0Njontw.png"}},"mainEntityOfPage":"https:\u002F\u002Fhcksyd.medium.com\u002Fasyncrat-analysing-the-three-stages-of-execution-378b343216bf"}</script><style type="text/css" data-fela-rehydration="558" data-fela-type="STATIC">html{box-sizing:border-box;-webkit-text-size-adjust:100%}*, *:before, *:after{box-sizing:inherit}body{margin:0;padding:0;text-rendering:optimizeLegibility;-webkit-font-smoothing:antialiased;color:rgba(0,0,0,0.8);position:relative;min-height:100vh}h1, h2, h3, h4, h5, h6, dl, dd, ol, ul, menu, figure, blockquote, p, pre, form{margin:0}menu, ol, ul{padding:0;list-style:none;list-style-image:none}main{display:block}a{color:inherit;text-decoration:none}a, button, input{-webkit-tap-highlight-color:transparent}img, svg{vertical-align:middle}button{background:transparent;overflow:visible}button, input, optgroup, select, textarea{margin:0}:root{--reach-tabs:1;--reach-menu-button:1}#speechify-root{font-family:Sohne, sans-serif}div[data-popper-reference-hidden="true"]{visibility:hidden;pointer-events:none}.grecaptcha-badge{visibility:hidden}
/*XCode style (c) Angel Garcia <angelgarcia.mail@gmail.com>*/.hljs {background: #fff;color: black;
}/* Gray DOCTYPE selectors like WebKit */
.xml .hljs-meta {color: #c0c0c0;
}.hljs-comment,
.hljs-quote {color: #007400;
}.hljs-tag,
.hljs-attribute,
.hljs-keyword,
.hljs-selector-tag,
.hljs-literal,
.hljs-name {color: #aa0d91;
}.hljs-variable,
.hljs-template-variable {color: #3F6E74;
}.hljs-code,
.hljs-string,
.hljs-meta .hljs-string {color: #c41a16;
}.hljs-regexp,
.hljs-link {color: #0E0EFF;
}.hljs-title,
.hljs-symbol,
.hljs-bullet,
.hljs-number {color: #1c00cf;
}.hljs-section,
.hljs-meta {color: #643820;
}.hljs-title.class_,
.hljs-class .hljs-title,
.hljs-type,
.hljs-built_in,
.hljs-params {color: #5c2699;
}.hljs-attr {color: #836C28;
}.hljs-subst {color: #000;
}.hljs-formula {background-color: #eee;font-style: italic;
}.hljs-addition {background-color: #baeeba;
}.hljs-deletion {background-color: #ffc8bd;
}.hljs-selector-id,
.hljs-selector-class {color: #9b703f;
}.hljs-doctag,
.hljs-strong {font-weight: bold;
}.hljs-emphasis {font-style: italic;
}
</style><style type="text/css" data-fela-rehydration="558" data-fela-type="KEYFRAME">@-webkit-keyframes k1{0%{opacity:0.8}50%{opacity:0.5}100%{opacity:0.8}}@-moz-keyframes k1{0%{opacity:0.8}50%{opacity:0.5}100%{opacity:0.8}}@keyframes k1{0%{opacity:0.8}50%{opacity:0.5}100%{opacity:0.8}}</style><style type="text/css" data-fela-rehydration="558" data-fela-type="RULE">.a{font-family:medium-content-sans-serif-font, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif}.b{font-weight:400}.c{background-color:rgba(255, 255, 255, 1)}.l{display:block}.m{position:sticky}.n{top:0}.o{z-index:500}.p{padding:0 24px}.q{align-items:center}.r{border-bottom:solid 1px #F2F2F2}.y{height:41px}.z{line-height:20px}.ab{display:flex}.ac{height:57px}.ae{flex:1 0 auto}.af{gap:16px}.ag{color:inherit}.ah{fill:inherit}.ai{font-size:inherit}.aj{border:inherit}.ak{font-family:inherit}.al{letter-spacing:inherit}.am{font-weight:inherit}.an{padding:0}.ao{margin:0}.ap{cursor:pointer}.aq:disabled{cursor:not-allowed}.ar:disabled{color:#6B6B6B}.as:disabled{fill:#6B6B6B}.av{width:auto}.aw path{fill:#242424}.ax{height:25px}.ay{border:none}.az{border-radius:20px}.ba{width:240px}.bb{background:#F9F9F9}.bc path{fill:#6B6B6B}.be{outline:none}.bf{font-family:sohne, "Helvetica Neue", Helvetica, Arial, sans-serif}.bg{font-size:14px}.bh{width:100%}.bi{padding:10px 20px 10px 0}.bj{background-color:transparent}.bk{color:#242424}.bl::placeholder{color:#6B6B6B}.bm{display:inline-block}.bn{margin-left:12px}.bo{margin-right:12px}.bp{border-radius:4px}.bq{margin-left:24px}.br{height:24px}.bx{background-color:#F9F9F9}.by{border-radius:50%}.bz{height:32px}.ca{width:32px}.cb{flex:1 1 auto}.cc{justify-content:center}.ci{max-width:680px}.cj{min-width:0}.ck{animation:k1 1.2s ease-in-out infinite}.cl{height:100vh}.cm{margin-bottom:16px}.cn{margin-top:48px}.co{align-items:flex-start}.cp{flex-direction:column}.cq{justify-content:space-between}.cr{margin-bottom:24px}.cx{width:80%}.cy{background-color:#F2F2F2}.de{height:44px}.df{width:44px}.dg{margin:auto 0}.dh{margin-bottom:4px}.di{height:16px}.dj{width:120px}.dk{width:80px}.dq{margin-bottom:8px}.dr{width:96%}.ds{width:98%}.dt{width:81%}.du{margin-left:8px}.dv{color:#6B6B6B}.dw{font-size:13px}.dx{height:100%}.eq{color:#FFFFFF}.er{fill:#FFFFFF}.es{background:#1A8917}.et{border-color:#1A8917}.ex:disabled{cursor:inherit !important}.ey:disabled{opacity:0.3}.ez:disabled:hover{background:#1A8917}.fa:disabled:hover{border-color:#1A8917}.fb{border-radius:99em}.fc{border-width:1px}.fd{border-style:solid}.fe{box-sizing:border-box}.ff{text-decoration:none}.fg{text-align:center}.fh{margin-left:16px}.fk{margin-right:32px}.fl{position:relative}.fm{fill:#6B6B6B}.fp{background:transparent}.fq svg{margin-left:4px}.fr svg{fill:#6B6B6B}.ft{box-shadow:inset 0 0 0 1px rgba(0, 0, 0, 0.05)}.fu{position:absolute}.gb{margin:0 24px}.gf{background:rgba(255, 255, 255, 1)}.gg{border:1px solid #F2F2F2}.gh{box-shadow:0 1px 4px #F2F2F2}.gi{max-height:100vh}.gj{overflow-y:auto}.gk{left:0}.gl{top:calc(100vh + 100px)}.gm{bottom:calc(100vh + 100px)}.gn{width:10px}.go{pointer-events:none}.gp{word-break:break-word}.gq{word-wrap:break-word}.gr:after{display:block}.gs:after{content:""}.gt:after{clear:both}.gu{line-height:1.23}.gv{letter-spacing:0}.gw{font-style:normal}.gx{font-weight:700}.ih{gap:12px}.ii{align-items:baseline}.ij{width:36px}.ik{height:36px}.il{border:2px solid rgba(255, 255, 255, 1)}.im{z-index:0}.in{box-shadow:none}.io{border:1px solid rgba(0, 0, 0, 0.05)}.ip{margin-bottom:2px}.iq{flex-wrap:nowrap}.is{width:12px}.it{transition:width 0.3s ease-in-out}.iu{background:0}.iv path{stroke:#242424}.iw{border-radius:24px}.ix{width:66px}.iy{padding:6px 12px 6px 12px}.iz{border:1px solid #242424}.ja{word-break:keep-all}.jb{flex-wrap:wrap}.jc{padding-left:8px}.jd{padding-right:8px}.ke> *{flex-shrink:0}.kf{overflow-x:scroll}.kg::-webkit-scrollbar{display:none}.kh{scrollbar-width:none}.ki{-ms-overflow-style:none}.kj{width:74px}.kk{flex-direction:row}.kl{z-index:2}.km{margin-right:4px}.kp{-webkit-user-select:none}.kq{border:0}.kr{fill:rgba(117, 117, 117, 1)}.ku{outline:0}.kv{user-select:none}.kw> svg{pointer-events:none}.lf{cursor:progress}.lg{margin-left:4px}.lh{margin-top:0px}.li{opacity:1}.lj{padding:4px 0}.lm{width:16px}.lo{display:inline-flex}.lu{max-width:100%}.lv{padding:8px 2px}.lw svg{color:#6B6B6B}.mn{line-height:1.58}.mo{letter-spacing:-0.004em}.mp{font-family:source-serif-pro, Georgia, Cambria, "Times New Roman", Times, serif}.nk{margin-bottom:-0.46em}.nl{text-decoration:underline}.nr{overflow-x:auto}.ns{font-family:source-code-pro, Menlo, Monaco, "Courier New", Courier, monospace}.nt{padding:32px}.nu{border:1px solid #E5E5E5}.nv{line-height:1.4}.nw{letter-spacing:-0.022em}.nx{margin-top:-0.2em}.ny{margin-bottom:-0.2em}.nz{white-space:pre}.oa{min-width:fit-content}.ob{font-style:italic}.oc{line-height:1.12}.od{font-weight:600}.oy{margin-bottom:-0.28em}.pe{list-style-type:disc}.pf{margin-left:30px}.pg{padding-left:0px}.pm{margin-left:auto}.pn{margin-right:auto}.po{max-width:919px}.pp{clear:both}.pr{cursor:zoom-in}.ps{z-index:auto}.pu{height:auto}.pv{margin-top:10px}.pw{max-width:728px}.pz{max-width:1450px}.qa{max-width:1010px}.qb{max-width:1600px}.qc{max-width:1407px}.qd{max-width:1153px}.qe{max-width:1253px}.qf{max-width:1140px}.qg{max-width:1144px}.qh{max-width:1405px}.qi{max-width:1249px}.qj{max-width:1137px}.qk{max-width:1132px}.ql{margin-bottom:26px}.qm{margin-top:6px}.qn{margin-top:8px}.qo{margin-right:8px}.qp{padding:8px 16px}.qq{border-radius:100px}.qr{transition:background 300ms ease}.qt{white-space:nowrap}.qu{border-top:none}.qv{margin-bottom:50px}.qw{height:52px}.qx{max-height:52px}.qy{box-sizing:content-box}.qz{position:static}.ra{z-index:1}.rc{max-width:155px}.ri{margin-right:20px}.rj{flex:0 0 auto}.rk{margin-bottom:64px}.rx{height:48px}.ry{width:48px}.sa{height:64px}.sb{width:64px}.sc{align-self:flex-end}.sd{border-radius:19px}.se{padding:9px 16px 9px 16px}.sk{padding-right:4px}.sl{font-weight:500}.sy{white-space:pre-wrap}.sz{margin:0 8px}.ta{margin-top:16px}.tg{height:0px}.th{gap:18px}.ti{fill:rgba(61, 61, 61, 1)}.tk{padding-bottom:20px}.tl{border-bottom:1px solid #F2F2F2}.tr{margin-top:32px}.ts{fill:#242424}.tt{border-color:#242424}.tv:disabled:hover{color:#242424}.tw:disabled:hover{fill:#242424}.tx:disabled:hover{border-color:#242424}.ui{border-bottom:solid 1px #E5E5E5}.uj{margin-top:72px}.uk{padding:24px 0}.ul{margin-bottom:0px}.um{margin-right:16px}.at:hover:not(:disabled){color:rgba(25, 25, 25, 1)}.au:hover:not(:disabled){fill:rgba(25, 25, 25, 1)}.eu:hover{background:#156D12}.ev:hover{border-color:#156D12}.ew:hover{cursor:pointer}.fn:hover{color:#242424}.fo:hover{fill:#242424}.fs:hover svg{fill:#242424}.fv:hover{background-color:rgba(0, 0, 0, 0.1)}.ir:hover{text-decoration:underline}.kt:hover{fill:rgba(8, 8, 8, 1)}.lk:hover{fill:#000000}.ll:hover p{color:#000000}.ln:hover{color:#000000}.lx:hover svg{color:#000000}.qs:hover{background-color:#F2F2F2}.rz:hover{background-color:none}.tj:hover{fill:rgba(25, 25, 25, 1)}.tu:hover{border-color:#242424}.bd:focus-within path{fill:#242424}.ks:focus{fill:rgba(8, 8, 8, 1)}.ly:focus svg{color:#000000}.pt:focus{transform:scale(1.01)}.kx:active{border-style:none}</style><style type="text/css" data-fela-rehydration="558" data-fela-type="RULE" media="all and (min-width: 1080px)">.d{display:none}.bw{width:64px}.ch{margin:0 64px}.cw{height:48px}.dd{margin-bottom:52px}.dp{margin-bottom:48px}.eg{font-size:14px}.eh{line-height:20px}.eo{font-size:13px}.ep{padding:5px 12px}.fj{display:flex}.ga{margin-bottom:50px}.ge{max-width:680px}.hs{font-size:42px}.ht{margin-top:1.19em}.hu{margin-bottom:32px}.hv{line-height:52px}.hw{letter-spacing:-0.011em}.if{align-items:center}.ig{flex-direction:row}.jq{border-top:solid 1px #F2F2F2}.jr{border-bottom:solid 1px #F2F2F2}.js{margin:32px 0 0}.jt{padding:3px 8px}.kc> *{margin-right:24px}.kd> :last-child{margin-right:0}.le{margin-top:0px}.lt{margin:0}.ng{font-size:20px}.nh{margin-top:2.14em}.ni{line-height:32px}.nj{letter-spacing:-0.003em}.nq{margin-top:56px}.ou{font-size:24px}.ov{margin-top:1.95em}.ow{line-height:30px}.ox{letter-spacing:-0.016em}.pd{margin-top:0.94em}.pl{margin-top:1.14em}.rh{display:inline-block}.rn{margin-bottom:0}.ro{margin-right:20px}.sf{max-width:500px}.sw{line-height:24px}.sx{letter-spacing:0}.tf{margin-bottom:88px}.tq{margin:40px 0 16px}.uc{width:min-width}.uh{padding-top:72px}</style><style type="text/css" data-fela-rehydration="558" data-fela-type="RULE" media="all and (max-width: 1079.98px)">.e{display:none}.ld{margin-top:0px}.px{margin-left:auto}.py{text-align:center}.rg{display:inline-block}</style><style type="text/css" data-fela-rehydration="558" data-fela-type="RULE" media="all and (max-width: 903.98px)">.f{display:none}.lc{margin-top:0px}.rf{display:inline-block}</style><style type="text/css" data-fela-rehydration="558" data-fela-type="RULE" media="all and (max-width: 727.98px)">.g{display:none}.la{margin-top:0px}.lb{margin-right:0px}.re{display:inline-block}</style><style type="text/css" data-fela-rehydration="558" data-fela-type="RULE" media="all and (max-width: 551.98px)">.h{display:none}.s{display:flex}.t{justify-content:space-between}.bs{width:24px}.cd{margin:0 24px}.cs{height:40px}.cz{margin-bottom:44px}.dl{margin-bottom:32px}.dy{font-size:13px}.dz{line-height:20px}.ei{padding:0px 8px 1px}.fw{margin-bottom:2px}.gy{font-size:32px}.gz{margin-top:1.01em}.ha{margin-bottom:24px}.hb{line-height:38px}.hc{letter-spacing:-0.014em}.hx{align-items:flex-start}.hy{flex-direction:column-reverse}.je{margin:24px -24px 0}.jf{padding:0}.ju> *{margin-right:8px}.jv> :last-child{margin-right:24px}.kn{margin-left:0px}.ky{margin-top:0px}.kz{margin-right:0px}.lp{margin:0}.lz{border:1px solid #F2F2F2}.ma{border-radius:99em}.mb{padding:0px 16px 0px 12px}.mc{height:38px}.md{align-items:center}.mf svg{margin-right:8px}.mq{font-size:18px}.mr{margin-top:1.56em}.ms{line-height:28px}.mt{letter-spacing:-0.003em}.nm{margin-top:40px}.oe{font-size:20px}.of{margin-top:1.2em}.og{line-height:24px}.oh{letter-spacing:0}.oz{margin-top:0.67em}.ph{margin-top:1.34em}.rd{display:inline-block}.rm{flex-direction:column}.rv{margin-bottom:20px}.rw{margin-right:0}.sj{max-width:100%}.sm{font-size:24px}.sn{line-height:30px}.so{letter-spacing:-0.016em}.tb{margin-bottom:64px}.tm{margin:32px 0 16px}.ty{width:100%}.ud{padding-top:48px}.me:hover{border-color:#E5E5E5}</style><style type="text/css" data-fela-rehydration="558" data-fela-type="RULE" media="all and (min-width: 904px) and (max-width: 1079.98px)">.i{display:none}.bv{width:64px}.cg{margin:0 64px}.cv{height:48px}.dc{margin-bottom:52px}.do{margin-bottom:48px}.ee{font-size:14px}.ef{line-height:20px}.el{font-size:13px}.em{padding:5px 12px}.fi{display:flex}.fz{margin-bottom:50px}.gd{max-width:680px}.hn{font-size:42px}.ho{margin-top:1.19em}.hp{margin-bottom:32px}.hq{line-height:52px}.hr{letter-spacing:-0.011em}.id{align-items:center}.ie{flex-direction:row}.jm{border-top:solid 1px #F2F2F2}.jn{border-bottom:solid 1px #F2F2F2}.jo{margin:32px 0 0}.jp{padding:3px 8px}.ka> *{margin-right:24px}.kb> :last-child{margin-right:0}.ls{margin:0}.nc{font-size:20px}.nd{margin-top:2.14em}.ne{line-height:32px}.nf{letter-spacing:-0.003em}.np{margin-top:56px}.oq{font-size:24px}.or{margin-top:1.95em}.os{line-height:30px}.ot{letter-spacing:-0.016em}.pc{margin-top:0.94em}.pk{margin-top:1.14em}.rp{margin-bottom:0}.rq{margin-right:20px}.sg{max-width:500px}.su{line-height:24px}.sv{letter-spacing:0}.te{margin-bottom:88px}.tp{margin:40px 0 16px}.ub{width:min-width}.ug{padding-top:72px}</style><style type="text/css" data-fela-rehydration="558" data-fela-type="RULE" media="all and (min-width: 728px) and (max-width: 903.98px)">.j{display:none}.w{display:flex}.x{justify-content:space-between}.bu{width:64px}.cf{margin:0 48px}.cu{height:48px}.db{margin-bottom:52px}.dn{margin-bottom:48px}.ec{font-size:13px}.ed{line-height:20px}.ek{padding:0px 8px 1px}.fy{margin-bottom:50px}.gc{max-width:680px}.hi{font-size:42px}.hj{margin-top:1.19em}.hk{margin-bottom:32px}.hl{line-height:52px}.hm{letter-spacing:-0.011em}.ib{align-items:center}.ic{flex-direction:row}.ji{border-top:solid 1px #F2F2F2}.jj{border-bottom:solid 1px #F2F2F2}.jk{margin:32px 0 0}.jl{padding:3px 8px}.jy> *{margin-right:24px}.jz> :last-child{margin-right:0}.lr{margin:0}.my{font-size:20px}.mz{margin-top:2.14em}.na{line-height:32px}.nb{letter-spacing:-0.003em}.no{margin-top:56px}.om{font-size:24px}.on{margin-top:1.95em}.oo{line-height:30px}.op{letter-spacing:-0.016em}.pb{margin-top:0.94em}.pj{margin-top:1.14em}.rr{margin-bottom:0}.rs{margin-right:20px}.sh{max-width:500px}.ss{line-height:24px}.st{letter-spacing:0}.td{margin-bottom:88px}.to{margin:40px 0 16px}.ua{width:min-width}.uf{padding-top:72px}</style><style type="text/css" data-fela-rehydration="558" data-fela-type="RULE" media="all and (min-width: 552px) and (max-width: 727.98px)">.k{display:none}.u{display:flex}.v{justify-content:space-between}.bt{width:24px}.ce{margin:0 24px}.ct{height:40px}.da{margin-bottom:44px}.dm{margin-bottom:32px}.ea{font-size:13px}.eb{line-height:20px}.ej{padding:0px 8px 1px}.fx{margin-bottom:2px}.hd{font-size:32px}.he{margin-top:1.01em}.hf{margin-bottom:24px}.hg{line-height:38px}.hh{letter-spacing:-0.014em}.hz{align-items:flex-start}.ia{flex-direction:column-reverse}.jg{margin:24px 0 0}.jh{padding:0}.jw> *{margin-right:8px}.jx> :last-child{margin-right:8px}.ko{margin-left:0px}.lq{margin:0}.mg{border:1px solid #F2F2F2}.mh{border-radius:99em}.mi{padding:0px 16px 0px 12px}.mj{height:38px}.mk{align-items:center}.mm svg{margin-right:8px}.mu{font-size:18px}.mv{margin-top:1.56em}.mw{line-height:28px}.mx{letter-spacing:-0.003em}.nn{margin-top:40px}.oi{font-size:20px}.oj{margin-top:1.2em}.ok{line-height:24px}.ol{letter-spacing:0}.pa{margin-top:0.67em}.pi{margin-top:1.34em}.rl{flex-direction:column}.rt{margin-bottom:20px}.ru{margin-right:0}.si{max-width:100%}.sp{font-size:24px}.sq{line-height:30px}.sr{letter-spacing:-0.016em}.tc{margin-bottom:64px}.tn{margin:32px 0 16px}.tz{width:100%}.ue{padding-top:48px}.ml:hover{border-color:#E5E5E5}</style><style type="text/css" data-fela-rehydration="558" data-fela-type="RULE" media="print">.rb{display:none}</style><style type="text/css" data-fela-rehydration="558" data-fela-type="RULE" media="(prefers-reduced-motion: no-preference)">.pq{transition:transform 300ms cubic-bezier(0.2, 0, 0.2, 1)}</style></head><body><div id="root"><div class="a b c"><div class="d e f g h i j k"></div><script>document.domain = document.domain;</script><div class="l c"><div class="l m n o c"><div class="p q r s t u v w x i d y z"><a class="dv ah dw bf al b an ao ap aq ar as at au s u w i d q dx z" href="https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F378b343216bf&amp;%7Efeature=LoOpenInAppButton&amp;%7Echannel=ShowPostUnderUser&amp;source=post_page---top_nav_layout_nav-----------------------------------------" rel="noopener follow">Open in app<svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" fill="none" viewBox="0 0 10 10" class="du"><path fill="currentColor" d="M.985 8.485a.375.375 0 1 0 .53.53zM8.75 1.25h.375A.375.375 0 0 0 8.75.875zM8.375 6.5a.375.375 0 1 0 .75 0zM3.5.875a.375.375 0 1 0 0 .75zm-1.985 8.14 7.5-7.5-.53-.53-7.5 7.5zm6.86-7.765V6.5h.75V1.25zM3.5 1.625h5.25v-.75H3.5z"></path></svg></a><div class="ab q"><p class="bf b dy dz ea eb ec ed ee ef eg eh dv"><span><button class="bf b dy dz ei ea eb ej ec ed ek el ef em eo eh ep eq er es et eu ev ew ex ey ez fa fb fc fd fe bm ff fg" data-testid="headerSignUpButton">Sign up</button></span></p><div class="fh l"><p class="bf b dy dz ea eb ec ed ee ef eg eh dv"><span><a class="ag ah ai aj ak al am an ao ap aq ar as at au" data-testid="headerSignInButton" href="https://medium.com/m/signin?operation=login&amp;redirect=https%3A%2F%2Fhcksyd.medium.com%2Fasyncrat-analysing-the-three-stages-of-execution-378b343216bf&amp;source=post_page---top_nav_layout_nav-----------------------global_nav------------------" rel="noopener follow">Sign in</a></span></p></div></div></div><div class="p q r ab ac"><div class="ab q ae af"><a class="ag ah ai aj ak al am an ao ap aq ar as at au ab" aria-label="Homepage" data-testid="headerMediumLogo" href="https://medium.com/?source=post_page---top_nav_layout_nav-----------------------------------------" rel="noopener follow"><svg xmlns="http://www.w3.org/2000/svg" width="719" height="160" fill="none" viewBox="0 0 719 160" class="av aw ax"><path fill="#242424" d="m174.104 9.734.215-.047V8.02H130.39L89.6 103.89 48.81 8.021H1.472v1.666l.212.047c8.018 1.81 12.09 4.509 12.09 14.242V137.93c0 9.734-4.087 12.433-12.106 14.243l-.212.047v1.671h32.118v-1.665l-.213-.048c-8.018-1.809-12.089-4.509-12.089-14.242V30.586l52.399 123.305h2.972l53.925-126.743V140.75c-.687 7.688-4.721 10.062-11.982 11.701l-.215.05v1.652h55.948v-1.652l-.215-.05c-7.269-1.639-11.4-4.013-12.087-11.701l-.037-116.774h.037c0-9.733 4.071-12.432 12.087-14.242m25.555 75.488c.915-20.474 8.268-35.252 20.606-35.507 3.806.063 6.998 1.312 9.479 3.714 5.272 5.118 7.751 15.812 7.368 31.793zm-.553 5.77h65.573v-.275c-.186-15.656-4.721-27.834-13.466-36.196-7.559-7.227-18.751-11.203-30.507-11.203h-.263c-6.101 0-13.584 1.48-18.909 4.16-6.061 2.807-11.407 7.003-15.855 12.511-7.161 8.874-11.499 20.866-12.554 34.343q-.05.606-.092 1.212a50 50 0 0 0-.065 1.151 85.807 85.807 0 0 0-.094 5.689c.71 30.524 17.198 54.917 46.483 54.917 25.705 0 40.675-18.791 44.407-44.013l-1.886-.664c-6.557 13.556-18.334 21.771-31.738 20.769-18.297-1.369-32.314-19.922-31.042-42.395m139.722 41.359c-2.151 5.101-6.639 7.908-12.653 7.908s-11.513-4.129-15.418-11.63c-4.197-8.053-6.405-19.436-6.405-32.92 0-28.067 8.729-46.22 22.24-46.22 5.657 0 10.111 2.807 12.236 7.704zm43.499 20.008c-8.019-1.897-12.089-4.722-12.089-14.951V1.309l-48.716 14.353v1.757l.299-.024c6.72-.543 11.278.386 13.925 2.83 2.072 1.915 3.082 4.853 3.082 8.987v18.66c-4.803-3.067-10.516-4.56-17.448-4.56-14.059 0-26.909 5.92-36.176 16.672-9.66 11.205-14.767 26.518-14.767 44.278-.003 31.72 15.612 53.039 38.851 53.039 13.595 0 24.533-7.449 29.54-20.013v16.865h43.711v-1.746zM424.1 19.819c0-9.904-7.468-17.374-17.375-17.374-9.859 0-17.573 7.632-17.573 17.374s7.721 17.374 17.573 17.374c9.907 0 17.375-7.47 17.375-17.374m11.499 132.546c-8.019-1.897-12.089-4.722-12.089-14.951h-.035V43.635l-43.714 12.551v1.705l.263.024c9.458.842 12.047 4.1 12.047 15.152v81.086h43.751v-1.746zm112.013 0c-8.018-1.897-12.089-4.722-12.089-14.951V43.635l-41.621 12.137v1.71l.246.026c7.733.813 9.967 4.257 9.967 15.36v59.279c-2.578 5.102-7.415 8.131-13.274 8.336-9.503 0-14.736-6.419-14.736-18.073V43.638l-43.714 12.55v1.703l.262.024c9.459.84 12.05 4.097 12.05 15.152v50.17a56.3 56.3 0 0 0 .91 10.444l.787 3.423c3.701 13.262 13.398 20.197 28.59 20.197 12.868 0 24.147-7.966 29.115-20.43v17.311h43.714v-1.747zm169.818 1.788v-1.749l-.213-.05c-8.7-2.006-12.089-5.789-12.089-13.49v-63.79c0-19.89-11.171-31.761-29.883-31.761-13.64 0-25.141 7.882-29.569 20.16-3.517-13.01-13.639-20.16-28.606-20.16-13.146 0-23.449 6.938-27.869 18.657V43.643L545.487 55.68v1.715l.263.024c9.345.829 12.047 4.181 12.047 14.95v81.784h40.787v-1.746l-.215-.053c-6.941-1.631-9.181-4.606-9.181-12.239V66.998c1.836-4.289 5.537-9.37 12.853-9.37 9.086 0 13.692 6.296 13.692 18.697v77.828h40.797v-1.746l-.215-.053c-6.94-1.631-9.18-4.606-9.18-12.239V75.066a42 42 0 0 0-.578-7.26c1.947-4.661 5.86-10.177 13.475-10.177 9.214 0 13.691 6.114 13.691 18.696v77.828z"></path></svg></a><div class="h"><div class="ab ay az ba bb q bc bd"><div class="bm" aria-hidden="false" aria-describedby="searchResults" aria-labelledby="searchResults"></div><div class="bn bo ab"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M4.092 11.06a6.95 6.95 0 1 1 13.9 0 6.95 6.95 0 0 1-13.9 0m6.95-8.05a8.05 8.05 0 1 0 5.13 14.26l3.75 3.75a.56.56 0 1 0 .79-.79l-3.73-3.73A8.05 8.05 0 0 0 11.042 3z" clip-rule="evenodd"></path></svg></div><input role="combobox" aria-controls="searchResults" aria-expanded="false" aria-label="search" data-testid="headerSearchInput" tabindex="0" class="ay be bf bg z bh bi bj bk bl" placeholder="Search" value=""/></div></div></div><div class="h k w fi fj"><div class="fk ab"><span><a class="ag ah ai aj ak al am an ao ap aq ar as at au" data-testid="headerWriteButton" href="https://medium.com/m/signin?operation=register&amp;redirect=https%3A%2F%2Fmedium.com%2Fnew-story&amp;source=---top_nav_layout_nav-----------------------new_post_topnav------------------" rel="noopener follow"><div class="bf b bg z dv fl fm ab q fn fo"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" aria-label="Write"><path fill="currentColor" d="M14 4a.5.5 0 0 0 0-1zm7 6a.5.5 0 0 0-1 0zm-7-7H4v1h10zM3 4v16h1V4zm1 17h16v-1H4zm17-1V10h-1v10zm-1 1a1 1 0 0 0 1-1h-1zM3 20a1 1 0 0 0 1 1v-1zM4 3a1 1 0 0 0-1 1h1z"></path><path stroke="currentColor" d="m17.5 4.5-8.458 8.458a.25.25 0 0 0-.06.098l-.824 2.47a.25.25 0 0 0 .316.316l2.47-.823a.25.25 0 0 0 .098-.06L19.5 6.5m-2-2 2.323-2.323a.25.25 0 0 1 .354 0l1.646 1.646a.25.25 0 0 1 0 .354L19.5 6.5m-2-2 2 2"></path></svg><div class="du l">Write</div></div></a></span></div></div><div class="k j i d"><div class="fk ab"><a class="ag ah ai aj ak al am an ao ap aq ar as at au" data-testid="headerSearchButton" href="https://medium.com/search?source=post_page---top_nav_layout_nav-----------------------------------------" rel="noopener follow"><div class="bf b bg z dv fl fm ab q fn fo"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24" aria-label="Search"><path fill="currentColor" fill-rule="evenodd" d="M4.092 11.06a6.95 6.95 0 1 1 13.9 0 6.95 6.95 0 0 1-13.9 0m6.95-8.05a8.05 8.05 0 1 0 5.13 14.26l3.75 3.75a.56.56 0 1 0 .79-.79l-3.73-3.73A8.05 8.05 0 0 0 11.042 3z" clip-rule="evenodd"></path></svg></div></a></div></div><div class="fk h k j"><div class="ab q"><p class="bf b dy dz ea eb ec ed ee ef eg eh dv"><span><button class="bf b dy dz ei ea eb ej ec ed ek el ef em eo eh ep eq er es et eu ev ew ex ey ez fa fb fc fd fe bm ff fg" data-testid="headerSignUpButton">Sign up</button></span></p><div class="fh l"><p class="bf b dy dz ea eb ec ed ee ef eg eh dv"><span><a class="ag ah ai aj ak al am an ao ap aq ar as at au" data-testid="headerSignInButton" href="https://medium.com/m/signin?operation=login&amp;redirect=https%3A%2F%2Fhcksyd.medium.com%2Fasyncrat-analysing-the-three-stages-of-execution-378b343216bf&amp;source=post_page---top_nav_layout_nav-----------------------global_nav------------------" rel="noopener follow">Sign in</a></span></p></div></div></div><div class="l" aria-hidden="false"><button class="ay fp an ab q ap fq fr fs" aria-label="user options menu" data-testid="headerUserIcon"><div class="l fl"><img alt="" class="l fe by bz ca cy" src="https://miro.medium.com/v2/resize:fill:64:64/1*dmbNkD5D-u45r44go_cf0g.png" width="32" height="32" loading="lazy" role="presentation"/><div class="ft by l bz ca fu n ay fv"></div></div></button></div></div></div><div class="ab"><div class="cb bh"><div class="l"><div class="fw fx fy fz ga l"><div class="ab cc"><div class="cj bh gb gc gd ge"></div></div><article><div class="l"><div class="l"><span class="l"></span><section><div><div class="fu gk gl gm gn go"></div><div class="gp gq gr gs gt"><div class="ab cc"><div class="cj bh gb gc gd ge"><div><h1 id="8bf9" class="pw-post-title gu gv gw bf gx gy gz ha hb hc hd he hf hg hh hi hj hk hl hm hn ho hp hq hr hs ht hu hv hw bk" data-testid="storyTitle">AsyncRAT: Analysing the Three Stages of Execution</h1><div><div class="speechify-ignore ab cq"><div class="speechify-ignore bh l"><div class="ab hx hy hz ia ib ic id ie if ig ih"><div class="ab q ih"><div class="ab ii"><div><div class="bm" aria-hidden="false"><a rel="noopener follow" href="/?source=post_page---byline--378b343216bf---------------------------------------"><div class="l ij ik by il im"><div class="l fl"><img alt="Hack Sydney" class="l fe by bz ca cy" src="https://miro.medium.com/v2/resize:fill:64:64/1*0al7KlH0A2FW1DLbW7xyqw.png" width="32" height="32" loading="lazy" data-testid="authorPhoto"/><div class="in by l bz ca fu n io fv"></div></div></div></a></div></div></div><span class="bf b bg z bk"><div class="ip ab q"><div class="ab q iq"><div class="ab q"><div><div class="bm" aria-hidden="false"><span class="bf b bg z bk"><a class="ag ah ai aj ak al am an ao ap aq ar as ir" data-testid="authorName" rel="noopener follow" href="/?source=post_page---byline--378b343216bf---------------------------------------">Hack Sydney</a></span></div></div></div><div class="is bm"></div><div class="bm" aria-hidden="false"><div class="bm"><button class="it iu iv ap ab cc q aq ey iw ix iy iz"><span class="bf b bg z bk"><span class="l ja">Follow</span></span></button></div></div></div></div></span></div><div class="ab q jb"><span class="bf b bg z dv"><div class="ab ae"><span data-testid="storyReadTime">8 min read</span><div class="jc jd l" aria-hidden="true"><span class="l" aria-hidden="true"><span class="bf b bg z dv">·</span></span></div><span data-testid="storyPublishDate">Feb 8, 2023</span></div></span></div></div><div class="ab cq je jf jg jh ji jj jk jl jm jn jo jp jq jr js jt"><div class="h k w fi fj q"><div class="kj l"><div class="ab q kk kl"><div class="pw-multi-vote-icon fl km kn ko kp"><span><a class="ag ah ai aj ak al am an ao ap aq ar as at au" data-testid="headerClapButton" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fp%2F378b343216bf&amp;operation=register&amp;redirect=https%3A%2F%2Fhcksyd.medium.com%2Fasyncrat-analysing-the-three-stages-of-execution-378b343216bf&amp;user=Hack+Sydney&amp;userId=bca54845b6&amp;source=---header_actions--378b343216bf---------------------clap_footer------------------" rel="noopener follow"><div><div class="bm" aria-hidden="false"><div class="kq ap kr ks kt ku an kv kw kx kp"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM13.916 3.953l1.523-2.112-1.184-.39zM8.589 1.84l1.522 2.112-.337-2.501zM18.523 18.92c-.86.86-1.75 1.246-2.62 1.33a6 6 0 0 0 .407-.372c2.388-2.389 2.86-4.951 1.399-7.623l-.912-1.603-.79-1.672c-.26-.56-.194-.98.203-1.288a.7.7 0 0 1 .546-.132c.283.046.546.231.728.5l2.363 4.157c.976 1.624 1.141 4.237-1.324 6.702m-10.999-.438L3.37 14.328a.828.828 0 0 1 .585-1.408.83.83 0 0 1 .585.242l2.158 2.157a.365.365 0 0 0 .516-.516l-2.157-2.158-1.449-1.449a.826.826 0 0 1 1.167-1.17l3.438 3.44a.363.363 0 0 0 .516 0 .364.364 0 0 0 0-.516L5.293 9.513l-.97-.97a.826.826 0 0 1 0-1.166.84.84 0 0 1 1.167 0l.97.968 3.437 3.436a.36.36 0 0 0 .517 0 .366.366 0 0 0 0-.516L6.977 7.83a.82.82 0 0 1-.241-.584.82.82 0 0 1 .824-.826c.219 0 .43.087.584.242l5.787 5.787a.366.366 0 0 0 .587-.415l-1.117-2.363c-.26-.56-.194-.98.204-1.289a.7.7 0 0 1 .546-.132c.283.046.545.232.727.501l2.193 3.86c1.302 2.38.883 4.59-1.277 6.75-1.156 1.156-2.602 1.627-4.19 1.367-1.418-.236-2.866-1.033-4.079-2.246M10.75 5.971l2.12 2.12c-.41.502-.465 1.17-.128 1.89l.22.465-3.523-3.523a.8.8 0 0 1-.097-.368c0-.22.086-.428.241-.584a.847.847 0 0 1 1.167 0m7.355 1.705c-.31-.461-.746-.758-1.23-.837a1.44 1.44 0 0 0-1.11.275c-.312.24-.505.543-.59.881a1.74 1.74 0 0 0-.906-.465 1.47 1.47 0 0 0-.82.106l-2.182-2.182a1.56 1.56 0 0 0-2.2 0 1.54 1.54 0 0 0-.396.701 1.56 1.56 0 0 0-2.21-.01 1.55 1.55 0 0 0-.416.753c-.624-.624-1.649-.624-2.237-.037a1.557 1.557 0 0 0 0 2.2c-.239.1-.501.238-.715.453a1.56 1.56 0 0 0 0 2.2l.516.515a1.556 1.556 0 0 0-.753 2.615L7.01 19c1.32 1.319 2.909 2.189 4.475 2.449q.482.08.971.08c.85 0 1.653-.198 2.393-.579.231.033.46.054.686.054 1.266 0 2.457-.52 3.505-1.567 2.763-2.763 2.552-5.734 1.439-7.586z" clip-rule="evenodd"></path></svg></div></div></div></a></span></div><div class="pw-multi-vote-count l ky kz la lb lc ld le"><p class="bf b dw z dv"><span class="lf">--</span></p></div></div></div><div><div class="bm" aria-hidden="false"><button class="ap kq li lj ab q fm lk ll" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="lh"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"></path></svg><p class="bf b dw z dv"><span class="pw-responses-count lg lh">1</span></p></button></div></div></div><div class="ab q ju jv jw jx jy jz ka kb kc kd ke kf kg kh ki"><div class="lm k j i d"></div><div class="h k"><div><div class="bm" aria-hidden="false"><span><a class="ag ah ai aj ak al am an ao ap aq ar as at au" data-testid="headerBookmarkButton" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F378b343216bf&amp;operation=register&amp;redirect=https%3A%2F%2Fhcksyd.medium.com%2Fasyncrat-analysing-the-three-stages-of-execution-378b343216bf&amp;source=---header_actions--378b343216bf---------------------bookmark_footer------------------" rel="noopener follow"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="none" viewBox="0 0 25 25" class="dv ln" aria-label="Add to list bookmark button"><path fill="currentColor" d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .805.396L12.5 17l5.695 4.396A.5.5 0 0 0 19 21v-8.5a.5.5 0 0 0-1 0v7.485l-5.195-4.012a.5.5 0 0 0-.61 0L7 19.985z"></path></svg></a></span></div></div></div><div class="fe lo co"><div class="l ae"><div class="ab cc"><div class="lp lq lr ls lt lu cj bh"><div class="ab"><div class="bm" aria-hidden="false"><div><div class="bm" aria-hidden="false"><button aria-label="Listen" data-testid="audioPlayButton" class="ag fm ai aj ak al am lv ao ap aq ey lw lx ll ly lz ma mb mc s md me mf mg mh mi mj u mk ml mm"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M3 12a9 9 0 1 1 18 0 9 9 0 0 1-18 0m9-10C6.477 2 2 6.477 2 12s4.477 10 10 10 10-4.477 10-10S17.523 2 12 2m3.376 10.416-4.599 3.066a.5.5 0 0 1-.777-.416V8.934a.5.5 0 0 1 .777-.416l4.599 3.066a.5.5 0 0 1 0 .832" clip-rule="evenodd"></path></svg><div class="j i d"><p class="bf b bg z dv">Listen</p></div></button></div></div></div></div></div></div></div></div><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="headerSocialShareButton" class="ag fm ai aj ak al am lv ao ap aq ey lw lx ll ly lz ma mb mc s md me mf mg mh mi mj u mk ml mm"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"></path></svg><div class="j i d"><p class="bf b bg z dv">Share</p></div></button></div></div></div></div></div></div></div></div></div><p id="d4b2" class="pw-post-body-paragraph mn mo gw mp b mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk gp bk"><a class="ag nl" href="https://www.linkedin.com/in/michael-elford-2a342b8a/" rel="noopener ugc nofollow" target="_blank">Michael Elford</a></p><pre class="nm nn no np nq nr ns nt bp nu bb bk"><span id="565b" class="nv nw gw ns b bg nx ny l nz oa">Michael is a cybersecurity professional that is passionate about <br/>malware analysis and reverse engineering.</span></pre><p id="cc70" class="pw-post-body-paragraph mn mo gw mp b mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk gp bk"><em class="ob">In the second half of 2022, I led an investigation that involved a suspicious registry key, comprising a value that would run a potentially malicious executable file.</em></p><p id="3f2c" class="pw-post-body-paragraph mn mo gw mp b mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk gp bk"><em class="ob">Further analysis of the executable file resulted in confirmation of the file being malicious.</em></p><p id="83de" class="pw-post-body-paragraph mn mo gw mp b mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk gp bk"><em class="ob">In this blog post, I aim to share the findings from the investigation, with the goal of making the audience aware of the techniques that can be used to effectively analyse malware in general and specifically analyse ASyncRAT.</em></p><h1 id="004e" class="oc nw gw bf od oe of og oh oi oj ok ol om on oo op oq or os ot ou ov ow ox oy bk">ASyncRAT Analysis</h1><pre class="nm nn no np nq nr ns nt bp nu bb bk"><span id="b1b5" class="nv nw gw ns b bg nx ny l nz oa">Note: All malware analysis should be carried out in a sandboxed environment.</span></pre><h1 id="6b3b" class="oc nw gw bf od oe of og oh oi oj ok ol om on oo op oq or os ot ou ov ow ox oy bk">Tools used</h1><p id="1c11" class="pw-post-body-paragraph mn mo gw mp b mq oz ms mt mu pa mw mx my pb na nb nc pc ne nf ng pd ni nj nk gp bk">This is the list of tools that were used for this analysis:</p><ul class=""><li id="7668" class="mn mo gw mp b mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk pe pf pg bk"><a class="ag nl" href="https://www.mandiant.com/resources/blog/flare-vm-the-windows-malware" rel="noopener ugc nofollow" target="_blank">FlareVM</a></li><li id="8301" class="mn mo gw mp b mq ph ms mt mu pi mw mx my pj na nb nc pk ne nf ng pl ni nj nk pe pf pg bk"><a class="ag nl" href="https://www.winitor.com/" rel="noopener ugc nofollow" target="_blank">PEStudio</a></li><li id="f5f2" class="mn mo gw mp b mq ph ms mt mu pi mw mx my pj na nb nc pk ne nf ng pl ni nj nk pe pf pg bk"><a class="ag nl" href="https://github.com/dnSpy/dnSpy" rel="noopener ugc nofollow" target="_blank">dnSpy</a></li><li id="0bc7" class="mn mo gw mp b mq ph ms mt mu pi mw mx my pj na nb nc pk ne nf ng pl ni nj nk pe pf pg bk"><a class="ag nl" href="https://gchq.github.io/CyberChef/" rel="noopener ugc nofollow" target="_blank">Cyberchef</a></li><li id="5485" class="mn mo gw mp b mq ph ms mt mu pi mw mx my pj na nb nc pk ne nf ng pl ni nj nk pe pf pg bk"><a class="ag nl" href="https://labs.withsecure.com/tools/garbageman" rel="noopener ugc nofollow" target="_blank">Garbage Man</a></li></ul><h1 id="03a7" class="oc nw gw bf od oe of og oh oi oj ok ol om on oo op oq or os ot ou ov ow ox oy bk">Stage One</h1><p id="d20f" class="pw-post-body-paragraph mn mo gw mp b mq oz ms mt mu pa mw mx my pb na nb nc pc ne nf ng pd ni nj nk gp bk">Starting the analysis of Stage One of the malware, the first step was to check the executable in PEStudio, which confirmed that we were dealing with a <a class="ag nl" href="https://dotnet.microsoft.com/en-us/learn/dotnet/what-is-dotnet" rel="noopener ugc nofollow" target="_blank">.NET</a> file. Furthermore, we interpreted the fairly <a class="ag nl" href="https://practicalsecurityanalytics.com/file-entropy/" rel="noopener ugc nofollow" target="_blank">high entropy</a> as indicative of malware packing, where malware adds complexity to stay undetected by security solutions.</p><figure class="nm nn no np nq pp pm pn paragraph-image"><div role="button" tabindex="0" class="pq pr fl ps bh pt"><div class="pm pn po"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/0*z_Q9-TeUXUUQvxzJ 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*z_Q9-TeUXUUQvxzJ 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*z_Q9-TeUXUUQvxzJ 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*z_Q9-TeUXUUQvxzJ 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*z_Q9-TeUXUUQvxzJ 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*z_Q9-TeUXUUQvxzJ 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/0*z_Q9-TeUXUUQvxzJ 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/0*z_Q9-TeUXUUQvxzJ 640w, https://miro.medium.com/v2/resize:fit:720/0*z_Q9-TeUXUUQvxzJ 720w, https://miro.medium.com/v2/resize:fit:750/0*z_Q9-TeUXUUQvxzJ 750w, https://miro.medium.com/v2/resize:fit:786/0*z_Q9-TeUXUUQvxzJ 786w, https://miro.medium.com/v2/resize:fit:828/0*z_Q9-TeUXUUQvxzJ 828w, https://miro.medium.com/v2/resize:fit:1100/0*z_Q9-TeUXUUQvxzJ 1100w, https://miro.medium.com/v2/resize:fit:1400/0*z_Q9-TeUXUUQvxzJ 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh lu pu c" width="700" height="349" loading="lazy" role="presentation"/></picture></div></div><figcaption class="pv fg pw pm pn px py bf b bg z dv">PEstudio file overview</figcaption></figure><p id="9c87" class="pw-post-body-paragraph mn mo gw mp b mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk gp bk">Our next step was to peruse the strings of the malware, and take note of anything strange we may want to look into a little bit deeper later on.</p><figure class="nm nn no np nq pp pm pn paragraph-image"><div role="button" tabindex="0" class="pq pr fl ps bh pt"><div class="pm pn pz"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/0*kbuno4MBw0l9VV2q 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*kbuno4MBw0l9VV2q 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*kbuno4MBw0l9VV2q 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*kbuno4MBw0l9VV2q 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*kbuno4MBw0l9VV2q 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*kbuno4MBw0l9VV2q 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kbuno4MBw0l9VV2q 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/0*kbuno4MBw0l9VV2q 640w, https://miro.medium.com/v2/resize:fit:720/0*kbuno4MBw0l9VV2q 720w, https://miro.medium.com/v2/resize:fit:750/0*kbuno4MBw0l9VV2q 750w, https://miro.medium.com/v2/resize:fit:786/0*kbuno4MBw0l9VV2q 786w, https://miro.medium.com/v2/resize:fit:828/0*kbuno4MBw0l9VV2q 828w, https://miro.medium.com/v2/resize:fit:1100/0*kbuno4MBw0l9VV2q 1100w, https://miro.medium.com/v2/resize:fit:1400/0*kbuno4MBw0l9VV2q 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh lu pu c" width="700" height="321" loading="lazy" role="presentation"/></picture></div></div><figcaption class="pv fg pw pm pn px py bf b bg z dv">PEstudio file overview</figcaption></figure><p id="bc12" class="pw-post-body-paragraph mn mo gw mp b mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk gp bk">Examining the strings, we immediately identified some strings that appear to be <strong class="mp gx">obfuscated</strong>. As a note to ourselves, we highlighted that we may need to deploy a ‘<a class="ag nl" href="https://gchq.github.io/CyberChef/#recipe=Find_/_Replace(%7B&#x27;option&#x27;:&#x27;Regex&#x27;,&#x27;string&#x27;:&#x27;&#x27;%7D,&#x27;&#x27;,true,false,true,false)" rel="noopener ugc nofollow" target="_blank">find and replace</a>’ later on.</p><h1 id="8051" class="oc nw gw bf od oe of og oh oi oj ok ol om on oo op oq or os ot ou ov ow ox oy bk">Going Further</h1><p id="8707" class="pw-post-body-paragraph mn mo gw mp b mq oz ms mt mu pa mw mx my pb na nb nc pc ne nf ng pd ni nj nk gp bk">After determining that the file was written in .NET and making note of the obfuscated strings, we then turned to <a class="ag nl" href="https://github.com/dnSpy/dnSpy" rel="noopener ugc nofollow" target="_blank">dnSpy</a>, a .NET debugger.</p><p id="ffea" class="pw-post-body-paragraph mn mo gw mp b mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk gp bk">One of the first things we noticed was a naming discrepancy. The name of the executable on the host and the name of the executable shown in dnSpy are completely different. The reason as to why the executable having a completely different name is of interest is due to many threat actors that use malware rename them so that they do not draw as much attention and can be hidden on the host and quietly run in the background so that even if the user does notice the something strange is going on with their system, they will skip over the file thinking that it is normal and doesn’t raise any alarms with the user and their AV.</p><p id="59a9" class="pw-post-body-paragraph mn mo gw mp b mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk gp bk">Looking through the code, there is a replace function for a string we had noted earlier. Now that we are certain about what is replacing the obfuscation pattern, we can check what those strings are, which could possibly give us a clue as to what is happening.</p><figure class="nm nn no np nq pp pm pn paragraph-image"><div role="button" tabindex="0" class="pq pr fl ps bh pt"><div class="pm pn qa"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/0*aPbEP5FNvUx41G8M 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*aPbEP5FNvUx41G8M 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*aPbEP5FNvUx41G8M 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*aPbEP5FNvUx41G8M 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*aPbEP5FNvUx41G8M 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*aPbEP5FNvUx41G8M 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/0*aPbEP5FNvUx41G8M 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/0*aPbEP5FNvUx41G8M 640w, https://miro.medium.com/v2/resize:fit:720/0*aPbEP5FNvUx41G8M 720w, https://miro.medium.com/v2/resize:fit:750/0*aPbEP5FNvUx41G8M 750w, https://miro.medium.com/v2/resize:fit:786/0*aPbEP5FNvUx41G8M 786w, https://miro.medium.com/v2/resize:fit:828/0*aPbEP5FNvUx41G8M 828w, https://miro.medium.com/v2/resize:fit:1100/0*aPbEP5FNvUx41G8M 1100w, https://miro.medium.com/v2/resize:fit:1400/0*aPbEP5FNvUx41G8M 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh lu pu c" width="700" height="169" loading="lazy" role="presentation"/></picture></div></div><figcaption class="pv fg pw pm pn px py bf b bg z dv">Executable name and replace function</figcaption></figure><h1 id="3d7a" class="oc nw gw bf od oe of og oh oi oj ok ol om on oo op oq or os ot ou ov ow ox oy bk">Pulling on the Thread</h1><p id="c38e" class="pw-post-body-paragraph mn mo gw mp b mq oz ms mt mu pa mw mx my pb na nb nc pc ne nf ng pd ni nj nk gp bk">For analysing the obfuscated strings, we used <strong class="mp gx">CyberChef</strong>. In CyberChef, we used the `Find/Replace` feature to perform the replace function found in the code. This enabled us to see the clear text of <em class="ob">what</em> was obfuscated which resulted in getting a clearer understanding of what was going on <em class="ob">within</em> the code.</p><p id="d6eb" class="pw-post-body-paragraph mn mo gw mp b mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk gp bk">The end-result of the above exercise gave us the de-obfuscated version of strings which contained “Load” and “Invoke”. This showed that something was going to be loaded and executed (“invoked”) by the code contained within the executable.</p><p id="0571" class="pw-post-body-paragraph mn mo gw mp b mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk gp bk"><em class="ob">If at any time you are unsure what actions these methods perform, the best thing to do is Google around and find some docs. It may be time consuming at first but it is an important part of analysing malware.</em></p><figure class="nm nn no np nq pp pm pn paragraph-image"><div role="button" tabindex="0" class="pq pr fl ps bh pt"><div class="pm pn qb"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/0*phTNc9lZHTFYrPzY 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*phTNc9lZHTFYrPzY 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*phTNc9lZHTFYrPzY 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*phTNc9lZHTFYrPzY 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*phTNc9lZHTFYrPzY 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*phTNc9lZHTFYrPzY 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/0*phTNc9lZHTFYrPzY 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/0*phTNc9lZHTFYrPzY 640w, https://miro.medium.com/v2/resize:fit:720/0*phTNc9lZHTFYrPzY 720w, https://miro.medium.com/v2/resize:fit:750/0*phTNc9lZHTFYrPzY 750w, https://miro.medium.com/v2/resize:fit:786/0*phTNc9lZHTFYrPzY 786w, https://miro.medium.com/v2/resize:fit:828/0*phTNc9lZHTFYrPzY 828w, https://miro.medium.com/v2/resize:fit:1100/0*phTNc9lZHTFYrPzY 1100w, https://miro.medium.com/v2/resize:fit:1400/0*phTNc9lZHTFYrPzY 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh lu pu c" width="700" height="241" loading="lazy" role="presentation"/></picture></div></div><figcaption class="pv fg pw pm pn px py bf b bg z dv">De-obfuscated strings</figcaption></figure><p id="fe6c" class="pw-post-body-paragraph mn mo gw mp b mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk gp bk">At this stage of the analysis, we had accumulated enough findings to start sketching out the trajectory of the malware’s execution flow. We had identified the malware was loading and executing <em class="ob">something, </em>and that the malware was packed and contained executable data that we would see in the next stage of analysis.</p><h1 id="1a5d" class="oc nw gw bf od oe of og oh oi oj ok ol om on oo op oq or os ot ou ov ow ox oy bk">Hunting for the Hidden</h1><p id="2184" class="pw-post-body-paragraph mn mo gw mp b mq oz ms mt mu pa mw mx my pb na nb nc pc ne nf ng pd ni nj nk gp bk">The tool <strong class="mp gx">Garbage Man</strong> is used for heap analysis — a technique that allows analysts to intervene and observe as the .NET malware is unraveling itself.</p><p id="b104" class="pw-post-body-paragraph mn mo gw mp b mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk gp bk">Analysing the malware in Garbage Man aided in extraction of hidden data that composed the <em class="ob">second</em> executable within the <em class="ob">first</em> executable.</p><p id="bffb" class="pw-post-body-paragraph mn mo gw mp b mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk gp bk">In order to further analyse the malware, we executed the original malware found on the host in Garbage Man. To get started, we added in a delay of 300ms with 10 snapshots taken at 100ms intervals.</p><p id="5ff0" class="pw-post-body-paragraph mn mo gw mp b mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk gp bk">We added in the delay to allow time for the process to start running and added the extra snapshots and intervals so that we can compare the difference between the intervals if we need to.</p><p id="8f77" class="pw-post-body-paragraph mn mo gw mp b mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk gp bk">Once Garbage Man had executed the file, we had these options:</p><ul class=""><li id="3347" class="mn mo gw mp b mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk pe pf pg bk">Sift through the heap manually, and look at the strings and values that are contained within the executable</li><li id="ce9e" class="mn mo gw mp b mq ph ms mt mu pi mw mx my pj na nb nc pk ne nf ng pl ni nj nk pe pf pg bk">Use the search function to look through all the snapshots. Specifically looking for bytes that start with the value of <em class="ob">MZ</em> — which is the <strong class="mp gx">PE header</strong> for executables and dll files, and then order them by size in descending order. The search function gives us a list of results, and we can save the binaries with MZ headers and save them for further analysis.</li></ul><figure class="nm nn no np nq pp pm pn paragraph-image"><div role="button" tabindex="0" class="pq pr fl ps bh pt"><div class="pm pn qc"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/0*Tg41ed_eoJ9h1GAA 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*Tg41ed_eoJ9h1GAA 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*Tg41ed_eoJ9h1GAA 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*Tg41ed_eoJ9h1GAA 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*Tg41ed_eoJ9h1GAA 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*Tg41ed_eoJ9h1GAA 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/0*Tg41ed_eoJ9h1GAA 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/0*Tg41ed_eoJ9h1GAA 640w, https://miro.medium.com/v2/resize:fit:720/0*Tg41ed_eoJ9h1GAA 720w, https://miro.medium.com/v2/resize:fit:750/0*Tg41ed_eoJ9h1GAA 750w, https://miro.medium.com/v2/resize:fit:786/0*Tg41ed_eoJ9h1GAA 786w, https://miro.medium.com/v2/resize:fit:828/0*Tg41ed_eoJ9h1GAA 828w, https://miro.medium.com/v2/resize:fit:1100/0*Tg41ed_eoJ9h1GAA 1100w, https://miro.medium.com/v2/resize:fit:1400/0*Tg41ed_eoJ9h1GAA 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh lu pu c" width="700" height="389" loading="lazy" role="presentation"/></picture></div></div><figcaption class="pv fg pw pm pn px py bf b bg z dv">Using Garbage Man to search for executables and save the binary for analysis</figcaption></figure><p id="f4a8" class="pw-post-body-paragraph mn mo gw mp b mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk gp bk">When saving the executable, we chose an executable with the large size value and due to us looking through all the snapshots we were getting repeats of the same executable, we could then save it as “stage2.exe”. We then pivoted back to PEstudio to check the file. On examination, our second hidden executable yet again turned out to be a .NET file.</p><figure class="nm nn no np nq pp pm pn paragraph-image"><div role="button" tabindex="0" class="pq pr fl ps bh pt"><div class="pm pn qd"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/0*YHv0lc27Q0PEcU1s 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*YHv0lc27Q0PEcU1s 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*YHv0lc27Q0PEcU1s 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*YHv0lc27Q0PEcU1s 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*YHv0lc27Q0PEcU1s 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*YHv0lc27Q0PEcU1s 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/0*YHv0lc27Q0PEcU1s 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/0*YHv0lc27Q0PEcU1s 640w, https://miro.medium.com/v2/resize:fit:720/0*YHv0lc27Q0PEcU1s 720w, https://miro.medium.com/v2/resize:fit:750/0*YHv0lc27Q0PEcU1s 750w, https://miro.medium.com/v2/resize:fit:786/0*YHv0lc27Q0PEcU1s 786w, https://miro.medium.com/v2/resize:fit:828/0*YHv0lc27Q0PEcU1s 828w, https://miro.medium.com/v2/resize:fit:1100/0*YHv0lc27Q0PEcU1s 1100w, https://miro.medium.com/v2/resize:fit:1400/0*YHv0lc27Q0PEcU1s 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh lu pu c" width="700" height="370" loading="lazy" role="presentation"/></picture></div></div><figcaption class="pv fg pw pm pn px py bf b bg z dv">PEstudio of stage2.exe</figcaption></figure><h1 id="eebc" class="oc nw gw bf od oe of og oh oi oj ok ol om on oo op oq or os ot ou ov ow ox oy bk">Stage Two</h1><p id="1d63" class="pw-post-body-paragraph mn mo gw mp b mq oz ms mt mu pa mw mx my pb na nb nc pc ne nf ng pd ni nj nk gp bk">Delving into our stage2.exe, we found that checking its strings highlighted some noteworthy <a class="ag nl" href="https://malapi.io/" rel="noopener ugc nofollow" target="_blank">Win32 APIs that malware leverages</a>. Some APIs that jumped out were connected with manipulating processes [<a class="ag nl" href="https://attack.mitre.org/techniques/T1055/" rel="noopener ugc nofollow" target="_blank">T1055</a>], specifically in this case, process hollowing [<a class="ag nl" href="https://attack.mitre.org/techniques/T1055/012/" rel="noopener ugc nofollow" target="_blank">T1055.012</a>] — an adversarial technique to create a paused, legitimate process then swap out its memory with malicious contents.</p><figure class="nm nn no np nq pp pm pn paragraph-image"><div role="button" tabindex="0" class="pq pr fl ps bh pt"><div class="pm pn qe"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/0*5Uv_of4opkyLBrzF 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*5Uv_of4opkyLBrzF 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*5Uv_of4opkyLBrzF 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*5Uv_of4opkyLBrzF 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*5Uv_of4opkyLBrzF 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*5Uv_of4opkyLBrzF 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/0*5Uv_of4opkyLBrzF 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/0*5Uv_of4opkyLBrzF 640w, https://miro.medium.com/v2/resize:fit:720/0*5Uv_of4opkyLBrzF 720w, https://miro.medium.com/v2/resize:fit:750/0*5Uv_of4opkyLBrzF 750w, https://miro.medium.com/v2/resize:fit:786/0*5Uv_of4opkyLBrzF 786w, https://miro.medium.com/v2/resize:fit:828/0*5Uv_of4opkyLBrzF 828w, https://miro.medium.com/v2/resize:fit:1100/0*5Uv_of4opkyLBrzF 1100w, https://miro.medium.com/v2/resize:fit:1400/0*5Uv_of4opkyLBrzF 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh lu pu c" width="700" height="370" loading="lazy" role="presentation"/></picture></div></div><figcaption class="pv fg pw pm pn px py bf b bg z dv">Some of the APIs and Strings that could indicate Process Hollowing</figcaption></figure><p id="515e" class="pw-post-body-paragraph mn mo gw mp b mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk gp bk">As our stage two was in the .NET world again, we used dnSpy to dig a little deeper. When opening up the executable, we were met with a <em class="ob">lot</em> of information we had to get through. Like the first stage, the second stage’s naming convention was also suspicious.</p><figure class="nm nn no np nq pp pm pn paragraph-image"><div role="button" tabindex="0" class="pq pr fl ps bh pt"><div class="pm pn qf"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/0*144ZvaM1iuYgSqG6 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*144ZvaM1iuYgSqG6 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*144ZvaM1iuYgSqG6 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*144ZvaM1iuYgSqG6 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*144ZvaM1iuYgSqG6 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*144ZvaM1iuYgSqG6 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/0*144ZvaM1iuYgSqG6 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/0*144ZvaM1iuYgSqG6 640w, https://miro.medium.com/v2/resize:fit:720/0*144ZvaM1iuYgSqG6 720w, https://miro.medium.com/v2/resize:fit:750/0*144ZvaM1iuYgSqG6 750w, https://miro.medium.com/v2/resize:fit:786/0*144ZvaM1iuYgSqG6 786w, https://miro.medium.com/v2/resize:fit:828/0*144ZvaM1iuYgSqG6 828w, https://miro.medium.com/v2/resize:fit:1100/0*144ZvaM1iuYgSqG6 1100w, https://miro.medium.com/v2/resize:fit:1400/0*144ZvaM1iuYgSqG6 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh lu pu c" width="700" height="390" loading="lazy" role="presentation"/></picture></div></div><figcaption class="pv fg pw pm pn px py bf b bg z dv">Stage 2 dnSpy</figcaption></figure><p id="d1c5" class="pw-post-body-paragraph mn mo gw mp b mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk gp bk">Examining dnSpy’s output, we discovered a section completely different to the other parts of the code due to it being obfuscated, and seemingly performing a function in memory — both of which are techniques used to evade detection [<a class="ag nl" href="https://attack.mitre.org/techniques/T1140/" rel="noopener ugc nofollow" target="_blank">T1140</a>].</p><figure class="nm nn no np nq pp pm pn paragraph-image"><div role="button" tabindex="0" class="pq pr fl ps bh pt"><div class="pm pn qg"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/0*WpMoKx1v3_KKbbia 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*WpMoKx1v3_KKbbia 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*WpMoKx1v3_KKbbia 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*WpMoKx1v3_KKbbia 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*WpMoKx1v3_KKbbia 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*WpMoKx1v3_KKbbia 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WpMoKx1v3_KKbbia 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/0*WpMoKx1v3_KKbbia 640w, https://miro.medium.com/v2/resize:fit:720/0*WpMoKx1v3_KKbbia 720w, https://miro.medium.com/v2/resize:fit:750/0*WpMoKx1v3_KKbbia 750w, https://miro.medium.com/v2/resize:fit:786/0*WpMoKx1v3_KKbbia 786w, https://miro.medium.com/v2/resize:fit:828/0*WpMoKx1v3_KKbbia 828w, https://miro.medium.com/v2/resize:fit:1100/0*WpMoKx1v3_KKbbia 1100w, https://miro.medium.com/v2/resize:fit:1400/0*WpMoKx1v3_KKbbia 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh lu pu c" width="700" height="391" loading="lazy" role="presentation"/></picture></div></div><figcaption class="pv fg pw pm pn px py bf b bg z dv">Obfuscated section in Stage 2</figcaption></figure><p id="3878" class="pw-post-body-paragraph mn mo gw mp b mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk gp bk">We used Garbage Man once again to sneakily observe how the malware unraveled itself. However, if you want an alternate technique to de-obfuscating this part of the code, you can use <a class="ag nl" href="https://github.com/de4dot/de4dot" rel="noopener ugc nofollow" target="_blank">de4dot</a> which may also lay it out in an easier to read format.</p><p id="5887" class="pw-post-body-paragraph mn mo gw mp b mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk gp bk">Next, in Garbage Man the objective was to retrieve the <strong class="mp gx"><em class="ob">third</em></strong> hidden stage. Our prior technique could be deployed here again, executing the binary and searching for the MZ headers.</p><p id="0df5" class="pw-post-body-paragraph mn mo gw mp b mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk gp bk">We found an executable and saved it as “stage3.exe”. We then packaged this up and shipped it to <strong class="mp gx">PEstudio</strong> (There is also information for procexp.sys contained in this but we are not going to focus on that at this time).</p><figure class="nm nn no np nq pp pm pn paragraph-image"><div role="button" tabindex="0" class="pq pr fl ps bh pt"><div class="pm pn qh"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/0*kSx0rBEXEoERxIsI 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*kSx0rBEXEoERxIsI 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*kSx0rBEXEoERxIsI 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*kSx0rBEXEoERxIsI 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*kSx0rBEXEoERxIsI 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*kSx0rBEXEoERxIsI 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/0*kSx0rBEXEoERxIsI 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/0*kSx0rBEXEoERxIsI 640w, https://miro.medium.com/v2/resize:fit:720/0*kSx0rBEXEoERxIsI 720w, https://miro.medium.com/v2/resize:fit:750/0*kSx0rBEXEoERxIsI 750w, https://miro.medium.com/v2/resize:fit:786/0*kSx0rBEXEoERxIsI 786w, https://miro.medium.com/v2/resize:fit:828/0*kSx0rBEXEoERxIsI 828w, https://miro.medium.com/v2/resize:fit:1100/0*kSx0rBEXEoERxIsI 1100w, https://miro.medium.com/v2/resize:fit:1400/0*kSx0rBEXEoERxIsI 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh lu pu c" width="700" height="390" loading="lazy" role="presentation"/></picture></div></div><figcaption class="pv fg pw pm pn px py bf b bg z dv">Searching for MZ header in stage2.exe</figcaption></figure><h1 id="d99e" class="oc nw gw bf od oe of og oh oi oj ok ol om on oo op oq or os ot ou ov ow ox oy bk">Stage Three</h1><p id="46fe" class="pw-post-body-paragraph mn mo gw mp b mq oz ms mt mu pa mw mx my pb na nb nc pc ne nf ng pd ni nj nk gp bk">When checking the third stage executable in PEstudio we observed <strong class="mp gx"><em class="ob">again</em></strong> it to be a .NET file and that it contained strings and APIs that suggested it was trying to make a network connection to an external source — like the API <a class="ag nl" href="https://malapi.io/winapi/Send" rel="noopener ugc nofollow" target="_blank"><em class="ob">Send</em></a>. This was a big hint that this was a Remote Access Trojan; I smell a RAT [<a class="ag nl" href="https://attack.mitre.org/tactics/TA0011/" rel="noopener ugc nofollow" target="_blank">​​TA0011</a>]!</p><figure class="nm nn no np nq pp pm pn paragraph-image"><div role="button" tabindex="0" class="pq pr fl ps bh pt"><div class="pm pn qi"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/0*ohA8YRyc6XuXrSMl 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*ohA8YRyc6XuXrSMl 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*ohA8YRyc6XuXrSMl 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*ohA8YRyc6XuXrSMl 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*ohA8YRyc6XuXrSMl 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*ohA8YRyc6XuXrSMl 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/0*ohA8YRyc6XuXrSMl 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/0*ohA8YRyc6XuXrSMl 640w, https://miro.medium.com/v2/resize:fit:720/0*ohA8YRyc6XuXrSMl 720w, https://miro.medium.com/v2/resize:fit:750/0*ohA8YRyc6XuXrSMl 750w, https://miro.medium.com/v2/resize:fit:786/0*ohA8YRyc6XuXrSMl 786w, https://miro.medium.com/v2/resize:fit:828/0*ohA8YRyc6XuXrSMl 828w, https://miro.medium.com/v2/resize:fit:1100/0*ohA8YRyc6XuXrSMl 1100w, https://miro.medium.com/v2/resize:fit:1400/0*ohA8YRyc6XuXrSMl 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh lu pu c" width="700" height="372" loading="lazy" role="presentation"/></picture></div></div><figcaption class="pv fg pw pm pn px py bf b bg z dv">APIs showing stage3 trying to connect to external sources</figcaption></figure><p id="7d7d" class="pw-post-body-paragraph mn mo gw mp b mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk gp bk">After we had a quick look at stage three’s strings through PEstudio, we hopped back over to ol’ reliable dnSpy. Trawling through stage three, we identified that AES encryption was used to encode the port and IP/domain that made up the adversary’s command-and-control (C2). We were for sure dealing with a RAT, and we wanted to gather the IoCs associated with this encryption.</p><figure class="nm nn no np nq pp pm pn paragraph-image"><div role="button" tabindex="0" class="pq pr fl ps bh pt"><div class="pm pn qj"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/0*bwX2fLXRA7Irk_Cf 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*bwX2fLXRA7Irk_Cf 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*bwX2fLXRA7Irk_Cf 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*bwX2fLXRA7Irk_Cf 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*bwX2fLXRA7Irk_Cf 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*bwX2fLXRA7Irk_Cf 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/0*bwX2fLXRA7Irk_Cf 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/0*bwX2fLXRA7Irk_Cf 640w, https://miro.medium.com/v2/resize:fit:720/0*bwX2fLXRA7Irk_Cf 720w, https://miro.medium.com/v2/resize:fit:750/0*bwX2fLXRA7Irk_Cf 750w, https://miro.medium.com/v2/resize:fit:786/0*bwX2fLXRA7Irk_Cf 786w, https://miro.medium.com/v2/resize:fit:828/0*bwX2fLXRA7Irk_Cf 828w, https://miro.medium.com/v2/resize:fit:1100/0*bwX2fLXRA7Irk_Cf 1100w, https://miro.medium.com/v2/resize:fit:1400/0*bwX2fLXRA7Irk_Cf 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh lu pu c" width="700" height="391" loading="lazy" role="presentation"/></picture></div></div><figcaption class="pv fg pw pm pn px py bf b bg z dv">AES encryption</figcaption></figure><p id="a3fb" class="pw-post-body-paragraph mn mo gw mp b mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk gp bk">We set a breakpoint in dnSpy where the AES decryption was performed, and then run the debugger for this to find the decrypted string. Using a ‘stop-start’ technique with breakpoints in a debugger allows a malware analyst to halt the malware at opportune moments as it decodes or decrypts itself. This allows us to understand what the malware is doing as it is doing it.</p><figure class="nm nn no np nq pp pm pn paragraph-image"><div role="button" tabindex="0" class="pq pr fl ps bh pt"><div class="pm pn qj"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/0*k8-6RpxNSO-ke30_ 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*k8-6RpxNSO-ke30_ 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*k8-6RpxNSO-ke30_ 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*k8-6RpxNSO-ke30_ 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*k8-6RpxNSO-ke30_ 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*k8-6RpxNSO-ke30_ 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/0*k8-6RpxNSO-ke30_ 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/0*k8-6RpxNSO-ke30_ 640w, https://miro.medium.com/v2/resize:fit:720/0*k8-6RpxNSO-ke30_ 720w, https://miro.medium.com/v2/resize:fit:750/0*k8-6RpxNSO-ke30_ 750w, https://miro.medium.com/v2/resize:fit:786/0*k8-6RpxNSO-ke30_ 786w, https://miro.medium.com/v2/resize:fit:828/0*k8-6RpxNSO-ke30_ 828w, https://miro.medium.com/v2/resize:fit:1100/0*k8-6RpxNSO-ke30_ 1100w, https://miro.medium.com/v2/resize:fit:1400/0*k8-6RpxNSO-ke30_ 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh lu pu c" width="700" height="311" loading="lazy" role="presentation"/></picture></div></div><figcaption class="pv fg pw pm pn px py bf b bg z dv">dnSpy breakpoint</figcaption></figure><p id="3cf0" class="pw-post-body-paragraph mn mo gw mp b mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk gp bk">When we got to our breakpoint it paused the malware’s execution. Now, we gingerly allowed the malware to progress one step at a time by using the step over button. We did this until eventually the malware began its decryption phase, and we were first gifted the ports used by this RAT.</p><figure class="nm nn no np nq pp pm pn paragraph-image"><div role="button" tabindex="0" class="pq pr fl ps bh pt"><div class="pm pn qk"><picture><source srcSet="https://miro.medium.com/v2/resize:fit:640/format:webp/0*WfKkOyDXXc_zpg1A 640w, https://miro.medium.com/v2/resize:fit:720/format:webp/0*WfKkOyDXXc_zpg1A 720w, https://miro.medium.com/v2/resize:fit:750/format:webp/0*WfKkOyDXXc_zpg1A 750w, https://miro.medium.com/v2/resize:fit:786/format:webp/0*WfKkOyDXXc_zpg1A 786w, https://miro.medium.com/v2/resize:fit:828/format:webp/0*WfKkOyDXXc_zpg1A 828w, https://miro.medium.com/v2/resize:fit:1100/format:webp/0*WfKkOyDXXc_zpg1A 1100w, https://miro.medium.com/v2/resize:fit:1400/format:webp/0*WfKkOyDXXc_zpg1A 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px" type="image/webp"/><source data-testid="og" srcSet="https://miro.medium.com/v2/resize:fit:640/0*WfKkOyDXXc_zpg1A 640w, https://miro.medium.com/v2/resize:fit:720/0*WfKkOyDXXc_zpg1A 720w, https://miro.medium.com/v2/resize:fit:750/0*WfKkOyDXXc_zpg1A 750w, https://miro.medium.com/v2/resize:fit:786/0*WfKkOyDXXc_zpg1A 786w, https://miro.medium.com/v2/resize:fit:828/0*WfKkOyDXXc_zpg1A 828w, https://miro.medium.com/v2/resize:fit:1100/0*WfKkOyDXXc_zpg1A 1100w, https://miro.medium.com/v2/resize:fit:1400/0*WfKkOyDXXc_zpg1A 1400w" sizes="(min-resolution: 4dppx) and (max-width: 700px) 50vw, (-webkit-min-device-pixel-ratio: 4) and (max-width: 700px) 50vw, (min-resolution: 3dppx) and (max-width: 700px) 67vw, (-webkit-min-device-pixel-ratio: 3) and (max-width: 700px) 65vw, (min-resolution: 2.5dppx) and (max-width: 700px) 80vw, (-webkit-min-device-pixel-ratio: 2.5) and (max-width: 700px) 80vw, (min-resolution: 2dppx) and (max-width: 700px) 100vw, (-webkit-min-device-pixel-ratio: 2) and (max-width: 700px) 100vw, 700px"/><img alt="" class="bh lu pu c" width="700" height="385" loading="lazy" role="presentation"/></picture></div></div><figcaption class="pv fg pw pm pn px py bf b bg z dv">Ports decrypted in dnSpy</figcaption></figure><p id="1603" class="pw-post-body-paragraph mn mo gw mp b mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk gp bk">When we stepped over the different sections we were able to see that for this RAT it was using ports “6606, 7707, 8808” and, eventually we unraveled the RAT until it delivered us the adversarial server it reported back to: “109.206.241[.]84”.</p><h1 id="f77d" class="oc nw gw bf od oe of og oh oi oj ok ol om on oo op oq or os ot ou ov ow ox oy bk">Defending against RATs</h1><p id="5261" class="pw-post-body-paragraph mn mo gw mp b mq oz ms mt mu pa mw mx my pb na nb nc pc ne nf ng pd ni nj nk gp bk">Our remediations will vary, but the first step is to recommend blocking this public IPv4 at the organisation firewall level so the RAT can no longer beacon out.</p><p id="ffe7" class="pw-post-body-paragraph mn mo gw mp b mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk gp bk">The advice for defending against RATs is really advice for malware overall:</p><ul class=""><li id="952a" class="mn mo gw mp b mq mr ms mt mu mv mw mx my mz na nb nc nd ne nf ng nh ni nj nk pe pf pg bk">Chief advice is to train staff to check what they are downloading. Whether it’s from an email attachment, or a site that promises to make their computer run faster if they run something, <a class="ag nl" href="https://www.huntress.com/platform/security-awareness-training" rel="noopener ugc nofollow" target="_blank">security awareness training</a> is the best and first layer of defense we’d advise you prioritise.</li><li id="ca4e" class="mn mo gw mp b mq ph ms mt mu pi mw mx my pj na nb nc pk ne nf ng pl ni nj nk pe pf pg bk">Leverage network telemetry to try and monitor for unexpected activity. Whether this is VPN, firewall, or more security-focused netflow, keeping an eye on in- and outbound traffic will help spot anomalous behaviour. Moreover, cultivating a well-maintained deny-list for <a class="ag nl" href="https://twitter.com/cobaltstrikebot?ref_src=twsrc%5Egoogle%7Ctwcamp%5Eserp%7Ctwgr%5Eauthor" rel="noopener ugc nofollow" target="_blank">new and emerging malicious addresses</a> can only be a good thing.</li><li id="c85f" class="mn mo gw mp b mq ph ms mt mu pi mw mx my pj na nb nc pk ne nf ng pl ni nj nk pe pf pg bk">Good security tools are the perfect enemy of our adversaries. Deploy what works for your organisation, just please deploy <em class="ob">something</em>. A machine without any security solutions is a machine that presents an unmanageable, unacceptable risk to your business.</li></ul><pre class="nm nn no np nq nr ns nt bp nu bb bk"><span id="c68e" class="nv nw gw ns b bg nx ny l nz oa">Big thanks to <a class="ag nl" href="https://www.linkedin.com/in/matthew-69b96bb9/" rel="noopener ugc nofollow" target="_blank">Matthew Brennan</a> and <a class="ag nl" href="https://www.linkedin.com/in/chadhudsoncybersec/" rel="noopener ugc nofollow" target="_blank">Chad Hudson</a> for help and guidance. <br/>Hopefully this writeup has helped show examples of some good tools and <br/>techniques that can be used to help decrypt and understand what is going on <br/>with other .NET executables in the future.</span></pre></div></div></div></div></section></div></div></article></div><div class="ab cc"><div class="cj bh gb gc gd ge"><div class="ql qm ab jb"><div class="qn ab"><a class="qo ay an ap" href="https://medium.com/tag/hcksyd?source=post_page-----378b343216bf---------------------------------------" rel="noopener follow"><div class="qp fl cy qq gg qr qs bf b bg z bk qt">Hcksyd</div></a></div><div class="qn ab"><a class="qo ay an ap" href="https://medium.com/tag/malware-analysis?source=post_page-----378b343216bf---------------------------------------" rel="noopener follow"><div class="qp fl cy qq gg qr qs bf b bg z bk qt">Malware Analysis</div></a></div><div class="qn ab"><a class="qo ay an ap" href="https://medium.com/tag/reverse-engineering?source=post_page-----378b343216bf---------------------------------------" rel="noopener follow"><div class="qp fl cy qq gg qr qs bf b bg z bk qt">Reverse Engineering</div></a></div><div class="qn ab"><a class="qo ay an ap" href="https://medium.com/tag/malware?source=post_page-----378b343216bf---------------------------------------" rel="noopener follow"><div class="qp fl cy qq gg qr qs bf b bg z bk qt">Malware</div></a></div><div class="qn ab"><a class="qo ay an ap" href="https://medium.com/tag/cybersecurity?source=post_page-----378b343216bf---------------------------------------" rel="noopener follow"><div class="qp fl cy qq gg qr qs bf b bg z bk qt">Cybersecurity</div></a></div></div></div></div><div class="l"></div><footer class="qu qv qw qx qy ab q qz ra c"><div class="l ae"><div class="ab cc"><div class="cj bh gb gc gd ge"><div class="ab cq rb"><div class="ab q kk"><div class="rc l"><span class="l rd re rf e d"><div class="ab q kk kl"><div class="pw-multi-vote-icon fl km kn ko kp"><span><a class="ag ah ai aj ak al am an ao ap aq ar as at au" data-testid="footerClapButton" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fp%2F378b343216bf&amp;operation=register&amp;redirect=https%3A%2F%2Fhcksyd.medium.com%2Fasyncrat-analysing-the-three-stages-of-execution-378b343216bf&amp;user=Hack+Sydney&amp;userId=bca54845b6&amp;source=---footer_actions--378b343216bf---------------------clap_footer------------------" rel="noopener follow"><div><div class="bm" aria-hidden="false"><div class="kq ap kr ks kt ku an kv kw kx kp"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM13.916 3.953l1.523-2.112-1.184-.39zM8.589 1.84l1.522 2.112-.337-2.501zM18.523 18.92c-.86.86-1.75 1.246-2.62 1.33a6 6 0 0 0 .407-.372c2.388-2.389 2.86-4.951 1.399-7.623l-.912-1.603-.79-1.672c-.26-.56-.194-.98.203-1.288a.7.7 0 0 1 .546-.132c.283.046.546.231.728.5l2.363 4.157c.976 1.624 1.141 4.237-1.324 6.702m-10.999-.438L3.37 14.328a.828.828 0 0 1 .585-1.408.83.83 0 0 1 .585.242l2.158 2.157a.365.365 0 0 0 .516-.516l-2.157-2.158-1.449-1.449a.826.826 0 0 1 1.167-1.17l3.438 3.44a.363.363 0 0 0 .516 0 .364.364 0 0 0 0-.516L5.293 9.513l-.97-.97a.826.826 0 0 1 0-1.166.84.84 0 0 1 1.167 0l.97.968 3.437 3.436a.36.36 0 0 0 .517 0 .366.366 0 0 0 0-.516L6.977 7.83a.82.82 0 0 1-.241-.584.82.82 0 0 1 .824-.826c.219 0 .43.087.584.242l5.787 5.787a.366.366 0 0 0 .587-.415l-1.117-2.363c-.26-.56-.194-.98.204-1.289a.7.7 0 0 1 .546-.132c.283.046.545.232.727.501l2.193 3.86c1.302 2.38.883 4.59-1.277 6.75-1.156 1.156-2.602 1.627-4.19 1.367-1.418-.236-2.866-1.033-4.079-2.246M10.75 5.971l2.12 2.12c-.41.502-.465 1.17-.128 1.89l.22.465-3.523-3.523a.8.8 0 0 1-.097-.368c0-.22.086-.428.241-.584a.847.847 0 0 1 1.167 0m7.355 1.705c-.31-.461-.746-.758-1.23-.837a1.44 1.44 0 0 0-1.11.275c-.312.24-.505.543-.59.881a1.74 1.74 0 0 0-.906-.465 1.47 1.47 0 0 0-.82.106l-2.182-2.182a1.56 1.56 0 0 0-2.2 0 1.54 1.54 0 0 0-.396.701 1.56 1.56 0 0 0-2.21-.01 1.55 1.55 0 0 0-.416.753c-.624-.624-1.649-.624-2.237-.037a1.557 1.557 0 0 0 0 2.2c-.239.1-.501.238-.715.453a1.56 1.56 0 0 0 0 2.2l.516.515a1.556 1.556 0 0 0-.753 2.615L7.01 19c1.32 1.319 2.909 2.189 4.475 2.449q.482.08.971.08c.85 0 1.653-.198 2.393-.579.231.033.46.054.686.054 1.266 0 2.457-.52 3.505-1.567 2.763-2.763 2.552-5.734 1.439-7.586z" clip-rule="evenodd"></path></svg></div></div></div></a></span></div><div class="pw-multi-vote-count l ky kz la lb lc ld le"><p class="bf b dw z dv"><span class="lf">--</span></p></div></div></span><span class="l h g f rg rh"><div class="ab q kk kl"><div class="pw-multi-vote-icon fl km kn ko kp"><span><a class="ag ah ai aj ak al am an ao ap aq ar as at au" data-testid="footerClapButton" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fvote%2Fp%2F378b343216bf&amp;operation=register&amp;redirect=https%3A%2F%2Fhcksyd.medium.com%2Fasyncrat-analysing-the-three-stages-of-execution-378b343216bf&amp;user=Hack+Sydney&amp;userId=bca54845b6&amp;source=---footer_actions--378b343216bf---------------------clap_footer------------------" rel="noopener follow"><div><div class="bm" aria-hidden="false"><div class="kq ap kr ks kt ku an kv kw kx kp"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" aria-label="clap"><path fill-rule="evenodd" d="M11.37.828 12 3.282l.63-2.454zM13.916 3.953l1.523-2.112-1.184-.39zM8.589 1.84l1.522 2.112-.337-2.501zM18.523 18.92c-.86.86-1.75 1.246-2.62 1.33a6 6 0 0 0 .407-.372c2.388-2.389 2.86-4.951 1.399-7.623l-.912-1.603-.79-1.672c-.26-.56-.194-.98.203-1.288a.7.7 0 0 1 .546-.132c.283.046.546.231.728.5l2.363 4.157c.976 1.624 1.141 4.237-1.324 6.702m-10.999-.438L3.37 14.328a.828.828 0 0 1 .585-1.408.83.83 0 0 1 .585.242l2.158 2.157a.365.365 0 0 0 .516-.516l-2.157-2.158-1.449-1.449a.826.826 0 0 1 1.167-1.17l3.438 3.44a.363.363 0 0 0 .516 0 .364.364 0 0 0 0-.516L5.293 9.513l-.97-.97a.826.826 0 0 1 0-1.166.84.84 0 0 1 1.167 0l.97.968 3.437 3.436a.36.36 0 0 0 .517 0 .366.366 0 0 0 0-.516L6.977 7.83a.82.82 0 0 1-.241-.584.82.82 0 0 1 .824-.826c.219 0 .43.087.584.242l5.787 5.787a.366.366 0 0 0 .587-.415l-1.117-2.363c-.26-.56-.194-.98.204-1.289a.7.7 0 0 1 .546-.132c.283.046.545.232.727.501l2.193 3.86c1.302 2.38.883 4.59-1.277 6.75-1.156 1.156-2.602 1.627-4.19 1.367-1.418-.236-2.866-1.033-4.079-2.246M10.75 5.971l2.12 2.12c-.41.502-.465 1.17-.128 1.89l.22.465-3.523-3.523a.8.8 0 0 1-.097-.368c0-.22.086-.428.241-.584a.847.847 0 0 1 1.167 0m7.355 1.705c-.31-.461-.746-.758-1.23-.837a1.44 1.44 0 0 0-1.11.275c-.312.24-.505.543-.59.881a1.74 1.74 0 0 0-.906-.465 1.47 1.47 0 0 0-.82.106l-2.182-2.182a1.56 1.56 0 0 0-2.2 0 1.54 1.54 0 0 0-.396.701 1.56 1.56 0 0 0-2.21-.01 1.55 1.55 0 0 0-.416.753c-.624-.624-1.649-.624-2.237-.037a1.557 1.557 0 0 0 0 2.2c-.239.1-.501.238-.715.453a1.56 1.56 0 0 0 0 2.2l.516.515a1.556 1.556 0 0 0-.753 2.615L7.01 19c1.32 1.319 2.909 2.189 4.475 2.449q.482.08.971.08c.85 0 1.653-.198 2.393-.579.231.033.46.054.686.054 1.266 0 2.457-.52 3.505-1.567 2.763-2.763 2.552-5.734 1.439-7.586z" clip-rule="evenodd"></path></svg></div></div></div></a></span></div><div class="pw-multi-vote-count l ky kz la lb lc ld le"><p class="bf b dw z dv"><span class="lf">--</span></p></div></div></span></div><div class="bq ab"><div><div class="bm" aria-hidden="false"><button class="ap kq li lj ab q fm lk ll" aria-label="responses"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" class="lh"><path d="M18.006 16.803c1.533-1.456 2.234-3.325 2.234-5.321C20.24 7.357 16.709 4 12.191 4S4 7.357 4 11.482c0 4.126 3.674 7.482 8.191 7.482.817 0 1.622-.111 2.393-.327.231.2.48.391.744.559 1.06.693 2.203 1.044 3.399 1.044.224-.008.4-.112.486-.287a.49.49 0 0 0-.042-.518c-.495-.67-.845-1.364-1.04-2.057a4 4 0 0 1-.125-.598zm-3.122 1.055-.067-.223-.315.096a8 8 0 0 1-2.311.338c-4.023 0-7.292-2.955-7.292-6.587 0-3.633 3.269-6.588 7.292-6.588 4.014 0 7.112 2.958 7.112 6.593 0 1.794-.608 3.469-2.027 4.72l-.195.168v.255c0 .056 0 .151.016.295.025.231.081.478.154.733.154.558.398 1.117.722 1.659a5.3 5.3 0 0 1-2.165-.845c-.276-.176-.714-.383-.941-.59z"></path></svg><p class="bf b bg z dv"><span class="pw-responses-count lg lh">1</span></p></button></div></div></div></div><div class="ab q"><div class="ri l rj"><div><div class="bm" aria-hidden="false"><span><a class="ag ah ai aj ak al am an ao ap aq ar as at au" data-testid="footerBookmarkButton" href="https://medium.com/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fbookmark%2Fp%2F378b343216bf&amp;operation=register&amp;redirect=https%3A%2F%2Fhcksyd.medium.com%2Fasyncrat-analysing-the-three-stages-of-execution-378b343216bf&amp;source=---footer_actions--378b343216bf---------------------bookmark_footer------------------" rel="noopener follow"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" fill="none" viewBox="0 0 25 25" class="dv ln" aria-label="Add to list bookmark button"><path fill="currentColor" d="M18 2.5a.5.5 0 0 1 1 0V5h2.5a.5.5 0 0 1 0 1H19v2.5a.5.5 0 1 1-1 0V6h-2.5a.5.5 0 0 1 0-1H18zM7 7a1 1 0 0 1 1-1h3.5a.5.5 0 0 0 0-1H8a2 2 0 0 0-2 2v14a.5.5 0 0 0 .805.396L12.5 17l5.695 4.396A.5.5 0 0 0 19 21v-8.5a.5.5 0 0 0-1 0v7.485l-5.195-4.012a.5.5 0 0 0-.61 0L7 19.985z"></path></svg></a></span></div></div></div><div class="ri l rj"><div class="bm" aria-hidden="false" aria-describedby="postFooterSocialMenu" aria-labelledby="postFooterSocialMenu"><div><div class="bm" aria-hidden="false"><button aria-controls="postFooterSocialMenu" aria-expanded="false" aria-label="Share Post" data-testid="footerSocialShareButton" class="ag fm ai aj ak al am lv ao ap aq ey lw lx ll ly"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="none" viewBox="0 0 24 24"><path fill="currentColor" fill-rule="evenodd" d="M15.218 4.931a.4.4 0 0 1-.118.132l.012.006a.45.45 0 0 1-.292.074.5.5 0 0 1-.3-.13l-2.02-2.02v7.07c0 .28-.23.5-.5.5s-.5-.22-.5-.5v-7.04l-2 2a.45.45 0 0 1-.57.04h-.02a.4.4 0 0 1-.16-.3.4.4 0 0 1 .1-.32l2.8-2.8a.5.5 0 0 1 .7 0l2.8 2.79a.42.42 0 0 1 .068.498m-.106.138.008.004v-.01zM16 7.063h1.5a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2h-11c-1.1 0-2-.9-2-2v-10a2 2 0 0 1 2-2H8a.5.5 0 0 1 .35.15.5.5 0 0 1 .15.35.5.5 0 0 1-.15.35.5.5 0 0 1-.35.15H6.4c-.5 0-.9.4-.9.9v10.2a.9.9 0 0 0 .9.9h11.2c.5 0 .9-.4.9-.9v-10.2c0-.5-.4-.9-.9-.9H16a.5.5 0 0 1 0-1" clip-rule="evenodd"></path></svg></button></div></div></div></div></div></div></div></div></div></footer><div class="rk l"><div class="ab cc"><div class="cj bh gb gc gd ge"><div class="ab ig ie ic rl rm"><div class="rn ro rp rq rr rs rt ru rv rw ab cq"><div class="h k"><a tabindex="0" rel="noopener follow" href="/?source=post_page---post_author_info--378b343216bf---------------------------------------"><div class="l fl"><img alt="Hack Sydney" class="l fe by rx ry cy" src="https://miro.medium.com/v2/resize:fill:96:96/1*0al7KlH0A2FW1DLbW7xyqw.png" width="48" height="48" loading="lazy"/><div class="ft by l rx ry fu n ay rz"></div></div></a></div><div class="j i d"><a tabindex="0" rel="noopener follow" href="/?source=post_page---post_author_info--378b343216bf---------------------------------------"><div class="l fl"><img alt="Hack Sydney" class="l fe by sa sb cy" src="https://miro.medium.com/v2/resize:fill:128:128/1*0al7KlH0A2FW1DLbW7xyqw.png" width="64" height="64" loading="lazy"/><div class="ft by l sa sb fu n ay rz"></div></div></a></div><div class="j i d sc rj"><div class="ab"><div class="bm" aria-hidden="false"><div class="bm"><button class="it iu iv ap ab cc q aq ey sd kj se iz"><span class="bf b bg z bk"><span class="l ja">Follow</span></span></button></div></div></div></div></div><div class="ab cp cb"><div class="sf sg sh si sj l"><a class="ag ah ai ak al am an ao ap aq ar as at au ab q" rel="noopener follow" href="/?source=post_page---post_author_info--378b343216bf---------------------------------------"><h2 class="pw-author-name bf sl sm sn so sp sq sr my ss st nc su sv ng sw sx bk"><span class="gp sk">Written by <!-- -->Hack Sydney</span></h2></a><div class="qn ab ii"><div class="l rj"><span class="pw-follower-count bf b bg z dv"><a class="ag ah ai aj ak al am an ao ap aq ar as ir" rel="noopener follow" href="/followers?source=post_page---post_author_info--378b343216bf---------------------------------------">11 Followers</a></span></div><div class="bf b bg z dv ab sy"><span class="sz l" aria-hidden="true"><span class="bf b bg z dv">·</span></span><a class="ag ah ai aj ak al am an ao ap aq ar as ir" rel="noopener follow" href="/following?source=post_page---post_author_info--378b343216bf---------------------------------------">1 Following</a></div></div><div class="ta l"><p class="bf b bg z bk"><span class="gp">HackSydney is an inclusive, diverse and educational InfoSec Conferences in the APAC region.</span></p></div></div></div><div class="h k"><div class="ab"><div class="bm" aria-hidden="false"><div class="bm"><button class="it iu iv ap ab cc q aq ey sd kj se iz"><span class="bf b bg z bk"><span class="l ja">Follow</span></span></button></div></div></div></div></div></div></div></div><div class="tb tc td te tf l"><div class="tg bh r rk"></div><div class="ab cc"><div class="cj bh gb gc gd ge"><div class="ab q cq"><h2 class="bf sl oe og oh oi ok ol om oo op oq os ot ou ow ox bk">Responses (<!-- -->1<!-- -->)</h2><div class="ab th"><div><div class="bm" aria-hidden="false"><a class="ti tj" href="https://policy.medium.com/medium-rules-30e5502c4eb4?source=post_page---post_responses--378b343216bf---------------------------------------" rel="noopener follow" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" width="25" height="25" viewBox="0 0 25 25"><path fill-rule="evenodd" d="M11.987 5.036a.754.754 0 0 1 .914-.01c.972.721 1.767 1.218 2.6 1.543.828.322 1.719.485 2.887.505a.755.755 0 0 1 .741.757c-.018 3.623-.43 6.256-1.449 8.21-1.034 1.984-2.662 3.209-4.966 4.083a.75.75 0 0 1-.537-.003c-2.243-.874-3.858-2.095-4.897-4.074-1.024-1.951-1.457-4.583-1.476-8.216a.755.755 0 0 1 .741-.757c1.195-.02 2.1-.182 2.923-.503.827-.322 1.6-.815 2.519-1.535m.468.903c-.897.69-1.717 1.21-2.623 1.564-.898.35-1.856.527-3.026.565.037 3.45.469 5.817 1.36 7.515.884 1.684 2.25 2.762 4.284 3.571 2.092-.81 3.465-1.89 4.344-3.575.886-1.698 1.299-4.065 1.334-7.512-1.149-.039-2.091-.217-2.99-.567-.906-.353-1.745-.873-2.683-1.561m-.009 9.155a2.672 2.672 0 1 0 0-5.344 2.672 2.672 0 0 0 0 5.344m0 1a3.672 3.672 0 1 0 0-7.344 3.672 3.672 0 0 0 0 7.344m-1.813-3.777.525-.526.916.917 1.623-1.625.526.526-2.149 2.152z" clip-rule="evenodd"></path></svg></a></div></div></div></div><div class="tk tl tm tn to tp tq l"></div><div class="tr l"><button class="bf b bg z bk qp ts iu tt ln lk tu ew ex ey tv tw tx fb ty tz ua ub uc fc fd fe bm ff fg">See all responses</button></div></div></div></div><div class="ud ue uf ug uh l bx"><div class="h k j"><div class="tg bh ui uj"></div><div class="ab cc"><div class="cj bh gb gc gd ge"><div class="uk ab kk jb"><div class="ul um l"><a class="ag ah ai aj ak al am an ao ap aq ar as at au" href="https://help.medium.com/hc/en-us?source=post_page-----378b343216bf---------------------------------------" rel="noopener follow"><p class="bf b dw z dv">Help</p></a></div><div class="ul um l"><a class="ag ah ai aj ak al am an ao ap aq ar as at au" href="https://medium.statuspage.io/?source=post_page-----378b343216bf---------------------------------------" rel="noopener follow"><p class="bf b dw z dv">Status</p></a></div><div class="ul um l"><a class="ag ah ai aj ak al am an ao ap aq ar as at au" href="https://medium.com/about?autoplay=1&amp;source=post_page-----378b343216bf---------------------------------------" rel="noopener follow"><p class="bf b dw z dv">About</p></a></div><div class="ul um l"><a class="ag ah ai aj ak al am an ao ap aq ar as at au" href="https://medium.com/jobs-at-medium/work-at-medium-959d1a85284e?source=post_page-----378b343216bf---------------------------------------" rel="noopener follow"><p class="bf b dw z dv">Careers</p></a></div><div class="ul um l"><a class="ag ah ai aj ak al am an ao ap aq ar as at au" href="mailto:pressinquiries@medium.com" rel="noopener follow"><p class="bf b dw z dv">Press</p></a></div><div class="ul um l"><a class="ag ah ai aj ak al am an ao ap aq ar as at au" href="https://blog.medium.com/?source=post_page-----378b343216bf---------------------------------------" rel="noopener follow"><p class="bf b dw z dv">Blog</p></a></div><div class="ul um l"><a class="ag ah ai aj ak al am an ao ap aq ar as at au" href="https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----378b343216bf---------------------------------------" rel="noopener follow"><p class="bf b dw z dv">Privacy</p></a></div><div class="ul um l"><a class="ag ah ai aj ak al am an ao ap aq ar as at au" href="https://policy.medium.com/medium-rules-30e5502c4eb4?source=post_page-----378b343216bf---------------------------------------" rel="noopener follow"><p class="bf b dw z dv">Rules</p></a></div><div class="ul um l"><a class="ag ah ai aj ak al am an ao ap aq ar as at au" href="https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----378b343216bf---------------------------------------" rel="noopener follow"><p class="bf b dw z dv">Terms</p></a></div><div class="ul l"><a class="ag ah ai aj ak al am an ao ap aq ar as at au" href="https://speechify.com/medium?source=post_page-----378b343216bf---------------------------------------" rel="noopener follow"><p class="bf b dw z dv">Text to speech</p></a></div></div></div></div></div></div></div></div></div></div></div></div><script>window.__BUILD_ID__="main-20250425-233158-99ae385342"</script><script>window.__GRAPHQL_URI__ = "https://hcksyd.medium.com/_/graphql"</script><script>window.__PRELOADED_STATE__ = {"algolia":{"queries":{}},"cache":{"experimentGroupSet":true,"reason":"","group":"enabled","tags":["group-edgeCachePosts","post-378b343216bf","user-bca54845b6","group-followSubscribeButtonEnabled"],"serverVariantState":"44136fa355b3678a1146ad16f7e8649e94fb4fc21fe77e8310c060f61caaff8a","middlewareEnabled":true,"cacheStatus":"DYNAMIC","shouldUseCache":true,"vary":[],"pubFeaturingPostPageLabelEnabled":false,"shouldFollowPostQueryEnabled":false,"followSubscribeButtonEnabled":true},"client":{"hydrated":false,"isUs":false,"isNativeMedium":false,"isSafariMobile":false,"isSafari":false,"isFirefox":false,"routingEntity":{"type":"USER","id":"bca54845b6","explicit":true},"viewerIsBot":false},"debug":{"requestId":"7a077023-503a-41b6-9f7c-d0f876eb7efc","requestTag":"","hybridDevServices":[],"originalSpanCarrier":{"traceparent":"00-d55279a365f41021afc11a2a0e11da42-39a75c23bf6f7744-01"}},"multiVote":{"clapsPerPost":{}},"navigation":{"branch":{"show":null,"hasRendered":null,"blockedByCTA":false},"hideGoogleOneTap":false,"hasRenderedAlternateUserBanner":null,"currentLocation":"https:\u002F\u002Fhcksyd.medium.com\u002Fasyncrat-analysing-the-three-stages-of-execution-378b343216bf","host":"hcksyd.medium.com","hostname":"hcksyd.medium.com","referrer":"","hasSetReferrer":false,"susiModal":{"step":null,"operation":"register"},"postRead":false,"partnerProgram":{"selectedCountryCode":null},"queryString":"","currentHash":""},"config":{"nodeEnv":"production","version":"main-20250425-233158-99ae385342","target":"production","productName":"Medium","publicUrl":"https:\u002F\u002Fcdn-client.medium.com\u002Flite","authDomain":"medium.com","authGoogleClientId":"216296035834-k1k6qe060s2tp2a2jam4ljdcms00sttg.apps.googleusercontent.com","favicon":"production","glyphUrl":"https:\u002F\u002Fglyph.medium.com","branchKey":"key_live_ofxXr2qTrrU9NqURK8ZwEhknBxiI6KBm","algolia":{"appId":"MQ57UUUQZ2","apiKeySearch":"394474ced050e3911ae2249ecc774921","indexPrefix":"medium_","host":"-dsn.algolia.net"},"recaptchaKey":"6Lfc37IUAAAAAKGGtC6rLS13R1Hrw_BqADfS1LRk","recaptcha3Key":"6Lf8R9wUAAAAABMI_85Wb8melS7Zj6ziuf99Yot5","recaptchaEnterpriseKeyId":"6Le-uGgpAAAAAPprRaokM8AKthQ9KNGdoxaGUvVp","datadog":{"applicationId":"6702d87d-a7e0-42fe-bbcb-95b469547ea0","clientToken":"pub853ea8d17ad6821d9f8f11861d23dfed","rumToken":"pubf9cc52896502b9413b68ba36fc0c7162","context":{"deployment":{"target":"production","tag":"main-20250425-233158-99ae385342","commit":"99ae385342e0deafe9c6550d85d553134465909a"}},"datacenter":"us"},"googleAnalyticsCode":"G-7JY7T788PK","googlePay":{"apiVersion":"2","apiVersionMinor":"0","merchantId":"BCR2DN6TV7EMTGBM","merchantName":"Medium","instanceMerchantId":"13685562959212738550"},"applePay":{"version":3},"signInWallCustomDomainCollectionIds":["3a8144eabfe3","336d898217ee","61061eb0c96b","138adf9c44c","819cc2aaeee0"],"mediumMastodonDomainName":"me.dm","mediumOwnedAndOperatedCollectionIds":["8a9336e5bb4","b7e45b22fec3","193b68bd4fba","8d6b8a439e32","54c98c43354d","3f6ecf56618","d944778ce714","92d2092dc598","ae2a65f35510","1285ba81cada","544c7006046e","fc8964313712","40187e704f1c","88d9857e584e","7b6769f2748b","bcc38c8f6edf","cef6983b292","cb8577c9149e","444d13b52878","713d7dbc99b0","ef8e90590e66","191186aaafa0","55760f21cdc5","9dc80918cc93","bdc4052bbdba","8ccfed20cbb2"],"tierOneDomains":["medium.com","thebolditalic.com","arcdigital.media","towardsdatascience.com","uxdesign.cc","codeburst.io","psiloveyou.xyz","writingcooperative.com","entrepreneurshandbook.co","prototypr.io","betterhumans.coach.me","theascent.pub"],"topicsToFollow":["d61cf867d93f","8a146bc21b28","1eca0103fff3","4d562ee63426","aef1078a3ef5","e15e46793f8d","6158eb913466","55f1c20aba7a","3d18b94f6858","4861fee224fd","63c6f1f93ee","1d98b3a9a871","decb52b64abf","ae5d4995e225","830cded25262"],"topicToTagMappings":{"accessibility":"accessibility","addiction":"addiction","android-development":"android-development","art":"art","artificial-intelligence":"artificial-intelligence","astrology":"astrology","basic-income":"basic-income","beauty":"beauty","biotech":"biotech","blockchain":"blockchain","books":"books","business":"business","cannabis":"cannabis","cities":"cities","climate-change":"climate-change","comics":"comics","coronavirus":"coronavirus","creativity":"creativity","cryptocurrency":"cryptocurrency","culture":"culture","cybersecurity":"cybersecurity","data-science":"data-science","design":"design","digital-life":"digital-life","disability":"disability","economy":"economy","education":"education","equality":"equality","family":"family","feminism":"feminism","fiction":"fiction","film":"film","fitness":"fitness","food":"food","freelancing":"freelancing","future":"future","gadgets":"gadgets","gaming":"gaming","gun-control":"gun-control","health":"health","history":"history","humor":"humor","immigration":"immigration","ios-development":"ios-development","javascript":"javascript","justice":"justice","language":"language","leadership":"leadership","lgbtqia":"lgbtqia","lifestyle":"lifestyle","machine-learning":"machine-learning","makers":"makers","marketing":"marketing","math":"math","media":"media","mental-health":"mental-health","mindfulness":"mindfulness","money":"money","music":"music","neuroscience":"neuroscience","nonfiction":"nonfiction","outdoors":"outdoors","parenting":"parenting","pets":"pets","philosophy":"philosophy","photography":"photography","podcasts":"podcast","poetry":"poetry","politics":"politics","privacy":"privacy","product-management":"product-management","productivity":"productivity","programming":"programming","psychedelics":"psychedelics","psychology":"psychology","race":"race","relationships":"relationships","religion":"religion","remote-work":"remote-work","san-francisco":"san-francisco","science":"science","self":"self","self-driving-cars":"self-driving-cars","sexuality":"sexuality","social-media":"social-media","society":"society","software-engineering":"software-engineering","space":"space","spirituality":"spirituality","sports":"sports","startups":"startup","style":"style","technology":"technology","transportation":"transportation","travel":"travel","true-crime":"true-crime","tv":"tv","ux":"ux","venture-capital":"venture-capital","visual-design":"visual-design","work":"work","world":"world","writing":"writing"},"defaultImages":{"avatar":{"imageId":"1*dmbNkD5D-u45r44go_cf0g.png","height":150,"width":150},"orgLogo":{"imageId":"7*V1_7XP4snlmqrc_0Njontw.png","height":110,"width":500},"postLogo":{"imageId":"bd978bb536350a710e8efb012513429cabdc4c28700604261aeda246d0f980b7","height":810,"width":1440},"postPreviewImage":{"imageId":"1*hn4v1tCaJy7cWMyb0bpNpQ.png","height":386,"width":579}},"collectionStructuredData":{"8d6b8a439e32":{"name":"Elemental","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fcdn-images-1.medium.com\u002Fmax\u002F980\u002F1*9ygdqoKprhwuTVKUM0DLPA@2x.png","width":980,"height":159}}},"3f6ecf56618":{"name":"Forge","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fcdn-images-1.medium.com\u002Fmax\u002F596\u002F1*uULpIlImcO5TDuBZ6lm7Lg@2x.png","width":596,"height":183}}},"ae2a65f35510":{"name":"GEN","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F264\u002F1*RdVZMdvfV3YiZTw6mX7yWA.png","width":264,"height":140}}},"88d9857e584e":{"name":"LEVEL","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F540\u002F1*JqYMhNX6KNNb2UlqGqO2WQ.png","width":540,"height":108}}},"7b6769f2748b":{"name":"Marker","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fcdn-images-1.medium.com\u002Fmax\u002F383\u002F1*haCUs0wF6TgOOvfoY-jEoQ@2x.png","width":383,"height":92}}},"444d13b52878":{"name":"OneZero","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F540\u002F1*cw32fIqCbRWzwJaoQw6BUg.png","width":540,"height":123}}},"8ccfed20cbb2":{"name":"Zora","data":{"@type":"NewsMediaOrganization","ethicsPolicy":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Farticles\u002F360043290473","logo":{"@type":"ImageObject","url":"https:\u002F\u002Fmiro.medium.com\u002Fmax\u002F540\u002F1*tZUQqRcCCZDXjjiZ4bDvgQ.png","width":540,"height":106}}}},"embeddedPostIds":{"coronavirus":"cd3010f9d81f"},"sharedCdcMessaging":{"COVID_APPLICABLE_TAG_SLUGS":[],"COVID_APPLICABLE_TOPIC_NAMES":[],"COVID_APPLICABLE_TOPIC_NAMES_FOR_TOPIC_PAGE":[],"COVID_MESSAGES":{"tierA":{"text":"For more information on the novel coronavirus and Covid-19, visit cdc.gov.","markups":[{"start":66,"end":73,"href":"https:\u002F\u002Fwww.cdc.gov\u002Fcoronavirus\u002F2019-nCoV"}]},"tierB":{"text":"Anyone can publish on Medium per our Policies, but we don’t fact-check every story. For more info about the coronavirus, see cdc.gov.","markups":[{"start":37,"end":45,"href":"https:\u002F\u002Fhelp.medium.com\u002Fhc\u002Fen-us\u002Fcategories\u002F201931128-Policies-Safety"},{"start":125,"end":132,"href":"https:\u002F\u002Fwww.cdc.gov\u002Fcoronavirus\u002F2019-nCoV"}]},"paywall":{"text":"This article has been made free for everyone, thanks to Medium Members. For more information on the novel coronavirus and Covid-19, visit cdc.gov.","markups":[{"start":56,"end":70,"href":"https:\u002F\u002Fmedium.com\u002Fmembership"},{"start":138,"end":145,"href":"https:\u002F\u002Fwww.cdc.gov\u002Fcoronavirus\u002F2019-nCoV"}]},"unbound":{"text":"This article is free for everyone, thanks to Medium Members. For more information on the novel coronavirus and Covid-19, visit cdc.gov.","markups":[{"start":45,"end":59,"href":"https:\u002F\u002Fmedium.com\u002Fmembership"},{"start":127,"end":134,"href":"https:\u002F\u002Fwww.cdc.gov\u002Fcoronavirus\u002F2019-nCoV"}]}},"COVID_BANNER_POST_ID_OVERRIDE_WHITELIST":["3b31a67bff4a"]},"sharedVoteMessaging":{"TAGS":["politics","election-2020","government","us-politics","election","2020-presidential-race","trump","donald-trump","democrats","republicans","congress","republican-party","democratic-party","biden","joe-biden","maga"],"TOPICS":["politics","election"],"MESSAGE":{"text":"Find out more about the U.S. election results here.","markups":[{"start":46,"end":50,"href":"https:\u002F\u002Fcookpolitical.com\u002F2020-national-popular-vote-tracker"}]},"EXCLUDE_POSTS":["397ef29e3ca5"]},"embedPostRules":[],"recircOptions":{"v1":{"limit":3},"v2":{"limit":8}},"braintreeClientKey":"production_zjkj96jm_m56f8fqpf7ngnrd4","braintree":{"enabled":true,"merchantId":"m56f8fqpf7ngnrd4","merchantAccountId":{"usd":"AMediumCorporation_instant","eur":"amediumcorporation_EUR","cad":"amediumcorporation_CAD"},"publicKey":"ds2nn34bg2z7j5gd","braintreeEnvironment":"production","dashboardUrl":"https:\u002F\u002Fwww.braintreegateway.com\u002Fmerchants","gracePeriodDurationInDays":14,"mediumMembershipPlanId":{"monthly":"ce105f8c57a3","monthlyV2":"e8a5e126-792b-4ee6-8fba-d574c1b02fc5","monthlyWithTrial":"d5ee3dbe3db8","monthlyPremium":"fa741a9b47a2","yearly":"a40ad4a43185","yearlyV2":"3815d7d6-b8ca-4224-9b8c-182f9047866e","yearlyStaff":"d74fb811198a","yearlyWithTrial":"b3bc7350e5c7","yearlyPremium":"e21bd2c12166","monthlyOneYearFree":"e6c0637a-2bad-4171-ab4f-3c268633d83c","monthly25PercentOffFirstYear":"235ecc62-0cdb-49ae-9378-726cd21c504b","monthly20PercentOffFirstYear":"ba518864-9c13-4a99-91ca-411bf0cac756","monthly15PercentOffFirstYear":"594c029b-9f89-43d5-88f8-8173af4e070e","monthly10PercentOffFirstYear":"c6c7bc9a-40f2-4b51-8126-e28511d5bdb0","monthlyForStudents":"629ebe51-da7d-41fd-8293-34cd2f2030a8","yearlyOneYearFree":"78ba7be9-0d9f-4ece-aa3e-b54b826f2bf1","yearly25PercentOffFirstYear":"2dbb010d-bb8f-4eeb-ad5c-a08509f42d34","yearly20PercentOffFirstYear":"47565488-435b-47f8-bf93-40d5fbe0ebc8","yearly15PercentOffFirstYear":"8259809b-0881-47d9-acf7-6c001c7f720f","yearly10PercentOffFirstYear":"9dd694fb-96e1-472c-8d9e-3c868d5c1506","yearlyForStudents":"e29345ef-ab1c-4234-95c5-70e50fe6bc23","monthlyCad":"p52orjkaceei","yearlyCad":"h4q9g2up9ktt"},"braintreeDiscountId":{"oneMonthFree":"MONTHS_FREE_01","threeMonthsFree":"MONTHS_FREE_03","sixMonthsFree":"MONTHS_FREE_06","fiftyPercentOffOneYear":"FIFTY_PERCENT_OFF_ONE_YEAR"},"3DSecureVersion":"2","defaultCurrency":"usd","providerPlanIdCurrency":{"4ycw":"usd","rz3b":"usd","3kqm":"usd","jzw6":"usd","c2q2":"usd","nnsw":"usd","q8qw":"usd","d9y6":"usd","fx7w":"cad","nwf2":"cad"}},"paypalClientId":"AXj1G4fotC2GE8KzWX9mSxCH1wmPE3nJglf4Z2ig_amnhvlMVX87otaq58niAg9iuLktVNF_1WCMnN7v","paypal":{"host":"https:\u002F\u002Fapi.paypal.com:443","clientMode":"production","serverMode":"live","webhookId":"4G466076A0294510S","monthlyPlan":{"planId":"P-9WR0658853113943TMU5FDQA","name":"Medium Membership (Monthly) with setup fee","description":"Unlimited access to the best and brightest stories on Medium. Membership billed monthly."},"yearlyPlan":{"planId":"P-7N8963881P8875835MU5JOPQ","name":"Medium Membership (Annual) with setup fee","description":"Unlimited access to the best and brightest stories on Medium. Membership billed annually."},"oneYearGift":{"name":"Medium Membership (1 Year, Digital Gift Code)","description":"Unlimited access to the best and brightest stories on Medium. Gift codes can be redeemed at medium.com\u002Fredeem.","price":"50.00","currency":"USD","sku":"membership-gift-1-yr"},"oldMonthlyPlan":{"planId":"P-96U02458LM656772MJZUVH2Y","name":"Medium Membership (Monthly)","description":"Unlimited access to the best and brightest stories on Medium. Membership billed monthly."},"oldYearlyPlan":{"planId":"P-59P80963JF186412JJZU3SMI","name":"Medium Membership (Annual)","description":"Unlimited access to the best and brightest stories on Medium. Membership billed annually."},"monthlyPlanWithTrial":{"planId":"P-66C21969LR178604GJPVKUKY","name":"Medium Membership (Monthly) with setup fee","description":"Unlimited access to the best and brightest stories on Medium. Membership billed monthly."},"yearlyPlanWithTrial":{"planId":"P-6XW32684EX226940VKCT2MFA","name":"Medium Membership (Annual) with setup fee","description":"Unlimited access to the best and brightest stories on Medium. Membership billed annually."},"oldMonthlyPlanNoSetupFee":{"planId":"P-4N046520HR188054PCJC7LJI","name":"Medium Membership (Monthly)","description":"Unlimited access to the best and brightest stories on Medium. Membership billed monthly."},"oldYearlyPlanNoSetupFee":{"planId":"P-7A4913502Y5181304CJEJMXQ","name":"Medium Membership (Annual)","description":"Unlimited access to the best and brightest stories on Medium. Membership billed annually."},"sdkUrl":"https:\u002F\u002Fwww.paypal.com\u002Fsdk\u002Fjs"},"stripePublishableKey":"pk_live_7FReX44VnNIInZwrIIx6ghjl","log":{"json":true,"level":"info"},"imageUploadMaxSizeMb":25,"staffPicks":{"title":"Staff Picks","catalogId":"c7bc6e1ee00f"}},"session":{"xsrf":""}}</script><script>window.__APOLLO_STATE__ = {"ROOT_QUERY":{"__typename":"Query","viewer":null,"collectionByDomainOrSlug({\"domainOrSlug\":\"hcksyd.medium.com\"})":null,"postResult({\"id\":\"378b343216bf\"})":{"__ref":"Post:378b343216bf"}},"LinkedAccounts:bca54845b6":{"__typename":"LinkedAccounts","mastodon":null,"id":"bca54845b6"},"UserViewerEdge:userId:bca54845b6-viewerId:lo_4f545cc3ee09":{"__typename":"UserViewerEdge","id":"userId:bca54845b6-viewerId:lo_4f545cc3ee09","isFollowing":false,"isUser":false,"isMuting":false},"User:bca54845b6":{"__typename":"User","id":"bca54845b6","linkedAccounts":{"__ref":"LinkedAccounts:bca54845b6"},"isSuspended":false,"name":"Hack Sydney","imageId":"1*0al7KlH0A2FW1DLbW7xyqw.png","customDomainState":{"__typename":"CustomDomainState","live":{"__typename":"CustomDomain","domain":"hcksyd.medium.com"}},"hasSubdomain":true,"username":"hcksyd","verifications":{"__typename":"VerifiedInfo","isBookAuthor":false},"isPartnerProgramEnrolled":false,"viewerEdge":{"__ref":"UserViewerEdge:userId:bca54845b6-viewerId:lo_4f545cc3ee09"},"viewerIsUser":false,"newsletterV3":null,"socialStats":{"__typename":"SocialStats","followerCount":11,"followingCount":1,"collectionFollowingCount":0},"bio":"HackSydney is an inclusive, diverse and educational InfoSec Conferences in the APAC region.","membership":null,"allowNotes":true,"twitterScreenName":""},"Paragraph:3061cd05121_0":{"__typename":"Paragraph","id":"3061cd05121_0","name":"8bf9","type":"H3","href":null,"layout":null,"metadata":null,"text":"AsyncRAT: Analysing the Three Stages of Execution","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_1":{"__typename":"Paragraph","id":"3061cd05121_1","name":"d4b2","type":"P","href":null,"layout":null,"metadata":null,"text":"Michael Elford","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":0,"end":14,"href":"https:\u002F\u002Fwww.linkedin.com\u002Fin\u002Fmichael-elford-2a342b8a\u002F","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_2":{"__typename":"Paragraph","id":"3061cd05121_2","name":"565b","type":"PRE","href":null,"layout":null,"metadata":null,"text":"Michael is a cybersecurity professional that is passionate about \nmalware analysis and reverse engineering.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":{"__typename":"CodeBlockMetadata","mode":"DISABLED","lang":null},"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_3":{"__typename":"Paragraph","id":"3061cd05121_3","name":"cc70","type":"P","href":null,"layout":null,"metadata":null,"text":"In the second half of 2022, I led an investigation that involved a suspicious registry key, comprising a value that would run a potentially malicious executable file.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":0,"end":166,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_4":{"__typename":"Paragraph","id":"3061cd05121_4","name":"3f2c","type":"P","href":null,"layout":null,"metadata":null,"text":"Further analysis of the executable file resulted in confirmation of the file being malicious.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":0,"end":93,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_5":{"__typename":"Paragraph","id":"3061cd05121_5","name":"83de","type":"P","href":null,"layout":null,"metadata":null,"text":"In this blog post, I aim to share the findings from the investigation, with the goal of making the audience aware of the techniques that can be used to effectively analyse malware in general and specifically analyse ASyncRAT.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":0,"end":225,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_6":{"__typename":"Paragraph","id":"3061cd05121_6","name":"004e","type":"H3","href":null,"layout":null,"metadata":null,"text":"ASyncRAT Analysis","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_7":{"__typename":"Paragraph","id":"3061cd05121_7","name":"b1b5","type":"PRE","href":null,"layout":null,"metadata":null,"text":"Note: All malware analysis should be carried out in a sandboxed environment.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":{"__typename":"CodeBlockMetadata","mode":"DISABLED","lang":null},"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_8":{"__typename":"Paragraph","id":"3061cd05121_8","name":"6b3b","type":"H3","href":null,"layout":null,"metadata":null,"text":"Tools used","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_9":{"__typename":"Paragraph","id":"3061cd05121_9","name":"1c11","type":"P","href":null,"layout":null,"metadata":null,"text":"This is the list of tools that were used for this analysis:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_10":{"__typename":"Paragraph","id":"3061cd05121_10","name":"7668","type":"ULI","href":null,"layout":null,"metadata":null,"text":"FlareVM","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":0,"end":7,"href":"https:\u002F\u002Fwww.mandiant.com\u002Fresources\u002Fblog\u002Fflare-vm-the-windows-malware","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_11":{"__typename":"Paragraph","id":"3061cd05121_11","name":"8301","type":"ULI","href":null,"layout":null,"metadata":null,"text":"PEStudio","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":0,"end":8,"href":"https:\u002F\u002Fwww.winitor.com\u002F","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_12":{"__typename":"Paragraph","id":"3061cd05121_12","name":"f5f2","type":"ULI","href":null,"layout":null,"metadata":null,"text":"dnSpy","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":0,"end":5,"href":"https:\u002F\u002Fgithub.com\u002FdnSpy\u002FdnSpy","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_13":{"__typename":"Paragraph","id":"3061cd05121_13","name":"0bc7","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Cyberchef","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":0,"end":9,"href":"https:\u002F\u002Fgchq.github.io\u002FCyberChef\u002F","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_14":{"__typename":"Paragraph","id":"3061cd05121_14","name":"5485","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Garbage Man","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":0,"end":11,"href":"https:\u002F\u002Flabs.withsecure.com\u002Ftools\u002Fgarbageman","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_15":{"__typename":"Paragraph","id":"3061cd05121_15","name":"03a7","type":"H3","href":null,"layout":null,"metadata":null,"text":"Stage One","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_16":{"__typename":"Paragraph","id":"3061cd05121_16","name":"d20f","type":"P","href":null,"layout":null,"metadata":null,"text":"Starting the analysis of Stage One of the malware, the first step was to check the executable in PEStudio, which confirmed that we were dealing with a .NET file. Furthermore, we interpreted the fairly high entropy as indicative of malware packing, where malware adds complexity to stay undetected by security solutions.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":151,"end":155,"href":"https:\u002F\u002Fdotnet.microsoft.com\u002Fen-us\u002Flearn\u002Fdotnet\u002Fwhat-is-dotnet","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":201,"end":213,"href":"https:\u002F\u002Fpracticalsecurityanalytics.com\u002Ffile-entropy\u002F","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*z_Q9-TeUXUUQvxzJ":{"__typename":"ImageMetadata","id":"0*z_Q9-TeUXUUQvxzJ","originalHeight":457,"originalWidth":919,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:3061cd05121_17":{"__typename":"Paragraph","id":"3061cd05121_17","name":"3f89","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*z_Q9-TeUXUUQvxzJ"},"text":"PEstudio file overview","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_18":{"__typename":"Paragraph","id":"3061cd05121_18","name":"9c87","type":"P","href":null,"layout":null,"metadata":null,"text":"Our next step was to peruse the strings of the malware, and take note of anything strange we may want to look into a little bit deeper later on.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*kbuno4MBw0l9VV2q":{"__typename":"ImageMetadata","id":"0*kbuno4MBw0l9VV2q","originalHeight":663,"originalWidth":1450,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:3061cd05121_19":{"__typename":"Paragraph","id":"3061cd05121_19","name":"aafa","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*kbuno4MBw0l9VV2q"},"text":"PEstudio file overview","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_20":{"__typename":"Paragraph","id":"3061cd05121_20","name":"bc12","type":"P","href":null,"layout":null,"metadata":null,"text":"Examining the strings, we immediately identified some strings that appear to be obfuscated. As a note to ourselves, we highlighted that we may need to deploy a ‘find and replace’ later on.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":161,"end":177,"href":"https:\u002F\u002Fgchq.github.io\u002FCyberChef\u002F#recipe=Find_\u002F_Replace(%7B'option':'Regex','string':''%7D,'',true,false,true,false)","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":80,"end":90,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_21":{"__typename":"Paragraph","id":"3061cd05121_21","name":"8051","type":"H3","href":null,"layout":null,"metadata":null,"text":"Going Further","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_22":{"__typename":"Paragraph","id":"3061cd05121_22","name":"8707","type":"P","href":null,"layout":null,"metadata":null,"text":"After determining that the file was written in .NET and making note of the obfuscated strings, we then turned to dnSpy, a .NET debugger.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":113,"end":118,"href":"https:\u002F\u002Fgithub.com\u002FdnSpy\u002FdnSpy","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_23":{"__typename":"Paragraph","id":"3061cd05121_23","name":"ffea","type":"P","href":null,"layout":null,"metadata":null,"text":"One of the first things we noticed was a naming discrepancy. The name of the executable on the host and the name of the executable shown in dnSpy are completely different. The reason as to why the executable having a completely different name is of interest is due to many threat actors that use malware rename them so that they do not draw as much attention and can be hidden on the host and quietly run in the background so that even if the user does notice the something strange is going on with their system, they will skip over the file thinking that it is normal and doesn’t raise any alarms with the user and their AV.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_24":{"__typename":"Paragraph","id":"3061cd05121_24","name":"59a9","type":"P","href":null,"layout":null,"metadata":null,"text":"Looking through the code, there is a replace function for a string we had noted earlier. Now that we are certain about what is replacing the obfuscation pattern, we can check what those strings are, which could possibly give us a clue as to what is happening.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*aPbEP5FNvUx41G8M":{"__typename":"ImageMetadata","id":"0*aPbEP5FNvUx41G8M","originalHeight":243,"originalWidth":1010,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:3061cd05121_25":{"__typename":"Paragraph","id":"3061cd05121_25","name":"7552","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*aPbEP5FNvUx41G8M"},"text":"Executable name and replace function","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_26":{"__typename":"Paragraph","id":"3061cd05121_26","name":"3d7a","type":"H3","href":null,"layout":null,"metadata":null,"text":"Pulling on the Thread","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_27":{"__typename":"Paragraph","id":"3061cd05121_27","name":"c38e","type":"P","href":null,"layout":null,"metadata":null,"text":"For analysing the obfuscated strings, we used CyberChef. In CyberChef, we used the `Find\u002FReplace` feature to perform the replace function found in the code. This enabled us to see the clear text of what was obfuscated which resulted in getting a clearer understanding of what was going on within the code.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":46,"end":55,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":198,"end":202,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":289,"end":295,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_28":{"__typename":"Paragraph","id":"3061cd05121_28","name":"d6eb","type":"P","href":null,"layout":null,"metadata":null,"text":"The end-result of the above exercise gave us the de-obfuscated version of strings which contained “Load” and “Invoke”. This showed that something was going to be loaded and executed (“invoked”) by the code contained within the executable.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_29":{"__typename":"Paragraph","id":"3061cd05121_29","name":"0571","type":"P","href":null,"layout":null,"metadata":null,"text":"If at any time you are unsure what actions these methods perform, the best thing to do is Google around and find some docs. It may be time consuming at first but it is an important part of analysing malware.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":0,"end":207,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*phTNc9lZHTFYrPzY":{"__typename":"ImageMetadata","id":"0*phTNc9lZHTFYrPzY","originalHeight":549,"originalWidth":1600,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:3061cd05121_30":{"__typename":"Paragraph","id":"3061cd05121_30","name":"89eb","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*phTNc9lZHTFYrPzY"},"text":"De-obfuscated strings","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_31":{"__typename":"Paragraph","id":"3061cd05121_31","name":"fe6c","type":"P","href":null,"layout":null,"metadata":null,"text":"At this stage of the analysis, we had accumulated enough findings to start sketching out the trajectory of the malware’s execution flow. We had identified the malware was loading and executing something, and that the malware was packed and contained executable data that we would see in the next stage of analysis.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":193,"end":204,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_32":{"__typename":"Paragraph","id":"3061cd05121_32","name":"1a5d","type":"H3","href":null,"layout":null,"metadata":null,"text":"Hunting for the Hidden","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_33":{"__typename":"Paragraph","id":"3061cd05121_33","name":"2184","type":"P","href":null,"layout":null,"metadata":null,"text":"The tool Garbage Man is used for heap analysis — a technique that allows analysts to intervene and observe as the .NET malware is unraveling itself.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":9,"end":20,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_34":{"__typename":"Paragraph","id":"3061cd05121_34","name":"b104","type":"P","href":null,"layout":null,"metadata":null,"text":"Analysing the malware in Garbage Man aided in extraction of hidden data that composed the second executable within the first executable.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":90,"end":96,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":119,"end":124,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_35":{"__typename":"Paragraph","id":"3061cd05121_35","name":"bffb","type":"P","href":null,"layout":null,"metadata":null,"text":"In order to further analyse the malware, we executed the original malware found on the host in Garbage Man. To get started, we added in a delay of 300ms with 10 snapshots taken at 100ms intervals.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_36":{"__typename":"Paragraph","id":"3061cd05121_36","name":"5ff0","type":"P","href":null,"layout":null,"metadata":null,"text":"We added in the delay to allow time for the process to start running and added the extra snapshots and intervals so that we can compare the difference between the intervals if we need to.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_37":{"__typename":"Paragraph","id":"3061cd05121_37","name":"8f77","type":"P","href":null,"layout":null,"metadata":null,"text":"Once Garbage Man had executed the file, we had these options:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_38":{"__typename":"Paragraph","id":"3061cd05121_38","name":"3347","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Sift through the heap manually, and look at the strings and values that are contained within the executable","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_39":{"__typename":"Paragraph","id":"3061cd05121_39","name":"ce9e","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Use the search function to look through all the snapshots. Specifically looking for bytes that start with the value of MZ — which is the PE header for executables and dll files, and then order them by size in descending order. The search function gives us a list of results, and we can save the binaries with MZ headers and save them for further analysis.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":137,"end":146,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":119,"end":121,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*Tg41ed_eoJ9h1GAA":{"__typename":"ImageMetadata","id":"0*Tg41ed_eoJ9h1GAA","originalHeight":781,"originalWidth":1407,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:3061cd05121_40":{"__typename":"Paragraph","id":"3061cd05121_40","name":"9e62","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*Tg41ed_eoJ9h1GAA"},"text":"Using Garbage Man to search for executables and save the binary for analysis","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_41":{"__typename":"Paragraph","id":"3061cd05121_41","name":"f4a8","type":"P","href":null,"layout":null,"metadata":null,"text":"When saving the executable, we chose an executable with the large size value and due to us looking through all the snapshots we were getting repeats of the same executable, we could then save it as “stage2.exe”. We then pivoted back to PEstudio to check the file. On examination, our second hidden executable yet again turned out to be a .NET file.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*YHv0lc27Q0PEcU1s":{"__typename":"ImageMetadata","id":"0*YHv0lc27Q0PEcU1s","originalHeight":609,"originalWidth":1153,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:3061cd05121_42":{"__typename":"Paragraph","id":"3061cd05121_42","name":"5134","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*YHv0lc27Q0PEcU1s"},"text":"PEstudio of stage2.exe","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_43":{"__typename":"Paragraph","id":"3061cd05121_43","name":"eebc","type":"H3","href":null,"layout":null,"metadata":null,"text":"Stage Two","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_44":{"__typename":"Paragraph","id":"3061cd05121_44","name":"1d63","type":"P","href":null,"layout":null,"metadata":null,"text":"Delving into our stage2.exe, we found that checking its strings highlighted some noteworthy Win32 APIs that malware leverages. Some APIs that jumped out were connected with manipulating processes [T1055], specifically in this case, process hollowing [T1055.012] — an adversarial technique to create a paused, legitimate process then swap out its memory with malicious contents.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":92,"end":125,"href":"https:\u002F\u002Fmalapi.io\u002F","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":197,"end":202,"href":"https:\u002F\u002Fattack.mitre.org\u002Ftechniques\u002FT1055\u002F","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":251,"end":260,"href":"https:\u002F\u002Fattack.mitre.org\u002Ftechniques\u002FT1055\u002F012\u002F","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*5Uv_of4opkyLBrzF":{"__typename":"ImageMetadata","id":"0*5Uv_of4opkyLBrzF","originalHeight":661,"originalWidth":1253,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:3061cd05121_45":{"__typename":"Paragraph","id":"3061cd05121_45","name":"e6c2","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*5Uv_of4opkyLBrzF"},"text":"Some of the APIs and Strings that could indicate Process Hollowing","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_46":{"__typename":"Paragraph","id":"3061cd05121_46","name":"515e","type":"P","href":null,"layout":null,"metadata":null,"text":"As our stage two was in the .NET world again, we used dnSpy to dig a little deeper. When opening up the executable, we were met with a lot of information we had to get through. Like the first stage, the second stage’s naming convention was also suspicious.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":135,"end":138,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*144ZvaM1iuYgSqG6":{"__typename":"ImageMetadata","id":"0*144ZvaM1iuYgSqG6","originalHeight":635,"originalWidth":1140,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:3061cd05121_47":{"__typename":"Paragraph","id":"3061cd05121_47","name":"ee63","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*144ZvaM1iuYgSqG6"},"text":"Stage 2 dnSpy","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_48":{"__typename":"Paragraph","id":"3061cd05121_48","name":"d1c5","type":"P","href":null,"layout":null,"metadata":null,"text":"Examining dnSpy’s output, we discovered a section completely different to the other parts of the code due to it being obfuscated, and seemingly performing a function in memory — both of which are techniques used to evade detection [T1140].","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":232,"end":237,"href":"https:\u002F\u002Fattack.mitre.org\u002Ftechniques\u002FT1140\u002F","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*WpMoKx1v3_KKbbia":{"__typename":"ImageMetadata","id":"0*WpMoKx1v3_KKbbia","originalHeight":639,"originalWidth":1144,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:3061cd05121_49":{"__typename":"Paragraph","id":"3061cd05121_49","name":"f42e","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*WpMoKx1v3_KKbbia"},"text":"Obfuscated section in Stage 2","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_50":{"__typename":"Paragraph","id":"3061cd05121_50","name":"3878","type":"P","href":null,"layout":null,"metadata":null,"text":"We used Garbage Man once again to sneakily observe how the malware unraveled itself. However, if you want an alternate technique to de-obfuscating this part of the code, you can use de4dot which may also lay it out in an easier to read format.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":182,"end":188,"href":"https:\u002F\u002Fgithub.com\u002Fde4dot\u002Fde4dot","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_51":{"__typename":"Paragraph","id":"3061cd05121_51","name":"5887","type":"P","href":null,"layout":null,"metadata":null,"text":"Next, in Garbage Man the objective was to retrieve the third hidden stage. Our prior technique could be deployed here again, executing the binary and searching for the MZ headers.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":55,"end":60,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":55,"end":60,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_52":{"__typename":"Paragraph","id":"3061cd05121_52","name":"0df5","type":"P","href":null,"layout":null,"metadata":null,"text":"We found an executable and saved it as “stage3.exe”. We then packaged this up and shipped it to PEstudio (There is also information for procexp.sys contained in this but we are not going to focus on that at this time).","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"STRONG","start":96,"end":104,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*kSx0rBEXEoERxIsI":{"__typename":"ImageMetadata","id":"0*kSx0rBEXEoERxIsI","originalHeight":781,"originalWidth":1405,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:3061cd05121_53":{"__typename":"Paragraph","id":"3061cd05121_53","name":"b5ce","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*kSx0rBEXEoERxIsI"},"text":"Searching for MZ header in stage2.exe","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_54":{"__typename":"Paragraph","id":"3061cd05121_54","name":"d99e","type":"H3","href":null,"layout":null,"metadata":null,"text":"Stage Three","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_55":{"__typename":"Paragraph","id":"3061cd05121_55","name":"46fe","type":"P","href":null,"layout":null,"metadata":null,"text":"When checking the third stage executable in PEstudio we observed again it to be a .NET file and that it contained strings and APIs that suggested it was trying to make a network connection to an external source — like the API Send. This was a big hint that this was a Remote Access Trojan; I smell a RAT [​​TA0011]!","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":226,"end":230,"href":"https:\u002F\u002Fmalapi.io\u002Fwinapi\u002FSend","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":305,"end":313,"href":"https:\u002F\u002Fattack.mitre.org\u002Ftactics\u002FTA0011\u002F","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"STRONG","start":65,"end":70,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":65,"end":70,"href":null,"anchorType":null,"userId":null,"linkMetadata":null},{"__typename":"Markup","type":"EM","start":226,"end":230,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*ohA8YRyc6XuXrSMl":{"__typename":"ImageMetadata","id":"0*ohA8YRyc6XuXrSMl","originalHeight":662,"originalWidth":1249,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:3061cd05121_56":{"__typename":"Paragraph","id":"3061cd05121_56","name":"9917","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*ohA8YRyc6XuXrSMl"},"text":"APIs showing stage3 trying to connect to external sources","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_57":{"__typename":"Paragraph","id":"3061cd05121_57","name":"7d7d","type":"P","href":null,"layout":null,"metadata":null,"text":"After we had a quick look at stage three’s strings through PEstudio, we hopped back over to ol’ reliable dnSpy. Trawling through stage three, we identified that AES encryption was used to encode the port and IP\u002Fdomain that made up the adversary’s command-and-control (C2). We were for sure dealing with a RAT, and we wanted to gather the IoCs associated with this encryption.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*bwX2fLXRA7Irk_Cf":{"__typename":"ImageMetadata","id":"0*bwX2fLXRA7Irk_Cf","originalHeight":634,"originalWidth":1137,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:3061cd05121_58":{"__typename":"Paragraph","id":"3061cd05121_58","name":"c986","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*bwX2fLXRA7Irk_Cf"},"text":"AES encryption","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_59":{"__typename":"Paragraph","id":"3061cd05121_59","name":"a3fb","type":"P","href":null,"layout":null,"metadata":null,"text":"We set a breakpoint in dnSpy where the AES decryption was performed, and then run the debugger for this to find the decrypted string. Using a ‘stop-start’ technique with breakpoints in a debugger allows a malware analyst to halt the malware at opportune moments as it decodes or decrypts itself. This allows us to understand what the malware is doing as it is doing it.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*k8-6RpxNSO-ke30_":{"__typename":"ImageMetadata","id":"0*k8-6RpxNSO-ke30_","originalHeight":505,"originalWidth":1137,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:3061cd05121_60":{"__typename":"Paragraph","id":"3061cd05121_60","name":"968e","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*k8-6RpxNSO-ke30_"},"text":"dnSpy breakpoint","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_61":{"__typename":"Paragraph","id":"3061cd05121_61","name":"3cf0","type":"P","href":null,"layout":null,"metadata":null,"text":"When we got to our breakpoint it paused the malware’s execution. Now, we gingerly allowed the malware to progress one step at a time by using the step over button. We did this until eventually the malware began its decryption phase, and we were first gifted the ports used by this RAT.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"ImageMetadata:0*WfKkOyDXXc_zpg1A":{"__typename":"ImageMetadata","id":"0*WfKkOyDXXc_zpg1A","originalHeight":621,"originalWidth":1132,"focusPercentX":null,"focusPercentY":null,"alt":null},"Paragraph:3061cd05121_62":{"__typename":"Paragraph","id":"3061cd05121_62","name":"4fcd","type":"IMG","href":null,"layout":"INSET_CENTER","metadata":{"__ref":"ImageMetadata:0*WfKkOyDXXc_zpg1A"},"text":"Ports decrypted in dnSpy","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_63":{"__typename":"Paragraph","id":"3061cd05121_63","name":"1603","type":"P","href":null,"layout":null,"metadata":null,"text":"When we stepped over the different sections we were able to see that for this RAT it was using ports “6606, 7707, 8808” and, eventually we unraveled the RAT until it delivered us the adversarial server it reported back to: “109.206.241[.]84”.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_64":{"__typename":"Paragraph","id":"3061cd05121_64","name":"f77d","type":"H3","href":null,"layout":null,"metadata":null,"text":"Defending against RATs","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_65":{"__typename":"Paragraph","id":"3061cd05121_65","name":"5261","type":"P","href":null,"layout":null,"metadata":null,"text":"Our remediations will vary, but the first step is to recommend blocking this public IPv4 at the organisation firewall level so the RAT can no longer beacon out.","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_66":{"__typename":"Paragraph","id":"3061cd05121_66","name":"ffe7","type":"P","href":null,"layout":null,"metadata":null,"text":"The advice for defending against RATs is really advice for malware overall:","hasDropCap":null,"dropCapImage":null,"markups":[],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_67":{"__typename":"Paragraph","id":"3061cd05121_67","name":"952a","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Chief advice is to train staff to check what they are downloading. Whether it’s from an email attachment, or a site that promises to make their computer run faster if they run something, security awareness training is the best and first layer of defense we’d advise you prioritise.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":187,"end":214,"href":"https:\u002F\u002Fwww.huntress.com\u002Fplatform\u002Fsecurity-awareness-training","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_68":{"__typename":"Paragraph","id":"3061cd05121_68","name":"ca4e","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Leverage network telemetry to try and monitor for unexpected activity. Whether this is VPN, firewall, or more security-focused netflow, keeping an eye on in- and outbound traffic will help spot anomalous behaviour. Moreover, cultivating a well-maintained deny-list for new and emerging malicious addresses can only be a good thing.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":269,"end":305,"href":"https:\u002F\u002Ftwitter.com\u002Fcobaltstrikebot?ref_src=twsrc%5Egoogle%7Ctwcamp%5Eserp%7Ctwgr%5Eauthor","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_69":{"__typename":"Paragraph","id":"3061cd05121_69","name":"c85f","type":"ULI","href":null,"layout":null,"metadata":null,"text":"Good security tools are the perfect enemy of our adversaries. Deploy what works for your organisation, just please deploy something. A machine without any security solutions is a machine that presents an unmanageable, unacceptable risk to your business.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"EM","start":122,"end":131,"href":null,"anchorType":null,"userId":null,"linkMetadata":null}],"codeBlockMetadata":null,"iframe":null,"mixtapeMetadata":null},"Paragraph:3061cd05121_70":{"__typename":"Paragraph","id":"3061cd05121_70","name":"c68e","type":"PRE","href":null,"layout":null,"metadata":null,"text":"Big thanks to Matthew Brennan and Chad Hudson for help and guidance. \nHopefully this writeup has helped show examples of some good tools and \ntechniques that can be used to help decrypt and understand what is going on \nwith other .NET executables in the future.","hasDropCap":null,"dropCapImage":null,"markups":[{"__typename":"Markup","type":"A","start":14,"end":29,"href":"https:\u002F\u002Fwww.linkedin.com\u002Fin\u002Fmatthew-69b96bb9\u002F","anchorType":"LINK","userId":null,"linkMetadata":null},{"__typename":"Markup","type":"A","start":34,"end":45,"href":"https:\u002F\u002Fwww.linkedin.com\u002Fin\u002Fchadhudsoncybersec\u002F","anchorType":"LINK","userId":null,"linkMetadata":null}],"codeBlockMetadata":{"__typename":"CodeBlockMetadata","mode":"DISABLED","lang":null},"iframe":null,"mixtapeMetadata":null},"PostViewerEdge:postId:378b343216bf-viewerId:lo_4f545cc3ee09":{"__typename":"PostViewerEdge","shouldIndexPostForExternalSearch":false,"id":"postId:378b343216bf-viewerId:lo_4f545cc3ee09"},"Tag:hcksyd":{"__typename":"Tag","id":"hcksyd","displayTitle":"Hcksyd","normalizedTagSlug":"hcksyd"},"Tag:malware-analysis":{"__typename":"Tag","id":"malware-analysis","displayTitle":"Malware Analysis","normalizedTagSlug":"malware-analysis"},"Tag:reverse-engineering":{"__typename":"Tag","id":"reverse-engineering","displayTitle":"Reverse Engineering","normalizedTagSlug":"reverse-engineering"},"Tag:malware":{"__typename":"Tag","id":"malware","displayTitle":"Malware","normalizedTagSlug":"malware"},"Tag:cybersecurity":{"__typename":"Tag","id":"cybersecurity","displayTitle":"Cybersecurity","normalizedTagSlug":"cybersecurity"},"Post:378b343216bf":{"__typename":"Post","id":"378b343216bf","collection":null,"content({\"postMeteringOptions\":{\"referrer\":\"\"}})":{"__typename":"PostContent","isLockedPreviewOnly":false,"bodyModel":{"__typename":"RichText","sections":[{"__typename":"Section","name":"592b","startIndex":0,"textLayout":null,"imageLayout":null,"backgroundImage":null,"videoLayout":null,"backgroundVideo":null}],"paragraphs":[{"__ref":"Paragraph:3061cd05121_0"},{"__ref":"Paragraph:3061cd05121_1"},{"__ref":"Paragraph:3061cd05121_2"},{"__ref":"Paragraph:3061cd05121_3"},{"__ref":"Paragraph:3061cd05121_4"},{"__ref":"Paragraph:3061cd05121_5"},{"__ref":"Paragraph:3061cd05121_6"},{"__ref":"Paragraph:3061cd05121_7"},{"__ref":"Paragraph:3061cd05121_8"},{"__ref":"Paragraph:3061cd05121_9"},{"__ref":"Paragraph:3061cd05121_10"},{"__ref":"Paragraph:3061cd05121_11"},{"__ref":"Paragraph:3061cd05121_12"},{"__ref":"Paragraph:3061cd05121_13"},{"__ref":"Paragraph:3061cd05121_14"},{"__ref":"Paragraph:3061cd05121_15"},{"__ref":"Paragraph:3061cd05121_16"},{"__ref":"Paragraph:3061cd05121_17"},{"__ref":"Paragraph:3061cd05121_18"},{"__ref":"Paragraph:3061cd05121_19"},{"__ref":"Paragraph:3061cd05121_20"},{"__ref":"Paragraph:3061cd05121_21"},{"__ref":"Paragraph:3061cd05121_22"},{"__ref":"Paragraph:3061cd05121_23"},{"__ref":"Paragraph:3061cd05121_24"},{"__ref":"Paragraph:3061cd05121_25"},{"__ref":"Paragraph:3061cd05121_26"},{"__ref":"Paragraph:3061cd05121_27"},{"__ref":"Paragraph:3061cd05121_28"},{"__ref":"Paragraph:3061cd05121_29"},{"__ref":"Paragraph:3061cd05121_30"},{"__ref":"Paragraph:3061cd05121_31"},{"__ref":"Paragraph:3061cd05121_32"},{"__ref":"Paragraph:3061cd05121_33"},{"__ref":"Paragraph:3061cd05121_34"},{"__ref":"Paragraph:3061cd05121_35"},{"__ref":"Paragraph:3061cd05121_36"},{"__ref":"Paragraph:3061cd05121_37"},{"__ref":"Paragraph:3061cd05121_38"},{"__ref":"Paragraph:3061cd05121_39"},{"__ref":"Paragraph:3061cd05121_40"},{"__ref":"Paragraph:3061cd05121_41"},{"__ref":"Paragraph:3061cd05121_42"},{"__ref":"Paragraph:3061cd05121_43"},{"__ref":"Paragraph:3061cd05121_44"},{"__ref":"Paragraph:3061cd05121_45"},{"__ref":"Paragraph:3061cd05121_46"},{"__ref":"Paragraph:3061cd05121_47"},{"__ref":"Paragraph:3061cd05121_48"},{"__ref":"Paragraph:3061cd05121_49"},{"__ref":"Paragraph:3061cd05121_50"},{"__ref":"Paragraph:3061cd05121_51"},{"__ref":"Paragraph:3061cd05121_52"},{"__ref":"Paragraph:3061cd05121_53"},{"__ref":"Paragraph:3061cd05121_54"},{"__ref":"Paragraph:3061cd05121_55"},{"__ref":"Paragraph:3061cd05121_56"},{"__ref":"Paragraph:3061cd05121_57"},{"__ref":"Paragraph:3061cd05121_58"},{"__ref":"Paragraph:3061cd05121_59"},{"__ref":"Paragraph:3061cd05121_60"},{"__ref":"Paragraph:3061cd05121_61"},{"__ref":"Paragraph:3061cd05121_62"},{"__ref":"Paragraph:3061cd05121_63"},{"__ref":"Paragraph:3061cd05121_64"},{"__ref":"Paragraph:3061cd05121_65"},{"__ref":"Paragraph:3061cd05121_66"},{"__ref":"Paragraph:3061cd05121_67"},{"__ref":"Paragraph:3061cd05121_68"},{"__ref":"Paragraph:3061cd05121_69"},{"__ref":"Paragraph:3061cd05121_70"}]},"validatedShareKey":"","shareKeyCreator":null},"creator":{"__ref":"User:bca54845b6"},"inResponseToEntityType":null,"isLocked":false,"isMarkedPaywallOnly":false,"lockedSource":"LOCKED_POST_SOURCE_NONE","mediumUrl":"https:\u002F\u002Fhcksyd.medium.com\u002Fasyncrat-analysing-the-three-stages-of-execution-378b343216bf","primaryTopic":null,"topics":[{"__typename":"Topic","slug":"cybersecurity"}],"isLimitedState":false,"isPublished":true,"allowResponses":true,"responsesLocked":false,"visibility":"PUBLIC","latestPublishedVersion":"3061cd05121","postResponses":{"__typename":"PostResponses","count":1},"responseDistribution":"NOT_DISTRIBUTED","clapCount":13,"title":"AsyncRAT: Analysing the Three Stages of Execution","isSeries":false,"sequence":null,"uniqueSlug":"asyncrat-analysing-the-three-stages-of-execution-378b343216bf","socialTitle":"","socialDek":"","canonicalUrl":"","metaDescription":"","latestPublishedAt":1675817265674,"readingTime":7.770754716981132,"previewContent":{"__typename":"PreviewContent","subtitle":"Michael Elford"},"previewImage":{"__ref":"ImageMetadata:0*aPbEP5FNvUx41G8M"},"isShortform":false,"seoTitle":"","firstPublishedAt":1675817265674,"updatedAt":1675817267393,"shortformType":"SHORTFORM_TYPE_LINK","seoDescription":"","viewerEdge":{"__ref":"PostViewerEdge:postId:378b343216bf-viewerId:lo_4f545cc3ee09"},"isSuspended":false,"license":"ALL_RIGHTS_RESERVED","tags":[{"__ref":"Tag:hcksyd"},{"__ref":"Tag:malware-analysis"},{"__ref":"Tag:reverse-engineering"},{"__ref":"Tag:malware"},{"__ref":"Tag:cybersecurity"}],"isFeaturedInPublishedPublication":false,"isNewsletter":false,"statusForCollection":null,"pendingCollection":null,"detectedLanguage":"en","wordCount":1675,"layerCake":0}}</script><script>window.__MIDDLEWARE_STATE__={"session":{"xsrf":""},"cache":{"cacheStatus":"HIT"}}</script><script src="https://cdn-client.medium.com/lite/static/js/manifest.a44f4a79.js"></script><script src="https://cdn-client.medium.com/lite/static/js/4783.3b00fa4a.js"></script><script src="https://cdn-client.medium.com/lite/static/js/main.de67a363.js"></script><script src="https://cdn-client.medium.com/lite/static/js/instrumentation.5bef8967.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/reporting.ff22a7a5.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/3171.5b0ceee8.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/628.4b410354.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/6618.db187378.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/3338.0505d492.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/2707.eb2e5cbe.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/9977.99a9f653.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/7465.a415ed06.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/3624.bcb3363d.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/4737.630086cd.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/7381.c9cdb06e.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/6372.bd4511fe.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/7938.de1b2637.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/3862.2b70461b.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/9033.024b0e84.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/7753.614a20a3.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/4580.aee7d3b0.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/3623.5e2c9233.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/7979.15bcd496.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/7975.926bfc82.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/8664.b06e2cc0.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/4378.70f1ec77.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/6834.b00d87e5.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/144.907f5276.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/3666.cdb15b43.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/8236.60d8c8cb.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/1069.085d404a.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/3523.fa9419d4.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/PostPage.MainContent.65aae5d0.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/2698.a5c8f865.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/3974.6ff9e2e8.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/2527.a7fe9cdb.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/PostResponsesContent.bd906408.chunk.js"></script>
<script src="https://cdn-client.medium.com/lite/static/js/responses.editor.0e146708.chunk.js"></script><script>window.main();</script><script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9372e46a8a99f099',t:'MTc0NTgwNDg1Mi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script><script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"rayId":"9372e46a8a99f099","version":"2025.4.0-1-g37f21b1","serverTiming":{"name":{"cfExtPri":true,"cfL4":true,"cfSpeedBrain":true,"cfCacheStatus":true}},"token":"0b5f665943484354a59c39c6833f7078","b":1}' crossorigin="anonymous"></script>
</body></html>